<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte Parent ASIN: NaturaleBio Coconut Oil</title>
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Charts (CDN) -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .card { background: white; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); padding: 24px; transition: all 0.3s ease; }
        .card:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .tab-btn { transition: all 0.2s; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: #2563eb; border-bottom-color: #2563eb; font-weight: 600; }
        .chart-container { width: 100%; height: 350px; }
        .insight-card { border-left: 4px solid #2563eb; background: #eff6ff; padding: 16px; border-radius: 8px; margin-bottom: 12px; }
        .rec-card { border-left: 4px solid #10b981; background: #ecfdf5; padding: 16px; border-radius: 8px; margin-bottom: 12px; }
        .metric-value { font-size: 2rem; font-weight: 700; color: #111827; }
        .metric-label { color: #6b7280; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; }
        /* Comparador Table Styles */
        .comparison-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        .comparison-table th { text-align: left; padding: 12px; background: #f9fafb; border-bottom: 1px solid #e5e7eb; color: #6b7280; font-size: 0.875rem; }
        .comparison-table td { padding: 12px; border-bottom: 1px solid #f3f4f6; color: #1f2937; }
        .comparison-table tr:last-child td { border-bottom: none; }
        .badge { padding: 4px 8px; border-radius: 99px; font-size: 0.75rem; font-weight: 600; }
        .badge-our { background: #dbeafe; color: #1e40af; }
        .badge-comp { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <span class="material-icons text-blue-600">analytics</span>
                <h1 class="text-xl font-bold text-gray-900">Parent ASIN Intelligence: <span class="text-blue-600">NaturaleBio</span></h1>
            </div>
            <div class="flex space-x-4">
                <button onclick="switchTab('static')" id="btn-static" class="tab-btn active px-3 py-2 text-sm">Dashboard Estratégico</button>
                <button onclick="switchTab('interactive')" id="btn-interactive" class="tab-btn px-3 py-2 text-sm text-gray-500">Comparador Interactivo</button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- TAB 1: REPORT -->
        <div id="tab-static" class="space-y-8 animate-fade-in">
            
            <!-- Global KPIs -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="card">
                    <p class="metric-label">Share Total (Semana 01)</p>
                    <p class="metric-value text-blue-600">22.1%</p>
                    <p class="text-sm text-gray-500 mt-1 flex items-center">
                        <span class="material-icons text-gray-400 text-sm mr-1">remove</span> Stable vs W52
                    </p>
                </div>
                <div class="card">
                    <p class="metric-label">Top Competidor</p>
                    <p class="metric-value text-gray-800">19.0%</p>
                    <p class="text-sm text-gray-500 mt-1">by Amazon</p>
                </div>
                <div class="card">
                    <p class="metric-label">Eficiencia (Rank 1)</p>
                    <p class="metric-value text-green-600">High</p>
                    <p class="text-sm text-gray-500 mt-1">ASIN 200ml (13.5% Share)</p>
                </div>
                <div class="card">
                    <p class="metric-label">Tendencia Mercado</p>
                    <p class="metric-value text-red-500">-35%</p>
                    <p class="text-sm text-gray-500 mt-1">Vol. Búsqueda Post-Xmas</p>
                </div>
            </div>

            <!-- Section 1: Tendencia Global -->
            <div class="card">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-bold text-gray-900 flex items-center">
                        <span class="material-icons mr-2 text-blue-500">show_chart</span>
                        1. Tendencia Global del Parent (Volumen vs Share)
                    </h2>
                </div>
                <div id="trend_chart" class="chart-container"></div>
                <div class="mt-4 text-sm text-gray-600 bg-gray-50 p-4 rounded-lg">
                    <strong>Análisis:</strong> El mercado sufrió una contracción severa del 35% en volumen de búsqueda tras la Navidad (W52 vs W01). Sin embargo, <strong>NaturaleBio mantuvo su cuota de mercado (~22.1%)</strong>, lo que indica una base de clientes leal o un posicionamiento orgánico resiliente frente a la caída de demanda estacional.
                </div>
            </div>

            <!-- Section 2: Competitividad -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="card">
                    <h2 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                        <span class="material-icons mr-2 text-purple-500">people_outline</span>
                        2. Competitividad de Marca (Share %)
                    </h2>
                    <div id="competitiveness_chart" class="chart-container"></div>
                </div>
                <div class="card">
                    <h2 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                        <span class="material-icons mr-2 text-green-500">scatter_plot</span>
                        4. Eficiencia (Rank vs Click Share)
                    </h2>
                    <div id="efficiency_chart" class="chart-container"></div>
                </div>
            </div>

            <!-- Insights Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                
                <!-- Section 3 & 5: Insights & Levers -->
                <div class="card">
                    <h2 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                        <span class="material-icons mr-2 text-amber-500">lightbulb</span>
                        5. Insights Clave y Causas
                    </h2>
                    
                    <div class="insight-card">
                        <h3 class="font-bold text-blue-900 text-sm mb-1">Resiliencia ante la caída de demanda</h3>
                        <p class="text-sm text-blue-800">A pesar de que el tráfico general cayó un 35% en Enero, NaturaleBio defendió exitosamente su cuota del 22%. Esto sugiere que la marca no depende excesivamente de tráfico promocional navideño.</p>
                    </div>

                    <div class="insight-card">
                        <h3 class="font-bold text-blue-900 text-sm mb-1">Dominio del formato pequeño (200ml)</h3>
                        <p class="text-sm text-blue-800">El ASIN de 200ml es el "Hero Product" con Rank #1 y 13.5% de share. Su eficiencia es máxima. Supera a competidores de bajo coste como "Eco nature" gracias al posicionamiento orgánico superior.</p>
                    </div>

                    <div class="insight-card">
                        <h3 class="font-bold text-blue-900 text-sm mb-1">Amenaza: "by Amazon" y Cupones</h3>
                        <p class="text-sm text-blue-800">El competidor "by Amazon" mantiene un fuerte 19% de share. En W52 usó cupones agresivos (7 días). En W01 redujo intensidad, pero mantiene la etiqueta 'Amazon Choice' en 3 días. Es el rival más peligroso por visibilidad.</p>
                    </div>

                    <div class="insight-card">
                        <h3 class="font-bold text-blue-900 text-sm mb-1">Precio vs Share</h3>
                        <p class="text-sm text-blue-800">"Eco nature" compite por precio (4.50€ vs nuestros 8.99€ en 200ml), capturando un 8.6% del mercado. Sin embargo, no logran destronar nuestro Rank #1, indicando que el cliente valora la calidad o marca de NaturaleBio sobre el precio puro.</p>
                    </div>

                    <div class="insight-card">
                        <h3 class="font-bold text-blue-900 text-sm mb-1">Eficiencia Orgánica</h3>
                        <p class="text-sm text-blue-800">Nuestros ASINs grandes (500ml/1L) tienen Rank 6, generando ~4-5% de share. Tienen espacio de mejora si logran subir al Top 3, donde la elasticidad de clics se dispara.</p>
                    </div>
                </div>

                <!-- Recommendations -->
                <div class="card bg-gray-50 border-gray-200">
                    <h2 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                        <span class="material-icons mr-2 text-green-600">check_circle</span>
                        Recomendaciones Accionables
                    </h2>

                    <div class="rec-card">
                        <div class="flex items-start">
                            <span class="material-icons text-green-600 mr-2 mt-0.5">trending_up</span>
                            <div>
                                <h3 class="font-bold text-green-900 text-sm">Blindar el ASIN 200ml (Defensa)</h3>
                                <p class="text-sm text-green-800 mt-1">Mantener stock absoluto. Dado que "Eco nature" ataca con precio (4.50€), considerar un cupón defensivo puntual del 5-10% solo si su Rank mejora, para no erosionar margen innecesariamente mientras mantengamos el Rank #1.</p>
                            </div>
                        </div>
                    </div>

                    <div class="rec-card">
                        <div class="flex items-start">
                            <span class="material-icons text-green-600 mr-2 mt-0.5">ads_click</span>
                            <div>
                                <h3 class="font-bold text-green-900 text-sm">Contraataque a "by Amazon" (Ataque)</h3>
                                <p class="text-sm text-green-800 mt-1">Aprovechar que "by Amazon" ha reducido sus días de cupones en la semana 01. Es el momento ideal para lanzar una campaña agresiva de Sponsored Products o un Deal Flash en los formatos de 500ml/1L para intentar robarles cuota mientras están "dormidos".</p>
                            </div>
                        </div>
                    </div>

                    <div class="rec-card">
                        <div class="flex items-start">
                            <span class="material-icons text-green-600 mr-2 mt-0.5">manage_search</span>
                            <div>
                                <h3 class="font-bold text-green-900 text-sm">Optimización SEO Formatos Grandes</h3>
                                <p class="text-sm text-green-800 mt-1">Los formatos de 500ml y 1L están estancados en Rank 6. Revisar keywords de backend y contenido A+ comparativo para justificar el precio vs competidores y subir al Top 3 orgánico.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other Insights -->
            <div class="card">
                <h2 class="text-lg font-bold text-gray-900 mb-2">Other Insights (Observaciones Adicionales)</h2>
                <p class="text-sm text-gray-600">
                    Se detectó la aparición de <strong>"Monte Nativo"</strong> en la semana 01 con un 1.5% de share. Aunque pequeño, su precio es alto (17.95€). Monitorizar si aumenta rank, ya que podría indicar un competidor premium emergente. Además, la categoría muestra una alta sensibilidad a badges de "Amazon Choice": los ASINs que lo pierden ven caídas inmediatas de eficiencia.
                </p>
            </div>
        </div>

        <!-- TAB 2: INTERACTIVE TOOL -->
        <div id="tab-interactive" class="hidden space-y-6">
            <div class="card">
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
                    <div>
                        <h2 class="text-lg font-bold text-gray-900">Comparador Cara a Cara</h2>
                        <p class="text-sm text-gray-500">Analiza métricas detalladas por semana y competidor.</p>
                    </div>
                    <div class="flex space-x-4">
                        <select id="week-selector" onchange="updateComparison()" class="block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm border bg-white">
                            <!-- Populated by JS -->
                        </select>
                        <select id="competitor-selector" onchange="updateComparison()" class="block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm border bg-white">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                </div>

                <div id="comparison-content" class="overflow-x-auto">
                    <!-- Table populated by JS -->
                </div>
            </div>
        </div>

    </main>

    <script type="text/javascript">
        // ---------------------------------------------------------
        // 1. DATA INJECTION
        // ---------------------------------------------------------
        const marketData = [{"week": "2026-01", "brand": "NaturaleBio", "is_yaba": "Y", "asin": "B01JA3S1F8", "title": "NaturaleBio Olio di Cocco Biologico Vergine 500 ml...", "price": 13.99, "rank": 6.0, "click_share": 4.11, "clicks": 210.89, "deal_days": 0, "coupon_days": 0, "choice_days": 0, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2025-52", "brand": "NaturaleBio", "is_yaba": "Y", "asin": "B01JA3S1F8", "title": "NaturaleBio Olio di Cocco Biologico Vergine 500 ml...", "price": 13.99, "rank": 5.0, "click_share": 6.12, "clicks": 485.52, "deal_days": 0, "coupon_days": 0, "choice_days": 0, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2026-01", "brand": "NaturaleBio", "is_yaba": "Y", "asin": "B01JIB2T32", "title": "NaturaleBio Olio di Cocco Biologico Vergine 1000 m...", "price": 19.49, "rank": 6.0, "click_share": 4.52, "clicks": 231.93, "deal_days": 0, "coupon_days": 0, "choice_days": 0, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2025-52", "brand": "NaturaleBio", "is_yaba": "Y", "asin": "B01JIB2T32", "title": "NaturaleBio Olio di Cocco Biologico Vergine 1000 m...", "price": 19.49, "rank": 6.0, "click_share": 4.8, "clicks": 380.8, "deal_days": 0, "coupon_days": 0, "choice_days": 0, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2025-52", "brand": "NaturaleBio", "is_yaba": "Y", "asin": "B01M0LGD6A", "title": "NaturaleBio Organic Virgin Coconut Oil 200 ml. Raw...", "price": 8.99, "rank": 1.0, "click_share": 11.25, "clicks": 892.49, "deal_days": 0, "coupon_days": 0, "choice_days": 1, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2026-01", "brand": "NaturaleBio", "is_yaba": "Y", "asin": "B01M0LGD6A", "title": "NaturaleBio Organic Virgin Coconut Oil 200 ml. Raw...", "price": 8.99, "rank": 1.0, "click_share": 13.51, "clicks": 693.22, "deal_days": 0, "coupon_days": 0, "choice_days": 1, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2025-52", "brand": "CocoNativo", "is_yaba": "N", "asin": "B073P974FR", "title": "CocoNativo Biologico Extra Vergine Olio di Cocco, ...", "price": 18.95, "rank": 8.0, "click_share": 6.22, "clicks": 493.45, "deal_days": 0, "coupon_days": 0, "choice_days": 0, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2026-01", "brand": "CocoNativo", "is_yaba": "N", "asin": "B073P974FR", "title": "CocoNativo Biologico Extra Vergine Olio di Cocco, ...", "price": 18.95, "rank": 9.0, "click_share": 6.62, "clicks": 339.68, "deal_days": 0, "coupon_days": 0, "choice_days": 0, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2026-01", "brand": "Monte Nativo", "is_yaba": "N", "asin": "B07TMGBPL7", "title": "Olio di Cocco Biologico Extra Vergin Monte Nativo ...", "price": 17.95, "rank": 14.0, "click_share": 1.52, "clicks": 77.99, "deal_days": 0, "coupon_days": 0, "choice_days": 0, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2026-01", "brand": "Eco nature", "is_yaba": "N", "asin": "B08HK4YWGH", "title": "Eco nature, Olio di cocco bio, 200g", "price": 4.5, "rank": 3.0, "click_share": 8.67, "clicks": 444.87, "deal_days": 0, "coupon_days": 0, "choice_days": 0, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2025-52", "brand": "Eco nature", "is_yaba": "N", "asin": "B08HK4YWGH", "title": "Eco nature, Olio di cocco bio, 200g", "price": 4.5, "rank": 4.0, "click_share": 8.81, "clicks": 698.92, "deal_days": 0, "coupon_days": 0, "choice_days": 0, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2025-52", "brand": "Crudolio", "is_yaba": "N", "asin": "B09G757HB2", "title": "CRUDOLIO - Olio Di Cocco Vergine Bio 200ml. | Spre...", "price": 7.99, "rank": 11.0, "click_share": 2.34, "clicks": 185.64, "deal_days": 0, "coupon_days": 0, "choice_days": 0, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2025-52", "brand": "BENVOLIO", "is_yaba": "N", "asin": "B0CH11HMCS", "title": "BENVOLIO - Olio di Cocco Biologico Deodorato | 950...", "price": 10.9, "rank": 7.0, "click_share": 4.23, "clicks": 335.58, "deal_days": 0, "coupon_days": 0, "choice_days": 0, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2026-01", "brand": "BENVOLIO", "is_yaba": "N", "asin": "B0CH11HMCS", "title": "BENVOLIO - Olio di Cocco Biologico Deodorato | 950...", "price": 10.9, "rank": 7.0, "click_share": 4.26, "clicks": 218.59, "deal_days": 0, "coupon_days": 0, "choice_days": 0, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2025-52", "brand": "Plan\u00e8te au Naturel", "is_yaba": "N", "asin": "B0D6S1L6PL", "title": "Olio di Cocco Bio 150 ml - Plan\u00e8te au Naturel - Cr...", "price": 5.9, "rank": 4.0, "click_share": 7.55, "clicks": 598.96, "deal_days": 0, "coupon_days": 0, "choice_days": 0, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2026-01", "brand": "Plan\u00e8te au Naturel", "is_yaba": "N", "asin": "B0D6S1L6PL", "title": "Olio di Cocco Bio 150 ml - Plan\u00e8te au Naturel - Cr...", "price": 5.9, "rank": 4.0, "click_share": 7.29, "clicks": 374.06, "deal_days": 0, "coupon_days": 0, "choice_days": 0, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2025-52", "brand": "Pipkin", "is_yaba": "N", "asin": "B0FVM32PSK", "title": "Pipkin Olio di Cocco 100% Biologico e Puro 1L \u2013 Na...", "price": 14.99, "rank": 9.0, "click_share": 2.54, "clicks": 201.51, "deal_days": 0, "coupon_days": 0, "choice_days": 0, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2026-01", "brand": "Pipkin", "is_yaba": "N", "asin": "B0FVM32PSK", "title": "Pipkin Olio di Cocco 100% Biologico e Puro 1L \u2013 Na...", "price": 14.99, "rank": 9.0, "click_share": 2.87, "clicks": 147.26, "deal_days": 0, "coupon_days": 0, "choice_days": 0, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2026-01", "brand": "by Amazon", "is_yaba": "N", "asin": "B07W8PPQQM", "title": "by Amazon - Olio di cocco vergine biologico, 950 m...", "price": 13.33, "rank": 2.0, "click_share": 18.98, "clicks": 973.9, "deal_days": 0, "coupon_days": 1, "choice_days": 3, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}, {"week": "2025-52", "brand": "by Amazon", "is_yaba": "N", "asin": "B07W8PPQQM", "title": "by Amazon - Olio di cocco vergine biologico, 950 m...", "price": 13.312857143, "rank": 2.0, "click_share": 19.28, "clicks": 1529.54, "deal_days": 0, "coupon_days": 7, "choice_days": 7, "best_seller_days": 0, "link": "https://www.amazon.it/s?k=olio+di+cocco"}];

        // ---------------------------------------------------------
        // 2. SETUP GOOGLE CHARTS
        // ---------------------------------------------------------
        google.charts.load('current', {'packages':['corechart', 'line', 'table']});
        google.charts.setOnLoadCallback(initDashboard);

        // Helper to get unique values
        const getUnique = (arr, key) => [...new Set(arr.map(item => item[key]))].sort();

        // Constants
        const ourBrand = "NaturaleBio";
        const weeks = getUnique(marketData, 'week');
        const competitors = getUnique(marketData.filter(d => d.brand !== ourBrand), 'brand');
        
        // ---------------------------------------------------------
        // 3. MAIN RENDER FUNCTION
        // ---------------------------------------------------------
        function initDashboard() {
            renderTrendChart();
            renderCompetitivenessChart();
            renderEfficiencyChart();
            populateComparisonTools();
            updateComparison();
        }

        function renderTrendChart() {
            // Aggregate Clicks and Share by Week for 'NaturaleBio' vs 'Competitors'
            const dataMap = {};
            
            marketData.forEach(d => {
                if (!dataMap[d.week]) dataMap[d.week] = { week: d.week, ourClicks: 0, compClicks: 0, ourShare: 0 };
                if (d.brand === ourBrand) {
                    dataMap[d.week].ourClicks += d.clicks;
                    dataMap[d.week].ourShare += d.click_share;
                } else {
                    dataMap[d.week].compClicks += d.clicks;
                }
            });

            const chartData = [['Week', 'NaturaleBio Clicks', 'Market Clicks', 'NaturaleBio Share %']];
            Object.values(dataMap).sort((a,b) => a.week.localeCompare(b.week)).forEach(r => {
                chartData.push([r.week, r.ourClicks, r.compClicks, r.ourShare]);
            });

            const data = google.visualization.arrayToDataTable(chartData);
            const options = {
                vAxis: {title: 'Clicks'},
                hAxis: {title: 'Week'},
                seriesType: 'bars',
                series: {2: {type: 'line', targetAxisIndex: 1, color: '#2563eb', lineWidth: 3}},
                colors: ['#3b82f6', '#d1d5db'], // Blue for us, Gray for market
                legend: { position: 'bottom' },
                animation: { startup: true, duration: 1000, easing: 'out' }
            };

            const chart = new google.visualization.ComboChart(document.getElementById('trend_chart'));
            chart.draw(data, options);
        }

        function renderCompetitivenessChart() {
            // Compare Our Brand vs Top 3 Competitors over weeks
            const topCompetitors = ["by Amazon", "Eco nature", "Planète au Naturel"]; // Derived from python analysis
            const brandsToChart = [ourBrand, ...topCompetitors];
            
            // Prepare Data Structure: Week | Our Brand | Comp 1 | Comp 2 | Comp 3
            const header = ['Week', ourBrand, ...topCompetitors];
            const rows = {};

            weeks.forEach(w => {
                rows[w] = { week: w };
                brandsToChart.forEach(b => rows[w][b] = 0);
            });

            marketData.forEach(d => {
                if (brandsToChart.includes(d.brand)) {
                    rows[d.week][d.brand] += d.click_share;
                }
            });

            const chartData = [header];
            Object.values(rows).sort((a,b) => a.week.localeCompare(b.week)).forEach(r => {
                chartData.push([r.week, r[ourBrand], r[topCompetitors[0]], r[topCompetitors[1]], r[topCompetitors[2]]]);
            });

            const data = google.visualization.arrayToDataTable(chartData);
            const options = {
                curveType: 'function',
                legend: { position: 'bottom' },
                colors: ['#2563eb', '#ef4444', '#f59e0b', '#10b981'], // Blue (Us), Red, Amber, Green
                vAxis: { title: 'Click Share (%)' },
                pointSize: 5
            };

            const chart = new google.visualization.LineChart(document.getElementById('competitiveness_chart'));
            chart.draw(data, options);
        }

        function renderEfficiencyChart() {
            // Scatter Plot: X=Rank, Y=Share. Color=Brand Type (Us vs Them)
            // Filter only last week for clarity
            const lastWeek = weeks[weeks.length - 1];
            const currentData = marketData.filter(d => d.week === lastWeek);

            const chartData = [['ID', 'Rank', 'Share', 'Brand', 'Size']];
            currentData.forEach(d => {
                const type = d.brand === ourBrand ? 'NaturaleBio' : 'Competitor';
                // Tooltip logic hack in ID or custom tooltip (keeping simple for strict mode)
                // Size dummy 1
                chartData.push([d.brand + ' (' + d.asin.slice(-4) + ')', d.rank, d.click_share, type, 5]);
            });

            const data = google.visualization.arrayToDataTable(chartData);
            const options = {
                title: 'Semana Actual: Rank vs Share',
                hAxis: { title: 'Organic Rank (Lower is Better)', direction: 1 }, // Rank 1 is left usually, but charts go 0->100. Rank 1 is "good".
                vAxis: { title: 'Click Share (%)' },
                legend: { position: 'bottom' },
                colors: ['#9ca3af', '#2563eb'], // Grey for Competitor, Blue for Us (Alphabetical order of series usually)
                // Note: Google colors assign by unique value in 4th col. 'Competitor' comes before 'NaturaleBio'
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('efficiency_chart'));
            chart.draw(data, options);
        }

        // ---------------------------------------------------------
        // 4. INTERACTIVE TOOL LOGIC
        // ---------------------------------------------------------
        function populateComparisonTools() {
            const weekSel = document.getElementById('week-selector');
            const compSel = document.getElementById('competitor-selector');

            // Weeks reverse order
            [...weeks].reverse().forEach(w => {
                const opt = document.createElement('option');
                opt.value = w;
                opt.innerText = w;
                weekSel.appendChild(opt);
            });

            // Competitors
            competitors.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.innerText = c;
                compSel.appendChild(opt);
            });
            
            // Set default competitor to top 1
            compSel.value = "by Amazon";
        }

        function updateComparison() {
            const week = document.getElementById('week-selector').value;
            const competitor = document.getElementById('competitor-selector').value;
            const container = document.getElementById('comparison-content');

            // Get Data
            const ourASINs = marketData.filter(d => d.week === week && d.brand === ourBrand);
            const compASINs = marketData.filter(d => d.week === week && d.brand === competitor);

            let html = `
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>ASIN / Título</th>
                            <th>Precio</th>
                            <th>Rank</th>
                            <th>Share</th>
                            <th>Badges</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            // Helper for rows
            const renderRow = (d, isUs) => `
                <tr class="${isUs ? 'bg-blue-50' : 'bg-white'}">
                    <td>
                        <span class="badge ${isUs ? 'badge-our' : 'badge-comp'} mb-1 inline-block">${isUs ? 'NaturaleBio' : d.brand}</span><br>
                        <a href="${d.link}" target="_blank" class="font-medium text-blue-600 hover:underline text-sm truncate block w-64">${d.title.substring(0, 40)}...</a>
                        <span class="text-xs text-gray-400">${d.asin}</span>
                    </td>
                    <td class="font-bold">${d.price.toFixed(2)}€</td>
                    <td>${d.rank}</td>
                    <td>
                        <div class="flex items-center">
                            <span class="mr-2 font-bold">${d.click_share}%</span>
                            <div class="w-16 h-2 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full ${isUs ? 'bg-blue-500' : 'bg-red-500'}" style="width: ${Math.min(d.click_share * 5, 100)}%"></div>
                            </div>
                        </div>
                    </td>
                    <td>
                        ${d.choice_days > 0 ? '<span class="material-icons text-yellow-500 text-sm" title="Amazon Choice">verified</span>' : ''}
                        ${d.coupon_days > 0 ? '<span class="material-icons text-green-500 text-sm" title="Coupon">local_offer</span>' : ''}
                        ${d.deal_days > 0 ? '<span class="material-icons text-red-500 text-sm" title="Deal">bolt</span>' : ''}
                        ${d.best_seller_days > 0 ? '<span class="material-icons text-orange-500 text-sm" title="Best Seller">emoji_events</span>' : ''}
                        ${(d.choice_days===0 && d.coupon_days===0 && d.deal_days===0) ? '<span class="text-gray-400 text-xs">-</span>' : ''}
                    </td>
                </tr>
            `;

            ourASINs.forEach(d => html += renderRow(d, true));
            compASINs.forEach(d => html += renderRow(d, false));

            html += '</tbody></table>';
            
            if(ourASINs.length === 0 && compASINs.length === 0) {
                html = '<div class="p-8 text-center text-gray-500">No hay datos para esta combinación de semana/competidor.</div>';
            }

            container.innerHTML = html;
        }

        // ---------------------------------------------------------
        // 5. UI UTILS
        // ---------------------------------------------------------
        function switchTab(tabName) {
            document.getElementById('tab-static').classList.add('hidden');
            document.getElementById('tab-interactive').classList.add('hidden');
            document.getElementById('btn-static').classList.remove('active', 'text-blue-600', 'border-blue-600');
            document.getElementById('btn-interactive').classList.remove('active', 'text-blue-600', 'border-blue-600');
            
            // Add inactive classes
            document.getElementById('btn-static').classList.add('text-gray-500');
            document.getElementById('btn-interactive').classList.add('text-gray-500');

            document.getElementById('tab-' + tabName).classList.remove('hidden');
            const activeBtn = document.getElementById('btn-' + tabName);
            activeBtn.classList.add('active', 'text-blue-600');
            activeBtn.classList.remove('text-gray-500');
        }

        // Handle Resize
        window.addEventListener('resize', () => {
            initDashboard();
        });

    </script>
</body>
</html>