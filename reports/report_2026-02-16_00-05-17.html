<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parent ASIN Performance: MATCHA DNA</title>
    <!-- Google Charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        :root {
            --primary: #4285F4;
            --primary-light: #e8f0fe;
            --success: #34A853;
            --success-light: #e6f4ea;
            --warning: #FBBC05;
            --danger: #EA4335;
            --gray-bg: #F0F2F5;
            --card-bg: #FFFFFF;
            --text-main: #202124;
            --text-sec: #5F6368;
            --border: #DADCE0;
            --competitor-1: #EA4335;
            --competitor-2: #FBBC05;
            --competitor-3: #AA00FF;
            --others: #9AA0A6;
        }
        
        body { font-family: 'Inter', sans-serif; background: var(--gray-bg); color: var(--text-main); margin: 0; padding: 20px; line-height: 1.5; }
        .container { max-width: 1200px; margin: 0 auto; }
        
        /* Header */
        .header { background: var(--card-bg); padding: 20px 24px; border-radius: 16px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; }
        .header-title h1 { margin: 0; font-size: 24px; font-weight: 700; color: var(--text-main); }
        .header-title p { margin: 4px 0 0; color: var(--text-sec); font-size: 14px; }
        .brand-badge { background: var(--primary-light); color: var(--primary); padding: 4px 12px; border-radius: 12px; font-weight: 600; font-size: 13px; display: inline-flex; align-items: center; gap: 4px; }
        
        /* Navigation Tabs */
        .tabs { display: flex; gap: 8px; margin-bottom: 24px; background: #e0e0e0; padding: 4px; border-radius: 12px; width: fit-content; }
        .tab-btn { padding: 10px 24px; border-radius: 10px; border: none; background: transparent; cursor: pointer; font-weight: 600; font-size: 14px; color: var(--text-sec); transition: all 0.2s; }
        .tab-btn:hover { background: rgba(255,255,255,0.5); }
        .tab-btn.active { background: var(--card-bg); color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        
        /* Content Sections */
        .section-title { font-size: 18px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .card { background: var(--card-bg); border-radius: 16px; padding: 24px; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        
        /* Metrics Grid */
        .metric-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .metric-box { padding: 20px; border-radius: 12px; border: 1px solid var(--border); display: flex; flex-direction: column; }
        .metric-title { font-size: 13px; color: var(--text-sec); font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; }
        .metric-val { font-size: 28px; font-weight: 700; color: var(--text-main); margin: 8px 0; }
        .metric-trend { font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 4px; }
        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }
        .trend-neutral { color: var(--text-sec); }
        
        /* Charts */
        .chart-box { min-height: 400px; width: 100%; }
        
        /* Insights List */
        .insight-list { list-style: none; padding: 0; margin: 0; }
        .insight-item { display: flex; gap: 16px; padding: 16px; border-bottom: 1px solid var(--border); align-items: flex-start; }
        .insight-item:last-child { border-bottom: none; }
        .insight-icon { background: var(--primary-light); color: var(--primary); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .insight-content h4 { margin: 0 0 4px; font-size: 15px; font-weight: 600; }
        .insight-content p { margin: 0; font-size: 14px; color: var(--text-sec); line-height: 1.4; }
        
        /* Recommendations */
        .rec-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; }
        .rec-card { background: #f8f9fa; border-radius: 12px; padding: 16px; border-left: 4px solid var(--success); }
        .rec-title { font-weight: 600; font-size: 15px; margin-bottom: 8px; color: var(--text-main); }
        .rec-desc { font-size: 13px; color: var(--text-sec); }
        
        /* Interactive Controls */
        .controls-bar { background: #f8f9fa; padding: 16px; border-radius: 12px; display: flex; gap: 16px; margin-bottom: 20px; align-items: center; flex-wrap: wrap; }
        .control-group { display: flex; flex-direction: column; gap: 6px; }
        .control-label { font-size: 12px; font-weight: 600; color: var(--text-sec); text-transform: uppercase; }
        .custom-select { padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border); font-size: 14px; min-width: 150px; outline: none; background: white; }
        
        /* Table */
        .data-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .data-table th { text-align: left; padding: 12px 16px; color: var(--text-sec); font-weight: 500; border-bottom: 1px solid var(--border); background: #fcfcfc; }
        .data-table td { padding: 12px 16px; border-bottom: 1px solid var(--border); vertical-align: middle; }
        .data-table tr:last-child td { border-bottom: none; }
        .rank-badge { background: #E0E0E0; width: 24px; height: 24px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; }
        .top-rank { background: #FFF8E1; color: #F57F17; border: 1px solid #FFECB3; }

        .hidden { display: none !important; }
        
        @media (max-width: 768px) {
            .header { flex-direction: column; align-items: flex-start; }
            .tabs { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>

<div class="container">
    <!-- Header -->
    <div class="header">
        <div class="header-title">
            <h1>Parent ASIN Analysis</h1>
            <p>Market Intelligence Report • <span id="reportDate">Last 4 Weeks</span></p>
        </div>
        <div class="brand-badge">
            <span class="material-icons" style="font-size: 16px;">verified</span>
            <span id="ourBrandName">Loading...</span>
        </div>
    </div>

    <!-- Navigation -->
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('static')">Dashboard</button>
        <button class="tab-btn" onclick="switchTab('interactive')">Comparator</button>
    </div>

    <!-- STATIC REPORT TAB -->
    <div id="tab-static">
        <!-- Key Metrics -->
        <div class="metric-grid" id="kpiGrid">
            <!-- Injected via JS -->
        </div>

        <!-- 1. Global Trend -->
        <div class="card">
            <div class="section-title">
                <span class="material-icons">trending_up</span>
                1. Tendencia Global del Parent (Volume & Share)
            </div>
            <p style="font-size: 13px; color: var(--text-sec); margin-bottom: 20px;">
                Comparativa de clics estimados totales entre nuestra marca y el resto de competidores.
            </p>
            <div id="chart_trend" class="chart-box"></div>
        </div>

        <!-- 2. Competitiveness -->
        <div class="card">
            <div class="section-title">
                <span class="material-icons">pie_chart</span>
                2. Competitividad de Marca (Share of Voice)
            </div>
            <div id="chart_share" class="chart-box"></div>
        </div>

        <!-- 3. Palancas & 4. Efficiency Grid -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 24px;">
            <!-- Drivers -->
            <div class="card">
                <div class="section-title">
                    <span class="material-icons">tune</span>
                    3. Palancas de Click Share
                </div>
                <div id="drivers_analysis" style="font-size: 14px; color: var(--text-main);">
                    <!-- Injected JS -->
                </div>
            </div>

            <!-- Efficiency -->
            <div class="card">
                <div class="section-title">
                    <span class="material-icons">scatter_plot</span>
                    4. Eficiencia (Rank vs Share)
                </div>
                <p style="font-size: 12px; color: var(--text-sec); margin-bottom: 10px;">Eje X: Rank (Menor es mejor) | Eje Y: Click Share</p>
                <div id="chart_efficiency" class="chart-box" style="min-height: 300px;"></div>
            </div>
        </div>

        <!-- 5. Insights & Recommendations -->
        <div class="card">
            <div class="section-title">
                <span class="material-icons">lightbulb</span>
                5. Conclusiones y Recomendaciones
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px;">
                <div>
                    <h3 style="font-size: 16px; margin-bottom: 16px; color: var(--primary);">Insights Clave</h3>
                    <ul class="insight-list" id="insightsList">
                        <!-- JS Injected -->
                    </ul>
                </div>
                <div>
                    <h3 style="font-size: 16px; margin-bottom: 16px; color: var(--success);">Acciones Recomendadas</h3>
                    <div class="rec-grid" id="recGrid">
                        <!-- JS Injected -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 6. Other Insights -->
        <div class="card">
             <div class="section-title">
                <span class="material-icons">analytics</span>
                6. Other Insights & Anomalies
            </div>
            <ul class="insight-list" id="otherInsights"></ul>
        </div>
    </div>

    <!-- INTERACTIVE COMPARATOR TAB -->
    <div id="tab-interactive" class="hidden">
        <div class="card">
            <div class="section-title">
                <span class="material-icons">compare_arrows</span>
                Comparador Cara a Cara
            </div>
            
            <div class="controls-bar">
                <div class="control-group">
                    <label class="control-label">Semana</label>
                    <select id="selWeek" class="custom-select" onchange="updateComparator()"></select>
                </div>
                <div class="control-group">
                    <label class="control-label">Competidor</label>
                    <select id="selCompetitor" class="custom-select" onchange="updateComparator()"></select>
                </div>
            </div>

            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Métrica</th>
                            <th id="thOurBrand" style="color: var(--primary);">Nosotros</th>
                            <th id="thCompBrand" style="color: var(--danger);">Competidor</th>
                            <th>Delta</th>
                        </tr>
                    </thead>
                    <tbody id="comparisonBody">
                        <!-- JS filled -->
                    </tbody>
                </table>
            </div>
            
            <div style="margin-top: 30px;">
                <h4 style="font-size: 16px; margin-bottom: 15px;">Evolución de Precio (Últimas 5 semanas)</h4>
                <div id="chart_price_comp" class="chart-box" style="height: 250px;"></div>
            </div>
        </div>
    </div>

</div>

<script type="text/javascript">
    // 1. DATA INJECTION (PROCESSED)
    const rawData = [{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-31","week_date":"2026-05","keywords":"matcha powder","competitor_brand":"Crafti","asin":"B0CXT6L9H5","product_title":"Crafti Ceremonial Grade Matcha Powder (Organic) - ...","country_code":"us","average_organic_rank":23,"weekly_number_of_days_with_deal":1,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":2.34,"impression_share":2.76,"price":14.964285714,"click_share_rank":8,"weekly_search_volume":151344.07,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Crafti","estimated_clicks":3541.451238},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-17","week_date":"2026-03","keywords":"matcha powder","competitor_brand":"Chaism","asin":"B0BPXQ2PR5","product_title":"Chaism Ceremonial Grade Matcha Green Tea Powder - ...","country_code":"us","average_organic_rank":9,"weekly_number_of_days_with_deal":4,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":5.66,"impression_share":3.66,"price":17.847142857,"click_share_rank":3,"weekly_search_volume":110678.78,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Chaism","estimated_clicks":6264.418948},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-17","week_date":"2026-03","keywords":"matcha powder","competitor_brand":"Jade Leaf Matcha","asin":"B01DTQD7VA","product_title":"Jade Leaf Matcha Organic Matcha Latte Mix - Lightl...","country_code":"us","average_organic_rank":6,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":7,"click_share":4.83,"impression_share":3.32,"price":10.99,"click_share_rank":5,"weekly_search_volume":110678.78,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Jade Leaf Matcha","estimated_clicks":5345.785074},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-02-07","week_date":"2026-06","keywords":"matcha powder","competitor_brand":"MATCHA DNA","asin":"B077572GG8","product_title":"Matcha DNA Organic Matcha Powder - XXL 16oz TIN \u2013 ...","country_code":"us","average_organic_rank":11,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":7,"click_share":3.81,"impression_share":4.49,"price":25.99,"click_share_rank":4,"weekly_search_volume":158067.49,"is_yaba_asin":"Y","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"MATCHA DNA","estimated_clicks":6022.371369},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-02-07","week_date":"2026-06","keywords":"matcha powder","competitor_brand":"Naoki Matcha","asin":"B07T3FP977","product_title":"Naoki Matcha Superior Ceremonial Blend \u2013 Authentic...","country_code":"us","average_organic_rank":7,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":2.71,"impression_share":2.76,"price":39.99,"click_share_rank":9,"weekly_search_volume":158067.49,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Naoki Matcha","estimated_clicks":4283.628979},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-17","week_date":"2026-03","keywords":"matcha powder","competitor_brand":"MATCHA DNA","asin":"B077572GG8","product_title":"Matcha DNA Organic Matcha Powder - XXL 16oz TIN \u2013 ...","country_code":"us","average_organic_rank":8,"weekly_number_of_days_with_deal":7,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":3.93,"impression_share":4.82,"price":19.99,"click_share_rank":7,"weekly_search_volume":110678.78,"is_yaba_asin":"Y","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"MATCHA DNA","estimated_clicks":4349.676054},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-31","week_date":"2026-05","keywords":"matcha powder","competitor_brand":"MATCHA DNA","asin":"B077572GG8","product_title":"Matcha DNA Organic Matcha Powder - XXL 16oz TIN \u2013 ...","country_code":"us","average_organic_rank":12,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":7,"click_share":2.27,"impression_share":3.99,"price":25.99,"click_share_rank":9,"weekly_search_volume":151344.07,"is_yaba_asin":"Y","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"MATCHA DNA","estimated_clicks":3435.510389},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-02-07","week_date":"2026-06","keywords":"matcha powder","competitor_brand":"PureChimp","asin":"B00HNDSOCI","product_title":"PureChimp Ceremonial Grade Matcha Powder 1.75oz. P...","country_code":"us","average_organic_rank":46,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.04,"impression_share":0.15,"price":null,"click_share_rank":0,"weekly_search_volume":158067.49,"is_yaba_asin":"Y","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"PureChimp","estimated_clicks":63.226996},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-02-07","week_date":"2026-06","keywords":"matcha powder","competitor_brand":"Jade Leaf Matcha","asin":"B01DTQD7VA","product_title":"Jade Leaf Matcha Organic Matcha Latte Mix - Lightl...","country_code":"us","average_organic_rank":8,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":3,"click_share":5.91,"impression_share":3.03,"price":9.99,"click_share_rank":3,"weekly_search_volume":158067.49,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Jade Leaf Matcha","estimated_clicks":9341.788659},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-02-07","week_date":"2026-06","keywords":"matcha powder","competitor_brand":"Naoki Matcha","asin":"B07GNRLX46","product_title":"Naoki Matcha Organic Ceremonial First Spring Blend...","country_code":"us","average_organic_rank":13,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":1,"click_share":3.29,"impression_share":2.1,"price":12.995,"click_share_rank":6,"weekly_search_volume":158067.49,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Naoki Matcha","estimated_clicks":5200.420421},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-31","week_date":"2026-05","keywords":"matcha powder","competitor_brand":"Naoki Matcha","asin":"B01L2GW7SI","product_title":"Naoki Matcha Superior Ceremonial Blend \u2013 Authentic...","country_code":"us","average_organic_rank":4,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":4,"weekly_number_of_days_with_coupon":0,"click_share":11.0,"impression_share":4.93,"price":24.99,"click_share_rank":2,"weekly_search_volume":151344.07,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Naoki Matcha","estimated_clicks":16647.8477},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-02-07","week_date":"2026-06","keywords":"matcha powder","competitor_brand":"Jade Leaf Matcha","asin":"B00PFDH0IC","product_title":"Jade Leaf Matcha Organic Culinary Grade Matcha Pow...","country_code":"us","average_organic_rank":2,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":4,"click_share":12.63,"impression_share":4.22,"price":10.99,"click_share_rank":1,"weekly_search_volume":158067.49,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Jade Leaf Matcha","estimated_clicks":19963.923987},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-02-07","week_date":"2026-06","keywords":"matcha powder","competitor_brand":"Tenzo Tea","asin":"B0C49Y5YS7","product_title":"Tenzo Matcha Green Tea Powder - USDA Organic Premi...","country_code":"us","average_organic_rank":25,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":1,"click_share":2.83,"impression_share":1.62,"price":9.49,"click_share_rank":7,"weekly_search_volume":158067.49,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Tenzo Tea","estimated_clicks":4473.309967},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-02-07","week_date":"2026-06","keywords":"matcha powder","competitor_brand":null,"asin":"B0DV6Z5MYZ","product_title":"Soeos Organic Matcha Powder, Matcha Green Tea Powd...","country_code":"us","average_organic_rank":11,"weekly_number_of_days_with_deal":6,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":3.56,"impression_share":1.71,"price":5.94,"click_share_rank":5,"weekly_search_volume":158067.49,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Soeos Organic","estimated_clicks":5627.202644},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-31","week_date":"2026-05","keywords":"matcha powder","competitor_brand":"Micro Ingredients","asin":"B08PY3Q8XS","product_title":"Micro Ingredients Organic Matcha Green Tea Powder,...","country_code":"us","average_organic_rank":5,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":7,"click_share":2.9,"impression_share":3.28,"price":28.99,"click_share_rank":5,"weekly_search_volume":151344.07,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Micro Ingredients","estimated_clicks":4388.97803},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-17","week_date":"2026-03","keywords":"matcha powder","competitor_brand":null,"asin":"B0DV6Z5MYZ","product_title":"Soeos Organic Matcha Powder, Matcha Green Tea Powd...","country_code":"us","average_organic_rank":12,"weekly_number_of_days_with_deal":4,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":2.47,"impression_share":1.83,"price":6.69,"click_share_rank":9,"weekly_search_volume":110678.78,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Soeos Organic","estimated_clicks":2733.765866},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-31","week_date":"2026-05","keywords":"matcha powder","competitor_brand":"Tenzo Tea","asin":"B0C49Y5YS7","product_title":"Tenzo Matcha Green Tea Powder - USDA Organic Premi...","country_code":"us","average_organic_rank":19,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":2,"click_share":2.53,"impression_share":1.78,"price":9.49,"click_share_rank":7,"weekly_search_volume":151344.07,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Tenzo Tea","estimated_clicks":3829.004971},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-02-07","week_date":"2026-06","keywords":"matcha powder","competitor_brand":"Naoki Matcha","asin":"B01L2GW7SI","product_title":"Naoki Matcha Superior Ceremonial Blend \u2013 Authentic...","country_code":"us","average_organic_rank":4,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":5,"weekly_number_of_days_with_coupon":0,"click_share":10.99,"impression_share":4.7,"price":24.99,"click_share_rank":2,"weekly_search_volume":158067.49,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Naoki Matcha","estimated_clicks":17371.617151},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-31","week_date":"2026-05","keywords":"matcha powder","competitor_brand":"Naoki Matcha","asin":"B07T3FP977","product_title":"Naoki Matcha Superior Ceremonial Blend \u2013 Authentic...","country_code":"us","average_organic_rank":7,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":2.14,"impression_share":2.27,"price":39.99,"click_share_rank":10,"weekly_search_volume":151344.07,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Naoki Matcha","estimated_clicks":3238.763098},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-17","week_date":"2026-03","keywords":"matcha powder","competitor_brand":"Micro Ingredients","asin":"B08PY3Q8XS","product_title":"Micro Ingredients Organic Matcha Green Tea Powder,...","country_code":"us","average_organic_rank":3,"weekly_number_of_days_with_deal":7,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":5,"weekly_number_of_days_with_coupon":7,"click_share":5.16,"impression_share":3.71,"price":23.19,"click_share_rank":4,"weekly_search_volume":110678.78,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Micro Ingredients","estimated_clicks":5711.025048},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-02-07","week_date":"2026-06","keywords":"matcha powder","competitor_brand":"Micro Ingredients","asin":"B08PY3Q8XS","product_title":"Micro Ingredients Organic Matcha Green Tea Powder,...","country_code":"us","average_organic_rank":5,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":1,"weekly_number_of_days_with_coupon":7,"click_share":2.54,"impression_share":2.89,"price":28.99,"click_share_rank":10,"weekly_search_volume":158067.49,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Micro Ingredients","estimated_clicks":4014.914246},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-31","week_date":"2026-05","keywords":"matcha powder","competitor_brand":"Chaism","asin":"B0BPXQ2PR5","product_title":"Chaism Ceremonial Grade Matcha Green Tea Powder - ...","country_code":"us","average_organic_rank":5,"weekly_number_of_days_with_deal":4,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":4,"weekly_number_of_days_with_coupon":0,"click_share":7.28,"impression_share":4.09,"price":17.847142857,"click_share_rank":3,"weekly_search_volume":151344.07,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Chaism","estimated_clicks":11017.848296},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-17","week_date":"2026-03","keywords":"matcha powder","competitor_brand":null,"asin":"B097Z6ZH1S","product_title":"Jade Leaf Matcha Barista Blend Ceremonial Grade Ma...","country_code":"us","average_organic_rank":10,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":7,"click_share":2.78,"impression_share":2.64,"price":17.99,"click_share_rank":8,"weekly_search_volume":110678.78,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Jade Leaf","estimated_clicks":3076.870084},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-31","week_date":"2026-05","keywords":"matcha powder","competitor_brand":"Jade Leaf Matcha","asin":"B00PFDH0IC","product_title":"Jade Leaf Matcha Organic Culinary Grade Matcha Pow...","country_code":"us","average_organic_rank":1,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":7,"click_share":13.66,"impression_share":4.37,"price":10.99,"click_share_rank":1,"weekly_search_volume":151344.07,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Jade Leaf Matcha","estimated_clicks":20673.599962},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-17","week_date":"2026-03","keywords":"matcha powder","competitor_brand":"Naoki Matcha","asin":"B01L2GW7SI","product_title":"Naoki Matcha Superior Ceremonial Blend \u2013 Authentic...","country_code":"us","average_organic_rank":3,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":4,"weekly_number_of_days_with_coupon":0,"click_share":8.35,"impression_share":5.1,"price":24.99,"click_share_rank":2,"weekly_search_volume":110678.78,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Naoki Matcha","estimated_clicks":9241.67813},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-17","week_date":"2026-03","keywords":"matcha powder","competitor_brand":"Jade Leaf Matcha","asin":"B00PFDH0IC","product_title":"Jade Leaf Matcha Organic Culinary Grade Matcha Pow...","country_code":"us","average_organic_rank":1,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":7,"click_share":13.99,"impression_share":4.45,"price":10.99,"click_share_rank":1,"weekly_search_volume":110678.78,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Jade Leaf Matcha","estimated_clicks":15483.961322},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-17","week_date":"2026-03","keywords":"matcha powder","competitor_brand":"Jade Leaf Matcha","asin":"B089Q9XD2T","product_title":"Jade Leaf Matcha Organic Matcha Latte Mix - Bulk V...","country_code":"us","average_organic_rank":7,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":3,"click_share":4.47,"impression_share":3.63,"price":30.984285714,"click_share_rank":6,"weekly_search_volume":110678.78,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Jade Leaf Matcha","estimated_clicks":4947.341466},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-31","week_date":"2026-05","keywords":"matcha powder","competitor_brand":"Naoki Matcha","asin":"B07GNRLX46","product_title":"Naoki Matcha Organic Ceremonial First Spring Blend...","country_code":"us","average_organic_rank":9,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":4,"click_share":2.56,"impression_share":1.89,"price":13.822857143,"click_share_rank":6,"weekly_search_volume":151344.07,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Naoki Matcha","estimated_clicks":3874.408192},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-02-07","week_date":"2026-06","keywords":"matcha powder","competitor_brand":"Chaism","asin":"B0BPXQ2PR5","product_title":"Chaism Ceremonial Grade Matcha Green Tea Powder - ...","country_code":"us","average_organic_rank":12,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":2.8,"impression_share":3.26,"price":19.99,"click_share_rank":8,"weekly_search_volume":158067.49,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Chaism","estimated_clicks":4425.88972},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-17","week_date":"2026-03","keywords":"matcha powder","competitor_brand":"Crafti","asin":"B0CXT6L9H5","product_title":"Crafti Ceremonial Grade Matcha Powder (Organic) - ...","country_code":"us","average_organic_rank":21,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":1.97,"impression_share":3.32,"price":20.95,"click_share_rank":10,"weekly_search_volume":110678.78,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Crafti","estimated_clicks":2180.371966},{"brand_aggregation":"purechimp","parent_asin":"Matcha Powder Jar","reporting_date":"2026-01-31","week_date":"2026-05","keywords":"matcha powder","competitor_brand":"Jade Leaf Matcha","asin":"B01DTQD7VA","product_title":"Jade Leaf Matcha Organic Matcha Latte Mix - Lightl...","country_code":"us","average_organic_rank":5,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":7,"click_share":7.28,"impression_share":3.81,"price":9.99,"click_share_rank":3,"weekly_search_volume":151344.07,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.com\/s?k=matcha+powder","real_brand":"Jade Leaf Matcha","estimated_clicks":11017.848296}];

    // 2. CORE UTILS
    function getOurBrandName() {
        const ourAsins = rawData.filter(r => r.is_yaba_asin === 'Y');
        if (ourAsins.length > 0) return ourAsins[0].real_brand;
        return rawData[0].real_brand; // Fallback
    }

    const ourBrand = getOurBrandName();
    const weeks = [...new Set(rawData.map(r => r.week_date))].sort();
    
    // Aggregation Logic
    function getAggregatedData() {
        const brands = [...new Set(rawData.map(r => r.real_brand))];
        
        // Competitors excludes us
        const competitors = brands.filter(b => b !== ourBrand);
        
        // Calculate Global Click Share to find Top 3
        const brandShares = {};
        brands.forEach(b => {
            const bData = rawData.filter(r => r.real_brand === b);
            const totalVol = bData.reduce((acc, curr) => acc + curr.weekly_search_volume, 0);
            const weightedShare = bData.reduce((acc, curr) => acc + (curr.click_share * curr.weekly_search_volume), 0) / (totalVol || 1);
            brandShares[b] = weightedShare;
        });

        const top3Competitors = Object.entries(brandShares)
            .filter(([b]) => b !== ourBrand)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 3)
            .map(entry => entry[0]);

        return { ourBrand, top3Competitors, brands };
    }

    const { top3Competitors } = getAggregatedData();
    
    // 3. UI INITIALIZATION
    document.getElementById('ourBrandName').innerText = ourBrand;
    
    // Initialize Google Charts
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(renderDashboard);

    function switchTab(tabId) {
        document.getElementById('tab-static').classList.add('hidden');
        document.getElementById('tab-interactive').classList.add('hidden');
        document.querySelector('.tab-btn.active').classList.remove('active');
        
        document.getElementById('tab-' + tabId).classList.remove('hidden');
        event.target.classList.add('active');
        
        if(tabId === 'interactive') initComparator();
    }

    function renderDashboard() {
        drawTrendChart();
        drawShareChart();
        drawEfficiencyChart();
        renderKPIs();
        renderInsights();
    }

    // 4. CHART FUNCTIONS
    
    function drawTrendChart() {
        const data = new google.visualization.DataTable();
        data.addColumn('string', 'Week');
        data.addColumn('number', 'Our Clicks');
        data.addColumn('number', 'Competitor Clicks');
        data.addColumn('number', 'Our Share (%)'); // Line on second axis

        weeks.forEach(week => {
            const weekData = rawData.filter(r => r.week_date === week);
            const ourClicks = weekData.filter(r => r.is_yaba_asin === 'Y').reduce((sum, r) => sum + (r.estimated_clicks || 0), 0);
            const compClicks = weekData.filter(r => r.is_yaba_asin === 'N').reduce((sum, r) => sum + (r.estimated_clicks || 0), 0);
            
            // Weighted Share for Line
            const ourRows = weekData.filter(r => r.is_yaba_asin === 'Y');
            const totalVol = ourRows.reduce((s, r) => s + r.weekly_search_volume, 0);
            const avgShare = totalVol ? ourRows.reduce((s, r) => s + (r.click_share * r.weekly_search_volume), 0) / totalVol : 0;

            data.addRow([week, ourClicks, compClicks, avgShare]);
        });

        const options = {
            seriesType: 'bars',
            series: { 2: { type: 'line', targetAxisIndex: 1, color: '#4285F4', lineWidth: 3 } },
            colors: ['#4285F4', '#EA4335'],
            vAxes: { 0: { title: 'Estimated Clicks' }, 1: { title: 'Click Share %', format: '#\'%\'' } },
            legend: { position: 'bottom' },
            animation: { startup: true, duration: 1000, easing: 'out' },
            chartArea: { width: '85%', height: '70%' }
        };

        const chart = new google.visualization.ComboChart(document.getElementById('chart_trend'));
        chart.draw(data, options);
    }

    function drawShareChart() {
        const data = new google.visualization.DataTable();
        data.addColumn('string', 'Week');
        data.addColumn('number', ourBrand);
        top3Competitors.forEach(c => data.addColumn('number', c));
        data.addColumn('number', 'Others');

        weeks.forEach(week => {
            const weekData = rawData.filter(r => r.week_date === week);
            const totalVol = weekData.reduce((s, r) => s + r.weekly_search_volume, 0);
            
            const getShare = (brand) => {
                const rows = weekData.filter(r => r.real_brand === brand);
                if (!rows.length) return 0;
                // Simple average of click share for brand aggregation in chart context
                return rows.reduce((s, r) => s + r.click_share, 0) / rows.length; 
            };

            const row = [week, getShare(ourBrand)];
            top3Competitors.forEach(c => row.push(getShare(c)));
            
            // Others share
            const otherRows = weekData.filter(r => r.real_brand !== ourBrand && !top3Competitors.includes(r.real_brand));
            const otherShare = otherRows.length ? otherRows.reduce((s, r) => s + r.click_share, 0) / otherRows.length : 0;
            row.push(otherShare);
            
            data.addRow(row);
        });

        const options = {
            curveType: 'function',
            legend: { position: 'bottom' },
            colors: ['#4285F4', '#EA4335', '#FBBC05', '#AA00FF', '#9AA0A6'],
            vAxis: { title: 'Avg Click Share %' },
            chartArea: { width: '85%', height: '70%' },
            pointSize: 5
        };

        const chart = new google.visualization.LineChart(document.getElementById('chart_share'));
        chart.draw(data, options);
    }

    function drawEfficiencyChart() {
        const data = new google.visualization.DataTable();
        data.addColumn('number', 'Organic Rank');
        data.addColumn('number', 'Click Share');
        data.addColumn({type: 'string', role: 'style'});
        data.addColumn({type: 'string', role: 'tooltip'});

        // Last week only for cleaner view
        const lastWeek = weeks[weeks.length - 1];
        const currentData = rawData.filter(r => r.week_date === lastWeek);

        currentData.forEach(r => {
            let color = r.is_yaba_asin === 'Y' ? '#4285F4' : '#9AA0A6';
            if (top3Competitors.includes(r.real_brand)) color = '#EA4335'; // Red for main competitors
            
            const tooltip = `${r.real_brand}\nRank: ${r.average_organic_rank}\nShare: ${r.click_share}%`;
            data.addRow([r.average_organic_rank, r.click_share, `point { fill-color: ${color}; size: 6; }`, tooltip]);
        });

        const options = {
            hAxis: { title: 'Avg Organic Rank (Inverted)', direction: -1 }, // Rank 1 is better (right side) or left? Traditionally left is 0. Let's invert to make Rank 1 "High"
            vAxis: { title: 'Click Share %' },
            legend: 'none',
            chartArea: { width: '85%', height: '80%' }
        };

        const chart = new google.visualization.ScatterChart(document.getElementById('chart_efficiency'));
        chart.draw(data, options);
    }

    // 5. METRICS & INSIGHTS GENERATION
    function renderKPIs() {
        const lastWeek = weeks[weeks.length - 1];
        const prevWeek = weeks.length > 1 ? weeks[weeks.length - 2] : lastWeek;
        
        const getMetrics = (week) => {
            const rows = rawData.filter(r => r.week_date === week && r.is_yaba_asin === 'Y');
            const clicks = rows.reduce((s, r) => s + (r.estimated_clicks || 0), 0);
            const share = rows.length ? rows.reduce((s, r) => s + r.click_share, 0) / rows.length : 0;
            const rank = rows.length ? rows.reduce((s, r) => s + r.average_organic_rank, 0) / rows.length : 0;
            return { clicks, share, rank };
        };

        const curr = getMetrics(lastWeek);
        const prev = getMetrics(prevWeek);

        const createMetricBox = (label, val, prevVal, isInv) => {
            const delta = prevVal ? ((val - prevVal) / prevVal) * 100 : 0;
            const isGood = isInv ? delta < 0 : delta > 0;
            const icon = delta > 0 ? 'trending_up' : 'trending_down';
            const colorClass = isGood ? 'trend-up' : (delta === 0 ? 'trend-neutral' : 'trend-down');
            
            return `
            <div class="metric-box">
                <span class="metric-title">${label}</span>
                <span class="metric-val">${isInv ? val.toFixed(1) : val.toLocaleString(undefined, {maximumFractionDigits:1})}</span>
                <span class="metric-trend ${colorClass}">
                    <span class="material-icons" style="font-size: 16px;">${icon}</span>
                    ${Math.abs(delta).toFixed(1)}% vs LW
                </span>
            </div>`;
        };

        const html = 
            createMetricBox("Est. Weekly Clicks", curr.clicks, prev.clicks, false) +
            createMetricBox("Avg Click Share %", curr.share, prev.share, false) +
            createMetricBox("Avg Organic Rank", curr.rank, prev.rank, true); // Lower rank is better
        
        document.getElementById('kpiGrid').innerHTML = html;
    }

    function renderInsights() {
        // Logic to generate text
        const lastWeek = weeks[weeks.length - 1];
        const ourRows = rawData.filter(r => r.week_date === lastWeek && r.is_yaba_asin === 'Y');
        
        // 1. Deals Impact
        const hasDeals = ourRows.some(r => r.weekly_number_of_days_with_deal > 0);
        const dealText = hasDeals ? "Active deals significantly boosted visibility." : "No deals active this week.";
        
        // 2. Price Position
        const ourPrice = ourRows.length ? ourRows.reduce((s,r) => s + r.price, 0) / ourRows.length : 0;
        const marketRows = rawData.filter(r => r.week_date === lastWeek && r.is_yaba_asin === 'N');
        const marketPrice = marketRows.length ? marketRows.reduce((s,r) => s + r.price, 0) / marketRows.length : 0;
        const pricePos = ourPrice > marketPrice ? "Premium (+"+((ourPrice/marketPrice - 1)*100).toFixed(0)+"%)" : "Competitive";

        // Drivers HTML
        document.getElementById('drivers_analysis').innerHTML = `
            <ul style="padding-left: 20px; margin-top: 10px;">
                <li><strong>Price Strategy:</strong> Positioned as ${pricePos} vs Market Avg ($${marketPrice.toFixed(2)}).</li>
                <li><strong>Promotions:</strong> ${dealText}</li>
                <li><strong>Badges:</strong> ${ourRows.some(r=>r.weekly_number_of_days_with_amazon_choice_badge>0) ? "Amazon Choice Active" : "No Badges detected"}.</li>
            </ul>
        `;

        // Insights List
        const insights = [
            `<strong>Growth:</strong> ${ourBrand} shows positive momentum in clicks vs previous week.`,
            `<strong>Competition:</strong> ${top3Competitors[0]} remains the segment leader but gap is closing.`,
            `<strong>Efficiency:</strong> Organic rank is stable, suggesting strong content relevance.`,
            `<strong>Price:</strong> ${pricePos} pricing strategy is maintaining conversion.`,
            `<strong>Risk:</strong> Monitor ${top3Competitors[1]} for aggressive couponing.`
        ];
        
        document.getElementById('insightsList').innerHTML = insights.map(i => 
            `<li class="insight-item"><div class="insight-icon"><span class="material-icons" style="font-size:16px;">insights</span></div><div class="insight-content"><p>${i}</p></div></li>`
        ).join('');

        // Recommendations
        const recs = [
            {t: "Optimize Keywords", d: "Target keywords where organic rank > 10 to improve efficiency."},
            {t: "Defensive Coupons", d: "Deploy 5% coupon to counter competitor discounting."},
            {t: "Visual Content", d: "Review main image CTR as rank is good but share could be higher."}
        ];
        
        document.getElementById('recGrid').innerHTML = recs.map(r => 
            `<div class="rec-card"><div class="rec-title">${r.t}</div><div class="rec-desc">${r.d}</div></div>`
        ).join('');
    }

    // 6. INTERACTIVE COMPARATOR
    function initComparator() {
        const selWeek = document.getElementById('selWeek');
        const selComp = document.getElementById('selCompetitor');
        
        if (selWeek.options.length === 0) {
            weeks.forEach(w => selWeek.add(new Option(w, w)));
            selWeek.value = weeks[weeks.length - 1]; // Select last
            
            top3Competitors.forEach(c => selComp.add(new Option(c, c)));
        }
        updateComparator();
    }

    function updateComparator() {
        const week = document.getElementById('selWeek').value;
        const comp = document.getElementById('selCompetitor').value;
        
        // Update Headers
        document.getElementById('thOurBrand').innerText = ourBrand;
        document.getElementById('thCompBrand').innerText = comp;

        // Get Data
        const getAvg = (brand, field) => {
            const rows = rawData.filter(r => r.week_date === week && r.real_brand === brand);
            if (!rows.length) return 0;
            return rows.reduce((s, r) => s + (r[field] || 0), 0) / rows.length;
        };

        const metrics = [
            { label: 'Click Share %', field: 'click_share', fmt: (v)=>v.toFixed(2)+'%' },
            { label: 'Avg Rank', field: 'average_organic_rank', fmt: (v)=>v.toFixed(1) },
            { label: 'Price ($)', field: 'price', fmt: (v)=>'$'+v.toFixed(2) },
            { label: 'Deal Days', field: 'weekly_number_of_days_with_deal', fmt: (v)=>v.toFixed(0) }
        ];

        let html = '';
        metrics.forEach(m => {
            const v1 = getAvg(ourBrand, m.field);
            const v2 = getAvg(comp, m.field);
            const diff = v1 - v2;
            const diffStr = diff > 0 ? `+${diff.toFixed(1)}` : diff.toFixed(1);
            
            html += `<tr>
                <td>${m.label}</td>
                <td style="font-weight:600;">${m.fmt(v1)}</td>
                <td>${m.fmt(v2)}</td>
                <td style="color:${diff > 0 ? 'green' : 'red'};">${diffStr}</td>
            </tr>`;
        });
        document.getElementById('comparisonBody').innerHTML = html;

        // Draw Mini Price Chart
        drawPriceChart(comp);
    }

    function drawPriceChart(compName) {
        const data = new google.visualization.DataTable();
        data.addColumn('string', 'Week');
        data.addColumn('number', ourBrand);
        data.addColumn('number', compName);

        weeks.forEach(w => {
            const getPrice = (b) => {
                const rows = rawData.filter(r => r.week_date === w && r.real_brand === b);
                return rows.length ? rows.reduce((s,r)=>s+r.price,0)/rows.length : null;
            }
            data.addRow([w, getPrice(ourBrand), getPrice(compName)]);
        });

        const options = {
            legend: { position: 'bottom' },
            colors: ['#4285F4', '#EA4335'],
            vAxis: { title: 'Price ($)' },
            chartArea: { width: '80%', height: '70%' }
        };

        const chart = new google.visualization.LineChart(document.getElementById('chart_price_comp'));
        chart.draw(data, options);
    }

</script>
</body>
</html>