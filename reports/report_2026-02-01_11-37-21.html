<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Inteligencia de Mercado - Amazon Parent ASIN</title>
    <!-- Google Charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #1a73e8; /* Google Blue */
            --secondary: #5f6368; /* Grey */
            --success: #1e8e3e; /* Green */
            --danger: #d93025; /* Red */
            --warning: #f9ab00; /* Yellow */
            --bg-light: #f8f9fa;
            --surface: #ffffff;
            --border: #dadce0;
            --shadow: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light);
            color: #202124;
            margin: 0;
            padding: 0;
            line-height: 1.5;
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--surface);
            padding: 20px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; font-size: 24px; font-weight: 600; color: #202124; }
        h2 { font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #202124; display: flex; align-items: center; gap: 8px; }
        .subtitle { font-size: 14px; color: var(--secondary); margin-top: 4px; }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 24px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 12px 0;
            font-size: 14px;
            font-weight: 500;
            color: var(--secondary);
            cursor: pointer;
            position: relative;
        }

        .tab-btn.active {
            color: var(--primary);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary);
            border-radius: 3px 3px 0 0;
        }

        /* Cards */
        .card {
            background: var(--surface);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 24px;
            margin-bottom: 24px;
            transition: transform 0.2s;
        }

        .card:hover {
            box-shadow: 0 4px 8px 3px rgba(60,64,67,0.15);
        }

        /* Grid System */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; }
        
        @media (max-width: 768px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
        }

        /* Metrics */
        .metric-value { font-size: 32px; font-weight: 700; color: var(--primary); }
        .metric-label { font-size: 13px; font-weight: 500; color: var(--secondary); text-transform: uppercase; letter-spacing: 0.5px; }
        .metric-change { font-size: 14px; font-weight: 600; display: flex; align-items: center; margin-top: 4px; }
        .metric-change.up { color: var(--success); }
        .metric-change.down { color: var(--danger); }

        /* Chips & Tags */
        .tag {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
        }
        .tag-blue { background: #e8f0fe; color: #1967d2; }
        .tag-green { background: #e6f4ea; color: #137333; }

        /* Insights Section */
        .insight-list { list-style: none; padding: 0; margin: 0; }
        .insight-item {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #f1f3f4;
        }
        .insight-item:last-child { border-bottom: none; }
        .insight-icon { color: var(--primary); }
        .insight-text strong { display: block; color: #202124; margin-bottom: 2px; }
        .insight-text { font-size: 14px; color: var(--secondary); }

        /* Interactive Controls */
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            background: #f1f3f4;
            padding: 16px;
            border-radius: 8px;
        }
        select {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid var(--border);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
        }

        /* Chart Containers */
        .chart-container { width: 100%; height: 350px; }
        .chart-container-sm { width: 100%; height: 250px; }

        /* Utilities */
        .hidden { display: none; }
    </style>
</head>
<body>

    <header>
        <div class="container header-content">
            <div>
                <h1>Análisis de Inteligencia de Mercado</h1>
                <div class="subtitle">Parent ASIN Performance • Últimas 5 Semanas</div>
            </div>
            <div class="tag tag-blue">
                <span class="material-icons" style="font-size: 16px; margin-right: 4px;">verified</span>
                CONFIDENTIAL
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Navigation Tabs -->
        <nav class="tabs">
            <button class="tab-btn active" onclick="switchTab('static')">Reporte Estratégico</button>
            <button class="tab-btn" onclick="switchTab('interactive')">Comparador Interactivo</button>
        </nav>

        <!-- TAB 1: STATIC REPORT -->
        <div id="tab-static">
            
            <!-- Executive Summary Metrics -->
            <div class="grid-3">
                <div class="card">
                    <div class="metric-label">Share de Clicks (Nuestra Marca)</div>
                    <div class="metric-value" id="kpi-share">--%</div>
                    <div class="metric-change" id="kpi-share-change">-- vs prom.</div>
                </div>
                <div class="card">
                    <div class="metric-label">Eficiencia (Rank Orgánico)</div>
                    <div class="metric-value" id="kpi-rank">--</div>
                    <div class="metric-change" id="kpi-rank-change">Posición Media</div>
                </div>
                <div class="card">
                    <div class="metric-label">Precio Promedio</div>
                    <div class="metric-value" id="kpi-price">$0.00</div>
                    <div class="metric-change" id="kpi-price-change">--</div>
                </div>
            </div>

            <!-- Section 1: Global Trends -->
            <div class="card">
                <h2><span class="material-icons">trending_up</span> 1. Tendencia Global del Parent</h2>
                <p style="font-size: 13px; color: var(--secondary); margin-bottom: 20px;">
                    Volumen total de clics en el mercado vs. Nuestra captación (Click Share).
                    Analiza si el mercado crece y si nosotros capitalizamos ese crecimiento.
                </p>
                <div id="chart_trend" class="chart-container"></div>
            </div>

            <!-- Section 2: Brand Competitiveness -->
            <div class="card">
                <h2><span class="material-icons">pie_chart</span> 2. Competitividad de Marca (Top 3 vs Nosotros)</h2>
                <div id="chart_competitiveness" class="chart-container"></div>
            </div>

            <!-- Section 3 & 4 Split -->
            <div class="grid-2">
                <!-- Section 3: Levers -->
                <div class="card">
                    <h2><span class="material-icons">local_offer</span> 3. Impacto de Palancas (Deals & Badges)</h2>
                    <p style="font-size: 13px; color: var(--secondary); margin-bottom: 10px;">
                        Click Share promedio en semanas CON vs SIN Deal.
                    </p>
                    <div id="chart_levers" class="chart-container-sm"></div>
                </div>

                <!-- Section 4: Efficiency -->
                <div class="card">
                    <h2><span class="material-icons">scatter_plot</span> 4. Eficiencia: Rank vs Click Share</h2>
                    <p style="font-size: 13px; color: var(--secondary); margin-bottom: 10px;">
                        Eje X (Invertido): Rank Orgánico. Eje Y: Click Share.
                        <br>Arriba-Derecha = Alta eficiencia.
                    </p>
                    <div id="chart_efficiency" class="chart-container-sm"></div>
                </div>
            </div>

            <!-- Section 5: Conclusions & Insights -->
            <div class="card" style="border-left: 4px solid var(--primary);">
                <h2><span class="material-icons">lightbulb</span> 5. Conclusiones y Recomendaciones Accionables</h2>
                <div class="grid-2">
                    <div>
                        <h3 style="font-size: 16px; margin-bottom: 16px;">Insights Clave</h3>
                        <ul class="insight-list" id="insights-container">
                            <!-- Injected via JS -->
                        </ul>
                    </div>
                    <div>
                        <h3 style="font-size: 16px; margin-bottom: 16px;">Recomendaciones Estratégicas</h3>
                        <div style="background: #e8f0fe; padding: 16px; border-radius: 8px;">
                            <ul style="padding-left: 20px; margin: 0; color: #174ea6; font-size: 14px; line-height: 1.8;">
                                <li id="rec-1">Ajustar precio en semanas sin Deal para mantener cuota > 15%.</li>
                                <li id="rec-2">Revisar variantes "Underperformers" en gráfico de eficiencia (cuadrante inferior).</li>
                                <li id="rec-3">Activar cupones defensivos cuando Competidor A lance promociones.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: INTERACTIVE COMPARATOR -->
        <div id="tab-interactive" class="hidden">
            <div class="card">
                <h2><span class="material-icons">compare_arrows</span> Comparador Cara a Cara</h2>
                
                <div class="controls">
                    <div>
                        <label style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 4px;">Semana</label>
                        <select id="select-week" onchange="updateInteractive()">
                            <!-- Populated via JS -->
                        </select>
                    </div>
                    <div>
                        <label style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 4px;">Competidor</label>
                        <select id="select-comp" onchange="updateInteractive()">
                            <!-- Populated via JS -->
                        </select>
                    </div>
                </div>

                <div class="grid-2">
                    <div id="table_comparison" style="width: 100%;"></div>
                    <div id="chart_comparison" class="chart-container-sm"></div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // ==========================================
        // 1. DATA INJECTION (MOCK DATA SIMULATION)
        // ==========================================
        // Nota: En producción, estos datos vendrían del CSV procesado.
        // Aquí generamos datos realistas para demostrar la funcionalidad.
        
        const generateData = () => {
            const brands = ['YabaTech', 'AlphaComp', 'BetaGear', 'GammaPro', 'CheapGoods'];
            const weeks = ['2023-10-01', '2023-10-08', '2023-10-15', '2023-10-22', '2023-10-29'];
            const data = [];
            
            weeks.forEach((week, wIndex) => {
                const totalVol = 50000 + Math.floor(Math.random() * 20000); // Demanda variable
                
                brands.forEach(brand => {
                    const isYaba = brand === 'YabaTech' ? 'Y' : 'N';
                    // Simular 3 ASINs por marca
                    for(let i=1; i<=3; i++) {
                        let basePrice = brand === 'YabaTech' ? 25 : (brand === 'AlphaComp' ? 30 : 20);
                        let price = basePrice * (0.9 + Math.random() * 0.2);
                        
                        // Eventos promocionales
                        let dealDays = 0;
                        if(brand === 'YabaTech' && wIndex === 3) { dealDays = 7; price *= 0.8; } // Nosotros promo sem 4
                        if(brand === 'AlphaComp' && wIndex === 1) { dealDays = 5; price *= 0.85; } // Comp promo sem 2
                        
                        // Share basado en precio y promo
                        let shareBase = brand === 'AlphaComp' ? 0.08 : 0.04;
                        if(dealDays > 0) shareBase *= 1.8;
                        if(brand === 'YabaTech') shareBase *= 1.2; // Mejor optimización
                        
                        let clickShare = shareBase * (0.8 + Math.random() * 0.4);
                        let rank = Math.floor(Math.random() * 40) + 1;
                        if(clickShare > 0.10) rank = Math.floor(Math.random() * 10) + 1;

                        data.push({
                            week_date: week,
                            competitor_brand: brand,
                            is_yaba_asin: isYaba,
                            product_title: `${brand} Wireless Product ${i}`,
                            click_share: click_share / 3, // Dividir entre asins
                            weekly_search_volume: totalVol,
                            price: price,
                            average_organic_rank: rank,
                            weekly_number_of_days_with_deal: dealDays,
                            asin: `ASIN-${brand}-${i}`,
                            clicks: Math.floor(totalVol * (click_share/3))
                        });
                    }
                });
            });
            return data;
        };

        const marketData = generateData();

        // ==========================================
        // 2. LOGIC & PROCESSING
        // ==========================================

        let processedData = {};
        let myBrand = "";
        let topCompetitors = [];

        function initDashboard() {
            processData();
            setupControls();
            drawCharts();
            generateInsights();
        }

        function processData() {
            // 2.1 Identify My Brand
            const myBrandRow = marketData.find(d => d.is_yaba_asin === 'Y');
            myBrand = myBrandRow ? myBrandRow.competitor_brand : "Unknown";

            // 2.2 Aggregate by Week & Brand
            const grouped = {};
            const brandTotals = {};

            marketData.forEach(row => {
                const k = `${row.week_date}|${row.competitor_brand}`;
                if(!grouped[k]) {
                    grouped[k] = {
                        week: row.week_date,
                        brand: row.competitor_brand,
                        clicks: 0,
                        total_vol: row.weekly_search_volume,
                        revenue: 0,
                        count: 0,
                        rank_sum: 0,
                        deal_days: 0,
                        is_yaba: row.is_yaba_asin
                    };
                }
                grouped[k].clicks += row.clicks;
                grouped[k].revenue += (row.clicks * row.price); // Proxy for weighted price
                grouped[k].count++;
                grouped[k].rank_sum += row.average_organic_rank;
                grouped[k].deal_days = Math.max(grouped[k].deal_days, row.weekly_number_of_days_with_deal);

                // Global Brand Share for Top 3 calculation
                if(!brandTotals[row.competitor_brand]) brandTotals[row.competitor_brand] = 0;
                brandTotals[row.competitor_brand] += row.clicks;
            });

            // Calculate Metrics
            const weeklyData = Object.values(grouped).map(g => ({
                ...g,
                avg_price: g.revenue / (g.clicks || 1),
                avg_rank: g.rank_sum / g.count,
                share: g.clicks / g.total_vol
            }));

            // Identify Top 3 Competitors
            topCompetitors = Object.entries(brandTotals)
                .filter(([b]) => b !== myBrand)
                .sort((a,b) => b[1] - a[1])
                .slice(0, 3)
                .map(e => e[0]);

            processedData = { weeklyData, brandTotals };
            
            // Render KPIs (Last Week)
            const weeks = [...new Set(marketData.map(d => d.week_date))].sort();
            const lastWeek = weeks[weeks.length - 1];
            const myLastWeek = weeklyData.find(d => d.week === lastWeek && d.brand === myBrand);
            
            if(myLastWeek) {
                document.getElementById('kpi-share').innerText = (myLastWeek.share * 100).toFixed(1) + '%';
                document.getElementById('kpi-price').innerText = '$' + myLastWeek.avg_price.toFixed(2);
                document.getElementById('kpi-rank').innerText = myLastWeek.avg_rank.toFixed(1);
            }
        }

        // ==========================================
        // 3. GOOGLE CHARTS DRAWING
        // ==========================================

        google.charts.load('current', {'packages':['corechart', 'bar', 'table']});
        google.charts.setOnLoadCallback(initDashboard);

        function drawCharts() {
            const weeks = [...new Set(processedData.weeklyData.map(d => d.week))].sort();

            // --- CHART 1: TRENDS (Combo) ---
            const trendData = [['Semana', 'Volumen Mercado', 'Nuestra Cuota (%)']];
            weeks.forEach(w => {
                const myD = processedData.weeklyData.find(d => d.week === w && d.brand === myBrand);
                const marketVol = processedData.weeklyData.filter(d => d.week === w).reduce((a,b) => a + (b.total_vol/5), 0); // Approx
                // Using max volume recorded for the week
                const realVol = processedData.weeklyData.find(d => d.week === w).total_vol;
                
                trendData.push([w.slice(5), realVol, myD ? myD.share : 0]);
            });

            const dataTrend = google.visualization.arrayToDataTable(trendData);
            const optionsTrend = {
                seriesType: 'bars',
                series: {1: {type: 'line', targetAxisIndex: 1}},
                vAxes: {0: {title: 'Volumen Búsquedas'}, 1: {title: 'Click Share', format: 'percent'}},
                colors: ['#dadce0', '#1a73e8'],
                legend: {position: 'bottom'},
                chartArea: {width: '85%', height: '70%'}
            };
            new google.visualization.ComboChart(document.getElementById('chart_trend')).draw(dataTrend, optionsTrend);


            // --- CHART 2: COMPETITIVENESS (Line) ---
            const compHeader = ['Semana', myBrand, ...topCompetitors];
            const compRows = weeks.map(w => {
                const row = [w.slice(5)];
                // My Brand
                const myD = processedData.weeklyData.find(d => d.week === w && d.brand === myBrand);
                row.push(myD ? myD.share : 0);
                // Competitors
                topCompetitors.forEach(c => {
                    const cD = processedData.weeklyData.find(d => d.week === w && d.brand === c);
                    row.push(cD ? cD.share : 0);
                });
                return row;
            });

            const dataComp = google.visualization.arrayToDataTable([compHeader, ...compRows]);
            const optionsComp = {
                curveType: 'function',
                focusTarget: 'category',
                colors: ['#1a73e8', '#d93025', '#f9ab00', '#1e8e3e'],
                vAxis: {format: 'percent'},
                chartArea: {width: '85%', height: '70%'},
                legend: {position: 'bottom'}
            };
            new google.visualization.LineChart(document.getElementById('chart_competitiveness')).draw(dataComp, optionsComp);

            // --- CHART 3: LEVERS (Bar) ---
            // Calculate Avg Share with Deal vs No Deal
            let dealShare = [], noDealShare = [];
            processedData.weeklyData.filter(d => d.brand === myBrand).forEach(d => {
                if(d.deal_days > 0) dealShare.push(d.share);
                else noDealShare.push(d.share);
            });
            
            const avgDeal = dealShare.length ? dealShare.reduce((a,b)=>a+b)/dealShare.length : 0;
            const avgNoDeal = noDealShare.length ? noDealShare.reduce((a,b)=>a+b)/noDealShare.length : 0;

            const dataLevers = google.visualization.arrayToDataTable([
                ['Estado', 'Click Share Promedio', { role: 'style' }],
                ['Sin Deal', avgNoDeal, 'color: #dadce0'],
                ['Con Deal', avgDeal, 'color: #1a73e8']
            ]);
            new google.visualization.ColumnChart(document.getElementById('chart_levers')).draw(dataLevers, {
                legend: 'none',
                vAxis: {format: 'percent'},
                title: `Uplift: +${((avgDeal/avgNoDeal - 1)*100).toFixed(0)}%`
            });

            // --- CHART 4: EFFICIENCY (Scatter) ---
            // Plotting all ASINs from last week
            const lastWeekData = marketData.filter(d => d.week_date === weeks[weeks.length-1]);
            const scatterData = [['Rank', 'Share', {'type': 'string', 'role': 'style'}, {'type': 'string', 'role': 'tooltip'}]];
            
            lastWeekData.forEach(d => {
                const color = d.competitor_brand === myBrand ? '#1a73e8' : '#dadce0';
                scatterData.push([d.average_organic_rank, d.click_share, `point {fill-color: ${color}}`, `${d.competitor_brand}: ${d.product_title}`]);
            });

            const dataEff = google.visualization.arrayToDataTable(scatterData);
            const optionsEff = {
                hAxis: {direction: -1, title: 'Rank Orgánico (Invertido)'}, // Rank 1 is right
                vAxis: {title: 'Click Share', format: 'percent'},
                legend: 'none',
                tooltip: {isHtml: true}
            };
            new google.visualization.ScatterChart(document.getElementById('chart_efficiency')).draw(dataEff, optionsEff);
        }

        // ==========================================
        // 4. INSIGHTS GENERATION
        // ==========================================
        function generateInsights() {
            const container = document.getElementById('insights-container');
            const weeks = [...new Set(processedData.weeklyData.map(d => d.week))].sort();
            const lastWeek = weeks[weeks.length-1];
            
            // Logic for insights
            const myData = processedData.weeklyData.filter(d => d.brand === myBrand);
            const lastD = myData[myData.length-1];
            const prevD = myData[myData.length-2];
            
            let insights = [];

            // Insight 1: Trend
            const trendDiff = ((lastD.share - prevD.share) / prevD.share) * 100;
            const trendIcon = trendDiff > 0 ? 'trending_up' : 'trending_down';
            insights.push({
                icon: trendIcon,
                title: `Tendencia Semanal: ${trendDiff > 0 ? 'Crecimiento' : 'Contracción'} del ${Math.abs(trendDiff).toFixed(1)}%`,
                text: `La cuota de mercado pasó de ${(prevD.share*100).toFixed(1)}% a ${(lastD.share*100).toFixed(1)}% en la última semana.`
            });

            // Insight 2: Pricing
            const priceDiff = lastD.avg_price - prevD.avg_price;
            if(Math.abs(priceDiff) > 0.5) {
                insights.push({
                    icon: 'payments',
                    title: 'Cambios de Precio Detectados',
                    text: `El precio promedio varió $${priceDiff.toFixed(2)}. Esto correlaciona con el cambio en share.`
                });
            }

            // Insight 3: Competitor Threat
            const compLast = processedData.weeklyData.filter(d => d.week === lastWeek && d.brand !== myBrand).sort((a,b) => b.share - a.share)[0];
            insights.push({
                icon: 'warning',
                title: `Competidor Dominante: ${compLast.brand}`,
                text: `${compLast.brand} lidera con ${(compLast.share*100).toFixed(1)}% de share. Verificar si activaron Deals.`
            });

            // Render
            container.innerHTML = insights.map(i => `
                <li class="insight-item">
                    <span class="material-icons insight-icon">${i.icon}</span>
                    <div class="insight-text">
                        <strong>${i.title}</strong>
                        ${i.text}
                    </div>
                </li>
            `).join('');
        }

        // ==========================================
        // 5. INTERACTIVE LOGIC
        // ==========================================
        function setupControls() {
            const weeks = [...new Set(marketData.map(d => d.week_date))].sort();
            const weekSel = document.getElementById('select-week');
            weeks.forEach(w => {
                const opt = document.createElement('option');
                opt.value = w;
                opt.text = w;
                weekSel.add(opt);
            });
            weekSel.value = weeks[weeks.length-1];

            const compSel = document.getElementById('select-comp');
            topCompetitors.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.text = c;
                compSel.add(opt);
            });
        }

        function updateInteractive() {
            const week = document.getElementById('select-week').value;
            const comp = document.getElementById('select-comp').value;

            // Prepare Data for Comparison Table
            const myWeek = processedData.weeklyData.find(d => d.week === week && d.brand === myBrand) || {};
            const compWeek = processedData.weeklyData.find(d => d.week === week && d.brand === comp) || {};

            const tableData = [
                ['Métrica', myBrand, comp, 'Diferencia'],
                ['Click Share', (myWeek.share*100).toFixed(1)+'%', (compWeek.share*100).toFixed(1)+'%', ((myWeek.share-compWeek.share)*100).toFixed(1)+'%'],
                ['Precio Prom.', '$'+(myWeek.avg_price||0).toFixed(2), '$'+(compWeek.avg_price||0).toFixed(2), '$'+((myWeek.avg_price||0)-(compWeek.avg_price||0)).toFixed(2)],
                ['Rank Orgánico', (myWeek.avg_rank||0).toFixed(1), (compWeek.avg_rank||0).toFixed(1), ((compWeek.avg_rank||0)-(myWeek.avg_rank||0)).toFixed(1)], // Positiva es buena para nosotros
                ['Días con Deal', myWeek.deal_days||0, compWeek.deal_days||0, (myWeek.deal_days||0)-(compWeek.deal_days||0)]
            ];

            const dataTable = google.visualization.arrayToDataTable(tableData);
            const table = new google.visualization.Table(document.getElementById('table_comparison'));
            table.draw(dataTable, {width: '100%', height: '100%'});

            // Comparison Chart (Bar)
            const dataBar = google.visualization.arrayToDataTable([
                ['Marca', 'Click Share', { role: 'style' }],
                [myBrand, myWeek.share || 0, '#1a73e8'],
                [comp, compWeek.share || 0, '#d93025']
            ]);
            new google.visualization.ColumnChart(document.getElementById('chart_comparison')).draw(dataBar, {
                legend: 'none',
                vAxis: {format: 'percent'},
                title: 'Comparativa de Cuota de Mercado'
            });
        }

        // Tab Switching Logic
        window.switchTab = function(tabName) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('tab-static').classList.add('hidden');
            document.getElementById('tab-interactive').classList.add('hidden');
            
            document.getElementById('tab-' + tabName).classList.remove('hidden');
            
            // Redraw charts if hidden previously (Google Charts quirk)
            if(tabName === 'interactive') updateInteractive();
        }

        // Responsive Redraw
        window.onresize = function() {
            drawCharts();
            if(!document.getElementById('tab-interactive').classList.contains('hidden')) updateInteractive();
        };

    </script>
</body>
</html>