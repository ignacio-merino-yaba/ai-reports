<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASIN Performance Report</title>
    
    <!-- Google Charts & Icons -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #007AFF; /* Apple Blue */
            --bg-color: #F5F5F7;
            --card-bg: #FFFFFF;
            --text-main: #1D1D1F;
            --text-sec: #86868B;
            --success: #34C759;
            --danger: #FF3B30;
            --border-radius: 16px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header */
        header {
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        h1 { font-size: 28px; font-weight: 700; margin: 0; }
        .subtitle { color: var(--text-sec); font-size: 14px; }

        /* Navigation Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: rgba(0,0,0,0.05);
            padding: 5px;
            border-radius: 12px;
            width: fit-content;
        }
        .tab-btn {
            border: none;
            background: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            color: var(--text-sec);
            cursor: pointer;
            transition: all 0.2s;
        }
        .tab-btn.active {
            background: var(--card-bg);
            color: var(--primary-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .card-title { font-size: 18px; font-weight: 600; }

        /* Grid Layouts */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }

        /* Metrics */
        .metric-box {
            text-align: center;
            padding: 15px;
            border-radius: 12px;
            background: #FAFAFA;
        }
        .metric-val { font-size: 24px; font-weight: 700; display: block; }
        .metric-label { font-size: 12px; color: var(--text-sec); text-transform: uppercase; letter-spacing: 0.5px; }

        /* Insights List */
        ul.insights-list { list-style: none; padding: 0; margin: 0; }
        ul.insights-list li {
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: start;
            gap: 10px;
        }
        ul.insights-list li:last-child { border-bottom: none; }
        .icon-blue { color: var(--primary-color); }
        .icon-green { color: var(--success); }
        .icon-red { color: var(--danger); }

        /* Charts */
        .chart-container { width: 100%; height: 350px; }

        /* Interactive Controls */
        select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 14px;
            background: white;
            min-width: 150px;
        }

        /* Utilities */
        .hidden { display: none; }
        .badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
        }
        .badge-our { background: #E3F2FD; color: #1565C0; }
        .badge-comp { background: #FFEBEE; color: #C62828; }

        @media (max-width: 768px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1>ASIN Intelligence Report</h1>
            <div class="subtitle" id="report-period">Analyzing Last 4 Weeks</div>
        </div>
        <div style="text-align: right;">
            <span class="badge badge-our" style="font-size: 14px; padding: 8px 16px;">
                Our Brand: <span id="header-brand-name">Loading...</span>
            </span>
        </div>
    </header>

    <!-- Navigation -->
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('static')">Strategic Analysis</button>
        <button class="tab-btn" onclick="switchTab('interactive')">Competitor Comparator</button>
    </div>

    <!-- TAB 1: STATIC REPORT -->
    <div id="tab-static">
        
        <!-- Section 1: Global Trend -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">1. Global Parent Trend</div>
                <span class="material-icons" style="color:#888">trending_up</span>
            </div>
            <div class="grid-2">
                <div id="chart_trend" class="chart-container"></div>
                <div>
                    <h4>Key Insights</h4>
                    <ul class="insights-list" id="trend-insights">
                        <!-- JS injected -->
                    </ul>
                </div>
            </div>
        </div>

        <!-- Section 2: Competitiveness -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">2. Brand Competitiveness (Click Share)</div>
                <span class="material-icons" style="color:#888">pie_chart</span>
            </div>
            <div id="chart_share" class="chart-container" style="height: 400px;"></div>
            <div style="margin-top: 15px; font-size: 14px; color: var(--text-sec);">
                * Curve analysis showing click share evolution of our brand vs top 3 competitors.
            </div>
        </div>

        <!-- Section 3 & 4: Levers & Efficiency -->
        <div class="grid-2">
            <!-- Efficiency -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">4. Efficiency (Rank vs. Share)</div>
                </div>
                <div id="chart_efficiency" class="chart-container"></div>
                <p style="font-size: 12px; color: #666; text-align: center;">X: Organic Rank (Lower is Better) | Y: Click Share</p>
            </div>

            <!-- Insights Summary -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">5. Strategic Conclusions</div>
                </div>
                <div id="conclusions-container">
                    <!-- JS Injected -->
                </div>
                
                <h4 style="margin-top: 20px;">Actionable Recommendations</h4>
                <ul class="insights-list" id="recommendations-list">
                    <!-- JS Injected -->
                </ul>
            </div>
        </div>
    </div>

    <!-- TAB 2: INTERACTIVE COMPARATOR -->
    <div id="tab-interactive" class="hidden">
        <div class="card">
            <div class="card-header">
                <div class="card-title">Head-to-Head Comparator</div>
                <div style="display: flex; gap: 10px;">
                    <select id="select-week" onchange="updateComparator()">
                        <!-- Options filled by JS -->
                    </select>
                    <select id="select-competitor" onchange="updateComparator()">
                        <!-- Options filled by JS -->
                    </select>
                </div>
            </div>

            <!-- Metrics Grid -->
            <div class="grid-3" style="margin-bottom: 30px;">
                <div class="metric-box">
                    <span class="metric-label">Price Gap</span>
                    <span class="metric-val" id="comp-price-gap">--</span>
                    <span style="font-size: 12px;" id="comp-price-detail">--</span>
                </div>
                <div class="metric-box">
                    <span class="metric-label">Share Gap</span>
                    <span class="metric-val" id="comp-share-gap">--</span>
                    <span style="font-size: 12px;" id="comp-share-detail">--</span>
                </div>
                <div class="metric-box">
                    <span class="metric-label">Rank Gap</span>
                    <span class="metric-val" id="comp-rank-gap">--</span>
                    <span style="font-size: 12px;" id="comp-rank-detail">--</span>
                </div>
            </div>

            <!-- Detailed Table -->
            <h4>Listing Details (Selected Week)</h4>
            <div id="table_div" style="width: 100%;"></div>
        </div>
    </div>

</div>

<script>
    // --- 1. DATA INJECTION ---
    const payload = {"our_brand": "NaturaleBio", "top_competitors": ["Perfect Ted", "SuperSelf", "Double"], "insights": ["<b>Global Trend:</b> Our brand click share is increasing (12.1% -> 13.1%) in the last week.", "<b>Market Leader:</b> Perfect Ted is currently the dominant player in click share.", "<b>Price Impact:</b> Our average price is 12.49. Deals show limited uplift.", "<b>Efficiency:</b> We have identified 3 keywords where we rank in Top 10.", "<b>Competitor Threat:</b> Perfect Ted remains the strongest direct competitor."], "recommendations": ["<b>Defend Top Ranks:</b> Ensure inventory stability for keywords where Rank < 5.", "<b>Pricing Strategy:</b> Review price competitiveness against Perfect Ted.", "<b>Deal Activation:</b> Consider increasing deal frequency if uplift is positive."], "trend_data": [["Week", "My Brand Clicks", "Competitor Clicks"], ["2026-03", 6205.5220500000005, 20537.979644], ["2026-04", 5852.478389999999, 27501.811674], ["2026-06", 5182.084063, 22220.20813]], "share_data": [["Week", "Double", "NaturaleBio", "Perfect Ted", "Rest of Market", "SuperSelf"], ["2026-03", 4.67, 13.5, 13.620000000000001, 10.120000000000001, 16.27], ["2026-04", 6.13, 12.1, 23.68, 12.830000000000002, 14.22], ["2026-06", 7.77, 13.13, 32.36, 5.33, 10.84]], "efficiency_data": [["Organic Rank", "My Brand", "Competitors", {"role": "tooltip"}], [8, null, 5.95, "Heapwell Superfoods | Heapwell Matcha Powder - 50g |... | $8.704285714"], [3, null, 5.86, "Perfect Ted | PerfectTed Original Matcha Pow... | $16.99"], [12, null, 4.67, "Double | Double Dragon | 100% Organic |... | $6.957142857"], [40, null, 1.93, "sevenhills wholefoods | Sevenhills Wholefoods Organic ... | $9.248571429"], [1, 13.5, null, "NaturaleBio | NaturaleBio Japanese Organic M... | $12.49"], [7, null, 7.76, "Perfect Ted | PerfectTed Organic Matcha Powd... | $8.49"], [7, null, 2.63, "SuperSelf | SuperSelf Organic Matcha Powde... | $15.58"], [3, null, 13.64, "SuperSelf | SuperSelf Organic Matcha Powde... | $9.9"], [11, null, 2.24, "PureChimp | PureChimp Ceremonial Grade Mat... | $12.49"], [6, null, 1.89, "SuperSelf | SuperSelf Organic Matcha Powde... | $19.18"], [26, null, 2.12, "Nu | Nu U Nutrition - Matcha Green ... | $15.97"], [4, null, 4.64, "Perfect Ted | PerfectTed Original Matcha Pow... | $16.99"], [7, null, 8.38, "Heapwell Superfoods | Heapwell Matcha Powder - 50g |... | $8.704285714"], [21, null, 2.33, "Organic | Organic Matcha Powder - Premiu... | $8.49"], [10, null, 6.13, "Double | Double Dragon | 100% Organic |... | $5.89"], [2, null, 12.33, "SuperSelf | SuperSelf Organic Matcha Powde... | $9.9"], [2, 12.1, null, "NaturaleBio | NaturaleBio Japanese Organic M... | $12.49"], [11, null, 4.1, "Perfect Ted | PerfectTed Vanilla Bean Matcha... | $8.45"], [7, null, 14.94, "Perfect Ted | PerfectTed Organic Matcha Powd... | $8.49"], [8, null, 6.31, "Perfect Ted | PerfectTed Vanilla Bean Matcha... | $8.5"], [7, null, 3.8, "Heapwell Superfoods | Heapwell Matcha Powder - 50g |... | $9.99"], [2, 13.13, null, "NaturaleBio | NaturaleBio Japanese Organic M... | $12.49"], [7, null, 1.72, "SuperSelf | SuperSelf Organic Matcha Powde... | $19.18"], [1, null, 23.24, "Perfect Ted | PerfectTed Organic Matcha Powd... | $8.49"], [6, null, 2.81, "Perfect Ted | PerfectTed Original Matcha Pow... | $18.99"], [4, null, 9.12, "SuperSelf | SuperSelf Organic Matcha Powde... | $9.9"], [7, null, 7.77, "Double | Double Dragon | 100% Organic |... | $6.94"], [14, null, 1.53, "PureChimp | PureChimp Ceremonial Grade Mat... | $12.841428571"]], "raw_data": [{"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-17", "week_date": "2026-03", "keywords": "matcha powder", "competitor_brand": "Heapwell Superfoods", "asin": "B06XTYYYJ8", "product_title": "Heapwell Matcha Powder - 50g | High Grade Japanese...", "country_code": "uk", "average_organic_rank": 8, "weekly_number_of_days_with_deal": 6, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 5.95, "impression_share": 5.55, "price": 8.704285714, "click_share_rank": 4, "weekly_search_volume": 45966.83, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "Heapwell Superfoods", "brand_type": "Competitor", "est_clicks": 2735.026385, "chart_brand": "Rest of Market"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-17", "week_date": "2026-03", "keywords": "matcha powder", "competitor_brand": "Perfect Ted", "asin": "B0F21VZMJQ", "product_title": "PerfectTed Original Matcha Powder, Ceremonial Grad...", "country_code": "uk", "average_organic_rank": 3, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 5.86, "impression_share": 3.37, "price": 16.99, "click_share_rank": 5, "weekly_search_volume": 45966.83, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "Perfect Ted", "brand_type": "Competitor", "est_clicks": 2693.656238, "chart_brand": "Perfect Ted"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-17", "week_date": "2026-03", "keywords": "matcha powder", "competitor_brand": null, "asin": "B08YRXQ2JH", "product_title": "Double Dragon | 100% Organic | Premium Matcha Gree...", "country_code": "uk", "average_organic_rank": 12, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 4.67, "impression_share": 3.5, "price": 6.957142857, "click_share_rank": 6, "weekly_search_volume": 45966.83, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "Double", "brand_type": "Competitor", "est_clicks": 2146.650961, "chart_brand": "Double"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-17", "week_date": "2026-03", "keywords": "matcha powder", "competitor_brand": "sevenhills wholefoods", "asin": "B07DL9M4NS", "product_title": "Sevenhills Wholefoods Organic Japanese Matcha Tea ...", "country_code": "uk", "average_organic_rank": 40, "weekly_number_of_days_with_deal": 1, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 1.93, "impression_share": 2.08, "price": 9.248571429, "click_share_rank": 10, "weekly_search_volume": 45966.83, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "sevenhills wholefoods", "brand_type": "Competitor", "est_clicks": 887.159819, "chart_brand": "Rest of Market"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-17", "week_date": "2026-03", "keywords": "matcha powder", "competitor_brand": "NaturaleBio", "asin": "B06XQ5DCYJ", "product_title": "NaturaleBio Japanese Organic Matcha Green Tea Powd...", "country_code": "uk", "average_organic_rank": 1, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 13.5, "impression_share": 3.34, "price": 12.49, "click_share_rank": 2, "weekly_search_volume": 45966.83, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "NaturaleBio", "brand_type": "My Brand", "est_clicks": 6205.52205, "chart_brand": "NaturaleBio"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-17", "week_date": "2026-03", "keywords": "matcha powder", "competitor_brand": "Perfect Ted", "asin": "B09DQ1PWGX", "product_title": "PerfectTed Organic Matcha Powder, Ceremonial Grade...", "country_code": "uk", "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 7.76, "impression_share": 5.78, "price": 8.49, "click_share_rank": 3, "weekly_search_volume": 45966.83, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "Perfect Ted", "brand_type": "Competitor", "est_clicks": 3567.026008, "chart_brand": "Perfect Ted"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-17", "week_date": "2026-03", "keywords": "matcha powder", "competitor_brand": "SuperSelf", "asin": "B082DKRSB4", "product_title": "SuperSelf Organic Matcha Powder - Ceremonial Grade...", "country_code": "uk", "average_organic_rank": 7, "weekly_number_of_days_with_deal": 6, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "click_share": 2.63, "impression_share": 3.72, "price": 15.58, "click_share_rank": 7, "weekly_search_volume": 45966.83, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "SuperSelf", "brand_type": "Competitor", "est_clicks": 1208.927629, "chart_brand": "SuperSelf"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-17", "week_date": "2026-03", "keywords": "matcha powder", "competitor_brand": "SuperSelf", "asin": "B08YK2RPBZ", "product_title": "SuperSelf Organic Matcha Powder - Ceremonial Grade...", "country_code": "uk", "average_organic_rank": 3, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "click_share": 13.64, "impression_share": 3.69, "price": 9.9, "click_share_rank": 1, "weekly_search_volume": 45966.83, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "SuperSelf", "brand_type": "Competitor", "est_clicks": 6269.875612, "chart_brand": "SuperSelf"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-17", "week_date": "2026-03", "keywords": "matcha powder", "competitor_brand": "PureChimp", "asin": "B00HNDSOCI", "product_title": "PureChimp Ceremonial Grade Matcha Powder 50g. 100%...", "country_code": "uk", "average_organic_rank": 11, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 2.24, "impression_share": 3.78, "price": 12.49, "click_share_rank": 8, "weekly_search_volume": 45966.83, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "PureChimp", "brand_type": "Competitor", "est_clicks": 1029.656992, "chart_brand": "Rest of Market"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-24", "week_date": "2026-04", "keywords": "matcha powder", "competitor_brand": "SuperSelf", "asin": "B082DKRSB4", "product_title": "SuperSelf Organic Matcha Powder - Ceremonial Grade...", "country_code": "uk", "average_organic_rank": 6, "weekly_number_of_days_with_deal": 1, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "click_share": 1.89, "impression_share": 3.81, "price": 19.18, "click_share_rank": 10, "weekly_search_volume": 48367.59, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "SuperSelf", "brand_type": "Competitor", "est_clicks": 914.147451, "chart_brand": "SuperSelf"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-24", "week_date": "2026-04", "keywords": "matcha powder", "competitor_brand": null, "asin": "B06XW9JN88", "product_title": "Nu U Nutrition - Matcha Green Tea Powder 250g - XL...", "country_code": "uk", "average_organic_rank": 26, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 2.12, "impression_share": 1.64, "price": 15.97, "click_share_rank": 9, "weekly_search_volume": 48367.59, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "Nu", "brand_type": "Competitor", "est_clicks": 1025.392908, "chart_brand": "Rest of Market"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-24", "week_date": "2026-04", "keywords": "matcha powder", "competitor_brand": "Perfect Ted", "asin": "B0F21VZMJQ", "product_title": "PerfectTed Original Matcha Powder, Ceremonial Grad...", "country_code": "uk", "average_organic_rank": 4, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 4.64, "impression_share": 3.48, "price": 16.99, "click_share_rank": 6, "weekly_search_volume": 48367.59, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "Perfect Ted", "brand_type": "Competitor", "est_clicks": 2244.256176, "chart_brand": "Perfect Ted"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-24", "week_date": "2026-04", "keywords": "matcha powder", "competitor_brand": "Heapwell Superfoods", "asin": "B06XTYYYJ8", "product_title": "Heapwell Matcha Powder - 50g | High Grade Japanese...", "country_code": "uk", "average_organic_rank": 7, "weekly_number_of_days_with_deal": 6, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 8.38, "impression_share": 6.08, "price": 8.704285714, "click_share_rank": 4, "weekly_search_volume": 48367.59, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "Heapwell Superfoods", "brand_type": "Competitor", "est_clicks": 4053.204042, "chart_brand": "Rest of Market"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-24", "week_date": "2026-04", "keywords": "matcha powder", "competitor_brand": null, "asin": "B0FSRNBC9H", "product_title": "Organic Matcha Powder - Premium Culinary Grade & 1...", "country_code": "uk", "average_organic_rank": 21, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 2.33, "impression_share": 2.8, "price": 8.49, "click_share_rank": 8, "weekly_search_volume": 48367.59, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "Organic", "brand_type": "Competitor", "est_clicks": 1126.964847, "chart_brand": "Rest of Market"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-24", "week_date": "2026-04", "keywords": "matcha powder", "competitor_brand": null, "asin": "B08YRXQ2JH", "product_title": "Double Dragon | 100% Organic | Premium Matcha Gree...", "country_code": "uk", "average_organic_rank": 10, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 6.13, "impression_share": 3.49, "price": 5.89, "click_share_rank": 5, "weekly_search_volume": 48367.59, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "Double", "brand_type": "Competitor", "est_clicks": 2964.933267, "chart_brand": "Double"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-24", "week_date": "2026-04", "keywords": "matcha powder", "competitor_brand": "SuperSelf", "asin": "B08YK2RPBZ", "product_title": "SuperSelf Organic Matcha Powder - Ceremonial Grade...", "country_code": "uk", "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 5, "weekly_number_of_days_with_coupon": 7, "click_share": 12.33, "impression_share": 3.96, "price": 9.9, "click_share_rank": 2, "weekly_search_volume": 48367.59, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "SuperSelf", "brand_type": "Competitor", "est_clicks": 5963.723847, "chart_brand": "SuperSelf"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-24", "week_date": "2026-04", "keywords": "matcha powder", "competitor_brand": "NaturaleBio", "asin": "B06XQ5DCYJ", "product_title": "NaturaleBio Japanese Organic Matcha Green Tea Powd...", "country_code": "uk", "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 12.1, "impression_share": 3.65, "price": 12.49, "click_share_rank": 3, "weekly_search_volume": 48367.59, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "NaturaleBio", "brand_type": "My Brand", "est_clicks": 5852.47839, "chart_brand": "NaturaleBio"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-24", "week_date": "2026-04", "keywords": "matcha powder", "competitor_brand": "Perfect Ted", "asin": "B0D9M91WZD", "product_title": "PerfectTed Vanilla Bean Matcha Powder, Ceremonial ...", "country_code": "uk", "average_organic_rank": 11, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 4.1, "impression_share": 4.88, "price": 8.45, "click_share_rank": 7, "weekly_search_volume": 48367.59, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "Perfect Ted", "brand_type": "Competitor", "est_clicks": 1983.07119, "chart_brand": "Perfect Ted"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-24", "week_date": "2026-04", "keywords": "matcha powder", "competitor_brand": "Perfect Ted", "asin": "B09DQ1PWGX", "product_title": "PerfectTed Organic Matcha Powder, Ceremonial Grade...", "country_code": "uk", "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 14.94, "impression_share": 6.21, "price": 8.49, "click_share_rank": 1, "weekly_search_volume": 48367.59, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "Perfect Ted", "brand_type": "Competitor", "est_clicks": 7226.117946, "chart_brand": "Perfect Ted"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-02-07", "week_date": "2026-06", "keywords": "matcha powder", "competitor_brand": "Perfect Ted", "asin": "B0D9M91WZD", "product_title": "PerfectTed Vanilla Bean Matcha Powder, Ceremonial ...", "country_code": "uk", "average_organic_rank": 8, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 6.31, "impression_share": 5.29, "price": 8.5, "click_share_rank": 5, "weekly_search_volume": 39467.51, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "Perfect Ted", "brand_type": "Competitor", "est_clicks": 2490.399881, "chart_brand": "Perfect Ted"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-02-07", "week_date": "2026-06", "keywords": "matcha powder", "competitor_brand": "Heapwell Superfoods", "asin": "B06XTYYYJ8", "product_title": "Heapwell Matcha Powder - 50g | High Grade Japanese...", "country_code": "uk", "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 3.8, "impression_share": 5.77, "price": 9.99, "click_share_rank": 6, "weekly_search_volume": 39467.51, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "Heapwell Superfoods", "brand_type": "Competitor", "est_clicks": 1499.76538, "chart_brand": "Rest of Market"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-02-07", "week_date": "2026-06", "keywords": "matcha powder", "competitor_brand": "NaturaleBio", "asin": "B06XQ5DCYJ", "product_title": "NaturaleBio Japanese Organic Matcha Green Tea Powd...", "country_code": "uk", "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 13.13, "impression_share": 4.01, "price": 12.49, "click_share_rank": 2, "weekly_search_volume": 39467.51, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "NaturaleBio", "brand_type": "My Brand", "est_clicks": 5182.084063, "chart_brand": "NaturaleBio"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-02-07", "week_date": "2026-06", "keywords": "matcha powder", "competitor_brand": "SuperSelf", "asin": "B082DKRSB4", "product_title": "SuperSelf Organic Matcha Powder - Ceremonial Grade...", "country_code": "uk", "average_organic_rank": 7, "weekly_number_of_days_with_deal": 1, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "click_share": 1.72, "impression_share": 3.37, "price": 19.18, "click_share_rank": 8, "weekly_search_volume": 39467.51, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "SuperSelf", "brand_type": "Competitor", "est_clicks": 678.841172, "chart_brand": "SuperSelf"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-02-07", "week_date": "2026-06", "keywords": "matcha powder", "competitor_brand": "Perfect Ted", "asin": "B09DQ1PWGX", "product_title": "PerfectTed Organic Matcha Powder, Ceremonial Grade...", "country_code": "uk", "average_organic_rank": 1, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 23.24, "impression_share": 6.14, "price": 8.49, "click_share_rank": 1, "weekly_search_volume": 39467.51, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "Perfect Ted", "brand_type": "Competitor", "est_clicks": 9172.249324, "chart_brand": "Perfect Ted"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-02-07", "week_date": "2026-06", "keywords": "matcha powder", "competitor_brand": "Perfect Ted", "asin": "B0F21VZMJQ", "product_title": "PerfectTed Original Matcha Powder, Ceremonial Grad...", "country_code": "uk", "average_organic_rank": 6, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 2.81, "impression_share": 3.47, "price": 18.99, "click_share_rank": 7, "weekly_search_volume": 39467.51, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "Perfect Ted", "brand_type": "Competitor", "est_clicks": 1109.037031, "chart_brand": "Perfect Ted"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-02-07", "week_date": "2026-06", "keywords": "matcha powder", "competitor_brand": "SuperSelf", "asin": "B08YK2RPBZ", "product_title": "SuperSelf Organic Matcha Powder - Ceremonial Grade...", "country_code": "uk", "average_organic_rank": 4, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 9.12, "impression_share": 4.06, "price": 9.9, "click_share_rank": 3, "weekly_search_volume": 39467.51, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "SuperSelf", "brand_type": "Competitor", "est_clicks": 3599.436912, "chart_brand": "SuperSelf"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-02-07", "week_date": "2026-06", "keywords": "matcha powder", "competitor_brand": null, "asin": "B08YRXQ2JH", "product_title": "Double Dragon | 100% Organic | Premium Matcha Gree...", "country_code": "uk", "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 7.77, "impression_share": 3.4, "price": 6.94, "click_share_rank": 4, "weekly_search_volume": 39467.51, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "Double", "brand_type": "Competitor", "est_clicks": 3066.625527, "chart_brand": "Double"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-02-07", "week_date": "2026-06", "keywords": "matcha powder", "competitor_brand": "PureChimp", "asin": "B00HNDSOCI", "product_title": "PureChimp Ceremonial Grade Matcha Powder 50g. 100%...", "country_code": "uk", "average_organic_rank": 14, "weekly_number_of_days_with_deal": 6, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 1, "click_share": 1.53, "impression_share": 2.85, "price": 12.841428571, "click_share_rank": 9, "weekly_search_volume": 39467.51, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.co.uk/s?k=matcha+powder", "real_brand": "PureChimp", "brand_type": "Competitor", "est_clicks": 603.852903, "chart_brand": "Rest of Market"}]};

    // --- 2. INITIALIZATION ---
    document.getElementById('header-brand-name').innerText = payload.our_brand;
    document.getElementById('report-period').innerText = `Data Range: ${payload.trend_data[1][0]} to ${payload.trend_data[payload.trend_data.length-1][0]}`;

    // Populate Insights
    const trendList = document.getElementById('trend-insights');
    payload.insights.forEach(txt => {
        const li = document.createElement('li');
        li.innerHTML = `<span class="material-icons icon-blue">analytics</span><span>${txt}</span>`;
        trendList.appendChild(li);
    });

    const recList = document.getElementById('recommendations-list');
    payload.recommendations.forEach(txt => {
        const li = document.createElement('li');
        li.innerHTML = `<span class="material-icons icon-green">check_circle</span><span>${txt}</span>`;
        recList.appendChild(li);
    });

    // Populate Selectors for Comparator
    const weeks = [...new Set(payload.raw_data.map(d => d.week_date))].sort();
    const compSelector = document.getElementById('select-competitor');
    const weekSelector = document.getElementById('select-week');
    
    weeks.forEach(w => {
        let opt = document.createElement('option');
        opt.value = w;
        opt.text = w;
        weekSelector.add(opt);
    });
    // Set last week by default
    weekSelector.value = weeks[weeks.length-1];

    payload.top_competitors.forEach(c => {
        let opt = document.createElement('option');
        opt.value = c;
        opt.text = c;
        compSelector.add(opt);
    });

    // --- 3. GOOGLE CHARTS LOGIC ---
    google.charts.load('current', {'packages':['corechart', 'table']});
    google.charts.setOnLoadCallback(drawCharts);

    function drawCharts() {
        // A. GLOBAL TREND (Combo)
        var trendData = google.visualization.arrayToDataTable(payload.trend_data);
        var trendOptions = {
            title: 'Weekly Estimated Clicks: Us vs Competitors',
            seriesType: 'bars',
            colors: ['#007AFF', '#86868B'],
            legend: { position: 'bottom' },
            vAxis: { title: 'Est. Clicks' }
        };
        var trendChart = new google.visualization.ComboChart(document.getElementById('chart_trend'));
        trendChart.draw(trendData, trendOptions);

        // B. BRAND SHARE (Line)
        var shareData = google.visualization.arrayToDataTable(payload.share_data);
        var shareOptions = {
            curveType: 'function',
            legend: { position: 'right' },
            lineWidth: 3,
            vAxis: { title: 'Click Share (%)' },
            colors: ['#FF3B30', '#007AFF', '#FF9500', '#86868B', '#5856D6'] // Custom colors, ours is Blue
        };
        var shareChart = new google.visualization.LineChart(document.getElementById('chart_share'));
        shareChart.draw(shareData, shareOptions);

        // C. EFFICIENCY (Scatter)
        var effData = google.visualization.arrayToDataTable(payload.efficiency_data);
        var effOptions = {
            hAxis: { title: 'Organic Rank', direction: -1 }, // Reverse scale so Rank 1 is right/top
            vAxis: { title: 'Click Share (%)' },
            colors: ['#007AFF', '#FF3B30'],
            legend: { position: 'bottom' }
        };
        var effChart = new google.visualization.ScatterChart(document.getElementById('chart_efficiency'));
        effChart.draw(effData, effOptions);

        // D. INITIALIZE COMPARATOR
        updateComparator();
    }

    // --- 4. INTERACTIVE LOGIC ---
    function switchTab(tabName) {
        document.getElementById('tab-static').classList.add('hidden');
        document.getElementById('tab-interactive').classList.add('hidden');
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        
        document.getElementById('tab-' + tabName).classList.remove('hidden');
        event.target.classList.add('active');
    }

    function updateComparator() {
        const week = document.getElementById('select-week').value;
        const comp = document.getElementById('select-competitor').value;
        
        // Filter Data
        const weekData = payload.raw_data.filter(d => d.week_date === week);
        
        // My Data (Aggregated for week)
        const myData = weekData.filter(d => d.real_brand === payload.our_brand);
        const compData = weekData.filter(d => d.real_brand === comp);

        if (myData.length === 0 || compData.length === 0) {
            document.getElementById('table_div').innerHTML = "<p style='padding:20px'>No data overlap for this selection.</p>";
            return;
        }

        // Metrics Calc (Weighted Avg by Share usually, but here simple mean for display)
        const getAvg = (arr, key) => arr.reduce((acc, c) => acc + c[key], 0) / arr.length;
        
        const myPrice = getAvg(myData, 'price');
        const compPrice = getAvg(compData, 'price');
        
        const myShare = getAvg(myData, 'click_share');
        const compShare = getAvg(compData, 'click_share');
        
        const myRank = getAvg(myData, 'average_organic_rank');
        const compRank = getAvg(compData, 'average_organic_rank');

        // Update DOM
        const setMetric = (id, val, detail) => {
            document.getElementById(id).innerText = val;
            document.getElementById(id.replace('gap', 'detail')).innerText = detail;
        };

        const priceDiff = ((myPrice - compPrice) / compPrice * 100).toFixed(1);
        setMetric('comp-price-gap', `${priceDiff}%`, `Us: $${myPrice.toFixed(2)} vs Them: $${compPrice.toFixed(2)}`);
        
        const shareDiff = (myShare - compShare).toFixed(1);
        setMetric('comp-share-gap', `${shareDiff > 0 ? '+' : ''}${shareDiff}%`, `Share gap points`);
        
        setMetric('comp-rank-gap', `${(myRank - compRank).toFixed(1)}`, `Rank diff (Lower is better)`);

        // Draw Table
        const tableData = new google.visualization.DataTable();
        tableData.addColumn('string', 'Brand');
        tableData.addColumn('string', 'Product');
        tableData.addColumn('number', 'Price');
        tableData.addColumn('number', 'Share %');
        tableData.addColumn('number', 'Rank');
        tableData.addColumn('string', 'Deals?');

        const rows = [];
        [...myData, ...compData].forEach(r => {
            rows.push([
                r.real_brand,
                r.product_title.substring(0, 40) + '...',
                r.price,
                r.click_share,
                r.average_organic_rank,
                r.weekly_number_of_days_with_deal > 0 ? 'YES' : 'NO'
            ]);
        });
        
        tableData.addRows(rows);
        var table = new google.visualization.Table(document.getElementById('table_div'));
        table.draw(tableData, {showRowNumber: true, width: '100%', height: '100%'});
    }
</script>

</body>
</html>