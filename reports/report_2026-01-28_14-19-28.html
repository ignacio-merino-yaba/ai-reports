<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte Parent ASIN: Matcha Ceremonial</title>
    
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Google Charts -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
        :root {
            --primary: #2563EB; /* Blue for Us */
            --secondary: #64748B; /* Slate for UI */
            --danger: #EF4444; /* Red for threats */
            --success: #10B981; /* Green for wins */
            --bg: #F8FAFC;
            --card-bg: #FFFFFF;
            --text-main: #1E293B;
            --text-sub: #64748B;
            --radius: 16px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }
        h1 { margin: 0; font-size: 24px; font-weight: 700; }
        .subtitle { color: var(--text-sub); font-size: 14px; }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            background: rgba(255,255,255,0.5);
            padding: 6px;
            border-radius: 12px;
            width: fit-content;
        }
        .tab-btn {
            border: none;
            background: transparent;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            color: var(--text-sub);
            cursor: pointer;
            transition: all 0.2s;
        }
        .tab-btn.active {
            background: var(--card-bg);
            color: var(--primary);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* Grid System */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px; }
        .grid-1 { display: grid; grid-template-columns: 1fr; gap: 24px; margin-bottom: 24px; }
        
        @media (max-width: 768px) {
            .grid-2 { grid-template-columns: 1fr; }
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }
        .card h3 { margin-top: 0; font-size: 16px; color: var(--text-sub); font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .card h3 .material-icons { font-size: 18px; }

        /* KPIs */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        .kpi-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        .kpi-value { font-size: 28px; font-weight: 700; color: var(--primary); }
        .kpi-label { font-size: 12px; color: var(--text-sub); text-transform: uppercase; letter-spacing: 0.5px; }

        /* Lists */
        ul.insights-list { padding-left: 20px; margin-bottom: 0; }
        ul.insights-list li { margin-bottom: 12px; color: var(--text-main); }
        ul.insights-list b { color: var(--primary); }

        /* Chart Containers */
        .chart-container { width: 100%; height: 350px; }

        /* Interactive Controls */
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            background: var(--card-bg);
            padding: 16px;
            border-radius: var(--radius);
        }
        select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #E2E8F0;
            font-family: inherit;
        }

        /* Utility */
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <div>
                <h1>Análisis Estratégico de Parent ASIN</h1>
                <div class="subtitle">Parent: Matcha Ceremonial | Brand: NaturaleBio</div>
            </div>
            <div style="text-align: right; font-size: 12px; color: #94A3B8;">
                Generado por AI Analyst<br>
                Fuente: Amazon Market Intelligence
            </div>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('report')">Reporte Estratégico</button>
            <button class="tab-btn" onclick="switchTab('interactive')">Comparador Interactivo</button>
        </div>

        <!-- TAB 1: REPORT -->
        <div id="tab-report">
            
            <!-- KPIs -->
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-value" id="kpi-share">--%</div>
                    <div class="kpi-label">Click Share (NaturaleBio)</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value" id="kpi-clicks">--</div>
                    <div class="kpi-label">Est. Clicks (Semana)</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value" id="kpi-price">--€</div>
                    <div class="kpi-label">Precio Promedio</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value" id="kpi-rank">--</div>
                    <div class="kpi-label">Avg Organic Rank</div>
                </div>
            </div>

            <!-- Global Trend -->
            <div class="card" style="margin-bottom: 24px;">
                <h3><span class="material-icons">show_chart</span> 1. Tendencia Global del Parent (Tracción)</h3>
                <div id="chart_global_trend" class="chart-container"></div>
            </div>

            <div class="grid-2">
                <!-- Competitiveness -->
                <div class="card">
                    <h3><span class="material-icons">pie_chart</span> 2. Competitividad de Marca (Share)</h3>
                    <div id="chart_competitiveness" class="chart-container"></div>
                </div>
                
                <!-- Efficiency -->
                <div class="card">
                    <h3><span class="material-icons">scatter_plot</span> 4. Eficiencia (Rank vs Share)</h3>
                    <div id="chart_efficiency" class="chart-container"></div>
                    <div style="font-size: 12px; color: #64748B; text-align: center; margin-top: 8px;">
                        *Eje X: Organic Rank (Invertido) | Eje Y: Click Share | Puntos Azules = NaturaleBio
                    </div>
                </div>
            </div>

            <!-- Insights Section -->
            <div class="grid-2">
                <div class="card" style="background: #F0F9FF; border: 1px solid #BAE6FD;">
                    <h3 style="color: #0369A1;"><span class="material-icons">lightbulb</span> 5. Conclusiones Clave</h3>
                    <ul class="insights-list" id="insights-container"></ul>
                </div>
                <div class="card" style="background: #F0FDF4; border: 1px solid #BBF7D0;">
                    <h3 style="color: #15803D;"><span class="material-icons">task_alt</span> Recomendaciones</h3>
                    <ul class="insights-list" id="recommendations-container"></ul>
                </div>
            </div>
            
            <!-- Levers Analysis (Textual/Table) -->
            <div class="card">
                 <h3><span class="material-icons">tune</span> 3. Palancas de Tracción (Análisis)</h3>
                 <div id="levers_table_div"></div>
            </div>

        </div>

        <!-- TAB 2: INTERACTIVE -->
        <div id="tab-interactive" class="hidden">
            <div class="controls">
                <div>
                    <label style="font-size: 12px; display: block; margin-bottom: 4px;">Semana</label>
                    <select id="sel-week" onchange="drawInteractiveTable()"></select>
                </div>
                <div>
                    <label style="font-size: 12px; display: block; margin-bottom: 4px;">Competidor</label>
                    <select id="sel-competitor" onchange="drawInteractiveTable()">
                        <option value="ALL">Todos</option>
                    </select>
                </div>
            </div>
            <div class="card">
                <h3>Detalle de ASINs</h3>
                <div id="table_interactive" style="width: 100%;"></div>
            </div>
        </div>

    </div>

    <script>
        // --- DATA INJECTION ---
        const marketData = [{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha ceremonial grade","competitor_brand":"NaturaleBio","asin":"B06XQ5DCYJ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":4,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":5.08,"impression_share":3.26,"price":13.99,"click_share_rank":4,"weekly_search_volume":963.2,"is_yaba_asin":"Y","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"NaturaleBio","estimated_clicks":48.93056,"brand_bucket":"Our Brand","week_date_str":"2026-01"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha ceremonial grade","competitor_brand":"NaturaleBio","asin":"B07SZFD3P9","product_title":"NaturaleBio Matcha Ceremonial Grade 100g. Original...","country_code":"de","average_organic_rank":10,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":5.74,"impression_share":5.46,"price":28.99,"click_share_rank":3,"weekly_search_volume":963.2,"is_yaba_asin":"Y","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"NaturaleBio","estimated_clicks":55.28768,"brand_bucket":"Our Brand","week_date_str":"2026-01"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha ceremonial grade","competitor_brand":"NORITUAL LAB","asin":"B0CNRX8G5S","product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","country_code":"de","average_organic_rank":1,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":4,"weekly_number_of_days_with_coupon":0,"click_share":17.86,"impression_share":3.27,"price":22.9,"click_share_rank":1,"weekly_search_volume":963.2,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"NORITUAL LAB","estimated_clicks":172.02752,"brand_bucket":"NORITUAL LAB","week_date_str":"2026-01"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha ceremonial grade","competitor_brand":null,"asin":"B0F9B1LWQQ","product_title":"UNREAL\u00ae 100g Ceremonial Bio Matcha \u2013 100% Japanisc...","country_code":"de","average_organic_rank":10,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":3.39,"impression_share":4.0,"price":29.95,"click_share_rank":7,"weekly_search_volume":963.2,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"UNREAL\u00ae","estimated_clicks":32.65248,"brand_bucket":"Rest of Market","week_date_str":"2026-01"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha ceremonial grade","competitor_brand":null,"asin":"B0FC2XRLV5","product_title":"Matcha Pulver Ceremonial Grade BIO-Qualit\u00e4t 100g i...","country_code":"de","average_organic_rank":9,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":1.96,"impression_share":3.75,"price":14.99,"click_share_rank":10,"weekly_search_volume":963.2,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"Matcha","estimated_clicks":18.87872,"brand_bucket":"Rest of Market","week_date_str":"2026-01"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha ceremonial grade","competitor_brand":null,"asin":"B0FJ917BGC","product_title":"ORIGEENS BIO MATCHA CEREMONIAL GRADE HINOTORI - Ja...","country_code":"de","average_organic_rank":15,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":2.74,"impression_share":2.43,"price":24.97,"click_share_rank":9,"weekly_search_volume":963.2,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"ORIGEENS","estimated_clicks":26.39168,"brand_bucket":"Rest of Market","week_date_str":"2026-01"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha ceremonial grade","competitor_brand":null,"asin":"B0FK5VGD2H","product_title":"M'atelier Reines Matcha Pulver aus Japan \u2013 Ceremon...","country_code":"de","average_organic_rank":6,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":4.17,"impression_share":3.09,"price":19.99,"click_share_rank":5,"weekly_search_volume":963.2,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"M'atelier","estimated_clicks":40.16544,"brand_bucket":"M'atelier","week_date_str":"2026-01"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha ceremonial grade","competitor_brand":"NORITUAL LAB","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","country_code":"de","average_organic_rank":2,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":14.08,"impression_share":4.42,"price":14.9,"click_share_rank":2,"weekly_search_volume":963.2,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"NORITUAL LAB","estimated_clicks":135.61856,"brand_bucket":"NORITUAL LAB","week_date_str":"2026-01"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha ceremonial grade","competitor_brand":null,"asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","country_code":"de","average_organic_rank":2,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":14.08,"impression_share":4.42,"price":14.9,"click_share_rank":2,"weekly_search_volume":963.2,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"Ceremonial","estimated_clicks":135.61856,"brand_bucket":"Ceremonial","week_date_str":"2026-01"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha ceremonial grade","competitor_brand":null,"asin":"B0G1T7N675","product_title":"Ceremonial Matcha Pulver BIO-Qualit\u00e4t 50g ideal zu...","country_code":"de","average_organic_rank":13,"weekly_number_of_days_with_deal":4,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":2.87,"impression_share":3.17,"price":8.47,"click_share_rank":8,"weekly_search_volume":963.2,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"Ceremonial","estimated_clicks":27.64384,"brand_bucket":"Ceremonial","week_date_str":"2026-01"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha ceremonial grade","competitor_brand":null,"asin":"B0G3XBLNKN","product_title":"Jibix Ceremonial Matcha \u2013 100% Japanischer zeremon...","country_code":"de","average_organic_rank":12,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":3.91,"impression_share":3.57,"price":22.99,"click_share_rank":6,"weekly_search_volume":963.2,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"Jibix","estimated_clicks":37.66112,"brand_bucket":"Rest of Market","week_date_str":"2026-01"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha ceremonial grade","competitor_brand":"NaturaleBio","asin":"B06XQ5DCYJ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":4,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":5.8,"impression_share":3.13,"price":14.347142857,"click_share_rank":4,"weekly_search_volume":1898.14,"is_yaba_asin":"Y","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"NaturaleBio","estimated_clicks":110.09212,"brand_bucket":"Our Brand","week_date_str":"2025-52"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha ceremonial grade","competitor_brand":"NaturaleBio","asin":"B07SZFD3P9","product_title":"NaturaleBio Matcha Ceremonial Grade 100g. Original...","country_code":"de","average_organic_rank":7,"weekly_number_of_days_with_deal":1,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":6.75,"impression_share":5.53,"price":29.228571429,"click_share_rank":3,"weekly_search_volume":1898.14,"is_yaba_asin":"Y","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"NaturaleBio","estimated_clicks":128.12445,"brand_bucket":"Our Brand","week_date_str":"2025-52"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha ceremonial grade","competitor_brand":"Matcha & CO","asin":"B0882ZCHMW","product_title":"T\u00e9 Matcha Ceremonial Premium 80 Gr","country_code":"de","average_organic_rank":14,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":1.78,"impression_share":3.3,"price":31.344285714,"click_share_rank":9,"weekly_search_volume":1898.14,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"Matcha & CO","estimated_clicks":33.786892,"brand_bucket":"Rest of Market","week_date_str":"2025-52"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha ceremonial grade","competitor_brand":"NORITUAL LAB","asin":"B0CNRX8G5S","product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","country_code":"de","average_organic_rank":1,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":0,"click_share":17.63,"impression_share":3.14,"price":23.484285714,"click_share_rank":1,"weekly_search_volume":1898.14,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"NORITUAL LAB","estimated_clicks":334.642082,"brand_bucket":"NORITUAL LAB","week_date_str":"2025-52"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha ceremonial grade","competitor_brand":"WeightWorld","asin":"B0DPJ4Z5WS","product_title":"Bio Matcha Pulver - 100 g Japanischer Matcha Tee -...","country_code":"de","average_organic_rank":42,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":1.18,"impression_share":1.64,"price":13.321428571,"click_share_rank":10,"weekly_search_volume":1898.14,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"WeightWorld","estimated_clicks":22.398052,"brand_bucket":"Rest of Market","week_date_str":"2025-52"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha ceremonial grade","competitor_brand":"Kuro Matcha","asin":"B0F99ZP2TX","product_title":"UNREAL\u00ae Ceremonial Bio Matcha \u2013 100% Japanischer Z...","country_code":"de","average_organic_rank":4,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":3.55,"impression_share":2.6,"price":9.178571429,"click_share_rank":6,"weekly_search_volume":1898.14,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"Kuro Matcha","estimated_clicks":67.38397,"brand_bucket":"Rest of Market","week_date_str":"2025-52"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha ceremonial grade","competitor_brand":null,"asin":"B0F99ZP2TX","product_title":"UNREAL\u00ae Ceremonial Bio Matcha \u2013 100% Japanischer Z...","country_code":"de","average_organic_rank":4,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":3.55,"impression_share":2.6,"price":9.178571429,"click_share_rank":6,"weekly_search_volume":1898.14,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"UNREAL\u00ae","estimated_clicks":67.38397,"brand_bucket":"Rest of Market","week_date_str":"2025-52"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha ceremonial grade","competitor_brand":null,"asin":"B0F9B1LWQQ","product_title":"UNREAL\u00ae 100g Ceremonial Bio Matcha \u2013 100% Japanisc...","country_code":"de","average_organic_rank":11,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":2.49,"impression_share":3.66,"price":30.714285714,"click_share_rank":8,"weekly_search_volume":1898.14,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"UNREAL\u00ae","estimated_clicks":47.263686,"brand_bucket":"Rest of Market","week_date_str":"2025-52"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha ceremonial grade","competitor_brand":null,"asin":"B0FJM1MBLM","product_title":"Ceremonial Matcha Kiri - Reines Gr\u00fcntee-Pulver aus...","country_code":"de","average_organic_rank":10,"weekly_number_of_days_with_deal":1,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":2.84,"impression_share":3.09,"price":39.492857143,"click_share_rank":7,"weekly_search_volume":1898.14,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"Ceremonial","estimated_clicks":53.907176,"brand_bucket":"Ceremonial","week_date_str":"2025-52"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha ceremonial grade","competitor_brand":"NORITUAL LAB","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","country_code":"de","average_organic_rank":2,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":14.2,"impression_share":4.38,"price":15.28,"click_share_rank":2,"weekly_search_volume":1898.14,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"NORITUAL LAB","estimated_clicks":269.53588,"brand_bucket":"NORITUAL LAB","week_date_str":"2025-52"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha ceremonial grade","competitor_brand":null,"asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","country_code":"de","average_organic_rank":2,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":14.2,"impression_share":4.38,"price":15.28,"click_share_rank":2,"weekly_search_volume":1898.14,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"Ceremonial","estimated_clicks":269.53588,"brand_bucket":"Ceremonial","week_date_str":"2025-52"},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Ceremonial","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha ceremonial grade","competitor_brand":null,"asin":"B0G3XBLNKN","product_title":"Jibix Ceremonial Matcha \u2013 100% Japanischer zeremon...","country_code":"de","average_organic_rank":12,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":3.67,"impression_share":3.17,"price":23.575714286,"click_share_rank":5,"weekly_search_volume":1898.14,"is_yaba_asin":"N","keywords_link":"https:\/\/www.amazon.de\/s?k=matcha+ceremonial+grade","brand_real":"Jibix","estimated_clicks":69.661738,"brand_bucket":"Rest of Market","week_date_str":"2025-52"}];
        
        const staticInsights = ["<b>Tendencia Global:</b> El volumen de clics muestra una tendencia decreciente (731 clics esta semana vs 1474 la anterior).", "<b>Desaf\u00edo Competitivo:</b> NORITUAL LAB domina con un 31.9% de share. NaturaleBio se sit\u00faa en 10.8%.", "<b>Posicionamiento de Precio:</b> Nuestro precio promedio (21.49\u20ac) es un 11.1% m\u00e1s alto que la media de la competencia (19.34\u20ac).", "<b>Eficiencia de Ranking:</b> Los ASINs propios bien posicionados mantienen una conversi\u00f3n a clics saludable.", "<b>Impacto de Ofertas:</b> Los productos con Deal activo promediaron 2.9% de share vs 7.3% sin deal."];
        const staticRecommendations = ["Mantener estrategia de precio actual; estamos alineados con el mercado.", "Potenciar variantes con 'Best Seller' o 'Amazon Choice' mediante PPC defensivo para maximizar la captura de tr\u00e1fico.", "Analizar t\u00edtulos y main images de los competidores Top 3 para identificar keywords visuales que est\u00e9n atrayendo clicks."];

        const ourBrand = "NaturaleBio";

        // --- INIT ---
        google.charts.load('current', {'packages':['corechart', 'table']});
        google.charts.setOnLoadCallback(initDashboard);

        function initDashboard() {
            renderKPIs();
            renderInsights();
            renderLeversTable();
            drawGlobalTrend();
            drawCompetitiveness();
            drawEfficiency();
            initInteractive();
        }

        function switchTab(tabId) {
            document.getElementById('tab-report').classList.add('hidden');
            document.getElementById('tab-interactive').classList.add('hidden');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById('tab-' + tabId).classList.remove('hidden');
            event.target.classList.add('active');
        }

        // --- RENDER FUNCTIONS ---

        function renderKPIs() {
            // Get last week data
            const weeks = [...new Set(marketData.map(d => d.week_date_str))].sort();
            const lastWeek = weeks[weeks.length - 1];
            const lastWeekData = marketData.filter(d => d.week_date_str === lastWeek);
            
            // Calc Metrics
            const ourData = lastWeekData.filter(d => d.is_yaba_asin === 'Y');
            const totalClicks = ourData.reduce((acc, curr) => acc + curr.estimated_clicks, 0);
            const avgPrice = ourData.length ? (ourData.reduce((acc, curr) => acc + curr.price, 0) / ourData.length) : 0;
            const avgRank = ourData.length ? (ourData.reduce((acc, curr) => acc + curr.average_organic_rank, 0) / ourData.length) : 0;
            
            const totalMarketClicks = lastWeekData.reduce((acc, curr) => acc + curr.estimated_clicks, 0);
            const share = totalMarketClicks ? (totalClicks / totalMarketClicks * 100) : 0;

            document.getElementById('kpi-share').textContent = share.toFixed(1) + '%';
            document.getElementById('kpi-clicks').textContent = Math.round(totalClicks);
            document.getElementById('kpi-price').textContent = avgPrice.toFixed(2) + '€';
            document.getElementById('kpi-rank').textContent = avgRank.toFixed(1);
        }

        function renderInsights() {
            const list = document.getElementById('insights-container');
            staticInsights.forEach(i => {
                const li = document.createElement('li');
                li.innerHTML = i;
                list.appendChild(li);
            });
            const recList = document.getElementById('recommendations-container');
            staticRecommendations.forEach(i => {
                const li = document.createElement('li');
                li.innerHTML = i;
                recList.appendChild(li);
            });
        }

        // --- CHARTS ---

        function drawGlobalTrend() {
            const weeks = [...new Set(marketData.map(d => d.week_date_str))].sort();
            const dataTable = [['Semana', 'Clics Competencia', 'Clics NaturaleBio', 'Click Share Total']];

            weeks.forEach(week => {
                const weekData = marketData.filter(d => d.week_date_str === week);
                const ourClicks = weekData.filter(d => d.is_yaba_asin === 'Y').reduce((s, c) => s + c.estimated_clicks, 0);
                const compClicks = weekData.filter(d => d.is_yaba_asin === 'N').reduce((s, c) => s + c.estimated_clicks, 0);
                const totalShare = weekData.reduce((s, c) => s + c.click_share, 0); // Aggregate visibility
                dataTable.push([week, compClicks, ourClicks, totalShare]);
            });

            const data = google.visualization.arrayToDataTable(dataTable);
            const options = {
                seriesType: 'bars',
                series: { 2: {type: 'line', targetAxisIndex: 1} },
                isStacked: true,
                colors: ['#CBD5E1', '#2563EB', '#10B981'],
                vAxes: { 0: {title: 'Volumen Clics'}, 1: {title: '% Share Total'} },
                legend: { position: 'bottom' },
                chartArea: { width: '85%', height: '70%' }
            };

            new google.visualization.ComboChart(document.getElementById('chart_global_trend')).draw(data, options);
        }

        function drawCompetitiveness() {
            const weeks = [...new Set(marketData.map(d => d.week_date_str))].sort();
            // Identify bucket columns dynamically
            const buckets = [...new Set(marketData.map(d => d.brand_bucket))];
            
            // Move "Our Brand" to front for color consistency
            const bucketList = buckets.filter(b => b === 'Our Brand')
                                    .concat(buckets.filter(b => b !== 'Our Brand'));

            const header = ['Semana', ...bucketList];
            const rows = [];

            weeks.forEach(week => {
                const row = [week];
                const weekData = marketData.filter(d => d.week_date_str === week);
                bucketList.forEach(bucket => {
                    const val = weekData.filter(d => d.brand_bucket === bucket).reduce((s, c) => s + c.click_share, 0);
                    row.push(val);
                });
                rows.push(row);
            });

            const data = google.visualization.arrayToDataTable([header, ...rows]);
            const options = {
                curveType: 'function',
                legend: { position: 'bottom' },
                chartArea: { width: '85%', height: '70%' },
                colors: bucketList.map(b => b === 'Our Brand' ? '#2563EB' : null) // Force blue for us
            };

            new google.visualization.LineChart(document.getElementById('chart_competitiveness')).draw(data, options);
        }

        function drawEfficiency() {
            // Last week only
            const weeks = [...new Set(marketData.map(d => d.week_date_str))].sort();
            const lastWeek = weeks[weeks.length - 1];
            const subset = marketData.filter(d => d.week_date_str === lastWeek);

            const dataTable = [['Organic Rank', 'Click Share', { role: 'style' }, {role: 'tooltip'}]];
            subset.forEach(d => {
                const color = d.is_yaba_asin === 'Y' ? '#2563EB' : '#94A3B8';
                const label = `${d.brand_real}: Rank ${d.average_organic_rank}, Share ${d.click_share}%`;
                dataTable.push([d.average_organic_rank, d.click_share, `point { fill-color: ${color}; size: 6; }`, label]);
            });

            const data = google.visualization.arrayToDataTable(dataTable);
            const options = {
                hAxis: { title: 'Organic Rank (Lower is Better)', direction: -1 },
                vAxis: { title: 'Click Share (%)' },
                legend: 'none',
                chartArea: { width: '85%', height: '70%' }
            };

            new google.visualization.ScatterChart(document.getElementById('chart_efficiency')).draw(data, options);
        }

        function renderLeversTable() {
            // Aggregated lever analysis
            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Palanca');
            dataTable.addColumn('number', 'Share con Palanca');
            dataTable.addColumn('number', 'Share sin Palanca');
            dataTable.addColumn('string', 'Delta');

            // Logic: Compare avg click_share for rows where lever > 0 vs == 0
            // 1. Deals
            const withDeal = marketData.filter(d => d.weekly_number_of_days_with_deal > 0);
            const noDeal = marketData.filter(d => d.weekly_number_of_days_with_deal == 0);
            const s1 = withDeal.length ? (withDeal.reduce((s,c)=>s+c.click_share,0)/withDeal.length) : 0;
            const s2 = noDeal.length ? (noDeal.reduce((s,c)=>s+c.click_share,0)/noDeal.length) : 0;
            dataTable.addRow(['Deals', s1, s2, (s1-s2).toFixed(2)+'%']);

            // 2. Coupons
            const withCoup = marketData.filter(d => d.weekly_number_of_days_with_coupon > 0);
            const noCoup = marketData.filter(d => d.weekly_number_of_days_with_coupon == 0);
            const c1 = withCoup.length ? (withCoup.reduce((s,c)=>s+c.click_share,0)/withCoup.length) : 0;
            const c2 = noCoup.length ? (noCoup.reduce((s,c)=>s+c.click_share,0)/noCoup.length) : 0;
            dataTable.addRow(['Cupones', c1, c2, (c1-c2).toFixed(2)+'%']);
            
            // 3. Choice Badge
            const withChoice = marketData.filter(d => d.weekly_number_of_days_with_amazon_choice_badge > 0);
            const noChoice = marketData.filter(d => d.weekly_number_of_days_with_amazon_choice_badge == 0);
            const ch1 = withChoice.length ? (withChoice.reduce((s,c)=>s+c.click_share,0)/withChoice.length) : 0;
            const ch2 = noChoice.length ? (noChoice.reduce((s,c)=>s+c.click_share,0)/noChoice.length) : 0;
            dataTable.addRow(['Amazon Choice', ch1, ch2, (ch1-ch2).toFixed(2)+'%']);

            const table = new google.visualization.Table(document.getElementById('levers_table_div'));
            table.draw(dataTable, {showRowNumber: false, width: '100%', height: '100%'});
        }

        // --- INTERACTIVE TAB ---

        function initInteractive() {
            // Populate Week Select
            const weeks = [...new Set(marketData.map(d => d.week_date_str))].sort().reverse();
            const selWeek = document.getElementById('sel-week');
            weeks.forEach(w => {
                const opt = document.createElement('option');
                opt.value = w;
                opt.text = w;
                selWeek.appendChild(opt);
            });

            // Populate Competitor Select
            const competitors = [...new Set(marketData.map(d => d.brand_real))].sort();
            const selComp = document.getElementById('sel-competitor');
            competitors.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.text = c;
                selComp.appendChild(opt);
            });
            
            drawInteractiveTable();
        }

        function drawInteractiveTable() {
            const week = document.getElementById('sel-week').value;
            const comp = document.getElementById('sel-competitor').value;

            let filtered = marketData.filter(d => d.week_date_str === week);
            if (comp !== 'ALL') {
                filtered = filtered.filter(d => d.brand_real === comp);
            }

            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'ASIN');
            dataTable.addColumn('string', 'Brand');
            dataTable.addColumn('string', 'Title');
            dataTable.addColumn('number', 'Price (€)');
            dataTable.addColumn('number', 'Rank');
            dataTable.addColumn('number', 'Share (%)');
            dataTable.addColumn('boolean', 'Deal?');

            filtered.forEach(d => {
                dataTable.addRow([
                    d.asin, 
                    d.brand_real, 
                    d.product_title.substring(0, 30) + '...', 
                    d.price, 
                    d.average_organic_rank, 
                    d.click_share, 
                    d.weekly_number_of_days_with_deal > 0
                ]);
            });

            const table = new google.visualization.Table(document.getElementById('table_interactive'));
            table.draw(dataTable, {showRowNumber: true, width: '100%', height: '100%'});
        }

    </script>
</body>
</html>