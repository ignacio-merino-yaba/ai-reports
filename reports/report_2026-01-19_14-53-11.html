<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASIN Performance Report: Matcha Premium</title>
    
    <!-- External Dependencies (CDN) -->
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8f9fa; color: #1f2937; }
        .card { background: white; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); padding: 24px; border: 1px solid #e5e7eb; }
        .google-chart { width: 100%; height: 350px; }
        .tab-btn { transition: all 0.3s; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: #2563eb; border-bottom-color: #2563eb; font-weight: 600; }
        .badge { padding: 4px 12px; border-radius: 99px; font-size: 0.75rem; font-weight: 600; }
        .badge-green { background: #dcfce7; color: #166534; }
        .badge-red { background: #fee2e2; color: #991b1b; }
        .badge-blue { background: #dbeafe; color: #1e40af; }
    </style>

    <script>
        // ==========================================
        // DATA INJECTION
        // ==========================================
        const marketData = {
            "metadata": {
                "our_brand": "NaturaleBio",
                "top_competitors": ["NORITUAL LAB", "Ceremonial", "Matcha"],
                "latest_week": "2026-01",
                "parent_asin": "Matcha Premium"
            },
            "global_trend": [
                {"week_date": "2025-51", "is_yaba_asin": "N", "estimated_clicks": 29992.12, "click_share": 49.29},
                {"week_date": "2025-51", "is_yaba_asin": "Y", "estimated_clicks": 13185.82, "click_share": 21.67},
                {"week_date": "2025-52", "is_yaba_asin": "N", "estimated_clicks": 25276.64, "click_share": 52.95},
                {"week_date": "2025-52", "is_yaba_asin": "Y", "estimated_clicks": 10420.94, "click_share": 21.83},
                {"week_date": "2026-01", "is_yaba_asin": "N", "estimated_clicks": 13364.52, "click_share": 49.6},
                {"week_date": "2026-01", "is_yaba_asin": "Y", "estimated_clicks": 6086.79, "click_share": 22.59}
            ],
            "brand_trends": [
                {"week_date": "2025-51", "chart_category": "Ceremonial", "click_share": 11.41},
                {"week_date": "2025-51", "chart_category": "Matcha", "click_share": 3.48},
                {"week_date": "2025-51", "chart_category": "NORITUAL LAB", "click_share": 25.51},
                {"week_date": "2025-51", "chart_category": "Our Brand", "click_share": 21.67},
                {"week_date": "2025-51", "chart_category": "Rest of Market", "click_share": 8.89},
                {"week_date": "2025-52", "chart_category": "Ceremonial", "click_share": 8.42},
                {"week_date": "2025-52", "chart_category": "Matcha", "click_share": 3.4},
                {"week_date": "2025-52", "chart_category": "NORITUAL LAB", "click_share": 27.19},
                {"week_date": "2025-52", "chart_category": "Our Brand", "click_share": 21.83},
                {"week_date": "2025-52", "chart_category": "Rest of Market", "click_share": 13.94},
                {"week_date": "2026-01", "chart_category": "Ceremonial", "click_share": 7.38},
                {"week_date": "2026-01", "chart_category": "Matcha", "click_share": 3.0},
                {"week_date": "2026-01", "chart_category": "NORITUAL LAB", "click_share": 26.72},
                {"week_date": "2026-01", "chart_category": "Our Brand", "click_share": 22.59},
                {"week_date": "2026-01", "chart_category": "Rest of Market", "click_share": 12.5}
            ],
            "products_latest": [
                {"asin": "B0CNRX8G5S", "product_title": "Ceremonial Matcha - Reines Matcha Pulver aus Japan...", "resolved_brand": "NORITUAL LAB", "price": 23.91, "click_share": 19.34, "average_organic_rank": 2.0, "is_yaba_asin": "N", "efficiency": "Aligned", "weekly_number_of_days_with_deal": 0.0},
                {"asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Grüntee-Pulver au...", "resolved_brand": "Ceremonial", "price": 15.56, "click_share": 7.38, "average_organic_rank": 6.0, "is_yaba_asin": "N", "efficiency": "Aligned", "weekly_number_of_days_with_deal": 0.0},
                {"asin": "B07MD4LB49", "product_title": "VAHDAM, Matcha Grüntee Pulver (100g, 50+ Tassen) A...", "resolved_brand": "VAHDAM", "price": 10.43, "click_share": 3.15, "average_organic_rank": 9.0, "is_yaba_asin": "N", "efficiency": "Aligned", "weekly_number_of_days_with_deal": 0.0},
                {"asin": "B08XVX8V1T", "product_title": "Bio Matcha Pulver 100 g – Japan Matcha Tee, 100% n...", "resolved_brand": "Bio", "price": 12.00, "click_share": 2.39, "average_organic_rank": 10.0, "is_yaba_asin": "N", "efficiency": "Aligned", "weekly_number_of_days_with_deal": 0.0},
                {"asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Natürlich & Fein Gemahl...", "resolved_brand": "Special Leaves", "price": 10.39, "click_share": 3.0, "average_organic_rank": 16.0, "is_yaba_asin": "N", "efficiency": "Aligned", "weekly_number_of_days_with_deal": 0.0},
                {"asin": "B0F9B1LWQQ", "product_title": "UNREAL® 100g Ceremonial Bio Matcha – 100% Japanisc...", "resolved_brand": "UNREAL®", "price": 31.27, "click_share": 1.57, "average_organic_rank": 19.0, "is_yaba_asin": "N", "efficiency": "Aligned", "weekly_number_of_days_with_deal": 0.0},
                {"asin": "B07SZFD3P9", "product_title": "NaturaleBio Matcha Ceremonial Grade 100g. Original...", "resolved_brand": "NaturaleBio", "price": 30.27, "click_share": 2.68, "average_organic_rank": 50, "is_yaba_asin": "Y", "efficiency": "Underperformer", "weekly_number_of_days_with_deal": 0.0},
                {"asin": "B06XQ5DCYJ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "resolved_brand": "NaturaleBio", "price": 14.61, "click_share": 12.9, "average_organic_rank": 2.0, "is_yaba_asin": "Y", "efficiency": "Overperformer", "weekly_number_of_days_with_deal": 0.0},
                {"asin": "B079VQ52MK", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "resolved_brand": "NaturaleBio", "price": 24.53, "click_share": 3.66, "average_organic_rank": 5.0, "is_yaba_asin": "Y", "efficiency": "Aligned", "weekly_number_of_days_with_deal": 0.0},
                {"asin": "B06XQ69YCQ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "resolved_brand": "NaturaleBio", "price": 10.22, "click_share": 3.35, "average_organic_rank": 5.0, "is_yaba_asin": "Y", "efficiency": "Aligned", "weekly_number_of_days_with_deal": 0.0}
            ],
            "levers": {
                "deal_impact": -3.33,
                "price_correlation": 0.28
            }
        };

        // Initialize Google Charts
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(initDashboard);

        function initDashboard() {
            drawGlobalTrend();
            drawBrandShare();
            drawEfficiencyChart();
            renderKPICards();
            renderInsights();
        }

        // ==========================================
        // CHART RENDERING
        // ==========================================

        function drawGlobalTrend() {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Week');
            data.addColumn('number', 'Our Clicks');
            data.addColumn('number', 'Competitor Clicks');

            // Process data for chart
            const weeks = [...new Set(marketData.global_trend.map(d => d.week_date))].sort();
            const rows = weeks.map(week => {
                const ours = marketData.global_trend.find(d => d.week_date === week && d.is_yaba_asin === 'Y');
                const comp = marketData.global_trend.find(d => d.week_date === week && d.is_yaba_asin === 'N');
                return [week, ours ? ours.estimated_clicks : 0, comp ? comp.estimated_clicks : 0];
            });

            data.addRows(rows);

            const options = {
                title: 'Estimated Clicks: Us vs Competitors',
                curveType: 'function',
                legend: { position: 'bottom' },
                colors: ['#2563eb', '#9ca3af'],
                vAxis: { title: 'Est. Clicks' },
                chartArea: { width: '85%', height: '70%' },
                pointSize: 5
            };

            const chart = new google.visualization.LineChart(document.getElementById('trend_chart'));
            chart.draw(data, options);
        }

        function drawBrandShare() {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Week');
            
            // Columns: Our Brand, Top 1, Top 2, Top 3, Rest
            const competitors = marketData.metadata.top_competitors;
            data.addColumn('number', 'Our Brand');
            competitors.forEach(c => data.addColumn('number', c));
            data.addColumn('number', 'Rest of Market');

            const weeks = [...new Set(marketData.brand_trends.map(d => d.week_date))].sort();
            
            const rows = weeks.map(week => {
                const weekData = marketData.brand_trends.filter(d => d.week_date === week);
                
                const getShare = (cat) => {
                    const found = weekData.find(d => d.chart_category === cat);
                    return found ? found.click_share : 0;
                };

                return [
                    week,
                    getShare('Our Brand'),
                    getShare(competitors[0]),
                    getShare(competitors[1]),
                    getShare(competitors[2]),
                    getShare('Rest of Market')
                ];
            });

            data.addRows(rows);

            const options = {
                title: 'Click Share Evolution by Brand',
                isStacked: true,
                legend: { position: 'bottom', maxLines: 2 },
                colors: ['#2563eb', '#ef4444', '#f97316', '#eab308', '#9ca3af'],
                vAxis: { title: 'Click Share (%)' },
                chartArea: { width: '85%', height: '70%' },
                areaOpacity: 0.8
            };

            const chart = new google.visualization.AreaChart(document.getElementById('share_chart'));
            chart.draw(data, options);
        }

        function drawEfficiencyChart() {
            const data = new google.visualization.DataTable();
            data.addColumn('number', 'Organic Rank');
            data.addColumn('number', 'Click Share (%)');
            data.addColumn({type: 'string', role: 'tooltip'});
            data.addColumn({type: 'string', role: 'style'});

            const rows = marketData.products_latest.map(p => {
                let color = p.is_yaba_asin === 'Y' ? '#2563eb' : '#9ca3af';
                // Adjust rank 0 to 50 for visualization if needed, but keeping raw for now
                let rank = p.average_organic_rank === 0 ? 50 : p.average_organic_rank;
                
                return [
                    rank, 
                    p.click_share, 
                    `${p.product_title}\nRank: ${rank}, Share: ${p.click_share}%`,
                    `point { size: 6; fill-color: ${color}; stroke-color: white; }`
                ];
            });

            data.addRows(rows);

            const options = {
                title: 'Efficiency: Organic Rank vs Click Share',
                hAxis: { title: 'Organic Rank (Lower is Better)', direction: -1 }, // Invert axis so Rank 1 is right/top
                vAxis: { title: 'Click Share (%)' },
                legend: 'none',
                chartArea: { width: '85%', height: '70%' }
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('efficiency_chart'));
            chart.draw(data, options);
        }

        // ==========================================
        // UI & LOGIC
        // ==========================================

        function renderKPICards() {
            const lastWeek = marketData.global_trend.filter(d => d.week_date === marketData.metadata.latest_week);
            const prevWeek = marketData.global_trend.filter(d => d.week_date !== marketData.metadata.latest_week).pop(); // Crude prev

            const ourShareNow = lastWeek.find(d => d.is_yaba_asin === 'Y')?.click_share || 0;
            const ourClicksNow = lastWeek.find(d => d.is_yaba_asin === 'Y')?.estimated_clicks || 0;
            
            // Simple DOM updates
            document.getElementById('kpi_share').innerText = ourShareNow.toFixed(2) + '%';
            document.getElementById('kpi_clicks').innerText = Math.round(ourClicksNow).toLocaleString();
            document.getElementById('kpi_brand').innerText = marketData.metadata.our_brand;
        }

        function renderInsights() {
            const products = marketData.products_latest.filter(p => p.is_yaba_asin === 'Y');
            const topProd = products.sort((a,b) => b.click_share - a.click_share)[0];
            
            const html = `
                <li class="flex items-start gap-2">
                    <span class="material-icons text-blue-500 text-sm mt-1">trending_up</span>
                    <span><strong>Dominio:</strong> Nuestro mejor ASIN (${topProd.asin}) captura el ${topProd.click_share}% del mercado.</span>
                </li>
                <li class="flex items-start gap-2">
                    <span class="material-icons text-red-500 text-sm mt-1">warning</span>
                    <span><strong>Eficiencia:</strong> La correlación Precio-Share es ${marketData.levers.price_correlation > 0 ? 'positiva (mayor precio, mayor share)' : 'negativa'}, lo que sugiere ${marketData.levers.price_correlation > 0 ? 'calidad percibida alta' : 'sensibilidad al precio'}.</span>
                </li>
                <li class="flex items-start gap-2">
                    <span class="material-icons text-orange-500 text-sm mt-1">bolt</span>
                    <span><strong>Competencia:</strong> ${marketData.metadata.top_competitors[0]} lidera la competencia. Necesitamos monitorizar sus ofertas.</span>
                </li>
                <li class="flex items-start gap-2">
                    <span class="material-icons text-green-500 text-sm mt-1">lightbulb</span>
                    <span><strong>Oportunidad:</strong> ${products.length} de nuestros variantes están activos. Optimizar rank del ASIN B07SZFD3P9 es prioritario.</span>
                </li>
            `;
            document.getElementById('insights_list').innerHTML = html;
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');
            
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('btn_' + tabId).classList.add('active');
            
            if(tabId === 'interactive') renderInteractiveTable();
        }

        function renderInteractiveTable() {
            const container = document.getElementById('interactive_table');
            const prods = marketData.products_latest.sort((a,b) => b.click_share - a.click_share);
            
            let html = `<table class="min-w-full text-sm text-left text-gray-500">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                    <tr>
                        <th class="px-6 py-3">ASIN</th>
                        <th class="px-6 py-3">Brand</th>
                        <th class="px-6 py-3">Price</th>
                        <th class="px-6 py-3">Share</th>
                        <th class="px-6 py-3">Rank</th>
                        <th class="px-6 py-3">Efficiency</th>
                    </tr>
                </thead>
                <tbody>`;
            
            prods.forEach(p => {
                const bg = p.is_yaba_asin === 'Y' ? 'bg-blue-50' : 'bg-white';
                html += `
                    <tr class="${bg} border-b">
                        <td class="px-6 py-4 font-medium text-gray-900">${p.asin}</td>
                        <td class="px-6 py-4">${p.resolved_brand}</td>
                        <td class="px-6 py-4">€${p.price.toFixed(2)}</td>
                        <td class="px-6 py-4 font-bold">${p.click_share}%</td>
                        <td class="px-6 py-4">${p.average_organic_rank > 0 ? p.average_organic_rank : '-'}</td>
                        <td class="px-6 py-4"><span class="badge ${p.efficiency === 'Overperformer' ? 'badge-green' : (p.efficiency === 'Underperformer' ? 'badge-red' : 'badge-blue')}">${p.efficiency}</span></td>
                    </tr>
                `;
            });
            
            html += `</tbody></table>`;
            container.innerHTML = html;
        }
    </script>
</head>
<body class="p-6">

    <div class="max-w-7xl mx-auto space-y-6">
        <!-- Header -->
        <header class="flex justify-between items-center bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
            <div>
                <h1 class="text-2xl font-bold text-gray-900">Parent ASIN Analysis</h1>
                <p class="text-gray-500 text-sm">Target: <span class="font-mono text-blue-600 font-semibold" id="kpi_brand">...</span> | Week: <span class="font-mono">2026-01</span></p>
            </div>
            <div class="flex gap-4">
                <div class="text-right">
                    <p class="text-xs text-gray-400 uppercase tracking-wider">Market Share</p>
                    <p class="text-3xl font-bold text-blue-600" id="kpi_share">--%</p>
                </div>
                <div class="text-right pl-4 border-l border-gray-200">
                    <p class="text-xs text-gray-400 uppercase tracking-wider">Est. Clicks</p>
                    <p class="text-3xl font-bold text-gray-800" id="kpi_clicks">--</p>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <div class="border-b border-gray-200">
            <nav class="flex gap-6" aria-label="Tabs">
                <button onclick="switchTab('report')" id="btn_report" class="tab-btn active py-2 px-1 text-sm font-medium">Static Report</button>
                <button onclick="switchTab('interactive')" id="btn_interactive" class="tab-btn py-2 px-1 text-sm text-gray-500 hover:text-gray-700 font-medium">Comparador Interactivo</button>
            </nav>
        </div>

        <!-- TAB 1: REPORT -->
        <div id="report" class="tab-content space-y-6">
            
            <!-- Section 1: Global Trend -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="card md:col-span-2">
                    <h3 class="text-lg font-semibold mb-4">1. Tendencia Global (Clicks)</h3>
                    <div id="trend_chart" class="google-chart"></div>
                </div>
                <div class="card bg-blue-50 border-blue-100">
                    <h3 class="text-blue-900 font-bold mb-2">Resumen de Tendencia</h3>
                    <p class="text-blue-800 text-sm leading-relaxed">
                        La tendencia muestra una caída general en el volumen de clicks del mercado (search volume) en la última semana. 
                        Sin embargo, <strong>Nuestra Marca</strong> ha mantenido su cuota de mercado (~22%), mostrando resiliencia frente a la caída de demanda estacional post-Navidad.
                    </p>
                </div>
            </div>

            <!-- Section 2: Competitiveness -->
            <div class="card">
                <h3 class="text-lg font-semibold mb-4">2. Competitividad de Marca (Share of Voice)</h3>
                <div id="share_chart" class="google-chart"></div>
                <p class="mt-4 text-sm text-gray-500 italic">
                    *El gráfico muestra la evolución porcentual de cuota de clicks por marca. Notar la estabilidad de NaturaleBio frente a NORITUAL LAB (Competidor Top 1).
                </p>
            </div>

            <!-- Section 3 & 4: Efficiency & Levers -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="card">
                    <h3 class="text-lg font-semibold mb-4">3. Eficiencia: Organic Rank vs Share</h3>
                    <div id="efficiency_chart" class="google-chart"></div>
                </div>
                <div class="space-y-6">
                    <!-- Insights Card -->
                    <div class="card">
                        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                            <span class="material-icons text-yellow-500">lightbulb</span>
                            Insights Clave
                        </h3>
                        <ul class="space-y-3 text-sm text-gray-600" id="insights_list">
                            <!-- Injected via JS -->
                        </ul>
                    </div>

                    <!-- Recommendations -->
                    <div class="card border-l-4 border-green-500">
                        <h3 class="text-lg font-semibold mb-3">Recomendaciones Accionables</h3>
                        <ul class="space-y-2 text-sm">
                            <li class="flex gap-2">
                                <span class="font-bold text-green-600">1.</span>
                                <span>Defender Share: Mantener precio actual en B06XQ5DCYJ ya que su eficiencia es alta (Overperformer).</span>
                            </li>
                            <li class="flex gap-2">
                                <span class="font-bold text-green-600">2.</span>
                                <span>Recuperar Rank: Investigar caída de B07SZFD3P9. Revisar si perdió indexación en keywords "matcha".</span>
                            </li>
                            <li class="flex gap-2">
                                <span class="font-bold text-green-600">3.</span>
                                <span>Ataque: NORITUAL LAB tiene un precio superior (€23+). Evaluar cupón agresivo en variante premium para robar cuota.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: INTERACTIVE -->
        <div id="interactive" class="tab-content hidden space-y-6">
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Detalle Semanal por ASIN</h3>
                </div>
                <div id="interactive_table" class="overflow-x-auto rounded-lg border border-gray-200">
                    <!-- Table injected via JS -->
                </div>
            </div>
        </div>
        
    </div>

    <footer class="mt-12 text-center text-xs text-gray-400 pb-6">
        Generated automatically by Amazon Market Intelligence Bot
    </footer>

</body>
</html>