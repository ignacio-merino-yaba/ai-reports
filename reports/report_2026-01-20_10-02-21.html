<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon ASIN Performance Report: NaturaleBio</title>
    <!-- Google Charts Loader -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        :root {
            --primary: #4285F4;       /* Google Blue */
            --secondary: #34A853;     /* Google Green */
            --warning: #FBBC05;       /* Google Yellow */
            --danger: #EA4335;        /* Google Red */
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-800: #1F2937;
            --white: #FFFFFF;
            --radius: 16px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--gray-100);
            color: var(--gray-800);
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--white);
            padding: 20px 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; font-size: 24px; font-weight: 700; color: var(--gray-800); }
        h2 { font-size: 18px; font-weight: 600; margin-bottom: 16px; color: var(--gray-800); }
        .subtitle { font-size: 14px; color: #6B7280; margin-top: 4px; }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }
        .tab-btn {
            padding: 10px 24px;
            border-radius: 99px;
            border: none;
            background: var(--white);
            font-weight: 500;
            color: #6B7280;
            cursor: pointer;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            transition: all 0.2s;
        }
        .tab-btn.active {
            background: var(--primary);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
        }

        /* Sections */
        .section { display: none; }
        .section.active { display: block; }

        .card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; }
        
        /* KPI Cards */
        .kpi-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        .kpi-card {
            background: var(--white);
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        .kpi-label { font-size: 12px; color: #6B7280; text-transform: uppercase; letter-spacing: 0.5px; }
        .kpi-value { font-size: 28px; font-weight: 700; margin: 8px 0; color: var(--gray-800); }
        .kpi-trend { font-size: 13px; font-weight: 500; display: flex; align-items: center; gap: 4px; }
        .trend-up { color: var(--secondary); }
        .trend-down { color: var(--danger); }

        /* Insights List */
        .insight-item {
            display: flex;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-200);
        }
        .insight-item:last-child { border-bottom: none; }
        .insight-icon { color: var(--primary); }
        .rec-tag {
            background: #EFF6FF;
            color: var(--primary);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-right: 6px;
        }

        /* Interactive Controls */
        .controls {
            background: var(--white);
            padding: 16px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            display: flex;
            gap: 16px;
            align-items: center;
        }
        select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
            font-size: 14px;
            min-width: 150px;
            outline: none;
        }

        /* Comparison Table */
        .comp-table {
            width: 100%;
            border-collapse: collapse;
        }
        .comp-table th { text-align: left; padding: 12px; color: #6B7280; font-weight: 500; border-bottom: 2px solid var(--gray-100); }
        .comp-table td { padding: 16px 12px; border-bottom: 1px solid var(--gray-100); font-weight: 500; }
        .comp-table td:first-child { color: #6B7280; font-weight: 400; }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }
        .badge-deal { background: #FEF2F2; color: var(--danger); }
        .badge-choice { background: #ECFDF5; color: var(--secondary); }
        
        @media (max-width: 768px) {
            .grid-2, .grid-3, .kpi-row { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1>Market Intelligence Report</h1>
            <div class="subtitle">Parent ASIN Analysis | Market: DE | Category: Matcha</div>
        </div>
        <div style="text-align: right;">
            <div style="font-weight: 700; color: var(--primary);">NaturaleBio</div>
            <div style="font-size: 12px; color: #9CA3AF;">Focus Brand</div>
        </div>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('static')">1. Strategic Dashboard</button>
        <button class="tab-btn" onclick="switchTab('interactive')">2. Competitor Deep-Dive</button>
    </div>

    <!-- TAB 1: STATIC REPORT -->
    <div id="static" class="section active">
        
        <!-- KPI Cards -->
        <div class="kpi-row" id="kpi-container">
            <!-- Injected by JS -->
        </div>

        <!-- Section 1: Global Trend -->
        <div class="card">
            <h2>1. Global Parent Trend & Market Traction</h2>
            <div id="chart_trend" style="width: 100%; height: 350px;"></div>
            <div style="margin-top: 10px; font-size: 13px; color: #666; padding: 10px; background: #f9fafb; border-radius: 8px;">
                <strong>Analysis:</strong> The bar chart represents total category volume (demand), while lines show the battle for visibility. 
                If the Blue Line (Us) diverges upwards from the Red Line (Competition) while bars grow, we are outperforming organic growth.
            </div>
        </div>

        <!-- Section 2: Competitiveness -->
        <div class="card">
            <h2>2. Brand Competitiveness (Share of Voice)</h2>
            <div id="chart_share" style="width: 100%; height: 350px;"></div>
        </div>

        <!-- Section 3 & 4: Efficiency & Insights -->
        <div class="grid-2">
            <div class="card">
                <h2>4. Efficiency Matrix (Rank vs Share)</h2>
                <div class="subtitle" style="margin-bottom: 10px;">Y-Axis: Click Share (Success) | X-Axis: Organic Rank (Visibility)</div>
                <div id="chart_scatter" style="width: 100%; height: 300px;"></div>
                <div style="margin-top: 10px; font-size: 12px; color: #666;">
                    * <strong>Top Left (High Share, Low Rank #):</strong> Efficient Leaders.<br>
                    * <strong>Bottom Right:</strong> Low visibility, low performance.
                </div>
            </div>

            <div class="card">
                <h2>5. Insights & Recommendations</h2>
                <div id="insights-container">
                    <!-- Python Generated Insights Injected Here -->
                </div>
            </div>
        </div>
    </div>

    <!-- TAB 2: INTERACTIVE COMPARATOR -->
    <div id="interactive" class="section">
        <div class="controls">
            <div>
                <label style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 4px;">Select Week</label>
                <select id="weekSelector" onchange="updateComparator()"></select>
            </div>
            <div>
                <label style="font-size: 12px; font-weight: 600; display: block; margin-bottom: 4px;">Compare vs</label>
                <select id="compSelector" onchange="updateComparator()"></select>
            </div>
        </div>

        <div class="grid-2">
            <!-- Comparison Table -->
            <div class="card">
                <h2>Head-to-Head Comparison</h2>
                <table class="comp-table">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th style="color: var(--primary);">NaturaleBio (Us)</th>
                            <th style="color: var(--danger);" id="comp-header">Competitor</th>
                        </tr>
                    </thead>
                    <tbody id="comp-body">
                        <!-- Filled by JS -->
                    </tbody>
                </table>
            </div>

            <!-- Price Evolution Chart -->
            <div class="card">
                <h2>Price Strategy History</h2>
                <div id="chart_price" style="width: 100%; height: 300px;"></div>
            </div>
        </div>
    </div>

</div>

<!-- DATA & LOGIC -->
<script>
    // 1. INJECTED DATA FROM PYTHON PROCESSING
    const marketData = [{"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha", "competitor_brand": "NaturaleBio", "asin": "B07SZFD3P9", "product_title": "NaturaleBio Matcha Ceremonial Grade 100g. Original...", "country_code": "de", "average_organic_rank": 2.68, "weekly_number_of_days_with_deal": 2.06, "weekly_number_of_days_with_best_seller_badge": 30.27, "weekly_number_of_days_with_amazon_choice_badge": 8, "weekly_number_of_days_with_coupon": 0.0, "click_share": 27011.1, "impression_share": "Y", "price": "https://www.amazon.de/s?k=matcha", "click_share_rank": 0.0, "weekly_search_volume": 0.0, "is_yaba_asin": 0, "keywords_link": 0, "clicks": 0.0, "real_brand": "NaturaleBio", "week_str": "2026-01"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "matcha", "competitor_brand": "NORITUAL LAB", "asin": "B0CNRX8G5S", "product_title": "Ceremonial Matcha - Reines Matcha Pulver aus Japan...", "country_code": "de", "average_organic_rank": 2.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0.0, "click_share": 16.66, "impression_share": 3.14, "price": 24.03, "click_share_rank": 1.0, "weekly_search_volume": 60855.1, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 10138.45966, "real_brand": "NORITUAL LAB", "week_str": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "matcha", "competitor_brand": "NaturaleBio", "asin": "B06XQ5DCYJ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "country_code": "de", "average_organic_rank": 2.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 11.18, "impression_share": 3.15, "price": 14.084285714, "click_share_rank": 2.0, "weekly_search_volume": 60855.1, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 6803.60018, "real_brand": "NaturaleBio", "week_str": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "matcha", "competitor_brand": "NaturaleBio", "asin": "B079VQ52MK", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "country_code": "de", "average_organic_rank": 5.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 3.69, "impression_share": 3.13, "price": 23.075714286, "click_share_rank": 5.0, "weekly_search_volume": 60855.1, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 2245.55319, "real_brand": "NaturaleBio", "week_str": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "matcha", "competitor_brand": "NaturaleBio", "asin": "B06XQ69YCQ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "country_code": "de", "average_organic_rank": 5.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 3.85, "impression_share": 3.15, "price": 9.2, "click_share_rank": 4.0, "weekly_search_volume": 60855.1, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 2342.92135, "real_brand": "NaturaleBio", "week_str": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "matcha", "competitor_brand": 0.0, "asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Grüntee-Pulver au...", "country_code": "de", "average_organic_rank": 5.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 8.85, "impression_share": 4.22, "price": 15.635714286, "click_share_rank": 3.0, "weekly_search_volume": 60855.1, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 5385.67635, "real_brand": "Ceremonial", "week_str": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "matcha", "competitor_brand": "NORITUAL LAB", "asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Grüntee-Pulver au...", "country_code": "de", "average_organic_rank": 5.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 8.85, "impression_share": 4.22, "price": 15.635714286, "click_share_rank": 3.0, "weekly_search_volume": 60855.1, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 5385.67635, "real_brand": "NORITUAL LAB", "week_str": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "matcha", "competitor_brand": "VAHDAM", "asin": "B07MD4LB49", "product_title": "\"VAHDAM, Matcha Grüntee Pulver (100g, 50+ Tassen) A...", "country_code": "de", "average_organic_rank": 8.0, "weekly_number_of_days_with_deal": 5.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 3.49, "impression_share": 4.25, "price": 9.005714286, "click_share_rank": 6.0, "weekly_search_volume": 60855.1, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 2123.84299, "real_brand": "VAHDAM", "week_str": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "matcha", "competitor_brand": 0.0, "asin": "B0F5BVFRC1", "product_title": "\"Jean & Len Handcreme I Love You So Matcha, für nor...", "country_code": "de", "average_organic_rank": 12.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 1.92, "impression_share": 2.66, "price": 3.095714286, "click_share_rank": 10.0, "weekly_search_volume": 60855.1, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 1168.41792, "real_brand": "\"Jean", "week_str": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "matcha", "competitor_brand": 0.0, "asin": "B0G1T7N675", "product_title": "Ceremonial Matcha Pulver BIO-Qualität 50g ideal zu...", "country_code": "de", "average_organic_rank": 12.0, "weekly_number_of_days_with_deal": 7.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 2.56, "impression_share": 3.71, "price": 8.898571429, "click_share_rank": 9.0, "weekly_search_volume": 60855.1, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 1557.89056, "real_brand": "Ceremonial", "week_str": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "matcha", "competitor_brand": 0.0, "asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Natürlich & Fein Gemahl...", "country_code": "de", "average_organic_rank": 14.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7.0, "click_share": 3.48, "impression_share": 4.53, "price": 10.44, "click_share_rank": 7.0, "weekly_search_volume": 60855.1, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 2117.75748, "real_brand": "Matcha", "week_str": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "matcha", "competitor_brand": "Special Leaves", "asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Natürlich & Fein Gemahl...", "country_code": "de", "average_organic_rank": 14.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7.0, "click_share": 3.48, "impression_share": 4.53, "price": 10.44, "click_share_rank": 7.0, "weekly_search_volume": 60855.1, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 2117.75748, "real_brand": "Special Leaves", "week_str": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "matcha", "competitor_brand": "NaturaleBio", "asin": "B07SZFD3P9", "product_title": "NaturaleBio Matcha Ceremonial Grade 100g. Original...", "country_code": "de", "average_organic_rank": 22.0, "weekly_number_of_days_with_deal": 7.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 2.95, "impression_share": 2.57, "price": 26.748571429, "click_share_rank": 8.0, "weekly_search_volume": 60855.1, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 1795.22545, "real_brand": "NaturaleBio", "week_str": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha", "competitor_brand": "NORITUAL LAB", "asin": "B0CNRX8G5S", "product_title": "Ceremonial Matcha - Reines Matcha Pulver aus Japan...", "country_code": "de", "average_organic_rank": 2.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0.0, "click_share": 18.77, "impression_share": 3.35, "price": 24.648571429, "click_share_rank": 1.0, "weekly_search_volume": 47708.06, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 8954.802862, "real_brand": "NORITUAL LAB", "week_str": "2025-52"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha", "competitor_brand": "NaturaleBio", "asin": "B06XQ5DCYJ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "country_code": "de", "average_organic_rank": 2.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 11.66, "impression_share": 3.37, "price": 15.058571429, "click_share_rank": 2.0, "weekly_search_volume": 47708.06, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 5562.759796, "real_brand": "NaturaleBio", "week_str": "2025-52"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha", "competitor_brand": "NaturaleBio", "asin": "B06XQ69YCQ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "country_code": "de", "average_organic_rank": 4.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 3.75, "impression_share": 3.25, "price": 10.538571429, "click_share_rank": 5.0, "weekly_search_volume": 47708.06, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 1789.05225, "real_brand": "NaturaleBio", "week_str": "2025-52"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha", "competitor_brand": "NaturaleBio", "asin": "B079VQ52MK", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "country_code": "de", "average_organic_rank": 5.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 3.49, "impression_share": 3.36, "price": 24.855714286, "click_share_rank": 6.0, "weekly_search_volume": 47708.06, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 1665.011294, "real_brand": "NaturaleBio", "week_str": "2025-52"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha", "competitor_brand": "NORITUAL LAB", "asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Grüntee-Pulver au...", "country_code": "de", "average_organic_rank": 6.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 8.42, "impression_share": 4.24, "price": 16.037142857, "click_share_rank": 3.0, "weekly_search_volume": 47708.06, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 4017.018652, "real_brand": "NORITUAL LAB", "week_str": "2025-52"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha", "competitor_brand": 0.0, "asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Grüntee-Pulver au...", "country_code": "de", "average_organic_rank": 6.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 8.42, "impression_share": 4.24, "price": 16.037142857, "click_share_rank": 3.0, "weekly_search_volume": 47708.06, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 4017.018652, "real_brand": "Ceremonial", "week_str": "2025-52"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha", "competitor_brand": "VAHDAM", "asin": "B07MD4LB49", "product_title": "\"VAHDAM, Matcha Grüntee Pulver (100g, 50+ Tassen) A...", "country_code": "de", "average_organic_rank": 7.0, "weekly_number_of_days_with_deal": 3.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 4.19, "impression_share": 5.29, "price": 9.895714286, "click_share_rank": 4.0, "weekly_search_volume": 47708.06, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 1998.967714, "real_brand": "VAHDAM", "week_str": "2025-52"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha", "competitor_brand": 0.0, "asin": "B08XVX8V1T", "product_title": "\"Bio Matcha Pulver 100 g – Japan Matcha Tee, 100% n...", "country_code": "de", "average_organic_rank": 10.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 2.44, "impression_share": 3.4, "price": 12.367142857, "click_share_rank": 9.0, "weekly_search_volume": 47708.06, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 1164.076664, "real_brand": "\"Bio", "week_str": "2025-52"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha", "competitor_brand": "bioKontor", "asin": "B08XVX8V1T", "product_title": "\"Bio Matcha Pulver 100 g – Japan Matcha Tee, 100% n...", "country_code": "de", "average_organic_rank": 10.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 2.44, "impression_share": 3.4, "price": 12.367142857, "click_share_rank": 9.0, "weekly_search_volume": 47708.06, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 1164.076664, "real_brand": "bioKontor", "week_str": "2025-52"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha", "competitor_brand": 0.0, "asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Natürlich & Fein Gemahl...", "country_code": "de", "average_organic_rank": 13.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7.0, "click_share": 3.4, "impression_share": 4.7, "price": 10.71, "click_share_rank": 7.0, "weekly_search_volume": 47708.06, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 1622.07404, "real_brand": "Matcha", "week_str": "2025-52"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha", "competitor_brand": "Special Leaves", "asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Natürlich & Fein Gemahl...", "country_code": "de", "average_organic_rank": 13.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7.0, "click_share": 3.4, "impression_share": 4.7, "price": 10.71, "click_share_rank": 7.0, "weekly_search_volume": 47708.06, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 1622.07404, "real_brand": "Special Leaves", "week_str": "2025-52"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha", "competitor_brand": "VAHDAM", "asin": "B07K1WBH4K", "product_title": "\"VAHDAM, Vanille Matcha Grüner Tee Pulver (100g, 50...", "country_code": "de", "average_organic_rank": 20.0, "weekly_number_of_days_with_deal": 3.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 1.47, "impression_share": 2.29, "price": 9.895714286, "click_share_rank": 10.0, "weekly_search_volume": 47708.06, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 701.308482, "real_brand": "VAHDAM", "week_str": "2025-52"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha", "competitor_brand": "NaturaleBio", "asin": "B07SZFD3P9", "product_title": "NaturaleBio Matcha Ceremonial Grade 100g. Original...", "country_code": "de", "average_organic_rank": 23.0, "weekly_number_of_days_with_deal": 1.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 2.93, "impression_share": 2.43, "price": 30.704285714, "click_share_rank": 8.0, "weekly_search_volume": 47708.06, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 1397.846158, "real_brand": "NaturaleBio", "week_str": "2025-52"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha", "competitor_brand": "NaturaleBio", "asin": "B07SZFD3P9", "product_title": "NaturaleBio Matcha Ceremonial Grade 100g. Original...", "country_code": "de", "average_organic_rank": 0.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 2.68, "impression_share": 2.06, "price": 30.27, "click_share_rank": 8.0, "weekly_search_volume": 27011.1, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 723.89748, "real_brand": "NaturaleBio", "week_str": "2026-01"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha", "competitor_brand": "NORITUAL LAB", "asin": "B0CNRX8G5S", "product_title": "Ceremonial Matcha - Reines Matcha Pulver aus Japan...", "country_code": "de", "average_organic_rank": 2.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 4, "weekly_number_of_days_with_coupon": 0.0, "click_share": 19.34, "impression_share": 3.36, "price": 23.91, "click_share_rank": 1.0, "weekly_search_volume": 27011.1, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 5223.94674, "real_brand": "NORITUAL LAB", "week_str": "2026-01"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha", "competitor_brand": "NaturaleBio", "asin": "B06XQ5DCYJ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "country_code": "de", "average_organic_rank": 2.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 12.9, "impression_share": 3.37, "price": 14.6075, "click_share_rank": 2.0, "weekly_search_volume": 27011.1, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 3484.4319, "real_brand": "NaturaleBio", "week_str": "2026-01"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha", "competitor_brand": "NaturaleBio", "asin": "B06XQ69YCQ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "country_code": "de", "average_organic_rank": 5.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 3.35, "impression_share": 3.02, "price": 10.2225, "click_share_rank": 5.0, "weekly_search_volume": 27011.1, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 904.87185, "real_brand": "NaturaleBio", "week_str": "2026-01"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha", "competitor_brand": "NaturaleBio", "asin": "B079VQ52MK", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "country_code": "de", "average_organic_rank": 5.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 3.66, "impression_share": 3.36, "price": 24.5275, "click_share_rank": 4.0, "weekly_search_volume": 27011.1, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 988.60626, "real_brand": "NaturaleBio", "week_str": "2026-01"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha", "competitor_brand": "NORITUAL LAB", "asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Grüntee-Pulver au...", "country_code": "de", "average_organic_rank": 6.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 7.38, "impression_share": 4.54, "price": 15.5575, "click_share_rank": 3.0, "weekly_search_volume": 27011.1, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 1993.41918, "real_brand": "NORITUAL LAB", "week_str": "2026-01"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha", "competitor_brand": 0.0, "asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Grüntee-Pulver au...", "country_code": "de", "average_organic_rank": 6.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 7.38, "impression_share": 4.54, "price": 15.5575, "click_share_rank": 3.0, "weekly_search_volume": 27011.1, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 1993.41918, "real_brand": "Ceremonial", "week_str": "2026-01"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha", "competitor_brand": "VAHDAM", "asin": "B07MD4LB49", "product_title": "\"VAHDAM, Matcha Grüntee Pulver (100g, 50+ Tassen) A...", "country_code": "de", "average_organic_rank": 9.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 3.15, "impression_share": 5.19, "price": 10.43, "click_share_rank": 6.0, "weekly_search_volume": 27011.1, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 850.84965, "real_brand": "VAHDAM", "week_str": "2026-01"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha", "competitor_brand": "bioKontor", "asin": "B08XVX8V1T", "product_title": "\"Bio Matcha Pulver 100 g – Japan Matcha Tee, 100% n...", "country_code": "de", "average_organic_rank": 10.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 2.39, "impression_share": 3.91, "price": 11.9975, "click_share_rank": 9.0, "weekly_search_volume": 27011.1, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 645.56529, "real_brand": "bioKontor", "week_str": "2026-01"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha", "competitor_brand": 0.0, "asin": "B08XVX8V1T", "product_title": "\"Bio Matcha Pulver 100 g – Japan Matcha Tee, 100% n...", "country_code": "de", "average_organic_rank": 10.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 2.39, "impression_share": 3.91, "price": 11.9975, "click_share_rank": 9.0, "weekly_search_volume": 27011.1, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 645.56529, "real_brand": "\"Bio", "week_str": "2026-01"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha", "competitor_brand": "Special Leaves", "asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Natürlich & Fein Gemahl...", "country_code": "de", "average_organic_rank": 16.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 4.0, "click_share": 3.0, "impression_share": 4.47, "price": 10.39, "click_share_rank": 7.0, "weekly_search_volume": 27011.1, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 810.333, "real_brand": "Special Leaves", "week_str": "2026-01"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha", "competitor_brand": 0.0, "asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Natürlich & Fein Gemahl...", "country_code": "de", "average_organic_rank": 16.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 4.0, "click_share": 3.0, "impression_share": 4.47, "price": 10.39, "click_share_rank": 7.0, "weekly_search_volume": 27011.1, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 810.333, "real_brand": "Matcha", "week_str": "2026-01"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha", "competitor_brand": 0.0, "asin": "B0F9B1LWQQ", "product_title": "UNREAL\u00ae 100g Ceremonial Bio Matcha \u2013 100% Japanisc...", "country_code": "de", "average_organic_rank": 19.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 1.57, "impression_share": 1.96, "price": 31.2725, "click_share_rank": 10.0, "weekly_search_volume": 27011.1, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha", "clicks": 424.07427, "real_brand": "UNREAL\u00ae", "week_str": "2026-01"}];
    const targetBrand = "NaturaleBio";
    const topCompetitors = ["NORITUAL LAB", "Ceremonial", "Matcha"];
    const generatedInsights = ["Se observa una contracci\u00f3n en la demanda del 43.4% respecto a la semana anterior.", "<b>NaturaleBio</b> gana tracci\u00f3n (+0.66% share), superando la tendencia del mercado.", "Revisar keywords con rank org\u00e1nico > 10 para optimizaci\u00f3n de backend search terms."];

    // 2. HELPER FUNCTIONS
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(initDashboard);

    function initDashboard() {
        populateKPIs();
        populateInsights();
        populateControls();
        drawTrendChart();
        drawShareChart();
        drawEfficiencyChart();
        updateComparator();
    }

    function switchTab(tabId) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
        if(tabId === 'interactive') updateComparator();
    }

    // --- DATA AGGREGATION ---

    function getUniqueWeeks() {
        return [...new Set(marketData.map(d => d.week_str))].sort();
    }

    // KPI LOGIC
    function populateKPIs() {
        const weeks = getUniqueWeeks();
        const lastWeek = weeks[weeks.length - 1];
        const lastWeekData = marketData.filter(d => d.week_str === lastWeek);
        
        // 1. My Clicks
        const myClicks = lastWeekData.filter(d => d.real_brand === targetBrand)
                                     .reduce((sum, d) => sum + d.clicks, 0);
        
        // 2. Market Share (My Clicks / Total Clicks in Data) - Proxy
        const totalClicks = lastWeekData.reduce((sum, d) => sum + d.clicks, 0);
        const myShare = totalClicks ? (myClicks / totalClicks) * 100 : 0;
        
        // 3. Avg Price
        const myPrice = lastWeekData.filter(d => d.real_brand === targetBrand)
                                    .reduce((sum, d, i, arr) => sum + d.price / arr.length, 0);

        // 4. Avg Rank
        const myRank = lastWeekData.filter(d => d.real_brand === targetBrand)
                                   .reduce((sum, d, i, arr) => sum + d.average_organic_rank / arr.length, 0);

        const html = `
            <div class="kpi-card">
                <div class="kpi-label">Weekly Clicks (Est.)</div>
                <div class="kpi-value">${Math.round(myClicks).toLocaleString()}</div>
                <div class="kpi-trend trend-up">Target Brand Volume</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Click Share</div>
                <div class="kpi-value">${myShare.toFixed(1)}%</div>
                <div class="kpi-trend">vs Total Tracked</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Avg. Price</div>
                <div class="kpi-value">€${myPrice.toFixed(2)}</div>
                <div class="kpi-trend">Latest Week</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Organic Rank</div>
                <div class="kpi-value">#${myRank.toFixed(1)}</div>
                <div class="kpi-trend">Average Position</div>
            </div>
        `;
        document.getElementById('kpi-container').innerHTML = html;
    }

    function populateInsights() {
        const container = document.getElementById('insights-container');
        container.innerHTML = generatedInsights.map(text => `
            <div class="insight-item">
                <div class="insight-icon"><span class="material-icons" style="font-size:18px;">lightbulb</span></div>
                <div style="font-size: 13px; line-height: 1.5;">${text}</div>
            </div>
        `).join('');
    }

    // --- CHART DRAWING FUNCTIONS ---

    function drawTrendChart() {
        const weeks = getUniqueWeeks();
        const dataArray = [['Week', 'Total Market Clicks', 'My Share (%)', 'Comp Share (%)']];

        weeks.forEach(w => {
            const weekData = marketData.filter(d => d.week_str === w);
            const totalClicks = weekData.reduce((sum, d) => sum + d.clicks, 0);
            
            const myClicks = weekData.filter(d => d.real_brand === targetBrand).reduce((sum, d) => sum + d.clicks, 0);
            const compClicks = totalClicks - myClicks;
            
            const myShare = totalClicks ? (myClicks / totalClicks) * 100 : 0;
            const compShare = totalClicks ? (compClicks / totalClicks) * 100 : 0;

            dataArray.push([w, totalClicks, myShare, compShare]);
        });

        const data = google.visualization.arrayToDataTable(dataArray);
        const options = {
            seriesType: 'bars',
            series: { 
                1: {type: 'line', targetAxisIndex: 1, color: '#4285F4'}, 
                2: {type: 'line', targetAxisIndex: 1, color: '#EA4335'} 
            },
            vAxes: { 0: {title: 'Est. Clicks'}, 1: {title: 'Share %', format: '#\'%\''} },
            hAxis: { title: 'Week' },
            colors: ['#E5E7EB'],
            legend: { position: 'bottom' },
            chartArea: { width: '85%', height: '70%' }
        };

        const chart = new google.visualization.ComboChart(document.getElementById('chart_trend'));
        chart.draw(data, options);
    }

    function drawShareChart() {
        const weeks = getUniqueWeeks();
        // Columns: Week, MyBrand, Comp1, Comp2, Comp3
        const header = ['Week', targetBrand, ...topCompetitors];
        const dataArray = [header];

        weeks.forEach(w => {
            const weekData = marketData.filter(d => d.week_str === w);
            const row = [w];
            
            // Calculate Share for Target Brand
            const myShare = getBrandShare(weekData, targetBrand);
            row.push(myShare);

            // Calculate Share for Competitors
            topCompetitors.forEach(comp => {
                row.push(getBrandShare(weekData, comp));
            });

            dataArray.push(row);
        });

        function getBrandShare(data, brand) {
            const totalClicks = data.reduce((s, d) => s + d.clicks, 0);
            const brandClicks = data.filter(d => d.real_brand === brand).reduce((s, d) => s + d.clicks, 0);
            return totalClicks ? (brandClicks / totalClicks) * 100 : 0;
        }

        const data = google.visualization.arrayToDataTable(dataArray);
        const options = {
            curveType: 'function',
            legend: { position: 'bottom' },
            colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853'],
            vAxis: { title: 'Click Share %' },
            chartArea: { width: '85%', height: '70%' }
        };

        const chart = new google.visualization.LineChart(document.getElementById('chart_share'));
        chart.draw(data, options);
    }

    function drawEfficiencyChart() {
        const weeks = getUniqueWeeks();
        const lastWeek = weeks[weeks.length - 1];
        const weekData = marketData.filter(d => d.week_str === lastWeek);

        // Header: [Rank, Share, Style (Color)]
        const dataArray = [['Organic Rank', 'Click Share %', { role: 'style' }, {role: 'tooltip'}]];

        weekData.forEach(d => {
            const isMe = d.real_brand === targetBrand;
            const color = isMe ? '#4285F4' : '#E5E7EB';
            const opacity = isMe ? 'opacity: 1.0' : 'opacity: 0.6';
            dataArray.push([
                d.average_organic_rank, 
                d.click_share, 
                `point { fill-color: ${color}; ${opacity} }`,
                `${d.real_brand}: Rank ${d.average_organic_rank}, Share ${d.click_share}%`
            ]);
        });

        const data = google.visualization.arrayToDataTable(dataArray);
        const options = {
            hAxis: { title: 'Average Organic Rank (Lower is Better)', direction: 1 },
            vAxis: { title: 'Click Share %' },
            legend: 'none',
            chartArea: { width: '85%', height: '70%' }
        };

        const chart = new google.visualization.ScatterChart(document.getElementById('chart_scatter'));
        chart.draw(data, options);
    }

    // --- INTERACTIVE SECTION ---

    function populateControls() {
        const weeks = getUniqueWeeks().reverse();
        const weekSel = document.getElementById('weekSelector');
        weeks.forEach(w => {
            const opt = document.createElement('option');
            opt.value = w;
            opt.text = w;
            weekSel.add(opt);
        });

        const compSel = document.getElementById('compSelector');
        // Get all brands excluding mine
        const allBrands = [...new Set(marketData.map(d => d.real_brand))].filter(b => b !== targetBrand).sort();
        allBrands.forEach(b => {
            const opt = document.createElement('option');
            opt.value = b;
            opt.text = b;
            compSel.add(opt);
        });
        if(topCompetitors.length > 0) compSel.value = topCompetitors[0];
    }

    function updateComparator() {
        const week = document.getElementById('weekSelector').value;
        const comp = document.getElementById('compSelector').value;
        const header = document.getElementById('comp-header');
        header.innerText = comp;

        const weekData = marketData.filter(d => d.week_str === week);
        
        // Metrics Calculation
        const myData = weekData.filter(d => d.real_brand === targetBrand);
        const compData = weekData.filter(d => d.real_brand === comp);

        const getAvg = (data, field) => {
            if(!data.length) return 0;
            return data.reduce((s, d) => s + d[field], 0) / data.length;
        };

        const metrics = [
            { label: 'Avg Price', field: 'price', fmt: v => `€${v.toFixed(2)}` },
            { label: 'Click Share', field: 'click_share', fmt: v => `${v.toFixed(1)}%` },
            { label: 'Organic Rank', field: 'average_organic_rank', fmt: v => `#${v.toFixed(1)}` },
            { label: 'Deal Days', field: 'weekly_number_of_days_with_deal', fmt: v => v > 0 ? `<span class="badge badge-deal">${v.toFixed(1)} days</span>` : '-' },
            { label: 'Choice Badge', field: 'weekly_number_of_days_with_amazon_choice_badge', fmt: v => v > 0 ? `<span class="badge badge-choice">Yes</span>` : 'No' }
        ];

        const tbody = document.getElementById('comp-body');
        tbody.innerHTML = metrics.map(m => `
            <tr>
                <td>${m.label}</td>
                <td style="color: var(--primary);">${m.fmt(getAvg(myData, m.field))}</td>
                <td style="color: var(--danger);">${m.fmt(getAvg(compData, m.field))}</td>
            </tr>
        `).join('');

        drawPriceChart(comp);
    }

    function drawPriceChart(compBrand) {
        const weeks = getUniqueWeeks();
        const dataArray = [['Week', targetBrand, compBrand]];

        weeks.forEach(w => {
            const weekData = marketData.filter(d => d.week_str === w);
            
            const myPrice = weekData.filter(d => d.real_brand === targetBrand)
                                    .reduce((s, d, _, a) => s + d.price/a.length, 0) || null;
            const compPrice = weekData.filter(d => d.real_brand === compBrand)
                                      .reduce((s, d, _, a) => s + d.price/a.length, 0) || null;
            
            dataArray.push([w, myPrice, compPrice]);
        });

        const data = google.visualization.arrayToDataTable(dataArray);
        const options = {
            title: 'Avg Price Evolution (€)',
            curveType: 'function',
            legend: { position: 'bottom' },
            colors: ['#4285F4', '#EA4335'],
            chartArea: { width: '85%', height: '70%' }
        };

        const chart = new google.visualization.LineChart(document.getElementById('chart_price'));
        chart.draw(data, options);
    }

    // Handle Resize
    window.onresize = () => {
        drawTrendChart();
        drawShareChart();
        drawEfficiencyChart();
        updateComparator();
    };

</script>
</body>
</html>