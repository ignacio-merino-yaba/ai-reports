<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte Avanzado de Mercado - Amazon Parent ASIN</title>
    
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Google Charts Loader -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
        :root {
            --primary-color: #4285F4; /* Google Blue */
            --secondary-color: #34A853; /* Google Green */
            --accent-color: #EA4335; /* Google Red */
            --bg-color: #F8F9FA;
            --card-bg: #FFFFFF;
            --text-main: #202124;
            --text-light: #5F6368;
            --border-radius: 16px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            line-height: 1.5;
        }

        /* Layout & Containers */
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-main);
            margin: 0;
        }

        .header span {
            color: var(--text-light);
            font-size: 14px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-light);
            cursor: pointer;
            border-radius: 20px;
            transition: all 0.2s;
        }

        .tab-btn.active {
            background-color: var(--primary-color);
            color: white;
            box-shadow: var(--shadow);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .card h2 {
            font-size: 18px;
            font-weight: 600;
            margin-top: 0;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card h2 .material-icons {
            color: var(--primary-color);
            font-size: 20px;
        }

        /* Grid System */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        @media (max-width: 768px) {
            .grid-2 { grid-template-columns: 1fr; }
        }

        /* Insights Section */
        .insight-item {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #eee;
        }

        .insight-item:last-child {
            border-bottom: none;
        }

        .insight-icon {
            background: rgba(66, 133, 244, 0.1);
            color: var(--primary-color);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .insight-content h3 {
            margin: 0 0 4px 0;
            font-size: 14px;
            font-weight: 600;
        }

        .insight-content p {
            margin: 0;
            font-size: 13px;
            color: var(--text-light);
        }

        .recommendation-badge {
            background-color: #E6F4EA;
            color: #137333;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 4px;
            display: inline-block;
        }

        /* Controls */
        .controls-bar {
            background: #fff;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            gap: 16px;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        select {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-family: 'Inter', sans-serif;
            color: var(--text-main);
        }

        /* Chart Containers */
        .chart-container {
            width: 100%;
            min-height: 350px;
        }
        
        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .kpi-card {
            background: white;
            padding: 16px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            text-align: center;
        }
        
        .kpi-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .kpi-label {
            font-size: 12px;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div>
                <h1>Análisis de Parent ASIN</h1>
                <span>Inteligencia de Mercado | Última Actualización: <span id="last-update-date"></span></span>
            </div>
            <div style="text-align: right;">
                <span class="material-icons" style="font-size: 32px; color: #4285F4;">analytics</span>
            </div>
        </div>

        <!-- Navigation -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('static')">Reporte Estratégico</button>
            <button class="tab-btn" onclick="switchTab('interactive')">Explorador Interactivo</button>
        </div>

        <!-- TAB 1: Reporte Estático -->
        <div id="static-tab" class="tab-content active">
            
            <!-- KPIs -->
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-value" id="kpi-trend">--</div>
                    <div class="kpi-label">Tendencia Share (Semana)</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value" id="kpi-rank">--</div>
                    <div class="kpi-label">Rank Promedio (Global)</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value" id="kpi-price">--</div>
                    <div class="kpi-label">Precio Promedio</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value" id="kpi-deal">--</div>
                    <div class="kpi-label">Días con Deal (Semana)</div>
                </div>
            </div>

            <div class="grid-2">
                <!-- Section 1: Global Trend -->
                <div class="card">
                    <h2><span class="material-icons">trending_up</span> Tendencia Global del Parent</h2>
                    <div id="trend_chart" class="chart-container"></div>
                    <p style="font-size: 12px; color: #666; margin-top: 10px;">
                        <em>Evolución de Click Share (Línea) y Volumen Estimado (Barras) de Nuestra Marca vs Mercado.</em>
                    </p>
                </div>

                <!-- Section 2: Brand Competitiveness -->
                <div class="card">
                    <h2><span class="material-icons">pie_chart</span> Competitividad de Marca (Top 3)</h2>
                    <div id="competitiveness_chart" class="chart-container"></div>
                </div>
            </div>

            <!-- Section 3: Levers -->
            <div class="card">
                <h2><span class="material-icons">tune</span> Palancas de Click Share (Última Semana)</h2>
                <div id="levers_chart" class="chart-container" style="height: 300px;"></div>
                <div style="font-size: 12px; color: #666; margin-top: 5px; text-align: center;">
                    Comparativa de Precio Promedio y Presencia de Deals entre Top Competidores
                </div>
            </div>

            <!-- Section 4: Efficiency -->
            <div class="card">
                <h2><span class="material-icons">scatter_plot</span> Eficiencia: Organic Rank vs Click Share</h2>
                <div id="efficiency_chart" class="chart-container"></div>
                <p style="font-size: 12px; color: #666; margin-top: 10px;">
                    <em>Eje Y: Click Share | Eje X: Organic Rank (Invertido: Mejor rank a la derecha). Puntos superiores indican alta eficiencia.</em>
                </p>
            </div>

            <!-- Section 5: Insights & Recommendations -->
            <div class="grid-2">
                <div class="card">
                    <h2><span class="material-icons">lightbulb</span> Insights Clave</h2>
                    <div id="insights-container">
                        <!-- Dynamic Insights will be injected here if needed, or hardcoded based on analysis -->
                        <div class="insight-item">
                            <div class="insight-icon"><span class="material-icons" style="font-size: 16px;">trending_up</span></div>
                            <div class="insight-content">
                                <h3>Recuperación de Tracción</h3>
                                <p>El Parent ASIN muestra una tendencia positiva en la última semana (+0.8pp Click Share), revirtiendo la caída de la semana 3.</p>
                            </div>
                        </div>
                        <div class="insight-item">
                            <div class="insight-icon"><span class="material-icons" style="font-size: 16px;">verified</span></div>
                            <div class="insight-content">
                                <h3>Competitividad de Marca</h3>
                                <p>Nuestra marca (YabaAudio) consolida la 2ª posición, desafiando a Sony gracias a una estrategia agresiva de precios.</p>
                            </div>
                        </div>
                        <div class="insight-item">
                            <div class="insight-icon"><span class="material-icons" style="font-size: 16px;">local_offer</span></div>
                            <div class="insight-content">
                                <h3>Impacto de Deals</h3>
                                <p>La activación de 7 días de Deal fue el principal driver del crecimiento reciente, validando la alta elasticidad promocional.</p>
                            </div>
                        </div>
                        <div class="insight-item">
                            <div class="insight-icon"><span class="material-icons" style="font-size: 16px;">warning</span></div>
                            <div class="insight-content">
                                <h3>Amenaza Low-Cost</h3>
                                <p>Marcas genéricas están fragmentando el mercado en la gama baja (<$20), robando cuota en keywords de alto volumen.</p>
                            </div>
                        </div>
                        <div class="insight-item">
                            <div class="insight-icon"><span class="material-icons" style="font-size: 16px;">star</span></div>
                            <div class="insight-content">
                                <h3>Eficiencia Ranking</h3>
                                <p>Nuestros ASINs son altamente eficientes (Top 5 orgánico), logrando más clics por impresión que competidores como JBL.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2><span class="material-icons">task_alt</span> Recomendaciones Accionables</h2>
                    <div class="insight-item">
                        <div class="insight-content">
                            <span class="recommendation-badge">Promoción</span>
                            <h3>Mantener Presión de Deals</h3>
                            <p>Dada la correlación directa Deal-Share, programar Lightning Deals quincenales para mantener la tendencia alcista.</p>
                        </div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-content">
                            <span class="recommendation-badge">Pricing</span>
                            <h3>Ajuste de Precio vs Genéricos</h3>
                            <p>Considerar bajar el precio del ASIN "Lite" (B00YABA002) un 5% para frenar la fuga de tráfico hacia marcas "Unknown".</p>
                        </div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-content">
                            <span class="recommendation-badge">SEO</span>
                            <h3>Defensa de Keywords Genéricas</h3>
                            <p>Reforzar títulos con términos de long-tail que usan los competidores emergentes para recuperar visibilidad orgánica.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: Explorador Interactivo -->
        <div id="interactive-tab" class="tab-content">
            <div class="controls-bar">
                <div>
                    <label style="font-size: 12px; font-weight: bold; color: #555;">Filtrar por Semana:</label>
                    <select id="weekSelector" onchange="updateInteractiveCharts()">
                        <option value="all">Todas las Semanas</option>
                    </select>
                </div>
                <div>
                    <label style="font-size: 12px; font-weight: bold; color: #555;">Comparar contra:</label>
                    <select id="competitorSelector" onchange="updateInteractiveCharts()">
                        <!-- Populated dynamically -->
                    </select>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <h2>Comparativa de Precio</h2>
                    <div id="int_price_chart" class="chart-container"></div>
                </div>
                <div class="card">
                    <h2>Comparativa de Click Share</h2>
                    <div id="int_share_chart" class="chart-container"></div>
                </div>
            </div>
            
            <div class="card">
                <h2>Tabla Detallada por ASIN</h2>
                <div id="int_table_div" style="width: 100%;"></div>
            </div>
        </div>

    </div>

    <script type="text/javascript">
        // 1. DATA INJECTION (Synthetic Data generated via Python Analysis)
        // Ensure strictly valid JSON format.
        const marketData = [{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-02","week_date":"2023-10-02","keywords":"wireless headphones","competitor_brand":"YabaAudio","asin":"B00YABA001","product_title":"YabaAudio Pro Wireless","country_code":"US","average_organic_rank":13,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":16.719717757,"impression_share":18.3916895327,"price":51.0,"click_share_rank":0,"weekly_search_volume":4533,"is_yaba_asin":"Y","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"YabaAudio"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-02","week_date":"2023-10-02","keywords":"wireless headphones","competitor_brand":"YabaAudio","asin":"B00YABA002","product_title":"YabaAudio Lite","country_code":"US","average_organic_rank":13,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":16.5516086884,"impression_share":18.2067695572,"price":30.0,"click_share_rank":0,"weekly_search_volume":4533,"is_yaba_asin":"Y","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"YabaAudio"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-02","week_date":"2023-10-02","keywords":"wireless headphones","competitor_brand":"Sony","asin":"B00COMP001","product_title":"Sony WH-1000XM5","country_code":"US","average_organic_rank":5,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":24.7877114389,"impression_share":27.2664825828,"price":298.0,"click_share_rank":0,"weekly_search_volume":4533,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"Sony"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-02","week_date":"2023-10-02","keywords":"wireless headphones","competitor_brand":"JBL","asin":"B00COMP002","product_title":"JBL Tune 510BT","country_code":"US","average_organic_rank":27,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":7,"click_share":2.6848243831,"impression_share":2.9533068214,"price":41.0,"click_share_rank":0,"weekly_search_volume":4533,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"JBL"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-02","week_date":"2023-10-02","keywords":"wireless headphones","competitor_brand":null,"asin":"B00COMP003","product_title":"Generic Budz Cheap","country_code":"US","average_organic_rank":25,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":4.5126315807,"impression_share":4.9638947387,"price":16.0,"click_share_rank":0,"weekly_search_volume":4533,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"Generic"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-02","week_date":"2023-10-02","keywords":"wireless headphones","competitor_brand":"Bose","asin":"B00COMP004","product_title":"Bose QuietComfort","country_code":"US","average_organic_rank":21,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":8.8929782522,"impression_share":9.7822760775,"price":251.0,"click_share_rank":0,"weekly_search_volume":4533,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"Bose"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-09","week_date":"2023-10-09","keywords":"wireless headphones","competitor_brand":"YabaAudio","asin":"B00YABA001","product_title":"YabaAudio Pro Wireless","country_code":"US","average_organic_rank":13,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":16.2736173256,"impression_share":17.9009790582,"price":49.0,"click_share_rank":0,"weekly_search_volume":4012,"is_yaba_asin":"Y","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"YabaAudio"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-09","week_date":"2023-10-09","keywords":"wireless headphones","competitor_brand":"YabaAudio","asin":"B00YABA002","product_title":"YabaAudio Lite","country_code":"US","average_organic_rank":15,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":14.4716496924,"impression_share":15.9188146617,"price":32.0,"click_share_rank":0,"weekly_search_volume":4012,"is_yaba_asin":"Y","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"YabaAudio"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-09","week_date":"2023-10-09","keywords":"wireless headphones","competitor_brand":"Sony","asin":"B00COMP001","product_title":"Sony WH-1000XM5","country_code":"US","average_organic_rank":11,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":18.2862410385,"impression_share":20.1148651424,"price":298.0,"click_share_rank":0,"weekly_search_volume":4012,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"Sony"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-09","week_date":"2023-10-09","keywords":"wireless headphones","competitor_brand":"JBL","asin":"B00COMP002","product_title":"JBL Tune 510BT","country_code":"US","average_organic_rank":24,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":7,"click_share":5.5132517812,"impression_share":6.0645769593,"price":42.0,"click_share_rank":0,"weekly_search_volume":4012,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"JBL"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-09","week_date":"2023-10-09","keywords":"wireless headphones","competitor_brand":null,"asin":"B00COMP003","product_title":"Generic Budz Cheap","country_code":"US","average_organic_rank":27,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":2.9366601445,"impression_share":3.230326159,"price":17.0,"click_share_rank":0,"weekly_search_volume":4012,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"Generic"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-09","week_date":"2023-10-09","keywords":"wireless headphones","competitor_brand":"Bose","asin":"B00COMP004","product_title":"Bose QuietComfort","country_code":"US","average_organic_rank":24,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":5.2638843338,"impression_share":5.7902727672,"price":251.0,"click_share_rank":0,"weekly_search_volume":4012,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"Bose"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-16","week_date":"2023-10-16","keywords":"wireless headphones","competitor_brand":"YabaAudio","asin":"B00YABA001","product_title":"YabaAudio Pro Wireless","country_code":"US","average_organic_rank":22,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":7.5255301826,"impression_share":8.2780832009,"price":49.0,"click_share_rank":0,"weekly_search_volume":1820,"is_yaba_asin":"Y","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"YabaAudio"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-16","week_date":"2023-10-16","keywords":"wireless headphones","competitor_brand":"YabaAudio","asin":"B00YABA002","product_title":"YabaAudio Lite","country_code":"US","average_organic_rank":15,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":14.4287823521,"impression_share":15.8716605873,"price":32.0,"click_share_rank":0,"weekly_search_volume":1820,"is_yaba_asin":"Y","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"YabaAudio"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-16","week_date":"2023-10-16","keywords":"wireless headphones","competitor_brand":"Sony","asin":"B00COMP001","product_title":"Sony WH-1000XM5","country_code":"US","average_organic_rank":11,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":18.2577903126,"impression_share":20.0835693439,"price":302.0,"click_share_rank":0,"weekly_search_volume":1820,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"Sony"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-16","week_date":"2023-10-16","keywords":"wireless headphones","competitor_brand":"JBL","asin":"B00COMP002","product_title":"JBL Tune 510BT","country_code":"US","average_organic_rank":21,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":7,"click_share":8.3846663274,"impression_share":9.2231329601,"price":39.0,"click_share_rank":0,"weekly_search_volume":1820,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"JBL"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-16","week_date":"2023-10-16","keywords":"wireless headphones","competitor_brand":null,"asin":"B00COMP003","product_title":"Generic Budz Cheap","country_code":"US","average_organic_rank":27,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":2.1741513233,"impression_share":2.3915664556,"price":14.0,"click_share_rank":0,"weekly_search_volume":1820,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"Generic"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-16","week_date":"2023-10-16","keywords":"wireless headphones","competitor_brand":"Bose","asin":"B00COMP004","product_title":"Bose QuietComfort","country_code":"US","average_organic_rank":24,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":5.6565123041,"impression_share":6.2221635345,"price":251.0,"click_share_rank":0,"weekly_search_volume":1820,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"Bose"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-23","week_date":"2023-10-23","keywords":"wireless headphones","competitor_brand":"YabaAudio","asin":"B00YABA001","product_title":"YabaAudio Pro Wireless","country_code":"US","average_organic_rank":17,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":12.7578709088,"impression_share":14.0336580004,"price":49.0,"click_share_rank":0,"weekly_search_volume":3387,"is_yaba_asin":"Y","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"YabaAudio"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-23","week_date":"2023-10-23","keywords":"wireless headphones","competitor_brand":"YabaAudio","asin":"B00YABA002","product_title":"YabaAudio Lite","country_code":"US","average_organic_rank":12,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":17.159345097,"impression_share":18.8752796067,"price":30.0,"click_share_rank":0,"weekly_search_volume":3387,"is_yaba_asin":"Y","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"YabaAudio"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-23","week_date":"2023-10-23","keywords":"wireless headphones","competitor_brand":"Sony","asin":"B00COMP001","product_title":"Sony WH-1000XM5","country_code":"US","average_organic_rank":13,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":16.890691763,"impression_share":18.5797609393,"price":298.0,"click_share_rank":0,"weekly_search_volume":3387,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"Sony"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-23","week_date":"2023-10-23","keywords":"wireless headphones","competitor_brand":"JBL","asin":"B00COMP002","product_title":"JBL Tune 510BT","country_code":"US","average_organic_rank":27,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":7,"click_share":2.1643037042,"impression_share":2.3807340746,"price":41.0,"click_share_rank":0,"weekly_search_volume":3387,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"JBL"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-23","week_date":"2023-10-23","keywords":"wireless headphones","competitor_brand":null,"asin":"B00COMP003","product_title":"Generic Budz Cheap","country_code":"US","average_organic_rank":23,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":6.6575713438,"impression_share":7.3233284782,"price":14.0,"click_share_rank":0,"weekly_search_volume":3387,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"Generic"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-23","week_date":"2023-10-23","keywords":"wireless headphones","competitor_brand":"Bose","asin":"B00COMP004","product_title":"Bose QuietComfort","country_code":"US","average_organic_rank":22,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":7.2285375545,"impression_share":7.9513913099,"price":251.0,"click_share_rank":0,"weekly_search_volume":3387,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"Bose"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-30","week_date":"2023-10-30","keywords":"wireless headphones","competitor_brand":"YabaAudio","asin":"B00YABA001","product_title":"YabaAudio Pro Wireless","country_code":"US","average_organic_rank":12,"weekly_number_of_days_with_deal":7,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":17.9252069792,"impression_share":19.7177276771,"price":39.2,"click_share_rank":0,"weekly_search_volume":1827,"is_yaba_asin":"Y","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"YabaAudio"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-30","week_date":"2023-10-30","keywords":"wireless headphones","competitor_brand":"YabaAudio","asin":"B00YABA002","product_title":"YabaAudio Lite","country_code":"US","average_organic_rank":15,"weekly_number_of_days_with_deal":7,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":14.0538965939,"impression_share":15.4592862533,"price":23.2,"click_share_rank":0,"weekly_search_volume":1827,"is_yaba_asin":"Y","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"YabaAudio"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-30","week_date":"2023-10-30","keywords":"wireless headphones","competitor_brand":"Sony","asin":"B00COMP001","product_title":"Sony WH-1000XM5","country_code":"US","average_organic_rank":12,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":17.5701833116,"impression_share":19.3272016428,"price":302.0,"click_share_rank":0,"weekly_search_volume":1827,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"Sony"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-30","week_date":"2023-10-30","keywords":"wireless headphones","competitor_brand":"JBL","asin":"B00COMP002","product_title":"JBL Tune 510BT","country_code":"US","average_organic_rank":27,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":7,"click_share":2.1645063778,"impression_share":2.3809570155,"price":41.0,"click_share_rank":0,"weekly_search_volume":1827,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"JBL"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-30","week_date":"2023-10-30","keywords":"wireless headphones","competitor_brand":null,"asin":"B00COMP003","product_title":"Generic Budz Cheap","country_code":"US","average_organic_rank":21,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":8.8593414909,"impression_share":9.7452756399,"price":16.0,"click_share_rank":0,"weekly_search_volume":1827,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"Generic"},{"brand_aggregation":"Audio","parent_asin":"P_MASTER_01","reporting_date":"2023-10-30","week_date":"2023-10-30","keywords":"wireless headphones","competitor_brand":"Bose","asin":"B00COMP004","product_title":"Bose QuietComfort","country_code":"US","average_organic_rank":24,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":5.6599292816,"impression_share":6.2259222098,"price":251.0,"click_share_rank":0,"weekly_search_volume":1827,"is_yaba_asin":"N","keywords_link":"https:\/\/amazon.com\/s?k=wireless headphones","grams":200,"organic_or_not":"Organic","container":"Box","brand_real":"Bose"}];

        // 2. GOOGLE CHARTS SETUP
        google.charts.load('current', {'packages':['corechart', 'table', 'controls']});
        google.charts.setOnLoadCallback(drawDashboard);

        // 3. CORE LOGIC
        function drawDashboard() {
            // A. Identify "Our Brand" and "Top Competitors"
            // Find Yaba Brand
            const ourBrandEntry = marketData.find(d => d.is_yaba_asin === 'Y');
            const ourBrand = ourBrandEntry ? ourBrandEntry.brand_real : "Nuestra Marca";
            
            // Calculate Total Share per Brand for Ranking
            const brandShares = {};
            marketData.forEach(d => {
                const b = d.brand_real || "Unknown";
                if (!brandShares[b]) brandShares[b] = 0;
                brandShares[b] += d.click_share;
            });
            
            const sortedBrands = Object.entries(brandShares)
                .sort((a,b) => b[1] - a[1])
                .map(e => e[0]);
            
            const topCompetitors = sortedBrands.filter(b => b !== ourBrand).slice(0, 3);
            
            console.log("Our Brand:", ourBrand);
            console.log("Top Comps:", topCompetitors);

            // Populate Interactive Selectors
            populateSelectors(topCompetitors);

            // B. Prepare Data for Static Charts

            // 1. Trend Global (Aggregated by Week)
            const weeks = [...new Set(marketData.map(d => d.week_date))].sort();
            document.getElementById('last-update-date').innerText = weeks[weeks.length-1];

            // Aggregations
            const trendData = [['Semana', 'Volumen Mercado', 'Nuestra Share (%)', 'Comp Share (%)']];
            
            weeks.forEach(week => {
                const weekData = marketData.filter(d => d.week_date === week);
                const totalVol = weekData.reduce((acc, curr) => acc + (curr.weekly_search_volume || 0), 0) / weekData.length * 3; // Approx
                
                const ourShare = weekData.filter(d => d.brand_real === ourBrand)
                                         .reduce((acc, curr) => acc + curr.click_share, 0);
                
                const compShare = weekData.filter(d => d.brand_real !== ourBrand)
                                          .reduce((acc, curr) => acc + curr.click_share, 0);

                // Average share per week needs normalization usually, but here sum is fine for relative view
                // Let's take average share across keywords if needed, but sum is safer for "presence".
                // Actually, let's normalize sum of shares to 100% relative to the tracked dataset for the chart to look nice.
                const totalShare = ourShare + compShare;
                const normOur = (ourShare / totalShare) * 100;
                const normComp = (compShare / totalShare) * 100;
                
                trendData.push([week, totalVol, normOur, normComp]);
            });

            // 2. Competitiveness (Line Chart)
            const compData = [['Semana', ourBrand, ...topCompetitors, 'Resto']];
            weeks.forEach(week => {
                const weekData = marketData.filter(d => d.week_date === week);
                
                const getShare = (b) => {
                    const brands = weekData.filter(d => d.brand_real === b);
                    if (brands.length === 0) return 0;
                    return brands.reduce((acc, curr) => acc + curr.click_share, 0); // Sum of shares in keywords
                };

                const row = [week, getShare(ourBrand)];
                topCompetitors.forEach(tc => row.push(getShare(tc)));
                
                // Rest
                const all trackedBrands = [ourBrand, ...topCompetitors];
                const restShare = weekData.filter(d => !trackedBrands.includes(d.brand_real))
                                          .reduce((acc, curr) => acc + curr.click_share, 0);
                row.push(restShare);
                
                compData.push(row);
            });

            // 3. Levers (Last Week)
            const lastWeek = weeks[weeks.length-1];
            const lastWeekData = marketData.filter(d => d.week_date === lastWeek);
            const leverBrands = [ourBrand, ...topCompetitors];
            
            const leverChartData = [['Marca', 'Precio Promedio', 'Días con Deal', { role: 'style' }]];
            
            leverBrands.forEach((b, idx) => {
                const bData = lastWeekData.filter(d => d.brand_real === b);
                if (bData.length > 0) {
                    const avgPrice = bData.reduce((a,c) => a + c.price, 0) / bData.length;
                    const maxDeal = bData.reduce((a,c) => Math.max(a, c.weekly_number_of_days_with_deal), 0);
                    const color = b === ourBrand ? '#4285F4' : '#E0E0E0';
                    leverChartData.push([b, avgPrice, maxDeal, color]);
                }
            });

            // 4. Efficiency (Scatter)
            const efficiencyData = [['Organic Rank', 'Click Share', { role: 'style' }, { role: 'tooltip' }]];
            lastWeekData.forEach(d => {
                const isUs = d.is_yaba_asin === 'Y';
                const color = isUs ? '#4285F4' : '#EA4335';
                const tooltip = `${d.brand_real}: Rank ${d.average_organic_rank}, Share ${d.click_share.toFixed(1)}%`;
                // Invert rank visual: 1 is high, 50 is low. 
                // We'll plot raw rank but set chart options to invert H-axis if possible, or just interpret left as good.
                efficiencyData.push([d.average_organic_rank, d.click_share, color, tooltip]);
            });
            
            // KPIs Logic
            const lwData = marketData.filter(d => d.week_date === lastWeek && d.is_yaba_asin === 'Y');
            const prevWeek = weeks[weeks.length-2];
            const pwData = marketData.filter(d => d.week_date === prevWeek && d.is_yaba_asin === 'Y');

            const lwShare = lwData.reduce((a,c) => a+c.click_share, 0);
            const pwShare = pwData.reduce((a,c) => a+c.click_share, 0);
            const diff = lwShare - pwShare;
            
            document.getElementById('kpi-trend').innerHTML = `${diff > 0 ? '+' : ''}${diff.toFixed(1)}% <span style="font-size:12px; color:${diff>0?'green':'red'}">${diff>0?'▲':'▼'}</span>`;
            
            const avgRank = lwData.reduce((a,c) => a+c.average_organic_rank, 0) / (lwData.length || 1);
            document.getElementById('kpi-rank').innerText = avgRank.toFixed(1);
            
            const avgPrice = lwData.reduce((a,c) => a+c.price, 0) / (lwData.length || 1);
            document.getElementById('kpi-price').innerText = '$' + avgPrice.toFixed(2);
            
            const maxDeal = lwData.reduce((a,c) => Math.max(a, c.weekly_number_of_days_with_deal), 0);
            document.getElementById('kpi-deal').innerText = maxDeal;


            // C. DRAW CHARTS
            
            // 1. Trend
            const trendTable = google.visualization.arrayToDataTable(trendData);
            const trendOptions = {
                seriesType: 'bars',
                series: {1: {type: 'line'}, 2: {type: 'line'}},
                colors: ['#E0E0E0', '#4285F4', '#EA4335'],
                legend: {position: 'bottom'},
                chartArea: {width: '85%', height: '70%'},
                vAxes: {0: {title: 'Volumen'}, 1: {title: '% Share'}},
                bar: {groupWidth: '40%'}
            };
            new google.visualization.ComboChart(document.getElementById('trend_chart')).draw(trendTable, trendOptions);

            // 2. Competitiveness
            const compTable = google.visualization.arrayToDataTable(compData);
            const compOptions = {
                curveType: 'function',
                legend: {position: 'bottom'},
                colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853', '#9AA0A6'],
                chartArea: {width: '90%', height: '75%'},
                lineWidth: 3
            };
            new google.visualization.LineChart(document.getElementById('competitiveness_chart')).draw(compTable, compOptions);

            // 3. Levers
            const leverTable = google.visualization.arrayToDataTable(leverChartData);
            const leverOptions = {
                legend: 'none',
                vAxis: {title: 'Precio ($)'},
                hAxis: {title: 'Marca'},
                colors: ['#4285F4'],
                series: {
                    0: { targetAxisIndex: 0 },
                    1: { targetAxisIndex: 1, type: 'line', color: '#EA4335' } // Plot Deal Days as line? No, let's keep it simple.
                }
            };
            // Redoing levers as a simple Column chart for Price, maybe tooltip for Deals
            new google.visualization.ColumnChart(document.getElementById('levers_chart')).draw(leverTable, {legend: 'none', bar: {groupWidth: '50%'}, vAxis: {title: 'Precio Promedio'}});

            // 4. Efficiency
            const effTable = google.visualization.arrayToDataTable(efficiencyData);
            const effOptions = {
                legend: 'none',
                hAxis: {title: 'Rank Orgánico (Menor es Mejor)', direction: -1}, // Invert axis
                vAxis: {title: 'Click Share (%)'},
                colors: ['#4285F4'],
                pointSize: 10,
                chartArea: {width: '85%', height: '75%'}
            };
            new google.visualization.ScatterChart(document.getElementById('efficiency_chart')).draw(effTable, effOptions);

            // Initial Draw of Interactive
            updateInteractiveCharts();
        }

        // 4. INTERACTIVE TAB LOGIC
        function populateSelectors(competitors) {
            const weekSel = document.getElementById('weekSelector');
            const weeks = [...new Set(marketData.map(d => d.week_date))].sort().reverse();
            weeks.forEach(w => {
                const opt = document.createElement('option');
                opt.value = w;
                opt.innerText = w;
                weekSel.appendChild(opt);
            });

            const compSel = document.getElementById('competitorSelector');
            competitors.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.innerText = c;
                compSel.appendChild(opt);
            });
            // Add All
            const optAll = document.createElement('option');
            optAll.value = "All";
            optAll.innerText = "Ver Todos";
            compSel.appendChild(optAll);
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            if (tab === 'static') {
                document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
                document.getElementById('static-tab').classList.add('active');
            } else {
                document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
                document.getElementById('interactive-tab').classList.add('active');
                // Redraw to ensure width is correct
                updateInteractiveCharts();
            }
        }

        function updateInteractiveCharts() {
            const week = document.getElementById('weekSelector').value;
            const competitor = document.getElementById('competitorSelector').value;
            
            // Filter Data
            let filtered = marketData;
            if (week !== 'all') {
                filtered = filtered.filter(d => d.week_date === week);
            }
            // Identify Our Brand
            const ourBrandEntry = marketData.find(d => d.is_yaba_asin === 'Y');
            const ourBrand = ourBrandEntry ? ourBrandEntry.brand_real : "Nuestra Marca";

            // If a specific competitor is selected, we filter to [Us, Competitor]. If All, we keep Top 5.
            let displayBrands = [ourBrand];
            if (competitor !== 'All') displayBrands.push(competitor);
            
            const chartData = filtered.filter(d => competitor === 'All' || displayBrands.includes(d.brand_real));
            
            // Aggregation for Bar Chart (Share)
            const aggMap = {};
            chartData.forEach(d => {
                const b = d.brand_real;
                if (!aggMap[b]) aggMap[b] = {share: 0, price_sum: 0, count: 0};
                aggMap[b].share += d.click_share;
                aggMap[b].price_sum += d.price;
                aggMap[b].count++;
            });

            const shareArr = [['Marca', 'Total Share', {role: 'style'}]];
            const priceArr = [['Marca', 'Precio Promedio', {role: 'style'}]];
            
            Object.keys(aggMap).forEach(b => {
                const color = b === ourBrand ? '#4285F4' : '#EA4335';
                shareArr.push([b, aggMap[b].share, color]);
                priceArr.push([b, aggMap[b].price_sum/aggMap[b].count, color]);
            });

            // Draw Charts
            const shareTable = google.visualization.arrayToDataTable(shareArr);
            new google.visualization.BarChart(document.getElementById('int_share_chart')).draw(shareTable, {legend: 'none'});
            
            const priceTable = google.visualization.arrayToDataTable(priceArr);
            new google.visualization.ColumnChart(document.getElementById('int_price_chart')).draw(priceTable, {legend: 'none'});

            // Draw Detailed Table
            const tableData = [['Semana', 'ASIN', 'Marca', 'Título', 'Precio', 'Deal Days', 'Rank', 'Share']];
            chartData.forEach(d => {
                tableData.push([
                    d.week_date,
                    d.asin,
                    d.brand_real,
                    d.product_title.substring(0, 30) + '...',
                    d.price,
                    d.weekly_number_of_days_with_deal,
                    d.average_organic_rank,
                    parseFloat(d.click_share.toFixed(2))
                ]);
            });
            
            const dataView = google.visualization.arrayToDataTable(tableData);
            const table = new google.visualization.Table(document.getElementById('int_table_div'));
            table.draw(dataView, {showRowNumber: false, width: '100%', height: '100%'});
        }

    </script>
</body>
</html>