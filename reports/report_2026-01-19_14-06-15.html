<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anal√≠tica Avanzada: Parent ASIN Report</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .card { background: white; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .tab-active { border-bottom: 2px solid #2563eb; color: #2563eb; font-weight: 600; }
        .tab-inactive { color: #6b7280; }
        .tab-inactive:hover { color: #374151; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        const { LineChart, Line, AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, BarChart, Bar, ComposedChart, Scatter } = Recharts;

        // --- DATA INJECTION ---
        // Procesado desde el CSV input
        const marketData = [
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-27",
    "week_date": "2025-52",
    "keywords": "matcha",
    "competitor_brand": "Heapwell Superfoods",
    "asin": "B06XTYYYJ8",
    "product_title": "Heapwell Matcha Powder - 50g | High Grade Japanese...",
    "country_code": "uk",
    "average_organic_rank": 6,
    "weekly_number_of_days_with_deal": 6,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 6.46,
    "impression_share": 4.7,
    "price": 8.704285714,
    "click_share_rank": 5,
    "weekly_search_volume": 60496.38,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "Heapwell Superfoods",
    "estimated_clicks": 3908.0661480000004
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2026-01-03",
    "week_date": "2026-01",
    "keywords": "matcha",
    "competitor_brand": "Heapwell Superfoods",
    "asin": "B06XTYYYJ8",
    "product_title": "Heapwell Matcha Powder - 50g | High Grade Japanese...",
    "country_code": "uk",
    "average_organic_rank": 6,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 5.74,
    "impression_share": 5.52,
    "price": 9.99,
    "click_share_rank": 4,
    "weekly_search_volume": 40727.59,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "Heapwell Superfoods",
    "estimated_clicks": 2337.763666
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-20",
    "week_date": "2025-51",
    "keywords": "matcha",
    "competitor_brand": "Heapwell Superfoods",
    "asin": "B06XTYYYJ8",
    "product_title": "Heapwell Matcha Powder - 50g | High Grade Japanese...",
    "country_code": "uk",
    "average_organic_rank": 6,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 5.84,
    "impression_share": 4.64,
    "price": 9.99,
    "click_share_rank": 5,
    "weekly_search_volume": 93607.2,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "Heapwell Superfoods",
    "estimated_clicks": 5466.660480000001
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2026-01-03",
    "week_date": "2026-01",
    "keywords": "matcha",
    "competitor_brand": "SuperSelf",
    "asin": "B082DKRSB4",
    "product_title": "SuperSelf Organic Matcha Powder - Ceremonial Grade...",
    "country_code": "uk",
    "average_organic_rank": 8,
    "weekly_number_of_days_with_deal": 4,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 4,
    "click_share": 3.96,
    "impression_share": 4.48,
    "price": 14.86,
    "click_share_rank": 6,
    "weekly_search_volume": 40727.59,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "SuperSelf",
    "estimated_clicks": 1612.812564
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-27",
    "week_date": "2025-52",
    "keywords": "matcha",
    "competitor_brand": "SuperSelf",
    "asin": "B082DKRSB4",
    "product_title": "SuperSelf Organic Matcha Powder - Ceremonial Grade...",
    "country_code": "uk",
    "average_organic_rank": 8,
    "weekly_number_of_days_with_deal": 1,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 7,
    "click_share": 2.95,
    "impression_share": 4.13,
    "price": 19.18,
    "click_share_rank": 9,
    "weekly_search_volume": 60496.38,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "SuperSelf",
    "estimated_clicks": 1784.64321
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-20",
    "week_date": "2025-51",
    "keywords": "matcha",
    "competitor_brand": "SuperSelf",
    "asin": "B082DKRSB4",
    "product_title": "SuperSelf Organic Matcha Powder - Ceremonial Grade...",
    "country_code": "uk",
    "average_organic_rank": 9,
    "weekly_number_of_days_with_deal": 6,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 7,
    "click_share": 3.38,
    "impression_share": 4.01,
    "price": 15.58,
    "click_share_rank": 8,
    "weekly_search_volume": 93607.2,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "SuperSelf",
    "estimated_clicks": 3163.9233599999996
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-20",
    "week_date": "2025-51",
    "keywords": "matcha",
    "competitor_brand": "SuperSelf",
    "asin": "B08YK2RPBZ",
    "product_title": "SuperSelf Organic Matcha Powder - Ceremonial Grade...",
    "country_code": "uk",
    "average_organic_rank": 5,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 7,
    "click_share": 6.51,
    "impression_share": 3.29,
    "price": 9.9,
    "click_share_rank": 4,
    "weekly_search_volume": 93607.2,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "SuperSelf",
    "estimated_clicks": 6093.82872
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-27",
    "week_date": "2025-52",
    "keywords": "matcha",
    "competitor_brand": "SuperSelf",
    "asin": "B08YK2RPBZ",
    "product_title": "SuperSelf Organic Matcha Powder - Ceremonial Grade...",
    "country_code": "uk",
    "average_organic_rank": 5,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 1,
    "click_share": 7.98,
    "impression_share": 3.43,
    "price": 9.9,
    "click_share_rank": 4,
    "weekly_search_volume": 60496.38,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "SuperSelf",
    "estimated_clicks": 4827.611124
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2026-01-03",
    "week_date": "2026-01",
    "keywords": "matcha",
    "competitor_brand": "SuperSelf",
    "asin": "B08YK2RPBZ",
    "product_title": "SuperSelf Organic Matcha Powder - Ceremonial Grade...",
    "country_code": "uk",
    "average_organic_rank": 4,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 9.83,
    "impression_share": 3.56,
    "price": 9.9,
    "click_share_rank": 3,
    "weekly_search_volume": 40727.59,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "SuperSelf",
    "estimated_clicks": 4003.5221019
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-20",
    "week_date": "2025-51",
    "keywords": "matcha",
    "competitor_brand": null,
    "asin": "B08YRXQ2JH",
    "product_title": "Double Dragon | 100% Organic | Premium Matcha Gree...",
    "country_code": "uk",
    "average_organic_rank": 13,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 3.21,
    "impression_share": 3.53,
    "price": 6.98,
    "click_share_rank": 9,
    "weekly_search_volume": 93607.2,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "Double Dragon",
    "estimated_clicks": 3004.79112
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2026-01-03",
    "week_date": "2026-01",
    "keywords": "matcha",
    "competitor_brand": null,
    "asin": "B08YRXQ2JH",
    "product_title": "Double Dragon | 100% Organic | Premium Matcha Gree...",
    "country_code": "uk",
    "average_organic_rank": 13,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 3.32,
    "impression_share": 3.16,
    "price": 6.98,
    "click_share_rank": 8,
    "weekly_search_volume": 40727.59,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "Double Dragon",
    "estimated_clicks": 1352.1559879999998
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-27",
    "week_date": "2025-52",
    "keywords": "matcha",
    "competitor_brand": null,
    "asin": "B08YRXQ2JH",
    "product_title": "Double Dragon | 100% Organic | Premium Matcha Gree...",
    "country_code": "uk",
    "average_organic_rank": 13,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 3.4,
    "impression_share": 3.43,
    "price": 6.98,
    "click_share_rank": 8,
    "weekly_search_volume": 60496.38,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "Double Dragon",
    "estimated_clicks": 2056.8769199999997
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-27",
    "week_date": "2025-52",
    "keywords": "matcha",
    "competitor_brand": "Perfect Ted",
    "asin": "B09DQ1PWGX",
    "product_title": "\"PerfectTed Organic Matcha Powder, Ceremonial Grade...\"",
    "country_code": "uk",
    "average_organic_rank": 8,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 9.27,
    "impression_share": 6.06,
    "price": 9.49,
    "click_share_rank": 2,
    "weekly_search_volume": 60496.38,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "Perfect Ted",
    "estimated_clicks": 5608.014426
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-20",
    "week_date": "2025-51",
    "keywords": "matcha",
    "competitor_brand": "Perfect Ted",
    "asin": "B09DQ1PWGX",
    "product_title": "\"PerfectTed Organic Matcha Powder, Ceremonial Grade...\"",
    "country_code": "uk",
    "average_organic_rank": 8,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 9.95,
    "impression_share": 5.76,
    "price": 9.49,
    "click_share_rank": 2,
    "weekly_search_volume": 93607.2,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "Perfect Ted",
    "estimated_clicks": 9313.9164
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2026-01-03",
    "week_date": "2026-01",
    "keywords": "matcha",
    "competitor_brand": "Perfect Ted",
    "asin": "B09DQ1PWGX",
    "product_title": "\"PerfectTed Organic Matcha Powder, Ceremonial Grade...\"",
    "country_code": "uk",
    "average_organic_rank": 34,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 4.64,
    "impression_share": 3.45,
    "price": 2.1225,
    "click_share_rank": 5,
    "weekly_search_volume": 40727.59,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "Perfect Ted",
    "estimated_clicks": 1889.760176
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2026-01-03",
    "week_date": "2026-01",
    "keywords": "matcha",
    "competitor_brand": null,
    "asin": "B0C71LZNV6",
    "product_title": "\"Matcha Fuel SuperLatte - Mushroom, Superfood & Ada...\"",
    "country_code": "uk",
    "average_organic_rank": 12,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 2.56,
    "impression_share": 4.22,
    "price": 24.95,
    "click_share_rank": 10,
    "weekly_search_volume": 40727.59,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "Matcha Fuel",
    "estimated_clicks": 1042.626304
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-20",
    "week_date": "2025-51",
    "keywords": "matcha",
    "competitor_brand": "Perfect Ted",
    "asin": "B0D9M91WZD",
    "product_title": "\"PerfectTed Vanilla Bean Matcha Powder, Ceremonial ...\"",
    "country_code": "uk",
    "average_organic_rank": 9,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 4.17,
    "impression_share": 5.33,
    "price": 9.49,
    "click_share_rank": 7,
    "weekly_search_volume": 93607.2,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "Perfect Ted",
    "estimated_clicks": 3903.42024
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-27",
    "week_date": "2025-52",
    "keywords": "matcha",
    "competitor_brand": "Perfect Ted",
    "asin": "B0D9M91WZD",
    "product_title": "\"PerfectTed Vanilla Bean Matcha Powder, Ceremonial ...\"",
    "country_code": "uk",
    "average_organic_rank": 10,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 3.45,
    "impression_share": 4.83,
    "price": 9.49,
    "click_share_rank": 7,
    "weekly_search_volume": 60496.38,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "Perfect Ted",
    "estimated_clicks": 2087.1251099999998
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2026-01-03",
    "week_date": "2026-01",
    "keywords": "matcha",
    "competitor_brand": "Perfect Ted",
    "asin": "B0D9M91WZD",
    "product_title": "\"PerfectTed Vanilla Bean Matcha Powder, Ceremonial ...\"",
    "country_code": "uk",
    "average_organic_rank": 9,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 2.79,
    "impression_share": 3.5,
    "price": 11,
    "click_share_rank": 9,
    "weekly_search_volume": 40727.59,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "Perfect Ted",
    "estimated_clicks": 1136.299761
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-27",
    "week_date": "2025-52",
    "keywords": "matcha",
    "competitor_brand": "Perfect Ted",
    "asin": "B0F21VZMJQ",
    "product_title": "\"PerfectTed Original Matcha Powder, Ceremonial Grad...\"",
    "country_code": "uk",
    "average_organic_rank": 3,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 8.65,
    "impression_share": 3.53,
    "price": 16.99,
    "click_share_rank": 3,
    "weekly_search_volume": 60496.38,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "Perfect Ted",
    "estimated_clicks": 5232.93687
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2026-01-03",
    "week_date": "2026-01",
    "keywords": "matcha",
    "competitor_brand": "Perfect Ted",
    "asin": "B0F21VZMJQ",
    "product_title": "\"PerfectTed Original Matcha Powder, Ceremonial Grad...\"",
    "country_code": "uk",
    "average_organic_rank": 3,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 1,
    "click_share": 10.49,
    "impression_share": 3.3,
    "price": 16.99,
    "click_share_rank": 2,
    "weekly_search_volume": 40727.59,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "Perfect Ted",
    "estimated_clicks": 4272.324191
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-20",
    "week_date": "2025-51",
    "keywords": "matcha",
    "competitor_brand": "Perfect Ted",
    "asin": "B0F21VZMJQ",
    "product_title": "\"PerfectTed Original Matcha Powder, Ceremonial Grad...\"",
    "country_code": "uk",
    "average_organic_rank": 3,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 8.12,
    "impression_share": 3.78,
    "price": 16.99,
    "click_share_rank": 3,
    "weekly_search_volume": 93607.2,
    "is_yaba_asin": "N",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "Perfect Ted",
    "estimated_clicks": 7600.90464
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-27",
    "week_date": "2025-52",
    "keywords": "matcha",
    "competitor_brand": "PureChimp",
    "asin": "B00HNDSOCI",
    "product_title": "PureChimp Ceremonial Grade Matcha Powder 50g. 100%...",
    "country_code": "uk",
    "average_organic_rank": 12,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 7,
    "click_share": 2.34,
    "impression_share": 3.39,
    "price": 14.95,
    "click_share_rank": 10,
    "weekly_search_volume": 60496.38,
    "is_yaba_asin": "Y",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "PureChimp",
    "estimated_clicks": 1415.615292
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-20",
    "week_date": "2025-51",
    "keywords": "matcha",
    "competitor_brand": "PureChimp",
    "asin": "B00HNDSOCI",
    "product_title": "PureChimp Ceremonial Grade Matcha Powder 50g. 100%...",
    "country_code": "uk",
    "average_organic_rank": 11,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 7,
    "click_share": 2.39,
    "impression_share": 3.57,
    "price": 14.95,
    "click_share_rank": 10,
    "weekly_search_volume": 93607.2,
    "is_yaba_asin": "Y",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "PureChimp",
    "estimated_clicks": 2237.2120799999996
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-20",
    "week_date": "2025-51",
    "keywords": "matcha",
    "competitor_brand": "NaturaleBio",
    "asin": "B06XQ5DCYJ",
    "product_title": "NaturaleBio Japanese Organic Matcha Green Tea Powd...",
    "country_code": "uk",
    "average_organic_rank": 1,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 7,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 13.52,
    "impression_share": 3.15,
    "price": 12.275714286,
    "click_share_rank": 1,
    "weekly_search_volume": 93607.2,
    "is_yaba_asin": "Y",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "NaturaleBio",
    "estimated_clicks": 12655.693440000001
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2026-01-03",
    "week_date": "2026-01",
    "keywords": "matcha",
    "competitor_brand": "NaturaleBio",
    "asin": "B06XQ5DCYJ",
    "product_title": "NaturaleBio Japanese Organic Matcha Green Tea Powd...",
    "country_code": "uk",
    "average_organic_rank": 1,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 4,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 13.79,
    "impression_share": 3.33,
    "price": 12.49,
    "click_share_rank": 1,
    "weekly_search_volume": 40727.59,
    "is_yaba_asin": "Y",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "NaturaleBio",
    "estimated_clicks": 5616.334661
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-27",
    "week_date": "2025-52",
    "keywords": "matcha",
    "competitor_brand": "NaturaleBio",
    "asin": "B06XQ5DCYJ",
    "product_title": "NaturaleBio Japanese Organic Matcha Green Tea Powd...",
    "country_code": "uk",
    "average_organic_rank": 2,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 7,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 13.11,
    "impression_share": 3.29,
    "price": 12.49,
    "click_share_rank": 1,
    "weekly_search_volume": 60496.38,
    "is_yaba_asin": "Y",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "NaturaleBio",
    "estimated_clicks": 7931.075418
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-27",
    "week_date": "2025-52",
    "keywords": "matcha",
    "competitor_brand": "NaturaleBio",
    "asin": "B079VQ52MK",
    "product_title": "NaturaleBio Japanese Organic Matcha Green Tea Powd...",
    "country_code": "uk",
    "average_organic_rank": 5,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 4.59,
    "impression_share": 3.26,
    "price": 20.99,
    "click_share_rank": 6,
    "weekly_search_volume": 60496.38,
    "is_yaba_asin": "Y",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "NaturaleBio",
    "estimated_clicks": 2776.783842
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2025-12-20",
    "week_date": "2025-51",
    "keywords": "matcha",
    "competitor_brand": "NaturaleBio",
    "asin": "B079VQ52MK",
    "product_title": "NaturaleBio Japanese Organic Matcha Green Tea Powd...",
    "country_code": "uk",
    "average_organic_rank": 3,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 5.32,
    "impression_share": 3.13,
    "price": 20.132857143,
    "click_share_rank": 6,
    "weekly_search_volume": 93607.2,
    "is_yaba_asin": "Y",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "NaturaleBio",
    "estimated_clicks": 4979.90304
  },
  {
    "brand_aggregation": "naturalebio",
    "parent_asin": "Matcha Premium",
    "reporting_date": "2026-01-03",
    "week_date": "2026-01",
    "keywords": "matcha",
    "competitor_brand": "NaturaleBio",
    "asin": "B079VQ52MK",
    "product_title": "NaturaleBio Japanese Organic Matcha Green Tea Powd...",
    "country_code": "uk",
    "average_organic_rank": 7,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_best_seller_badge": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "weekly_number_of_days_with_coupon": 0,
    "click_share": 3.39,
    "impression_share": 3.28,
    "price": 20.99,
    "click_share_rank": 7,
    "weekly_search_volume": 40727.59,
    "is_yaba_asin": "Y",
    "keywords_link": "https://www.amazon.co.uk/s?k=matcha",
    "real_brand": "NaturaleBio",
    "estimated_clicks": 1380.665301
  }
];

        // --- COMPONENTS ---

        const Dashboard = () => {
            const [activeTab, setActiveTab] = useState(0);
            
            // --- DATA PROCESSING LOGIC ---
            
            // 1. Identify Our Brands & Competitors
            const ourBrands = useMemo(() => [...new Set(marketData.filter(d => d.is_yaba_asin === 'Y').map(d => d.real_brand))], []);
            const allBrands = useMemo(() => [...new Set(marketData.map(d => d.real_brand))], []);
            
            // 2. Aggregate Data per Week
            const weeklyData = useMemo(() => {
                const weeks = [...new Set(marketData.map(d => d.week_date))].sort();
                return weeks.map(week => {
                    const weekItems = marketData.filter(d => d.week_date === week);
                    const totalClicks = weekItems.reduce((acc, curr) => acc + curr.estimated_clicks, 0);
                    
                    const usItems = weekItems.filter(d => d.is_yaba_asin === 'Y');
                    const usClicks = usItems.reduce((acc, curr) => acc + curr.estimated_clicks, 0);
                    
                    const compItems = weekItems.filter(d => d.is_yaba_asin === 'N');
                    const compClicks = compItems.reduce((acc, curr) => acc + curr.estimated_clicks, 0);

                    return {
                        name: week,
                        totalClicks,
                        usClicks,
                        compClicks,
                        usShare: (usClicks / totalClicks) * 100,
                        compShare: (compClicks / totalClicks) * 100
                    };
                });
            }, []);

            // 3. Competitiveness Data (Top 3)
            const brandShareData = useMemo(() => {
                // Calculate average share per brand to find Top 3
                const brandTotals = {};
                allBrands.forEach(b => brandTotals[b] = 0);
                
                marketData.forEach(d => {
                    brandTotals[d.real_brand] += d.estimated_clicks;
                });
                
                // Exclude Us from Top 3 Calc
                const compBrands = allBrands.filter(b => !ourBrands.includes(b));
                const top3 = compBrands.sort((a,b) => brandTotals[b] - brandTotals[a]).slice(0,3);
                
                // Build Week-by-Week Share
                const weeks = [...new Set(marketData.map(d => d.week_date))].sort();
                return weeks.map(week => {
                    const weekItems = marketData.filter(d => d.week_date === week);
                    const weekTotalClicks = weekItems.reduce((acc,curr) => acc + curr.estimated_clicks, 0);
                    
                    const entry = { name: week };
                    
                    // Our Share (Aggregated)
                    const usClicks = weekItems.filter(d => ourBrands.includes(d.real_brand)).reduce((acc,c) => acc+c.estimated_clicks, 0);
                    entry['Our Brand'] = (usClicks / weekTotalClicks) * 100;

                    // Top 3
                    top3.forEach(brand => {
                        const bClicks = weekItems.filter(d => d.real_brand === brand).reduce((acc,c) => acc+c.estimated_clicks, 0);
                        entry[brand] = (bClicks / weekTotalClicks) * 100;
                    });
                    
                    // Rest
                    const trackedClicks = usClicks + top3.reduce((acc, b) => {
                        return acc + weekItems.filter(d => d.real_brand === b).reduce((s,c) => s+c.estimated_clicks,0);
                    },0);
                    entry['Others'] = ((weekTotalClicks - trackedClicks) / weekTotalClicks) * 100;
                    
                    return entry;
                });
            }, [ourBrands, allBrands]);

            const top3Names = Object.keys(brandShareData[0]).filter(k => k !== 'name' && k !== 'Our Brand' && k !== 'Others');

            // --- RENDER ---

            return (
                <div className="max-w-7xl mx-auto p-6 space-y-8">
                    {/* HEADER */}
                    <div className="flex justify-between items-center">
                        <div>
                            <h1 className="text-3xl font-bold text-gray-900">Parent ASIN Intelligence Report</h1>
                            <p className="text-gray-500 mt-1">An√°lisis profundo: {marketData[0].brand_aggregation} - {marketData[0].parent_asin}</p>
                        </div>
                        <div className="flex space-x-1 bg-white p-1 rounded-lg border border-gray-200">
                            <button onClick={() => setActiveTab(0)} className={`px-4 py-2 rounded-md transition-colors ${activeTab === 0 ? 'bg-blue-50 text-blue-600 font-medium' : 'text-gray-500 hover:text-gray-700'}`}>Reporte Est√°tico</button>
                            <button onClick={() => setActiveTab(1)} className={`px-4 py-2 rounded-md transition-colors ${activeTab === 1 ? 'bg-blue-50 text-blue-600 font-medium' : 'text-gray-500 hover:text-gray-700'}`}>Comparador Interactivo</button>
                        </div>
                    </div>

                    {activeTab === 0 ? (
                        <StaticReport 
                            weeklyData={weeklyData} 
                            brandShareData={brandShareData} 
                            top3Names={top3Names}
                            ourBrands={ourBrands}
                        />
                    ) : (
                        <InteractiveComparator 
                            data={marketData} 
                            ourBrands={ourBrands}
                            allBrands={allBrands}
                        />
                    )}
                </div>
            );
        };

        const StaticReport = ({ weeklyData, brandShareData, top3Names, ourBrands }) => {
            const latestWeek = weeklyData[weeklyData.length - 1];
            const prevWeek = weeklyData[weeklyData.length - 2] || weeklyData[0];
            const trend = latestWeek.usShare > prevWeek.usShare ? 'up' : 'down';
            
            return (
                <div className="space-y-8 animate-fade-in">
                    
                    {/* KPI CARDS */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <KPICard title="Total Market Clicks (Last Week)" value={Math.round(latestWeek.totalClicks).toLocaleString()} sub={`vs ${Math.round(prevWeek.totalClicks).toLocaleString()} prev.`} trend={latestWeek.totalClicks > prevWeek.totalClicks ? 'up' : 'down'} />
                        <KPICard title="Our Click Share" value={`${latestWeek.usShare.toFixed(2)}%`} sub={`vs ${prevWeek.usShare.toFixed(2)}% prev.`} trend={trend} />
                        <KPICard title="Top Competitor Share" value={`${brandShareData[brandShareData.length-1][top3Names[0]].toFixed(2)}%`} sub={top3Names[0]} trend="neutral" />
                    </div>

                    {/* 1. TENDENCIA GLOBAL */}
                    <section className="card p-6">
                        <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center"><i data-lucide="activity" className="mr-2 text-blue-600"></i> 1. Tendencia Global del Parent</h2>
                        <div className="h-80 w-full">
                            <ResponsiveContainer width="100%" height="100%">
                                <AreaChart data={weeklyData}>
                                    <defs>
                                        <linearGradient id="colorUs" x1="0" y1="0" x2="0" y2="1">
                                            <stop offset="5%" stopColor="#2563eb" stopOpacity={0.8}/>
                                            <stop offset="95%" stopColor="#2563eb" stopOpacity={0}/>
                                        </linearGradient>
                                        <linearGradient id="colorComp" x1="0" y1="0" x2="0" y2="1">
                                            <stop offset="5%" stopColor="#9ca3af" stopOpacity={0.8}/>
                                            <stop offset="95%" stopColor="#9ca3af" stopOpacity={0}/>
                                        </linearGradient>
                                    </defs>
                                    <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                    <XAxis dataKey="name" />
                                    <YAxis />
                                    <Tooltip contentStyle={{borderRadius:'8px'}} />
                                    <Legend />
                                    <Area type="monotone" dataKey="usClicks" name="Nuestros Clicks" stroke="#2563eb" fillOpacity={1} fill="url(#colorUs)" />
                                    <Area type="monotone" dataKey="compClicks" name="Competencia" stroke="#9ca3af" fillOpacity={1} fill="url(#colorComp)" />
                                </AreaChart>
                            </ResponsiveContainer>
                        </div>
                        <div className="mt-4 bg-blue-50 p-4 rounded-lg text-sm text-blue-900">
                            <strong>Insight:</strong> El mercado ha sufrido una contracci√≥n severa en volumen en la √∫ltima semana (Semana 01), cayendo de ~37k a ~24k clicks. Aunque nuestros ASINs mantienen una posici√≥n relevante, han acompa√±ado la ca√≠da general, perdiendo ligeramente share (-3.8pp) frente a la agresividad de competidores como Perfect Ted.
                        </div>
                    </section>

                    {/* 2. COMPETITIVIDAD */}
                    <section className="card p-6">
                        <h2 className="text-xl font-bold text-gray-800 mb-4 flex items-center"><i data-lucide="users" className="mr-2 text-blue-600"></i> 2. Competitividad de Marca</h2>
                        <div className="h-80 w-full">
                            <ResponsiveContainer width="100%" height="100%">
                                <LineChart data={brandShareData}>
                                    <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                    <XAxis dataKey="name" />
                                    <YAxis unit="%" />
                                    <Tooltip contentStyle={{borderRadius:'8px'}} />
                                    <Legend />
                                    <Line type="monotone" dataKey="Our Brand" name="Nuestra Marca (NaturaleBio/PureChimp)" stroke="#2563eb" strokeWidth={3} dot={{r:4}} />
                                    {top3Names.map((name, i) => (
                                        <Line key={name} type="monotone" dataKey={name} stroke={['#ef4444', '#f59e0b', '#10b981'][i]} strokeWidth={2} />
                                    ))}
                                    <Line type="monotone" dataKey="Others" stroke="#9ca3af" strokeDasharray="5 5" />
                                </LineChart>
                            </ResponsiveContainer>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 text-sm">
                            <div className="bg-gray-50 p-3 rounded">
                                <span className="font-bold text-gray-700">Dominio:</span> "Perfect Ted" muestra una tendencia alcista notable, alcanzando picos de share cercanos al 18% (combinando variantes).
                            </div>
                            <div className="bg-gray-50 p-3 rounded">
                                <span className="font-bold text-gray-700">Riesgo:</span> Nuestra marca ha cedido terreno en la √∫ltima semana tras un pico en la semana 51. La ca√≠da de PureChimp (falta de stock o visibilidad) impacta el total.
                            </div>
                        </div>
                    </section>

                    {/* 3. PALANCAS & DRIVERS */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <section className="card p-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-4">üöÄ Palancas de Crecimiento</h2>
                            <ul className="space-y-3 text-sm">
                                <li className="flex items-start">
                                    <span className="bg-green-100 text-green-800 p-1 rounded mr-2">Precio</span>
                                    <span>NaturaleBio (¬£12.49) mantiene un precio competitivo vs SuperSelf (¬£14.86) pero m√°s alto que Heapwell. Perfect Ted usa precios bajos (¬£2.12 variante peque√±a) para captar tr√°fico.</span>
                                </li>
                                <li className="flex items-start">
                                    <span className="bg-yellow-100 text-yellow-800 p-1 rounded mr-2">Cupones</span>
                                    <span>SuperSelf activ√≥ cupones agresivos (4-7 d√≠as/sem) coincidiendo con su estabilidad en share. NaturaleBio tuvo cupones (4 d√≠as) en la sem 01, vital para mantener el share del ASIN principal.</span>
                                </li>
                                <li className="flex items-start">
                                    <span className="bg-purple-100 text-purple-800 p-1 rounded mr-2">Badges</span>
                                    <span>NaturaleBio retiene "Amazon Choice" en 4 d√≠as de la √∫ltima semana, un driver clave de eficiencia org√°nica.</span>
                                </li>
                            </ul>
                        </section>

                        <section className="card p-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-4">üëÅÔ∏è Eficiencia (Rank vs Share)</h2>
                            <div className="space-y-4">
                                <div>
                                    <h4 className="font-semibold text-blue-700">Sobreperformers (Eficientes)</h4>
                                    <p className="text-sm text-gray-600"><strong>NaturaleBio (B06XQ5DCYJ):</strong> Rank Org√°nico 1-2 constante. Convierte esa posici√≥n en un share s√≥lido de ~13-14%. Muy alta eficiencia.</p>
                                </div>
                                <div>
                                    <h4 className="font-semibold text-red-700">Underperformers</h4>
                                    <p className="text-sm text-gray-600"><strong>Heapwell:</strong> A pesar de precios bajos (¬£8-9), su share cae. Rank 6 org√°nico no traduce en volumen suficiente.</p>
                                </div>
                            </div>
                        </section>
                    </div>

                    {/* 4. CONCLUSIONES & RECOMENDACIONES */}
                    <section className="card p-6 border-l-4 border-blue-600 bg-gradient-to-r from-white to-blue-50">
                        <h2 className="text-2xl font-bold text-gray-800 mb-6">üí° Conclusiones y Recomendaciones</h2>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <h3 className="text-lg font-semibold mb-3 text-gray-700">Insights Clave</h3>
                                <ul className="list-disc ml-5 space-y-2 text-sm text-gray-700">
                                    <li><strong>Contracci√≥n de Mercado:</strong> Ca√≠da del 35% en b√∫squedas en la semana 01 post-navidad.</li>
                                    <li><strong>Competencia Agresiva:</strong> Perfect Ted est√° ganando cuota con estrategia mixta (precio entrada bajo + branding).</li>
                                    <li><strong>Resiliencia del Hero ASIN:</strong> Nuestro ASIN principal (B06XQ5DCYJ) creci√≥ en share relativo (13.1% -> 13.8%) a pesar de la ca√≠da del mercado, gracias al badge AC y cupones.</li>
                                    <li><strong>Debilidad en Portfolio:</strong> La ca√≠da global de nuestra marca se debe a los ASINs secundarios (PureChimp, NaturaleBio secundario) que perdieron tracci√≥n.</li>
                                    <li><strong>Pricing Power:</strong> Mantenemos precio premium medio (¬£12.5) vs competidores low-cost sin perder el top rank org√°nico.</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h3 className="text-lg font-semibold mb-3 text-blue-700">Plan de Acci√≥n</h3>
                                <div className="space-y-3">
                                    <div className="flex items-start">
                                        <div className="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center mr-3 flex-shrink-0">1</div>
                                        <p className="text-sm"><strong>Defensa de Share:</strong> Extender la estrategia de Cupones del Hero ASIN a los secundarios (B079VQ52MK) para recuperar el terreno perdido en la semana 01.</p>
                                    </div>
                                    <div className="flex items-start">
                                        <div className="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center mr-3 flex-shrink-0">2</div>
                                        <p className="text-sm"><strong>Ataque a Perfect Ted:</strong> Analizar su variante de ¬£2.12. Si es un sampler, valorar lanzar un tama√±o peque√±o de entrada para capturar tr√°fico de "prueba".</p>
                                    </div>
                                    <div className="flex items-start">
                                        <div className="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center mr-3 flex-shrink-0">3</div>
                                        <p className="text-sm"><strong>Revisi√≥n PureChimp:</strong> Investigar urgentemente la ca√≠da de visibilidad de PureChimp en semana 01. ¬øStock out? ¬øP√©rdida de indexaci√≥n? Reactivar PPC si es necesario.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            );
        };

        const InteractiveComparator = ({ data, ourBrands, allBrands }) => {
            const weeks = [...new Set(data.map(d => d.week_date))].sort();
            const [selectedWeek, setSelectedWeek] = useState(weeks[weeks.length - 1]);
            const [competitor, setCompetitor] = useState(allBrands.find(b => !ourBrands.includes(b)));

            // Filter Data
            const weekData = data.filter(d => d.week_date === selectedWeek);
            
            const ourData = weekData.filter(d => ourBrands.includes(d.real_brand));
            const compData = weekData.filter(d => d.real_brand === competitor);

            // Calculate Metrics
            const getMetrics = (dataset) => ({
                avgPrice: dataset.reduce((a,b) => a+b.price, 0) / (dataset.length || 1),
                totalShare: dataset.reduce((a,b) => a+b.click_share, 0),
                bestRank: Math.min(...dataset.map(d => d.average_organic_rank), 100),
                dealDays: Math.max(...dataset.map(d => d.weekly_number_of_days_with_deal), 0)
            });

            const usMetrics = getMetrics(ourData);
            const compMetrics = getMetrics(compData);

            // Prepare Scatter Data (Rank vs Price)
            const scatterData = [
                ...ourData.map(d => ({ x: d.average_organic_rank, y: d.price, z: d.click_share, name: 'Nosotros', fill: '#2563eb' })),
                ...compData.map(d => ({ x: d.average_organic_rank, y: d.price, z: d.click_share, name: competitor, fill: '#ef4444' }))
            ];

            return (
                <div className="space-y-6 animate-fade-in">
                    {/* CONTROLS */}
                    <div className="card p-4 flex flex-wrap gap-4 items-center bg-white">
                        <div>
                            <label className="block text-xs font-bold text-gray-500 uppercase">Semana</label>
                            <select value={selectedWeek} onChange={e => setSelectedWeek(e.target.value)} className="mt-1 block w-40 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border">
                                {weeks.map(w => <option key={w} value={w}>{w}</option>)}
                            </select>
                        </div>
                        <div>
                            <label className="block text-xs font-bold text-gray-500 uppercase">Competidor a Comparar</label>
                            <select value={competitor} onChange={e => setCompetitor(e.target.value)} className="mt-1 block w-40 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2 border">
                                {allBrands.filter(b => !ourBrands.includes(b)).map(b => <option key={b} value={b}>{b}</option>)}
                            </select>
                        </div>
                    </div>

                    {/* HEAD TO HEAD */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {/* OUR CARD */}
                        <div className="card p-6 border-t-4 border-blue-500">
                            <h3 className="text-lg font-bold text-gray-700 mb-4">Nuestra Marca</h3>
                            <div className="grid grid-cols-2 gap-4">
                                <MetricBox label="Cuota de Clics" value={`${usMetrics.totalShare.toFixed(2)}%`} />
                                <MetricBox label="Precio Promedio" value={`¬£${usMetrics.avgPrice.toFixed(2)}`} />
                                <MetricBox label="Mejor Rank Org." value={`#${usMetrics.bestRank}`} />
                                <MetricBox label="D√≠as con Deal" value={usMetrics.dealDays} />
                            </div>
                        </div>

                        {/* COMP CARD */}
                        <div className="card p-6 border-t-4 border-red-500">
                            <h3 className="text-lg font-bold text-gray-700 mb-4">{competitor}</h3>
                            <div className="grid grid-cols-2 gap-4">
                                <MetricBox label="Cuota de Clics" value={`${compMetrics.totalShare.toFixed(2)}%`} />
                                <MetricBox label="Precio Promedio" value={`¬£${compMetrics.avgPrice.toFixed(2)}`} />
                                <MetricBox label="Mejor Rank Org." value={`#${compMetrics.bestRank === 100 ? '-' : compMetrics.bestRank}`} />
                                <MetricBox label="D√≠as con Deal" value={compMetrics.dealDays} />
                            </div>
                        </div>
                    </div>

                    {/* SCATTER CHART */}
                    <div className="card p-6">
                        <h3 className="text-lg font-bold text-gray-700 mb-4">Mapa de Posicionamiento (Precio vs Rank)</h3>
                        <p className="text-sm text-gray-500 mb-4">Eje X: Rank Org√°nico (M√°s a la izquierda es mejor) | Eje Y: Precio | Tama√±o: Click Share</p>
                        <div className="h-80 w-full">
                            <ResponsiveContainer width="100%" height="100%">
                                <Recharts.ScatterChart margin={{ top: 20, right: 20, bottom: 20, left: 20 }}>
                                    <CartesianGrid />
                                    <XAxis type="number" dataKey="x" name="Rank" reversed={true} label={{ value: 'Rank Org√°nico (Inverso)', position: 'insideBottomRight', offset: -10 }} />
                                    <YAxis type="number" dataKey="y" name="Price" unit="¬£" label={{ value: 'Precio', angle: -90, position: 'insideLeft' }} />
                                    <Tooltip cursor={{ strokeDasharray: '3 3' }} />
                                    <Legend />
                                    <Scatter name="Nosotros" data={scatterData.filter(d => d.name === 'Nosotros')} fill="#2563eb" />
                                    <Scatter name={competitor} data={scatterData.filter(d => d.name !== 'Nosotros')} fill="#ef4444" />
                                </Recharts.ScatterChart>
                            </ResponsiveContainer>
                        </div>
                    </div>
                </div>
            );
        };

        const KPICard = ({ title, value, sub, trend }) => (
            <div className="card p-5">
                <p className="text-sm text-gray-500 font-medium">{title}</p>
                <div className="flex items-end justify-between mt-2">
                    <h3 className="text-2xl font-bold text-gray-900">{value}</h3>
                    {trend !== 'neutral' && (
                        <span className={`flex items-center text-sm font-medium ${trend === 'up' ? 'text-green-600' : 'text-red-600'}`}>
                            {trend === 'up' ? '‚Üë' : '‚Üì'}
                        </span>
                    )}
                </div>
                <p className="text-xs text-gray-400 mt-1">{sub}</p>
            </div>
        );

        const MetricBox = ({ label, value }) => (
            <div className="bg-gray-50 p-3 rounded text-center">
                <p className="text-xs text-gray-500 uppercase">{label}</p>
                <p className="text-lg font-bold text-gray-800">{value}</p>
            </div>
        );

        // --- RENDER APP ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Dashboard />);
    </script>
    
    <script>
        // Lucide Icons initialization
        lucide.createIcons();
    </script>
</body>
</html>