<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parent ASIN Performance Report | NaturaleBio</title>
    
    <!-- External Dependencies (CDN) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .chart-container { width: 100%; height: 300px; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;
        const { 
            LineChart, Line, AreaChart, Area, XAxis, YAxis, CartesianGrid, 
            Tooltip, Legend, ResponsiveContainer, ScatterChart, Scatter, ZAxis, ReferenceLine
        } = Recharts;

        // --- INJECTED DATA ---
        const marketData = {
            "our_brand": "NaturaleBio",
            "top_competitors": ["NKD Living", "NEW LEAF PRODUCTS", "Natural Health 4 Life"],
            "global_trend": [
                {"week": "2025-51", "us_clicks": 2164.9, "comp_clicks": 5530.8, "us_share": 28.1, "comp_share": 71.9},
                {"week": "2025-52", "us_clicks": 340.8, "comp_clicks": 870.7, "us_share": 28.1, "comp_share": 71.9},
                {"week": "2026-01", "us_clicks": 1577.9, "comp_clicks": 3875.8, "us_share": 28.9, "comp_share": 71.1}
            ],
            "competitiveness": [
                {"week": "2025-51", "Our Brand": 28.13, "NKD Living": 17.4, "NEW LEAF PRODUCTS": 15.96, "Natural Health 4 Life": 7.92, "Rest of Market": 30.59},
                {"week": "2025-52", "Our Brand": 28.13, "NKD Living": 15.89, "NEW LEAF PRODUCTS": 16.54, "Natural Health 4 Life": 14.63, "Rest of Market": 24.81},
                {"week": "2026-01", "Our Brand": 28.93, "NKD Living": 14.48, "NEW LEAF PRODUCTS": 12.04, "Natural Health 4 Life": 15.92, "Rest of Market": 28.64}
            ],
            "levers": [
                {"week": "2025-51", "us_price": 8.89, "us_share": 22.1, "us_promo": 0, "comp_price": 9.99, "comp_share": 6.84, "comp_promo": 0, "top_competitor_name": "NKD Living"},
                {"week": "2025-52", "us_price": 8.89, "us_share": 22.7, "us_promo": 0, "comp_price": 9.99, "comp_share": 6.41, "comp_promo": 0, "top_competitor_name": "NKD Living"},
                {"week": "2026-01", "us_price": 8.89, "us_share": 23.34, "us_promo": 0, "comp_price": 9.99, "comp_share": 5.84, "comp_promo": 0, "top_competitor_name": "NKD Living"}
            ],
            "efficiency": [
                {"asin": "B08WM1VP8V", "brand": "NEW LEAF PRODUCTS", "is_us": false, "rank": 3, "click_share": 9.71, "price": 13.29, "deal": false, "coupon": false},
                {"asin": "B07BZ59D68", "brand": "NKD Living", "is_us": false, "rank": 5, "click_share": 5.88, "price": 9.99, "deal": false, "coupon": false},
                {"asin": "B08FQYKS82", "brand": "NKD Living", "is_us": false, "rank": 3, "click_share": 5.8, "price": 9.99, "deal": false, "coupon": false},
                {"asin": "B07PX2TYXN", "brand": "Natural Health 4 Life", "is_us": false, "rank": 7, "click_share": 12.84, "price": 17.62, "deal": false, "coupon": false},
                {"asin": "B07L9WJ4P2", "brand": "NaturaleBio", "is_us": true, "rank": 2, "click_share": 23.34, "price": 8.89, "deal": false, "coupon": false},
                {"asin": "B0CYQ1ZKV6", "brand": "Horbäach", "is_us": false, "rank": 12, "click_share": 1.19, "price": 7.99, "deal": false, "coupon": false},
                {"asin": "B0F3JB86T3", "brand": "The Worldwide Mint", "is_us": false, "rank": 9, "click_share": 7.06, "price": 5.45, "deal": false, "coupon": false},
                {"asin": "B0FW6P4NKY", "brand": "Vinco Fibre", "is_us": false, "rank": 21, "click_share": 1.8, "price": 9.99, "deal": false, "coupon": false},
                {"asin": "B0B1QQNZ2S", "brand": "WeightWorld", "is_us": false, "rank": 5, "click_share": 8.81, "price": 11.96, "deal": false, "coupon": false},
                {"asin": "B005P0WGNE", "brand": "Solgar", "is_us": false, "rank": 13, "click_share": 4.24, "price": 12.29, "deal": true, "coupon": true}
            ],
            "raw_data_dump": [{"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "psyllium husk", "competitor_brand": "NEW LEAF PRODUCTS", "asin": "B08WM1VP8V", "product_title": "Fibre Supplement 4000mg Psyllium Husk with Acidoph...", "country_code": "uk", "average_organic_rank": 3, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 12.54, "impression_share": 5.73, "price": 13.29, "click_share_rank": 2, "weekly_search_volume": 9795.92, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "NEW LEAF PRODUCTS", "estimated_clicks": 1228.4083679999999}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "psyllium husk", "competitor_brand": "NEW LEAF PRODUCTS", "asin": "B08WM1VP8V", "product_title": "Fibre Supplement 4000mg Psyllium Husk with Acidoph...", "country_code": "uk", "average_organic_rank": 3, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 13.35, "impression_share": 5.86, "price": 13.29, "click_share_rank": 2, "weekly_search_volume": 1501.28, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "NEW LEAF PRODUCTS", "estimated_clicks": 200.42088}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "psyllium husk", "competitor_brand": "NEW LEAF PRODUCTS", "asin": "B08WM1VP8V", "product_title": "Fibre Supplement 4000mg Psyllium Husk with Acidoph...", "country_code": "uk", "average_organic_rank": 3, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 9.71, "impression_share": 4.3, "price": 13.29, "click_share_rank": 3, "weekly_search_volume": 6760.5, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "NEW LEAF PRODUCTS", "estimated_clicks": 656.44455}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "psyllium husk", "competitor_brand": "NKD Living", "asin": "B07BZ59D68", "product_title": "NKD Living Psyllium Husk Powder (500g) | Tested fo...", "country_code": "uk", "average_organic_rank": 3, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 9.39, "impression_share": 3.65, "price": 9.99, "click_share_rank": 3, "weekly_search_volume": 9795.92, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "NKD Living", "estimated_clicks": 919.8368880000002}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "psyllium husk", "competitor_brand": "NKD Living", "asin": "B07BZ59D68", "product_title": "NKD Living Psyllium Husk Powder (500g) | Tested fo...", "country_code": "uk", "average_organic_rank": 3, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 9.17, "impression_share": 3.68, "price": 9.99, "click_share_rank": 5, "weekly_search_volume": 1501.28, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "NKD Living", "estimated_clicks": 137.667376}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "psyllium husk", "competitor_brand": "NKD Living", "asin": "B07BZ59D68", "product_title": "NKD Living Psyllium Husk Powder (500g) | Tested fo...", "country_code": "uk", "average_organic_rank": 5, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 5.88, "impression_share": 3.76, "price": 9.99, "click_share_rank": 6, "weekly_search_volume": 6760.5, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "NKD Living", "estimated_clicks": 397.5174}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "psyllium husk", "competitor_brand": "NKD Living", "asin": "B08FQYKS82", "product_title": "NKD Living Whole Psyllium husks (500g)", "country_code": "uk", "average_organic_rank": 4, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 3.65, "impression_share": 3.57, "price": 9.99, "click_share_rank": 7, "weekly_search_volume": 1501.28, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "NKD Living", "estimated_clicks": 54.79671999999999}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "psyllium husk", "competitor_brand": "NKD Living", "asin": "B08FQYKS82", "product_title": "NKD Living Whole Psyllium husks (500g)", "country_code": "uk", "average_organic_rank": 5, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 4.28, "impression_share": 3.53, "price": 9.99, "click_share_rank": 7, "weekly_search_volume": 9795.92, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "NKD Living", "estimated_clicks": 419.26537600000006}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "psyllium husk", "competitor_brand": "NKD Living", "asin": "B08FQYKS82", "product_title": "NKD Living Whole Psyllium husks (500g)", "country_code": "uk", "average_organic_rank": 3, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 5.8, "impression_share": 3.63, "price": 9.99, "click_share_rank": 7, "weekly_search_volume": 6760.5, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "NKD Living", "estimated_clicks": 392.109}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "psyllium husk", "competitor_brand": "Natural Health 4 Life", "asin": "B07PX2TYXN", "product_title": "Natural Health 4 Life Vegetable Fibre Psyllium Hus...", "country_code": "uk", "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 12.84, "impression_share": 3.37, "price": 17.62, "click_share_rank": 2, "weekly_search_volume": 6760.5, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "Natural Health 4 Life", "estimated_clicks": 868.0482}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "psyllium husk", "competitor_brand": "Natural Health 4 Life", "asin": "B07PX2TYXN", "product_title": "Natural Health 4 Life Vegetable Fibre Psyllium Hus...", "country_code": "uk", "average_organic_rank": 9, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 6.22, "impression_share": 3.4, "price": 17.49, "click_share_rank": 6, "weekly_search_volume": 9795.92, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "Natural Health 4 Life", "estimated_clicks": 609.306224}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "psyllium husk", "competitor_brand": "Natural Health 4 Life", "asin": "B07PX2TYXN", "product_title": "Natural Health 4 Life Vegetable Fibre Psyllium Hus...", "country_code": "uk", "average_organic_rank": 6, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 11.81, "impression_share": 3.48, "price": 17.49, "click_share_rank": 3, "weekly_search_volume": 1501.28, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "Natural Health 4 Life", "estimated_clicks": 177.30116800000002}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "psyllium husk", "competitor_brand": "NaturaleBio", "asin": "B07L9WJ4P2", "product_title": "NaturaleBio Organic Psyllium Husk - 99% Purity - 2...", "country_code": "uk", "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 4, "weekly_number_of_days_with_coupon": 0, "click_share": 23.34, "impression_share": 6.41, "price": 8.89, "click_share_rank": 1, "weekly_search_volume": 6760.5, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "NaturaleBio", "estimated_clicks": 1577.9007}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "psyllium husk", "competitor_brand": "NaturaleBio", "asin": "B07L9WJ4P2", "product_title": "NaturaleBio Organic Psyllium Husk - 99% Purity - 2...", "country_code": "uk", "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 22.7, "impression_share": 6.62, "price": 8.89, "click_share_rank": 1, "weekly_search_volume": 1501.28, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "NaturaleBio", "estimated_clicks": 340.79055999999997}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "psyllium husk", "competitor_brand": "NaturaleBio", "asin": "B07L9WJ4P2", "product_title": "NaturaleBio Organic Psyllium Husk - 99% Purity - 2...", "country_code": "uk", "average_organic_rank": 1, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 22.1, "impression_share": 5.74, "price": 8.89, "click_share_rank": 1, "weekly_search_volume": 9795.92, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "NaturaleBio", "estimated_clicks": 2164.8983200000002}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "psyllium husk", "competitor_brand": "Horb\u00e4ach", "asin": "B0CYQ1ZKV6", "product_title": "Psyllium Husk Capsules 5000mg with Acidophilus | N...", "country_code": "uk", "average_organic_rank": 12, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 1.19, "impression_share": 2.94, "price": 7.99, "click_share_rank": 10, "weekly_search_volume": 6760.5, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "Horb\u00e4ach", "estimated_clicks": 80.44994999999999}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "psyllium husk", "competitor_brand": "REBIRTH WELLNESS BE YOURSELF | ONLY BETTER", "asin": "B0F227549B", "product_title": "Psyllium Husk Fibre Supplement 4000mg with Probiot...", "country_code": "uk", "average_organic_rank": 18, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 1.8, "impression_share": 4.64, "price": 9.95, "click_share_rank": 9, "weekly_search_volume": 1501.28, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "REBIRTH WELLNESS BE YOURSELF | ONLY BETTER", "estimated_clicks": 27.02304}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "psyllium husk", "competitor_brand": "The Worldwide Mint", "asin": "B0F3JB86T3", "product_title": "Psyllium Husk Powder 200g | 100% Pure & Natural | ...", "country_code": "uk", "average_organic_rank": 17, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 4.33, "impression_share": 4.65, "price": 5.45, "click_share_rank": 6, "weekly_search_volume": 1501.28, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "The Worldwide Mint", "estimated_clicks": 65.00542399999999}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "psyllium husk", "competitor_brand": "The Worldwide Mint", "asin": "B0F3JB86T3", "product_title": "Psyllium Husk Powder 200g | 100% Pure & Natural | ...", "country_code": "uk", "average_organic_rank": 18, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 2.54, "impression_share": 3.29, "price": 5.792857143, "click_share_rank": 9, "weekly_search_volume": 9795.92, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "The Worldwide Mint", "estimated_clicks": 248.81636799999998}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "psyllium husk", "competitor_brand": "The Worldwide Mint", "asin": "B0F3JB86T3", "product_title": "Psyllium Husk Powder 200g | 100% Pure & Natural | ...", "country_code": "uk", "average_organic_rank": 9, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 7.06, "impression_share": 5.8, "price": 5.45, "click_share_rank": 5, "weekly_search_volume": 6760.5, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "The Worldwide Mint", "estimated_clicks": 477.2913}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "psyllium husk", "competitor_brand": null, "asin": "B0FW6P4NKY", "product_title": "Vinco Fibre Supplement 5000mg Psyllium Husk with A...", "country_code": "uk", "average_organic_rank": 21, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 1.8, "impression_share": 3.44, "price": 9.99, "click_share_rank": 9, "weekly_search_volume": 6760.5, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "Vinco Fibre", "estimated_clicks": 121.68900000000001}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "psyllium husk", "competitor_brand": "WeightWorld", "asin": "B0B1QQNZ2S", "product_title": "WeightWorld Organic Psyllium Husk Capsules | 1400m...", "country_code": "uk", "average_organic_rank": 7, "weekly_number_of_days_with_deal": 1, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 9.21, "impression_share": 6.36, "price": 11.678571429, "click_share_rank": 4, "weekly_search_volume": 1501.28, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "WeightWorld", "estimated_clicks": 138.26788800000003}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "psyllium husk", "competitor_brand": "WeightWorld", "asin": "B0B1QQNZ2S", "product_title": "WeightWorld Organic Psyllium Husk Capsules | 1400m...", "country_code": "uk", "average_organic_rank": 5, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 8.81, "impression_share": 6.04, "price": 11.96, "click_share_rank": 4, "weekly_search_volume": 6760.5, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "WeightWorld", "estimated_clicks": 595.6000500000001}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "psyllium husk", "competitor_brand": "WeightWorld", "asin": "B0B1QQNZ2S", "product_title": "WeightWorld Organic Psyllium Husk Capsules | 1400m...", "country_code": "uk", "average_organic_rank": 10, "weekly_number_of_days_with_deal": 6, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 9.39, "impression_share": 6.07, "price": 10.271428571, "click_share_rank": 3, "weekly_search_volume": 9795.92, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "WeightWorld", "estimated_clicks": 919.8368880000002}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "psyllium husk", "competitor_brand": "Wholefood Earth", "asin": "B07F88MZ4K", "product_title": "Wholefood Earth Organic Psyllium Husk Powder 250g ...", "country_code": "uk", "average_organic_rank": 14, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 6.83, "impression_share": 4.2, "price": 6.43, "click_share_rank": 5, "weekly_search_volume": 9795.92, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "Wholefood Earth", "estimated_clicks": 669.061336}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "psyllium husk", "competitor_brand": "yourhealthstore", "asin": "B07ZJQ6JNK", "product_title": "yourhealthstore Blond Psyllium Husks 300g, Whole, ...", "country_code": "uk", "average_organic_rank": 14, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 1.32, "impression_share": 3.19, "price": 7.682857143, "click_share_rank": 10, "weekly_search_volume": 9795.92, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "yourhealthstore", "estimated_clicks": 129.306144}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "psyllium husk", "competitor_brand": "Solgar", "asin": "B005P0WGNE", "product_title": "Solgar Psyllium Husks Fibre 500 Mg Vegetable Capsu...", "country_code": "uk", "average_organic_rank": 13, "weekly_number_of_days_with_deal": 4, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 2, "click_share": 4.24, "impression_share": 4.01, "price": 12.29, "click_share_rank": 8, "weekly_search_volume": 6760.5, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "Solgar", "estimated_clicks": 286.6452}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "psyllium husk", "competitor_brand": "Solgar", "asin": "B005P0WGNE", "product_title": "Solgar Psyllium Husks Fibre 500 Mg Vegetable Capsu...", "country_code": "uk", "average_organic_rank": 11, "weekly_number_of_days_with_deal": 2, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 4, "click_share": 3.45, "impression_share": 3.69, "price": 14.261428571, "click_share_rank": 8, "weekly_search_volume": 1501.28, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "Solgar", "estimated_clicks": 51.794160000000005}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "psyllium husk", "competitor_brand": "Wholefood Earth", "asin": "B07F88MZ4K", "product_title": "Wholefood Earth Organic Psyllium Husk Powder 250g ...", "country_code": "uk", "average_organic_rank": 19, "weekly_number_of_days_with_deal": 2, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 5, "click_share": 1.23, "impression_share": 2.72, "price": 8.881428571, "click_share_rank": 10, "weekly_search_volume": 1501.28, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "Wholefood Earth", "estimated_clicks": 18.465744}, {"brand_aggregation": "naturalebio", "parent_asin": "Psyllium", "reporting_date": "2025-12-20", "week_date": "2025-51", "keywords": "psyllium husk", "competitor_brand": "Solgar", "asin": "B005P0WGNE", "product_title": "Solgar Psyllium Husks Fibre 500 Mg Vegetable Capsu...", "country_code": "uk", "average_organic_rank": 6, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "click_share": 3.95, "impression_share": 4.21, "price": 15.05, "click_share_rank": 8, "weekly_search_volume": 9795.92, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.co.uk/s?k=psyllium+husk", "real_brand": "Solgar", "estimated_clicks": 386.93884}]
        };

        const BrandColors = {
            us: '#2563eb', // Blue
            comp1: '#dc2626', // Red
            comp2: '#4b5563', // Gray
            comp3: '#9ca3af', // Light Gray
            rest: '#e5e7eb'
        };

        // --- COMPONENTS ---

        const Dashboard = () => {
            const [activeTab, setActiveTab] = useState('static');

            return (
                <div className="max-w-7xl mx-auto p-6 space-y-8">
                    {/* Header */}
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center">
                        <div>
                            <h1 className="text-3xl font-bold text-slate-900">Brand Intelligence Report</h1>
                            <p className="text-slate-500 mt-1">
                                Analysis for <span className="font-semibold text-blue-600">{marketData.our_brand}</span> | Parent ASIN: Psyllium
                            </p>
                        </div>
                        <div className="flex bg-slate-200 p-1 rounded-xl mt-4 md:mt-0">
                            <button 
                                onClick={() => setActiveTab('static')}
                                className={`px-4 py-2 rounded-lg text-sm font-medium transition ${activeTab === 'static' ? 'bg-white shadow text-slate-900' : 'text-slate-500'}`}
                            >
                                Executive Report
                            </button>
                            <button 
                                onClick={() => setActiveTab('interactive')}
                                className={`px-4 py-2 rounded-lg text-sm font-medium transition ${activeTab === 'interactive' ? 'bg-white shadow text-slate-900' : 'text-slate-500'}`}
                            >
                                Interactive Comparator
                            </button>
                        </div>
                    </div>

                    {activeTab === 'static' ? <StaticReport /> : <InteractiveComparator />}
                </div>
            );
        };

        const StaticReport = () => {
            return (
                <div className="space-y-8 animate-fade-in">
                    
                    {/* 1. Global Trend */}
                    <SectionCard title="1. Global Trend: Parent ASIN Performance" icon={<lucide.TrendingUp />}>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div className="h-72">
                                <h3 className="text-sm font-semibold text-slate-500 mb-4">Total Clicks Estimate</h3>
                                <ResponsiveContainer width="100%" height="100%">
                                    <AreaChart data={marketData.global_trend}>
                                        <defs>
                                            <linearGradient id="colorUs" x1="0" y1="0" x2="0" y2="1">
                                                <stop offset="5%" stopColor={BrandColors.us} stopOpacity={0.8}/>
                                                <stop offset="95%" stopColor={BrandColors.us} stopOpacity={0}/>
                                            </linearGradient>
                                            <linearGradient id="colorComp" x1="0" y1="0" x2="0" y2="1">
                                                <stop offset="5%" stopColor={BrandColors.comp2} stopOpacity={0.8}/>
                                                <stop offset="95%" stopColor={BrandColors.comp2} stopOpacity={0}/>
                                            </linearGradient>
                                        </defs>
                                        <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                        <XAxis dataKey="week" />
                                        <YAxis />
                                        <Tooltip />
                                        <Legend />
                                        <Area type="monotone" dataKey="us_clicks" stroke={BrandColors.us} fillOpacity={1} fill="url(#colorUs)" name="Our Clicks" />
                                        <Area type="monotone" dataKey="comp_clicks" stroke={BrandColors.comp2} fillOpacity={1} fill="url(#colorComp)" name="Competitor Clicks" />
                                    </AreaChart>
                                </ResponsiveContainer>
                            </div>
                            <div className="h-72">
                                <h3 className="text-sm font-semibold text-slate-500 mb-4">Click Share Evolution (%)</h3>
                                <ResponsiveContainer width="100%" height="100%">
                                    <LineChart data={marketData.global_trend}>
                                        <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                        <XAxis dataKey="week" />
                                        <YAxis domain={[0, 100]} />
                                        <Tooltip />
                                        <Legend />
                                        <Line type="monotone" dataKey="us_share" stroke={BrandColors.us} strokeWidth={3} name="Our Share %" />
                                        <Line type="monotone" dataKey="comp_share" stroke={BrandColors.comp2} strokeWidth={3} name="Competitor Share %" />
                                    </LineChart>
                                </ResponsiveContainer>
                            </div>
                        </div>
                        <div className="mt-4 bg-blue-50 p-4 rounded-lg text-sm text-blue-800">
                            <strong>Analysis:</strong> Despite a significant market volume drop in week 52 (likely seasonal), our click share remained stable and even grew slightly to 28.9% in the latest week. This indicates high brand resilience compared to competitors.
                        </div>
                    </SectionCard>

                    {/* 2. Brand Competitiveness */}
                    <SectionCard title="2. Brand Competitiveness: Share of Voice" icon={<lucide.Users />}>
                         <div className="h-80 w-full">
                            <ResponsiveContainer width="100%" height="100%">
                                <LineChart data={marketData.competitiveness}>
                                    <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                    <XAxis dataKey="week" />
                                    <YAxis domain={[0, 40]} />
                                    <Tooltip contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }} />
                                    <Legend />
                                    <Line type="monotone" dataKey="Our Brand" stroke={BrandColors.us} strokeWidth={3} dot={{r:4}} />
                                    <Line type="monotone" dataKey={marketData.top_competitors[0]} stroke={BrandColors.comp1} strokeWidth={2} />
                                    <Line type="monotone" dataKey={marketData.top_competitors[1]} stroke={BrandColors.comp2} strokeWidth={2} />
                                    <Line type="monotone" dataKey={marketData.top_competitors[2]} stroke={BrandColors.comp3} strokeWidth={2} />
                                </LineChart>
                            </ResponsiveContainer>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                            <div className="bg-white border p-4 rounded-xl">
                                <div className="text-xs text-slate-500 uppercase">Leader</div>
                                <div className="text-lg font-bold text-blue-600">{marketData.our_brand}</div>
                                <div className="text-sm text-slate-600">Dominating with ~29% share</div>
                            </div>
                            <div className="bg-white border p-4 rounded-xl">
                                <div className="text-xs text-slate-500 uppercase">Top Rival</div>
                                <div className="text-lg font-bold text-red-600">{marketData.top_competitors[0]}</div>
                                <div className="text-sm text-slate-600">Declining trend (17% -> 14%)</div>
                            </div>
                            <div className="bg-white border p-4 rounded-xl">
                                <div className="text-xs text-slate-500 uppercase">Market Dyn</div>
                                <div className="text-lg font-bold text-slate-700">Consolidating</div>
                                <div className="text-sm text-slate-600">Top players holding ground</div>
                            </div>
                        </div>
                    </SectionCard>

                    {/* 3. Levers */}
                    <SectionCard title="3. Growth Levers: Price & Promos" icon={<lucide.Zap />}>
                        <div className="overflow-x-auto">
                            <table className="w-full text-left text-sm text-slate-600">
                                <thead className="bg-slate-50 text-slate-900 font-semibold">
                                    <tr>
                                        <th className="p-3 rounded-l-lg">Week</th>
                                        <th className="p-3 text-blue-600">Our Price</th>
                                        <th className="p-3 text-blue-600">Our Share</th>
                                        <th className="p-3 text-red-600">Comp Price ({marketData.levers[0].top_competitor_name})</th>
                                        <th className="p-3 text-red-600">Comp Share</th>
                                        <th className="p-3 rounded-r-lg">Promo Impact</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-100">
                                    {marketData.levers.map((row, idx) => (
                                        <tr key={idx} className="hover:bg-slate-50">
                                            <td className="p-3 font-medium">{row.week}</td>
                                            <td className="p-3 font-bold">£{row.us_price}</td>
                                            <td className="p-3">{row.us_share}%</td>
                                            <td className="p-3">£{row.comp_price}</td>
                                            <td className="p-3">{row.comp_share}%</td>
                                            <td className="p-3">
                                                {row.comp_promo ? <span className="bg-red-100 text-red-700 px-2 py-1 rounded text-xs">Comp Promo</span> : <span className="text-slate-400">-</span>}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </SectionCard>

                    {/* 4. Efficiency */}
                    <SectionCard title="4. Efficiency: Rank vs. Click Share (Last Week)" icon={<lucide.Target />}>
                        <div className="h-96 w-full">
                            <ResponsiveContainer width="100%" height="100%">
                                <ScatterChart margin={{ top: 20, right: 20, bottom: 20, left: 20 }}>
                                    <CartesianGrid />
                                    <XAxis type="number" dataKey="rank" name="Organic Rank" reversed={true} label={{ value: 'Organic Rank (Lower is Better)', position: 'insideBottom', offset: -10 }} domain={[25, 0]}/>
                                    <YAxis type="number" dataKey="click_share" name="Click Share %" label={{ value: 'Click Share %', angle: -90, position: 'insideLeft' }} />
                                    <Tooltip cursor={{ strokeDasharray: '3 3' }} content={({ active, payload }) => {
                                        if (active && payload && payload.length) {
                                            const data = payload[0].payload;
                                            return (
                                                <div className="bg-white p-3 border shadow-lg rounded-lg text-sm">
                                                    <p className="font-bold">{data.brand}</p>
                                                    <p>Rank: {data.rank}</p>
                                                    <p>Share: {data.click_share}%</p>
                                                    <p>Price: £{data.price}</p>
                                                </div>
                                            );
                                        }
                                        return null;
                                    }} />
                                    <Scatter name="ASINs" data={marketData.efficiency} fill="#8884d8">
                                        {marketData.efficiency.map((entry, index) => (
                                            <cell key={`cell-${index}`} fill={entry.is_us ? BrandColors.us : (entry.deal ? '#f59e0b' : BrandColors.comp3)} />
                                        ))}
                                    </Scatter>
                                    <ReferenceLine y={10} stroke="red" strokeDasharray="3 3" label="High Performance Zone" />
                                </ScatterChart>
                            </ResponsiveContainer>
                        </div>
                        <div className="flex gap-4 justify-center text-sm text-slate-600 mt-2">
                            <div className="flex items-center gap-2"><div className="w-3 h-3 rounded-full bg-blue-600"></div> Us</div>
                            <div className="flex items-center gap-2"><div className="w-3 h-3 rounded-full bg-amber-500"></div> Competitor with Deal</div>
                            <div className="flex items-center gap-2"><div className="w-3 h-3 rounded-full bg-gray-400"></div> Competitor Standard</div>
                        </div>
                    </SectionCard>

                    {/* 5. Conclusions & Recs */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <SectionCard title="Key Insights" icon={<lucide.Lightbulb />}>
                            <ul className="space-y-3">
                                <li className="flex items-start gap-3">
                                    <div className="bg-green-100 p-1 rounded mt-1"><lucide.Check className="w-4 h-4 text-green-700"/></div>
                                    <p className="text-sm text-slate-700"><strong>Dominant Position:</strong> Maintained ~29% Click Share despite market fluctuations, outperforming the closest rival by >10 points.</p>
                                </li>
                                <li className="flex items-start gap-3">
                                    <div className="bg-blue-100 p-1 rounded mt-1"><lucide.TrendingUp className="w-4 h-4 text-blue-700"/></div>
                                    <p className="text-sm text-slate-700"><strong>Price Efficiency:</strong> At £8.89 vs £9.99 (NKD Living), our pricing strategy is the primary driver of high click-through rates.</p>
                                </li>
                                <li className="flex items-start gap-3">
                                    <div className="bg-amber-100 p-1 rounded mt-1"><lucide.AlertTriangle className="w-4 h-4 text-amber-700"/></div>
                                    <p className="text-sm text-slate-700"><strong>Competitor Weakness:</strong> Top competitors (NKD, New Leaf) are trending downwards in share, opening a gap for us to consolidate further.</p>
                                </li>
                                <li className="flex items-start gap-3">
                                    <div className="bg-purple-100 p-1 rounded mt-1"><lucide.Search className="w-4 h-4 text-purple-700"/></div>
                                    <p className="text-sm text-slate-700"><strong>Rank Impact:</strong> Organic Rank 2 is delivering "Amazon Choice" level share (23%+). We are over-indexing on visibility vs rank.</p>
                                </li>
                                <li className="flex items-start gap-3">
                                    <div className="bg-red-100 p-1 rounded mt-1"><lucide.Activity className="w-4 h-4 text-red-700"/></div>
                                    <p className="text-sm text-slate-700"><strong>Volatility:</strong> Week 52 showed a massive search volume drop (-80%), but our share held. This proves brand stickiness over seasonality.</p>
                                </li>
                            </ul>
                        </SectionCard>

                        <SectionCard title="Actionable Recommendations" icon={<lucide.Rocket />}>
                            <ul className="space-y-4">
                                <li className="bg-slate-50 p-4 rounded-lg border border-slate-100">
                                    <h4 className="font-bold text-slate-900 text-sm mb-1">1. Test Price Elasticity</h4>
                                    <p className="text-xs text-slate-600">Since we are dominating on value (£1.10 cheaper than #2), test a small price increase to £9.29. Monitor if rank or share drops. Potentially recover margin without losing volume.</p>
                                </li>
                                <li className="bg-slate-50 p-4 rounded-lg border border-slate-100">
                                    <h4 className="font-bold text-slate-900 text-sm mb-1">2. Defensive Coupon Strategy</h4>
                                    <p className="text-xs text-slate-600">Competitors like Solgar are using coupons. Keep a 5% coupon ready to activate solely if our organic rank slips below 3 to regain CTR immediately.</p>
                                </li>
                                <li className="bg-slate-50 p-4 rounded-lg border border-slate-100">
                                    <h4 className="font-bold text-slate-900 text-sm mb-1">3. Inventory Preparation</h4>
                                    <p className="text-xs text-slate-600">Volume bounced back 4x in Week 01. Ensure stock levels are prepped for January "New Year Resolution" health trends to avoid stockouts during high-traffic weeks.</p>
                                </li>
                            </ul>
                        </SectionCard>
                    </div>

                </div>
            );
        };

        const InteractiveComparator = () => {
            const weeks = [...new Set(marketData.raw_data_dump.map(d => d.week_date))].sort();
            const competitors = marketData.top_competitors;
            
            const [selectedWeek, setSelectedWeek] = useState(weeks[weeks.length - 1]);
            const [selectedComp, setSelectedComp] = useState(competitors[0]);

            const weekData = marketData.raw_data_dump.filter(d => d.week_date === selectedWeek);
            
            // Get Our Data (assuming single main ASIN for simplicity of display, taking best performing if multiple)
            const ourData = weekData.filter(d => d.is_yaba_asin === 'Y').sort((a,b) => b.click_share - a.click_share)[0] || {};
            // Get Comp Data
            const compData = weekData.filter(d => d.real_brand === selectedComp).sort((a,b) => b.click_share - a.click_share)[0] || {};

            const MetricCard = ({ label, us, them, format = (v) => v, inverse = false }) => {
                const diff = us - them;
                const isBetter = inverse ? diff < 0 : diff > 0;
                const color = isBetter ? 'text-green-600' : 'text-red-600';
                
                return (
                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <h4 className="text-sm font-medium text-slate-500 mb-2">{label}</h4>
                        <div className="flex items-end justify-between">
                            <div>
                                <div className="text-2xl font-bold text-blue-600">{format(us)}</div>
                                <div className="text-xs text-slate-400">Us</div>
                            </div>
                            <div className="text-center pb-1">
                                <span className={`text-sm font-bold ${color}`}>
                                    {diff > 0 ? '+' : ''}{format(Number(diff.toFixed(2)))}
                                </span>
                            </div>
                            <div className="text-right">
                                <div className="text-2xl font-bold text-slate-600">{format(them)}</div>
                                <div className="text-xs text-slate-400">Them</div>
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="space-y-6">
                    <div className="flex gap-4 p-4 bg-white rounded-xl shadow-sm border border-slate-200">
                        <div>
                            <label className="block text-xs font-semibold text-slate-500 mb-1">Week</label>
                            <select 
                                value={selectedWeek} 
                                onChange={(e) => setSelectedWeek(e.target.value)}
                                className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                            >
                                {weeks.map(w => <option key={w} value={w}>{w}</option>)}
                            </select>
                        </div>
                        <div>
                            <label className="block text-xs font-semibold text-slate-500 mb-1">Competitor</label>
                            <select 
                                value={selectedComp} 
                                onChange={(e) => setSelectedComp(e.target.value)}
                                className="bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                            >
                                {competitors.map(c => <option key={c} value={c}>{c}</option>)}
                            </select>
                        </div>
                    </div>

                    {!ourData.asin || !compData.asin ? (
                         <div className="p-8 text-center text-slate-500">Data not available for this combination.</div>
                    ) : (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <MetricCard label="Click Share (%)" us={ourData.click_share} them={compData.click_share} format={(v) => v + '%'} />
                            <MetricCard label="Organic Rank" us={ourData.average_organic_rank} them={compData.average_organic_rank} inverse={true} />
                            <MetricCard label="Price (£)" us={ourData.price} them={compData.price} inverse={true} />
                            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                <h4 className="text-sm font-medium text-slate-500 mb-2">Active Promo</h4>
                                <div className="flex justify-between mt-4">
                                    <div className="text-center">
                                        <div className={`text-lg font-bold ${ourData.weekly_number_of_days_with_deal > 0 ? 'text-green-600' : 'text-slate-400'}`}>
                                            {ourData.weekly_number_of_days_with_deal > 0 ? 'YES' : 'NO'}
                                        </div>
                                        <div className="text-xs text-slate-400">Us</div>
                                    </div>
                                    <div className="text-center">
                                        <div className={`text-lg font-bold ${compData.weekly_number_of_days_with_deal > 0 ? 'text-red-600' : 'text-slate-400'}`}>
                                            {compData.weekly_number_of_days_with_deal > 0 ? 'YES' : 'NO'}
                                        </div>
                                        <div className="text-xs text-slate-400">Them</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Product Details Comparison */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mt-8">
                         <div className="bg-blue-50 p-6 rounded-2xl border border-blue-100">
                            <h3 className="font-bold text-blue-900 mb-4">Our Listing</h3>
                            <div className="space-y-2 text-sm text-blue-800">
                                <p><span className="font-semibold">ASIN:</span> {ourData.asin}</p>
                                <p><span className="font-semibold">Title:</span> {ourData.product_title}</p>
                                <a href={ourData.keywords_link} target="_blank" className="text-blue-600 underline text-xs mt-2 block">View SERP</a>
                            </div>
                         </div>
                         <div className="bg-slate-50 p-6 rounded-2xl border border-slate-200">
                            <h3 className="font-bold text-slate-900 mb-4">Competitor Listing</h3>
                            <div className="space-y-2 text-slate-700 text-sm">
                                <p><span className="font-semibold">ASIN:</span> {compData.asin}</p>
                                <p><span className="font-semibold">Title:</span> {compData.product_title}</p>
                            </div>
                         </div>
                    </div>
                </div>
            );
        };

        const SectionCard = ({ title, children, icon }) => (
            <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                <div className="flex items-center gap-3 mb-6 pb-4 border-b border-slate-100">
                    <div className="bg-blue-50 p-2 rounded-lg text-blue-600">
                        {icon}
                    </div>
                    <h2 className="text-xl font-bold text-slate-800">{title}</h2>
                </div>
                {children}
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Dashboard />);
    </script>
</body>
</html>