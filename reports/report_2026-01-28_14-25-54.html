<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Market Intelligence Report</title>
    <!-- Google Charts -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        :root {
            --primary: #0071e3; /* Apple/Amazon Blue mix */
            --primary-bg: #e8f0fe;
            --secondary: #86868b;
            --bg-color: #f5f5f7;
            --card-bg: #ffffff;
            --text-main: #1d1d1f;
            --text-secondary: #86868b;
            --border-radius: 20px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --danger: #ff3b30;
            --success: #34c759;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            padding-bottom: 40px;
        }

        /* Header */
        header {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            padding: 16px 24px;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { font-size: 20px; font-weight: 600; }
        .badge { background: var(--primary-bg); color: var(--primary); padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; }

        /* Navigation */
        .nav-container {
            max-width: 1200px;
            margin: 24px auto 0;
            padding: 0 24px;
        }
        
        .tabs {
            display: inline-flex;
            background: #e0e0e0;
            padding: 4px;
            border-radius: 12px;
        }
        
        .tab-btn {
            padding: 8px 24px;
            border: none;
            background: transparent;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .tab-btn.active {
            background: white;
            color: black;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Content */
        .container {
            max-width: 1200px;
            margin: 24px auto;
            padding: 0 24px;
        }

        .section-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 24px;
            margin-bottom: 24px;
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .col-12 { grid-column: span 12; }
        .col-8 { grid-column: span 8; }
        .col-6 { grid-column: span 6; }
        .col-4 { grid-column: span 4; }

        @media (max-width: 768px) {
            .col-8, .col-6, .col-4 { grid-column: span 12; }
        }

        h2 { font-size: 18px; margin-bottom: 16px; font-weight: 600; display: flex; align-items: center; gap: 8px; }
        h2 .material-icons { color: var(--primary); font-size: 20px; }

        .chart-container {
            width: 100%;
            height: 350px;
        }

        .insight-text {
            font-size: 15px;
            line-height: 1.6;
            color: #424245;
        }

        .metric-big { font-size: 32px; font-weight: 700; letter-spacing: -1px; margin: 8px 0; }
        .metric-label { font-size: 13px; color: var(--text-secondary); font-weight: 500; text-transform: uppercase; }

        /* Insights List */
        .insights-list { list-style: none; }
        .insights-list li {
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            gap: 12px;
            align-items: start;
        }
        .insights-list li:last-child { border-bottom: none; }
        .insights-list li .material-icons { font-size: 18px; margin-top: 2px; }
        .insights-list li.positive .material-icons { color: var(--success); }
        .insights-list li.warning .material-icons { color: #ff9f0a; }

        /* Comparator Specific */
        .comparator-controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            background: white;
            padding: 16px;
            border-radius: 16px;
            flex-wrap: wrap;
        }
        
        select {
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid #d2d2d7;
            background: #fbfbfd;
            font-size: 14px;
            min-width: 150px;
        }

        .vs-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 16px;
            margin-bottom: 16px;
        }
        .vs-side { text-align: center; flex: 1; }
        .vs-mid { font-weight: bold; color: #d2d2d7; font-size: 12px; text-transform: uppercase; }
        .vs-val { font-size: 20px; font-weight: 700; margin-top: 4px; }
        
        .hidden { display: none; }
    </style>
</head>
<body>

    <header>
        <div class="header-content">
            <div style="display:flex; align-items:center; gap:12px;">
                <span class="material-icons" style="color:var(--primary)">analytics</span>
                <h1>Market Intelligence</h1>
            </div>
            <span class="badge">Parent ASIN Analysis</span>
        </div>
    </header>

    <div class="nav-container">
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('report')">Executive Report</button>
            <button class="tab-btn" onclick="switchTab('comparator')">Competitor Lab</button>
        </div>
    </div>

    <!-- TAB 1: EXECUTIVE REPORT -->
    <div id="tab-report" class="container">
        
        <!-- SECTION 1: GLOBAL TREND -->
        <div class="section-grid">
            <div class="col-8 card">
                <h2><span class="material-icons">show_chart</span> Global Trend (Clicks & Share)</h2>
                <div id="chart_trend" class="chart-container"></div>
            </div>
            <div class="col-4 card" style="display:flex; flex-direction:column; justify-content:center;">
                <h2>Strategic Context</h2>
                <p id="insight_trend" class="insight-text"></p>
                <div style="margin-top:24px; padding:16px; background:#f0f7ff; border-radius:12px;">
                    <div class="metric-label">Last Week Share</div>
                    <div id="metric_share" class="metric-big" style="color:var(--primary)">--%</div>
                </div>
            </div>
        </div>

        <!-- SECTION 2: BRAND COMPETITIVENESS -->
        <div class="section-grid">
            <div class="col-12 card">
                <h2><span class="material-icons">pie_chart</span> Brand Competitiveness (Share of Voice)</h2>
                <div id="chart_brand" class="chart-container"></div>
                <div style="margin-top:16px; padding-top:16px; border-top:1px solid #eee;">
                    <p id="insight_comp" class="insight-text"></p>
                </div>
            </div>
        </div>

        <!-- SECTION 3: PALANCAS & EFFICIENCY -->
        <div class="section-grid">
            <!-- Palancas Text -->
            <div class="col-4 card">
                <h2><span class="material-icons">tune</span> Growth Levers</h2>
                <p id="insight_levers" class="insight-text" style="margin-bottom:16px;"></p>
                <ul class="insights-list">
                    <li class="positive"><span class="material-icons">check_circle</span> Deals Impact Analyzed</li>
                    <li class="warning"><span class="material-icons">sell</span> Price Sensitivity Check</li>
                </ul>
            </div>
            <!-- Efficiency Chart -->
            <div class="col-8 card">
                <h2><span class="material-icons">scatter_plot</span> Efficiency: Organic Rank vs Click Share</h2>
                <div id="chart_scatter" class="chart-container"></div>
                <p class="metric-label" style="text-align:center; margin-top:8px;">Lower Rank (Left) is Better. Higher Share (Top) is Better.</p>
            </div>
        </div>

        <!-- SECTION 5: CONCLUSIONS -->
        <div class="section-grid">
            <div class="col-6 card">
                <h2><span class="material-icons">lightbulb</span> Key Insights</h2>
                <ul id="list_insights" class="insights-list">
                    <!-- Populated by JS -->
                </ul>
            </div>
            <div class="col-6 card" style="background: #f5f5f7; border: 1px solid #d2d2d7;">
                <h2><span class="material-icons">rocket_launch</span> Actionable Recommendations</h2>
                <ul id="list_recs" class="insights-list">
                    <!-- Populated by JS -->
                </ul>
            </div>
        </div>

    </div>

    <!-- TAB 2: INTERACTIVE COMPARATOR -->
    <div id="tab-comparator" class="container hidden">
        <div class="comparator-controls">
            <div>
                <label class="metric-label">Week</label><br>
                <select id="comp_week"></select>
            </div>
            <div>
                <label class="metric-label">Our ASIN (Brand)</label><br>
                <select id="comp_brand_us" disabled style="background:#e8f0fe; color:var(--primary); font-weight:bold;"></select>
            </div>
            <div>
                <label class="metric-label">Competitor</label><br>
                <select id="comp_brand_them"></select>
            </div>
        </div>

        <div class="section-grid">
            <div class="col-6 card">
                <h2 style="justify-content:center;">Head to Head Comparison</h2>
                
                <div class="vs-card">
                    <div class="vs-side">
                        <div class="metric-label">Click Share</div>
                        <div id="vs_share_us" class="vs-val" style="color:var(--primary)">--</div>
                    </div>
                    <div class="vs-mid">VS</div>
                    <div class="vs-side">
                        <div class="metric-label">Click Share</div>
                        <div id="vs_share_them" class="vs-val">--</div>
                    </div>
                </div>

                <div class="vs-card">
                    <div class="vs-side">
                        <div class="metric-label">Avg Price</div>
                        <div id="vs_price_us" class="vs-val" style="color:var(--primary)">--</div>
                    </div>
                    <div class="vs-mid">VS</div>
                    <div class="vs-side">
                        <div class="metric-label">Avg Price</div>
                        <div id="vs_price_them" class="vs-val">--</div>
                    </div>
                </div>

                <div class="vs-card">
                    <div class="vs-side">
                        <div class="metric-label">Avg Rank</div>
                        <div id="vs_rank_us" class="vs-val" style="color:var(--primary)">--</div>
                    </div>
                    <div class="vs-mid">VS</div>
                    <div class="vs-side">
                        <div class="metric-label">Avg Rank</div>
                        <div id="vs_rank_them" class="vs-val">--</div>
                    </div>
                </div>
            </div>

            <div class="col-6 card">
                <h2>Product Details</h2>
                <div style="font-size:13px; color:#666;">
                    <strong style="color:var(--primary)">Us:</strong> <span id="vs_title_us">Select filters...</span>
                    <hr style="margin:12px 0; border:0; border-top:1px solid #eee;">
                    <strong>Them:</strong> <span id="vs_title_them">Select filters...</span>
                </div>
                <div style="margin-top:24px; padding:16px; background:#fff8e1; border-radius:12px;">
                    <div class="metric-label">Deal Status</div>
                    <p id="vs_deals" style="font-weight:600; font-size:14px; margin-top:4px;">--</p>
                </div>
            </div>
        </div>
    </div>

    <!-- DATA INJECTION & LOGIC -->
    <script>
        // --- 1. PROCESSED DATA INJECTION ---
        const marketData = {"trend_header": ["Week", "Our Clicks", "Comp Clicks", "Our Share (%)", "Comp Share (%)"], "trend_rows": [["2025-52", 9020.372208, 15900.900208, 26.220000000000002, 46.22], ["2026-01", 7199.30127, 12714.132822, 25.9, 45.739999999999995]], "brand_header": ["Week", "NaturaleBio", "NORITUAL LAB", "Ceremonial", "VAHDAM", "Rest of Market"], "brand_rows": [["2025-52", 26.220000000000002, 20.77, 8.32, 8.89, 8.24], ["2026-01", 25.900000000000002, 20.02, 6.01, 6.53, 13.18]], "scatter_rows": [[8.0, 3.79, "point {'fill-color': '{color}'}", "VAHDAM, Matcha Gr\u00fcntee Pulver ...\nBrand: VAHDAM\nRank: 8.0\nShare: 3.79%"], [5.0, 3.5, "point {'fill-color': '{color}'}", "NaturaleBio Matcha Tee Pulver ...\nBrand: NaturaleBio\nRank: 5.0\nShare: 3.5%"], [1.0, 14.75, "point {'fill-color': '{color}'}", "NaturaleBio Matcha Tee Pulver ...\nBrand: NaturaleBio\nRank: 1.0\nShare: 14.75%"], [4.0, 4.96, "point {'fill-color': '{color}'}", "NaturaleBio Matcha Tee Pulver ...\nBrand: NaturaleBio\nRank: 4.0\nShare: 4.96%"], [9.0, 3.08, "point {'fill-color': '{color}'}", "Bio Matcha Pulver 100 g \u2013 Japa...\nBrand: bioKontor\nRank: 9.0\nShare: 3.08%"], [12.0, 2.74, "point {'fill-color': '{color}'}", "VAHDAM, Vanille Matcha Gr\u00fcner ...\nBrand: VAHDAM\nRank: 12.0\nShare: 2.74%"], [15.0, 3.51, "point {'fill-color': '{color}'}", "Matcha Pulver - 90g - 100% Nat...\nBrand: Special Leaves\nRank: 15.0\nShare: 3.51%"], [7.0, 6.01, "point {'fill-color': '{color}'}", "Ceremonial Matcha Ryoku - Rein...\nBrand: Ceremonial\nRank: 7.0\nShare: 6.01%"], [7.0, 6.01, "point {'fill-color': '{color}'}", "Ceremonial Matcha Ryoku - Rein...\nBrand: NORITUAL LAB\nRank: 7.0\nShare: 6.01%"], [2.0, 14.01, "point {'fill-color': '{color}'}", "Ceremonial Matcha - Reines Mat...\nBrand: NORITUAL LAB\nRank: 2.0\nShare: 14.01%"], [9.0, 3.08, "point {'fill-color': '{color}'}", "Bio Matcha Pulver 100 g \u2013 Japa...\nBrand: Bio\nRank: 9.0\nShare: 3.08%"], [50.0, 2.69, "point {'fill-color': '{color}'}", "NaturaleBio Matcha Ceremonial ...\nBrand: NaturaleBio\nRank: nan\nShare: 2.69%"], [15.0, 3.51, "point {'fill-color': '{color}'}", "Matcha Pulver - 90g - 100% Nat...\nBrand: Matcha\nRank: 15.0\nShare: 3.51%"]], "raw_data": [["2025-52", "VAHDAM", "B07K1WBH4K", "VAHDAM, Vanille Matcha Gr\u00fcner Tee Pulver (100g, 50...", 9.727142857, 3.49, 12.0, 3.0], ["2025-52", "VAHDAM", "B07MD4LB49", "VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A...", 9.727142857, 5.4, 6.0, 3.0], ["2025-52", "NORITUAL LAB", "B0CNRX8G5S", "Ceremonial Matcha - Reines Matcha Pulver aus Japan...", 24.602857143, 14.83, 2.0, 0.0], ["2025-52", "Ceremonial", "B0G1T7N675", "Ceremonial Matcha Pulver BIO-Qualit\u00e4t 50g ideal zu...", 12.447142857, 2.38, 12.0, 3.0], ["2025-52", "Ceremonial", "B0FSL3C3Z8", "Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...", 16.008571429, 5.94, 7.0, 0.0], ["2025-52", "NORITUAL LAB", "B0FSL3C3Z8", "Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...", 16.008571429, 5.94, 7.0, 0.0], ["2025-52", "Matcha", "B0DRP6Y6XC", "Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...", 10.69, 4.12, 14.0, 0.0], ["2025-52", "Special Leaves", "B0DRP6Y6XC", "Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...", 10.69, 4.12, 14.0, 0.0], ["2025-52", "NaturaleBio", "B06XQ5DCYJ", "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", 15.031428571, 14.3, 1.0, 0.0], ["2025-52", "NaturaleBio", "B06XQ69YCQ", "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", 10.518571429, 5.19, 4.0, 0.0], ["2025-52", "NaturaleBio", "B07SZFD3P9", "NaturaleBio Matcha Ceremonial Grade 100g. Original...", 30.562857143, 2.75, 25.0, 1.0], ["2025-52", "NaturaleBio", "B079VQ52MK", "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", 24.737142857, 3.98, 5.0, 0.0], ["2026-01", "VAHDAM", "B07MD4LB49", "VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A...", 10.43, 3.79, 8.0, 0.0], ["2026-01", "NaturaleBio", "B079VQ52MK", "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", 24.5275, 3.5, 5.0, 0.0], ["2026-01", "NaturaleBio", "B06XQ5DCYJ", "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", 14.6075, 14.75, 1.0, 0.0], ["2026-01", "NaturaleBio", "B06XQ69YCQ", "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", 10.2225, 4.96, 4.0, 0.0], ["2026-01", "bioKontor", "B08XVX8V1T", "Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...", 11.9975, 3.08, 9.0, 0.0], ["2026-01", "VAHDAM", "B07K1WBH4K", "VAHDAM, Vanille Matcha Gr\u00fcner Tee Pulver (100g, 50...", 10.43, 2.74, 12.0, 0.0], ["2026-01", "Special Leaves", "B0DRP6Y6XC", "Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...", 10.39, 3.51, 15.0, 0.0], ["2026-01", "Ceremonial", "B0FSL3C3Z8", "Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...", 15.5575, 6.01, 7.0, 0.0], ["2026-01", "NORITUAL LAB", "B0FSL3C3Z8", "Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...", 15.5575, 6.01, 7.0, 0.0], ["2026-01", "NORITUAL LAB", "B0CNRX8G5S", "Ceremonial Matcha - Reines Matcha Pulver aus Japan...", 23.91, 14.01, 2.0, 0.0], ["2026-01", "Bio", "B08XVX8V1T", "Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...", 11.9975, 3.08, 9.0, 0.0], ["2026-01", "NaturaleBio", "B07SZFD3P9", "NaturaleBio Matcha Ceremonial Grade 100g. Original...", 30.27, 2.69, 0.0, 0.0], ["2026-01", "Matcha", "B0DRP6Y6XC", "Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...", 10.39, 3.51, 15.0, 0.0]], "insights": {"trend_global": "El parent ASIN muestra una tendencia negativa. Nuestros ASINs han disminuido sus clics en un 20.2% respecto a la semana anterior. La cuota de visibilidad (Click Share) cay\u00f3 en 0.32 puntos porcentuales.", "competitiveness": "En el panorama competitivo, la marca NaturaleBio ha mostrado el mayor dinamismo esta semana, capturando un crecimiento de 0.32% en cuota. Nuestra marca (NaturaleBio) se sit\u00faa con un 25.90% del mercado total en estas keywords.", "levers": "Al analizar las palancas: No se observa correlaci\u00f3n directa clara entre Deals activos y picos de cuota esta semana. El precio promedio se mantiene en torno a 19.91.", "efficiency": "En t\u00e9rminos de eficiencia (Rank vs Share), nuestros ASINs muestran un rendimiento alineado a su posici\u00f3n org\u00e1nica.", "recommendations": ["Revisar competitividad de precio en variantes top: Los competidores con mayor crecimiento est\u00e1n agresivos en precio.", "Optimizar Main Image: Para mejorar el CTR en posiciones org\u00e1nicas altas (Underperformance detectado en Scatter).", "Defender Brand Keywords: Asegurar que los competidores no roben tr\u00e1fico en b\u00fasquedas de marca."]}, "weeks": ["2025-52", "2026-01"], "brands": ["NaturaleBio", "NORITUAL LAB", "Ceremonial", "VAHDAM", "Others"]};

        // --- 2. GOOGLE CHARTS SETUP ---
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(initDashboard);

        function initDashboard() {
            drawCharts();
            populateText();
            initComparator();
        }

        function drawCharts() {
            // A. TREND COMBO CHART
            var trendData = google.visualization.arrayToDataTable([
                marketData.trend_header,
                ...marketData.trend_rows
            ]);

            var trendOptions = {
                vAxes: {0: {title: 'Est. Clicks'}, 1: {title: 'Click Share %', format: '#\'%\''}},
                hAxis: {title: 'Week'},
                seriesType: 'bars',
                series: {
                    0: {targetAxisIndex: 0, color: '#4285F4'}, // Our Clicks
                    1: {targetAxisIndex: 0, color: '#E0E0E0'}, // Comp Clicks
                    2: {type: 'line', targetAxisIndex: 1, color: '#1a73e8', lineWidth: 3}, // Our Share
                    3: {type: 'line', targetAxisIndex: 1, color: '#9e9e9e', lineDashStyle: [4, 4]} // Comp Share
                },
                legend: {position: 'bottom'},
                chartArea: {width: '80%', height: '70%'}
            };

            var trendChart = new google.visualization.ComboChart(document.getElementById('chart_trend'));
            trendChart.draw(trendData, trendOptions);

            // B. BRAND LINE CHART
            var brandData = google.visualization.arrayToDataTable([
                marketData.brand_header,
                ...marketData.brand_rows
            ]);

            var brandOptions = {
                curveType: 'function',
                legend: { position: 'bottom' },
                vAxis: {title: 'Click Share (%)'},
                series: {
                    0: {color: '#4285F4', lineWidth: 4}, // Us
                    1: {color: '#ea4335'}, // Comp 1
                    2: {color: '#fbbc04'}, // Comp 2
                    3: {color: '#34a853'}, // Comp 3
                    4: {color: '#999999', lineDashStyle: [2, 2]} // Rest
                },
                chartArea: {width: '85%', height: '70%'}
            };

            var brandChart = new google.visualization.LineChart(document.getElementById('chart_brand'));
            brandChart.draw(brandData, brandOptions);

            // C. SCATTER CHART (Efficiency)
            // Pre-process scatter data to replace color placeholder
            var processedScatter = marketData.scatter_rows.map(row => {
                var color = row[2].includes('4285F4') ? '#4285F4' : '#9e9e9e';
                return [row[0], row[1], 'point { fill-color: ' + color + ' }', row[3]];
            });

            var scatterData = new google.visualization.DataTable();
            scatterData.addColumn('number', 'Rank');
            scatterData.addColumn('number', 'Share');
            scatterData.addColumn({type: 'string', role: 'style'});
            scatterData.addColumn({type: 'string', role: 'tooltip'});
            scatterData.addRows(processedScatter);

            var scatterOptions = {
                hAxis: {title: 'Organic Rank (Lower is Better)', direction: 1}, // 1 -> 50
                vAxis: {title: 'Click Share (%)'},
                legend: 'none',
                chartArea: {width: '85%', height: '70%'},
                tooltip: {isHtml: false} // Native tooltips
            };

            var scatterChart = new google.visualization.ScatterChart(document.getElementById('chart_scatter'));
            scatterChart.draw(scatterData, scatterOptions);
        }

        // --- 3. TEXT INJECTION ---
        function populateText() {
            // Text Paragraphs
            document.getElementById('insight_trend').innerText = marketData.insights.trend_global;
            document.getElementById('insight_comp').innerText = marketData.insights.competitiveness;
            document.getElementById('insight_levers').innerText = marketData.insights.levers;
            
            // Last Week Share Metric
            const lastRow = marketData.trend_rows[marketData.trend_rows.length - 1];
            document.getElementById('metric_share').innerText = lastRow[3].toFixed(2) + '%';

            // Lists
            const ulInsights = document.getElementById('list_insights');
            const recsList = marketData.insights.recommendations || [];
            
            // Generate some dynamic additional insights based on data
            ulInsights.innerHTML = `
                <li class="positive"><span class="material-icons">trending_up</span> ${marketData.insights.efficiency}</li>
                <li><span class="material-icons">info</span> Analysis Period: ${marketData.weeks[0]} to ${marketData.weeks[marketData.weeks.length-1]}</li>
            `;

            const ulRecs = document.getElementById('list_recs');
            ulRecs.innerHTML = recsList.map(rec => `
                <li><span class="material-icons" style="color:var(--primary)">arrow_forward</span> ${rec}</li>
            `).join('');
        }

        // --- 4. INTERACTIVITY & TABS ---
        function switchTab(tabId) {
            document.querySelectorAll('.container').forEach(el => el.classList.add('hidden'));
            document.getElementById('tab-' + tabId).classList.remove('hidden');
            
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function initComparator() {
            // Fill Dropdowns
            const selWeek = document.getElementById('comp_week');
            marketData.weeks.forEach(w => {
                let opt = document.createElement('option');
                opt.value = w;
                opt.text = w;
                selWeek.add(opt);
            });
            selWeek.value = marketData.weeks[marketData.weeks.length - 1]; // Select last

            const selBrandUs = document.getElementById('comp_brand_us');
            let optUs = document.createElement('option');
            optUs.value = marketData.brands[0];
            optUs.text = marketData.brands[0];
            selBrandUs.add(optUs);

            const selBrandThem = document.getElementById('comp_brand_them');
            marketData.brands.slice(1).forEach(b => { // Skip Our Brand
                if (b === 'Others') return;
                let opt = document.createElement('option');
                opt.value = b;
                opt.text = b;
                selBrandThem.add(opt);
            });

            // Listeners
            [selWeek, selBrandThem].forEach(el => el.addEventListener('change', updateComparator));

            updateComparator();
        }

        function updateComparator() {
            const week = document.getElementById('comp_week').value;
            const usBrand = document.getElementById('comp_brand_us').value;
            const themBrand = document.getElementById('comp_brand_them').value;

            // Filter Raw Data: [Week, Brand, ASIN, Title, Price, Share, Rank, Deals]
            // We want average metrics for the brand in that week
            const getMetrics = (br) => {
                const rows = marketData.raw_data.filter(r => r[0] === week && r[1] === br);
                if (rows.length === 0) return null;

                let sumShare = 0, sumPrice = 0, sumRank = 0, sumDeals = 0;
                rows.forEach(r => {
                    sumShare += r[5];
                    sumPrice += r[4];
                    sumRank += (r[6] || 50); // Fallback rank
                    sumDeals += r[7];
                });
                
                return {
                    share: sumShare.toFixed(2),
                    price: (sumPrice / rows.length).toFixed(2),
                    rank: Math.round(sumRank / rows.length),
                    deals: sumDeals > 0 ? "Active Deals" : "No Deals",
                    title: rows[0][3].substring(0, 40) + "..." // Sample title
                };
            };

            const usM = getMetrics(usBrand);
            const themM = getMetrics(themBrand);

            // Update DOM
            if (usM) {
                document.getElementById('vs_share_us').innerText = usM.share + '%';
                document.getElementById('vs_price_us').innerText = '€' + usM.price;
                document.getElementById('vs_rank_us').innerText = '#' + usM.rank;
                document.getElementById('vs_title_us').innerText = usM.title;
            } else {
                document.getElementById('vs_share_us').innerText = '-';
            }

            if (themM) {
                document.getElementById('vs_share_them').innerText = themM.share + '%';
                document.getElementById('vs_price_them').innerText = '€' + themM.price;
                document.getElementById('vs_rank_them').innerText = '#' + themM.rank;
                document.getElementById('vs_title_them').innerText = themM.title;
                document.getElementById('vs_deals').innerText = `Us: ${usM ? usM.deals : '-'} vs Them: ${themM.deals}`;
            } else {
                 document.getElementById('vs_share_them').innerText = 'N/A';
                 document.getElementById('vs_title_them').innerText = 'No data for this week';
            }
        }
    </script>
</body>
</html>