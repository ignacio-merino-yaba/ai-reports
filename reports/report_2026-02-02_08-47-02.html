<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Parent ASIN Analysis: Matcha Premium</title>
    
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Google Charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
        :root {
            --primary: #4285F4; /* Google Blue */
            --success: #34A853; /* Google Green */
            --warning: #FBBC05; /* Google Yellow */
            --danger: #EA4335;  /* Google Red */
            --bg: #F5F5F7;
            --card-bg: #FFFFFF;
            --text-main: #1D1D1F;
            --text-sec: #86868B;
            --border: #E5E5E5;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            line-height: 1.5;
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--card-bg);
            padding: 24px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { font-size: 24px; font-weight: 600; margin: 0; }
        .subtitle { color: var(--text-sec); font-size: 14px; margin-top: 4px; }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 20px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }
        
        .tab-btn {
            background: none;
            border: none;
            padding: 12px 0;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-sec);
            cursor: pointer;
            position: relative;
            transition: color 0.2s;
        }
        
        .tab-btn.active {
            color: var(--primary);
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary);
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.02);
            margin-bottom: 24px;
            border: 1px solid var(--border);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .metric-box {
            background: #Fbfbfd;
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border);
        }
        
        .metric-label { font-size: 12px; color: var(--text-sec); margin-bottom: 4px; }
        .metric-value { font-size: 24px; font-weight: 700; color: var(--text-main); }
        .metric-delta { font-size: 12px; font-weight: 500; margin-left: 8px; }
        .delta-pos { color: var(--success); }
        .delta-neg { color: var(--danger); }

        /* Charts */
        .chart-container {
            width: 100%;
            height: 350px;
        }

        /* Insights Section */
        .insights-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }
        
        .insight-item {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .insight-icon {
            color: var(--primary);
        }
        
        .insight-text h4 { margin: 0 0 4px 0; font-size: 14px; font-weight: 600; }
        .insight-text p { margin: 0; font-size: 13px; color: var(--text-sec); }

        /* Comparator Controls */
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }
        
        select {
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: white;
            font-family: inherit;
            font-size: 14px;
            outline: none;
        }

        /* Utility */
        .hidden { display: none; }
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
        }
        .badge-our { background: #E8F0FE; color: var(--primary); }
        .badge-comp { background: #FCE8E6; color: var(--danger); }

        /* Section Layout */
        .section-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }
        @media (max-width: 768px) {
            .section-row, .insights-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <header>
        <div class="header-content">
            <div>
                <h1>Parent ASIN Analytics Report</h1>
                <div class="subtitle">Matcha Premium | Market Snapshot (Jan 2026)</div>
            </div>
            <div style="text-align: right;">
                <span class="badge badge-our" style="font-size: 12px; padding: 6px 12px;">NaturaleBio (Our Brand)</span>
            </div>
        </div>
    </header>

    <div class="container">
        
        <!-- Navigation -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('static')">1. Reporte Estático & Estratégico</button>
            <button class="tab-btn" onclick="switchTab('interactive')">2. Comparador Interactivo</button>
        </div>

        <!-- TAB 1: STATIC REPORT -->
        <div id="tab-static">
            
            <!-- Section 1: Global Trend -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><span class="material-icons">trending_up</span> Tendencia Global del Parent</div>
                </div>
                <div class="metrics-grid">
                    <div class="metric-box">
                        <div class="metric-label">Total Clicks (Wk)</div>
                        <div class="metric-value" id="total-clicks">-</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-label">Our Share %</div>
                        <div class="metric-value" id="our-share">-</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-label">Top Competitor Share</div>
                        <div class="metric-value" id="comp-share">-</div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-label">Avg Price (Us vs Them)</div>
                        <div class="metric-value" id="price-diff">-</div>
                    </div>
                </div>
                <div id="chart_trend" class="chart-container"></div>
                <div style="margin-top:16px; font-size:12px; color:#666; font-style:italic;">
                    *Nota: El dataset contiene 1 semana de datos. La tendencia se muestra como snapshot actual.
                </div>
            </div>

            <!-- Section 2: Brand Competitiveness -->
            <div class="section-row">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><span class="material-icons">pie_chart</span> Competitividad de Marca (Click Share)</div>
                    </div>
                    <div id="chart_share" class="chart-container"></div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><span class="material-icons">leaderboard</span> Top 3 Competidores</div>
                    </div>
                    <div id="top_competitors_list">
                        <!-- Filled by JS -->
                    </div>
                </div>
            </div>

            <!-- Section 3 & 4: Efficiency & Levers -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><span class="material-icons">scatter_plot</span> Eficiencia: Organic Rank vs Click Share</div>
                </div>
                <div id="chart_scatter" class="chart-container"></div>
                <p style="font-size: 13px; color: var(--text-sec); margin-top: 10px;">
                    <strong>Lectura:</strong> Los puntos arriba a la izquierda (Rank bajo, Share alto) son "Sobreperformers". 
                    Los puntos azules son nuestros ASINs.
                </p>
            </div>

            <!-- Section 5: Insights & Actions -->
            <div class="card" style="border-left: 4px solid var(--primary);">
                <div class="card-header">
                    <div class="card-title"><span class="material-icons">lightbulb</span> Conclusiones Clave y Recomendaciones</div>
                </div>
                <div class="insights-grid">
                    <div>
                        <h3 style="font-size:14px; text-transform:uppercase; color:var(--text-sec); margin-bottom:16px;">Insights (Diagnóstico)</h3>
                        <div id="insights-container">
                            <!-- Injected by JS -->
                        </div>
                    </div>
                    <div>
                        <h3 style="font-size:14px; text-transform:uppercase; color:var(--text-sec); margin-bottom:16px;">Recomendaciones Accionables</h3>
                        <div id="actions-container">
                            <!-- Injected by JS -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Section 6: Other Insights -->
            <div class="card">
                 <div class="card-header">
                    <div class="card-title"><span class="material-icons">visibility</span> Other Insights</div>
                </div>
                <p style="font-size:14px; color:var(--text-main);">
                    <strong>Anomalía de Precio:</strong> Existe una bifurcación clara en el mercado. Un segmento de bajo precio (~€10-15) dominado por <em>NaturaleBio</em>, y un segmento Premium (~€24) dominado por <em>NORITUAL LAB</em>.
                    Curiosamente, el segmento Premium está capturando una cuota masiva (20%+) a pesar del precio, impulsado fuertemente por Cupones activos.
                </p>
            </div>

        </div>

        <!-- TAB 2: INTERACTIVE COMPARATOR -->
        <div id="tab-interactive" class="hidden">
            <div class="controls">
                <select id="week-selector" onchange="updateComparator()">
                    <option value="2026-01">Semana: 2026-01</option>
                </select>
                <select id="competitor-selector" onchange="updateComparator()">
                    <!-- Options populated by JS -->
                </select>
            </div>

            <div class="metrics-grid">
                <div class="metric-box">
                    <div class="metric-label">Diferencial de Precio</div>
                    <div class="metric-value" id="comp-price-diff">0%</div>
                    <div class="metric-label" style="margin-top:4px;">Nosotros vs Ellos</div>
                </div>
                <div class="metric-box">
                    <div class="metric-label">Share Gap</div>
                    <div class="metric-value" id="comp-share-gap">0%</div>
                </div>
                <div class="metric-box">
                    <div class="metric-label">Rank Gap</div>
                    <div class="metric-value" id="comp-rank-gap">0</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">Cara a Cara: Métricas Clave</div>
                </div>
                <div id="chart_comparator" class="chart-container"></div>
            </div>
        </div>

    </div>

    <!-- DATA INJECTION & LOGIC -->
    <script type="text/javascript">
        // 1. DATASET
        // Injected from Python processing
        const marketData = [{"week_date": "2026-01", "real_brand": "VAHDAM", "asin": "B07MD4LB49", "product_title": "VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A...", "clicks": 1049.661345, "click_share": 3.79, "average_organic_rank": 8.0, "price": 10.43, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_coupon": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "is_our_brand": false, "grams": 0, "organic_or_not": 0}, {"week_date": "2026-01", "real_brand": "bioKontor", "asin": "B08XVX8V1T", "product_title": "Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...", "clicks": 853.02294, "click_share": 3.08, "average_organic_rank": 9.0, "price": 11.9975, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_coupon": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "is_our_brand": false, "grams": 0, "organic_or_not": 0}, {"week_date": "2026-01", "real_brand": "bioKontor", "asin": "B08XVX8V1T", "product_title": "Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...", "clicks": 853.02294, "click_share": 3.08, "average_organic_rank": 9.0, "price": 11.9975, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_coupon": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "is_our_brand": false, "grams": 0, "organic_or_not": 0}, {"week_date": "2026-01", "real_brand": "NaturaleBio", "asin": "B079VQ52MK", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "clicks": 969.34425, "click_share": 3.5, "average_organic_rank": 5.0, "price": 24.5275, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_coupon": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "is_our_brand": true, "grams": 0, "organic_or_not": 0}, {"week_date": "2026-01", "real_brand": "NORITUAL", "asin": "B0CNRX8G5S", "product_title": "Ceremonial Matcha - Reines Matcha Pulver aus Japan...", "clicks": 3880.146555, "click_share": 14.01, "average_organic_rank": 2.0, "price": 23.91, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_coupon": 4.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "is_our_brand": false, "grams": 0, "organic_or_not": 0}, {"week_date": "2026-01", "real_brand": "Ceremonial", "asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...", "clicks": 1664.502555, "click_share": 6.01, "average_organic_rank": 7.0, "price": 15.5575, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_coupon": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "is_our_brand": false, "grams": 0, "organic_or_not": 0}, {"week_date": "2026-01", "real_brand": "NORITUAL", "asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...", "clicks": 1664.502555, "click_share": 6.01, "average_organic_rank": 7.0, "price": 15.5575, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_coupon": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "is_our_brand": false, "grams": 0, "organic_or_not": 0}, {"week_date": "2026-01", "real_brand": "NaturaleBio", "asin": "B07SZFD3P9", "product_title": "NaturaleBio Matcha Ceremonial Grade 100g. Original...", "clicks": 745.010295, "click_share": 2.69, "average_organic_rank": 0.0, "price": 30.27, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_coupon": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "is_our_brand": true, "grams": 0, "organic_or_not": 0}, {"week_date": "2026-01", "real_brand": "VAHDAM", "asin": "B07K1WBH4K", "product_title": "VAHDAM, Vanille Matcha Gr\u00fcner Tee Pulver (100g, 50...", "clicks": 758.85807, "click_share": 2.74, "average_organic_rank": 12.0, "price": 10.43, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_coupon": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "is_our_brand": false, "grams": 0, "organic_or_not": 0}, {"week_date": "2026-01", "real_brand": "NaturaleBio", "asin": "B06XQ5DCYJ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "clicks": 4085.093625, "click_share": 14.75, "average_organic_rank": 1.0, "price": 14.6075, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_coupon": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "is_our_brand": true, "grams": 0, "organic_or_not": 0}, {"week_date": "2026-01", "real_brand": "Special", "asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...", "clicks": 972.113805, "click_share": 3.51, "average_organic_rank": 15.0, "price": 10.39, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_coupon": 4.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "is_our_brand": false, "grams": 0, "organic_or_not": 0}, {"week_date": "2026-01", "real_brand": "Matcha", "asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...", "clicks": 972.113805, "click_share": 3.51, "average_organic_rank": 15.0, "price": 10.39, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_coupon": 4.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "is_our_brand": false, "grams": 0, "organic_or_not": 0}, {"week_date": "2026-01", "real_brand": "NaturaleBio", "asin": "B06XQ69YCQ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "clicks": 1373.69928, "click_share": 4.96, "average_organic_rank": 4.0, "price": 10.2225, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_coupon": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "is_our_brand": true, "grams": 0, "organic_or_not": 0}];

        // 2. CONFIG
        google.charts.load('current', {'packages':['corechart', 'bar']});
        google.charts.setOnLoadCallback(initDashboard);

        let ourBrandName = "NaturaleBio"; // Derived from data
        let topCompetitors = [];

        // 3. LOGIC
        function initDashboard() {
            processData();
            renderStaticMetrics();
            drawTrendChart();
            drawShareChart();
            drawScatterChart();
            renderInsights();
            populateCompetitorSelect();
        }

        function processData() {
            // Identify top competitors by click share sum
            const brandShares = {};
            marketData.forEach(d => {
                if (!d.is_our_brand && d.real_brand !== 'Matcha' && d.real_brand !== 'Ceremonial' && d.real_brand !== 'Unknown Brand') {
                    brandShares[d.real_brand] = (brandShares[d.real_brand] || 0) + d.click_share;
                }
            });
            topCompetitors = Object.entries(brandShares)
                .sort((a,b) => b[1] - a[1])
                .slice(0, 3)
                .map(e => e[0]);
            
            // Render Top Competitors List
            const compContainer = document.getElementById('top_competitors_list');
            compContainer.innerHTML = topCompetitors.map((c, i) => `
                <div style="display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid #eee;">
                    <span><span style="font-weight:bold; color:#666;">#${i+1}</span> ${c}</span>
                </div>
            `).join('');
        }

        function renderStaticMetrics() {
            // Aggregates for 2026-01
            const ourData = marketData.filter(d => d.is_our_brand);
            const compData = marketData.filter(d => !d.is_our_brand);

            const totalClicks = marketData.reduce((acc, curr) => acc + curr.clicks, 0);
            const ourClicks = ourData.reduce((acc, curr) => acc + curr.clicks, 0);
            const ourShare = (ourClicks / totalClicks * 100).toFixed(1) + '%';
            
            // Calc avg price
            const avgPriceOur = ourData.reduce((acc, c) => acc + c.price, 0) / ourData.length;
            const avgPriceComp = compData.reduce((acc, c) => acc + c.price, 0) / compData.length;

            document.getElementById('total-clicks').innerText = Math.round(totalClicks).toLocaleString();
            document.getElementById('our-share').innerText = ourShare;
            document.getElementById('comp-share').innerText = topCompetitors[0] + " Leading";
            document.getElementById('price-diff').innerText = `€${avgPriceOur.toFixed(2)} vs €${avgPriceComp.toFixed(2)}`;
        }

        // --- CHARTS ---

        function drawTrendChart() {
            // Aggregate by Brand Type (Us vs Them)
            const data = google.visualization.arrayToDataTable([
                ['Metric', 'Total Clicks', 'Our Share %'],
                ['Jan W1', 27695, 25.9] // Hardcoded based on single week sum for visualization demo
            ]);

            const options = {
                seriesType: 'bars',
                series: {1: {type: 'line', targetAxisIndex: 1}},
                vAxes: {0: {title: 'Clicks'}, 1: {title: 'Share %', format: '#\'%\''}},
                colors: ['#E0E0E0', '#4285F4'],
                legend: {position: 'bottom'},
                chartArea: {width: '80%', height: '70%'}
            };

            const chart = new google.visualization.ComboChart(document.getElementById('chart_trend'));
            chart.draw(data, options);
        }

        function drawShareChart() {
            // Since we have 1 week, we'll show a bar chart of Brand Share Breakdown
            const dataArr = [['Brand', 'Click Share', { role: 'style' }]];
            
            // Aggregate shares
            const shares = {};
            marketData.forEach(d => {
                const b = d.is_our_brand ? ourBrandName : (topCompetitors.includes(d.real_brand) ? d.real_brand : 'Others');
                shares[b] = (shares[b] || 0) + d.click_share;
            });

            // Sort
            Object.keys(shares).forEach(k => {
                const color = k === ourBrandName ? '#4285F4' : '#9E9E9E';
                dataArr.push([k, shares[k], color]);
            });

            const data = google.visualization.arrayToDataTable(dataArr);
            const options = {
                title: 'Market Share Distribution (This Week)',
                legend: 'none',
                hAxis: { title: 'Share %' },
                chartArea: {width: '70%', height: '80%'}
            };

            const chart = new google.visualization.BarChart(document.getElementById('chart_share'));
            chart.draw(data, options);
        }

        function drawScatterChart() {
            const data = new google.visualization.DataTable();
            data.addColumn('number', 'Organic Rank');
            data.addColumn('number', 'Click Share');
            data.addColumn({type: 'string', role: 'style'});
            data.addColumn({type: 'string', role: 'tooltip'});

            marketData.forEach(d => {
                if(d.average_organic_rank > 0) { // Filter out unranked
                    const color = d.is_our_brand ? 'point { fill-color: #4285F4; size: 6; }' : 'point { fill-color: #EA4335; size: 4; }';
                    const tooltip = `${d.real_brand} \nRank: ${d.average_organic_rank} \nShare: ${d.click_share}% \nPrice: €${d.price}`;
                    data.addRow([d.average_organic_rank, d.click_share, color, tooltip]);
                }
            });

            const options = {
                title: 'Efficiency: Rank vs Click Share',
                hAxis: {title: 'Organic Rank (Lower is Better)', direction: 1}, // 1 -> 15
                vAxis: {title: 'Click Share %'},
                legend: 'none',
                chartArea: {width: '85%', height: '80%'}
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('chart_scatter'));
            chart.draw(data, options);
        }

        // --- INSIGHTS ---

        function renderInsights() {
            const insights = [
                {icon: 'trending_up', title: 'Dominio de Mercado', text: 'NaturaleBio lidera la categoría con un Share agregado de ~26%. Sin embargo, la competencia está muy fragmentada.'},
                {icon: 'warning', title: 'Amenaza Principal: NORITUAL', text: 'NORITUAL LAB es el competidor más peligroso (20% share estimado) logrando alta conversión con un precio Premium (€23.91).'},
                {icon: 'local_offer', title: 'Impacto de Cupones', text: 'El éxito de NORITUAL se correlaciona con el uso agresivo de Cupones (4 días activos). NaturaleBio no activó promociones.'},
                {icon: 'stars', title: 'Producto Estrella', text: 'Nuestro ASIN B06XQ5DCYJ es el líder absoluto en Eficiencia (Rank #1, Share 14.75%).'},
                {icon: 'attach_money', title: 'Polarización de Precios', text: 'Competimos bien en el segmento de entrada (€10-14), pero perdemos el segmento Premium ante NORITUAL.'}
            ];

            const actions = [
                'Activar cupones en el ASIN Premium (B07SZFD3P9) para combatir a NORITUAL.',
                'Defender la posición #1 del ASIN estrella manteniendo el precio competitivo actual.',
                'Optimizar el listing de B06XQ69YCQ (Rank 4) para capturar más tráfico del segmento bajo precio.'
            ];

            document.getElementById('insights-container').innerHTML = insights.map(i => `
                <div class="insight-item">
                    <div class="insight-icon"><span class="material-icons">${i.icon}</span></div>
                    <div class="insight-text">
                        <h4>${i.title}</h4>
                        <p>${i.text}</p>
                    </div>
                </div>
            `).join('');

            document.getElementById('actions-container').innerHTML = actions.map(a => `
                <div style="background: #E8F0FE; padding: 10px; border-radius: 8px; margin-bottom: 8px; color: #1967D2; font-size: 13px; font-weight: 500;">
                    ${a}
                </div>
            `).join('');
        }

        // --- INTERACTIVITY ---

        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('tab-static').classList.add('hidden');
            document.getElementById('tab-interactive').classList.add('hidden');
            
            document.getElementById('tab-' + tabId).classList.remove('hidden');

            if(tabId === 'interactive') {
                updateComparator();
            }
        }

        function populateCompetitorSelect() {
            const sel = document.getElementById('competitor-selector');
            topCompetitors.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.innerText = "Vs. " + c;
                sel.appendChild(opt);
            });
        }

        function updateComparator() {
            const compName = document.getElementById('competitor-selector').value || topCompetitors[0];
            
            // Filter Data
            const ourData = marketData.filter(d => d.is_our_brand);
            const compData = marketData.filter(d => d.real_brand === compName);

            // Calculate Metrics
            const avgPriceOur = ourData.reduce((a,c) => a + c.price, 0) / (ourData.length || 1);
            const avgPriceComp = compData.reduce((a,c) => a + c.price, 0) / (compData.length || 1);
            const priceDiff = ((avgPriceOur - avgPriceComp) / avgPriceComp * 100).toFixed(1);

            const shareOur = ourData.reduce((a,c) => a + c.click_share, 0);
            const shareComp = compData.reduce((a,c) => a + c.click_share, 0);

            // Update DOM
            const diffEl = document.getElementById('comp-price-diff');
            diffEl.innerText = (priceDiff > 0 ? '+' : '') + priceDiff + '%';
            diffEl.className = 'metric-value ' + (priceDiff > 0 ? 'delta-neg' : 'delta-pos'); // High price usually bad for volume unless premium

            document.getElementById('comp-share-gap').innerText = (shareOur - shareComp).toFixed(1) + '%';
            
            // Draw Comparison Chart
            const data = google.visualization.arrayToDataTable([
                ['Metric', 'NaturaleBio', compName],
                ['Price (€)', avgPriceOur, avgPriceComp],
                ['Share (%)', shareOur, shareComp]
            ]);

            const options = {
                title: 'Comparativa Directa',
                bars: 'horizontal',
                colors: ['#4285F4', '#EA4335']
            };

            const chart = new google.visualization.BarChart(document.getElementById('chart_comparator'));
            chart.draw(data, options);
        }

    </script>
</body>
</html>