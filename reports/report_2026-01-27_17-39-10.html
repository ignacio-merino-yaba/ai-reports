<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Intelligence: NaturaleBio Psyllium</title>
    
    <!-- Google Charts -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #4285F4; /* Google Blue */
            --success: #34A853; /* Google Green */
            --warning: #FBBC05; /* Google Yellow */
            --danger: #EA4335;  /* Google Red */
            --gray-50: #F8F9FA;
            --gray-100: #F1F3F4;
            --gray-200: #E8EAED;
            --gray-600: #5F6368;
            --gray-800: #202124;
            --shadow: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
            --card-radius: 16px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--gray-50);
            color: var(--gray-800);
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin: 0;
            color: var(--gray-800);
        }

        .badge {
            background-color: #E8F0FE;
            color: var(--primary);
            padding: 6px 12px;
            border-radius: 99px;
            font-size: 13px;
            font-weight: 500;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--gray-200);
            padding-bottom: 12px;
        }

        .tab-btn {
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-600);
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .tab-btn.active {
            color: var(--primary);
            background-color: #E8F0FE;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: var(--card-radius);
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .metric-box {
            background: var(--gray-50);
            padding: 16px;
            border-radius: 12px;
            text-align: center;
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-800);
        }

        .metric-label {
            font-size: 12px;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        .chart-container {
            width: 100%;
            height: 350px;
        }

        /* Insights Section */
        .insights-section {
            background: white;
            border-radius: var(--card-radius);
            padding: 24px;
            border-left: 6px solid var(--primary);
            box-shadow: var(--shadow);
        }

        .insight-item {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .insight-icon {
            color: var(--primary);
        }

        .rec-section {
            margin-top: 24px;
            border-top: 1px solid var(--gray-200);
            padding-top: 24px;
        }

        .rec-item {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            align-items: flex-start;
        }

        .rec-check {
            color: var(--success);
        }

        /* Interactive Tool */
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            background: white;
            padding: 16px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            align-items: center;
        }

        select {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            min-width: 200px;
            background-color: var(--gray-50);
        }

        .vs-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 24px;
            align-items: center;
        }

        .vs-badge {
            background: var(--gray-800);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .product-card {
            text-align: center;
            padding: 24px;
            border: 1px solid var(--gray-200);
            border-radius: 16px;
        }
        
        .product-card.winner {
            border: 2px solid var(--success);
            background-color: #F6FFED;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div>
            <h1>Market Intelligence Report</h1>
            <p style="margin: 4px 0 0 0; color: var(--gray-600);">Parent ASIN: Psyllium | Country: UK</p>
        </div>
        <span class="badge">Last Updated: 2026-01-03</span>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('static')">üìä Executive Report</button>
        <button class="tab-btn" onclick="switchTab('interactive')">‚öîÔ∏è Competitor Lab</button>
    </div>

    <!-- TAB 1: STATIC REPORT -->
    <div id="static-tab">
        
        <!-- 1. Global Trend -->
        <div class="card">
            <div class="card-title">
                <span class="material-icons">trending_up</span>
                1. Global Trend & Market Share
            </div>
            <p style="font-size: 14px; color: var(--gray-600); margin-bottom: 16px;">
                Evolution of total market volume (bars) vs. NaturaleBio's click share (line).
            </p>
            <div id="trend_chart" class="chart-container"></div>
        </div>

        <!-- 2. Competitiveness -->
        <div class="card">
            <div class="card-title">
                <span class="material-icons">pie_chart</span>
                2. Brand Competitiveness
            </div>
            <p style="font-size: 14px; color: var(--gray-600); margin-bottom: 16px;">
                Click Share History: NaturaleBio vs. Top 3 Competitors.
            </p>
            <div id="comp_chart" class="chart-container"></div>
        </div>

        <!-- 3. Efficiency & Levers -->
        <div class="card">
            <div class="card-title">
                <span class="material-icons">speed</span>
                3. Efficiency Matrix (Rank vs. Share)
            </div>
            <p style="font-size: 14px; color: var(--gray-600); margin-bottom: 16px;">
                Identifies Overperformers (High Share, Low Rank) and Underperformers.
            </p>
            <div id="efficiency_chart" class="chart-container"></div>
        </div>

        <!-- 4. Insights & Recommendations -->
        <div class="insights-section">
            <div class="card-title" style="color: var(--primary);">
                <span class="material-icons">lightbulb</span>
                5. Key Conclusions & Actions
            </div>
            
            <div style="margin-top: 20px;">
                <h3 style="font-size: 16px; margin-bottom: 16px;">üí° Strategic Insights</h3>
                
                <div class="insight-item">
                    <span class="material-icons insight-icon">show_chart</span>
                    <div>
                        <strong>Explosive Seasonal Spike (Week 01):</strong>
                        Total category clicks surged nearly 5x (from ~1.2k to ~5.4k) entering the new year. This "New Year Resolution" effect is massive for the Psyllium category.
                    </div>
                </div>

                <div class="insight-item">
                    <span class="material-icons insight-icon">check_circle</span>
                    <div>
                        <strong>NaturaleBio Captures Growth:</strong>
                        Our ASIN successfully rode this wave, maintaining and slightly growing share (22.7% ‚Üí 23.3%) despite the flood of traffic. We are not losing visibility.
                    </div>
                </div>

                <div class="insight-item">
                    <span class="material-icons insight-icon">sell</span>
                    <div>
                        <strong>Aggressive Price Leadership:</strong>
                        At ¬£8.89, NaturaleBio is significantly undercutting the market average (¬£10.95) and key rivals like Natural Health 4 Life (¬£17.62). This is a primary driver of our high click efficiency.
                    </div>
                </div>

                <div class="insight-item">
                    <span class="material-icons insight-icon">warning</span>
                    <div>
                        <strong>Threat from "Natural Health 4 Life":</strong>
                        Despite a higher price, this competitor holds significant share (~12%). Their organic rank is consistently strong, suggesting high brand equity or repeat purchase behavior we lack.
                    </div>
                </div>

                <div class="insight-item">
                    <span class="material-icons insight-icon">search</span>
                    <div>
                        <strong>Efficiency Anomaly:</strong>
                        We are achieving #1 Click Share despite an average organic rank of ~2. This indicates our listing (Title/Image/Price) is converting impressions to clicks extremely well (Overperformer).
                    </div>
                </div>
            </div>

            <div class="rec-section">
                <h3 style="font-size: 16px; margin-bottom: 16px;">üöÄ Actionable Recommendations</h3>
                
                <div class="rec-item">
                    <span class="material-icons rec-check">done_all</span>
                    <div>
                        <strong>Defend Inventory Immediately:</strong>
                        With the 5x volume spike in Week 01, stockout risk is critical. Verify inventory depth for Q1 immediately to avoid losing the Buy Box during peak seasonality.
                    </div>
                </div>

                <div class="rec-item">
                    <span class="material-icons rec-check">done_all</span>
                    <div>
                        <strong>Test Slight Price Increase:</strong>
                        Since we are ¬£2.00+ below market average and have high efficiency, we likely have elasticity. Test increasing to ¬£9.49 to capture margin without sacrificing significant rank.
                    </div>
                </div>

                <div class="rec-item">
                    <span class="material-icons rec-check">done_all</span>
                    <div>
                        <strong>Target "Natural Health 4 Life" Keywords:</strong>
                        Use Sponsored Product ads targeting their ASINs. We have a massive price advantage (¬£8.89 vs ¬£17.62) and can steal their price-sensitive traffic easily.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB 2: INTERACTIVE LAB -->
    <div id="interactive-tab" class="hidden">
        <div class="controls">
            <div>
                <label style="font-size: 12px; display: block; margin-bottom: 4px;">Select Week</label>
                <select id="weekSelector" onchange="updateInteractive()">
                    <!-- Populated by JS -->
                </select>
            </div>
            <div>
                <label style="font-size: 12px; display: block; margin-bottom: 4px;">Compare Against</label>
                <select id="compSelector" onchange="updateInteractive()">
                    <!-- Populated by JS -->
                </select>
            </div>
        </div>

        <div class="vs-grid">
            <!-- Our ASIN -->
            <div class="product-card winner" style="background-color: #E8F0FE; border-color: var(--primary);">
                <h3 style="color: var(--primary);">NaturaleBio (Us)</h3>
                <div style="font-size: 32px; font-weight: 700; margin: 16px 0;" id="our-share">--%</div>
                <p style="color: var(--gray-600); font-size: 14px;">Click Share</p>
                
                <hr style="border: 0; border-top: 1px solid rgba(0,0,0,0.1); margin: 16px 0;">
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>Price</span>
                    <strong id="our-price">--</strong>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>Org Rank</span>
                    <strong id="our-rank">--</strong>
                </div>
                 <div style="display: flex; justify-content: space-between;">
                    <span>Deals Active</span>
                    <strong id="our-deals">--</strong>
                </div>
            </div>

            <div class="vs-badge">VS</div>

            <!-- Competitor -->
            <div class="product-card" id="comp-card">
                <h3 id="comp-name">Competitor</h3>
                <div style="font-size: 32px; font-weight: 700; margin: 16px 0;" id="comp-share">--%</div>
                <p style="color: var(--gray-600); font-size: 14px;">Click Share</p>
                
                <hr style="border: 0; border-top: 1px solid rgba(0,0,0,0.1); margin: 16px 0;">
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>Price</span>
                    <strong id="comp-price">--</strong>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>Org Rank</span>
                    <strong id="comp-rank">--</strong>
                </div>
                 <div style="display: flex; justify-content: space-between;">
                    <span>Deals Active</span>
                    <strong id="comp-deals">--</strong>
                </div>
            </div>
        </div>

        <div style="margin-top: 32px;">
            <div class="card">
                <div class="card-title">Detailed Comparison Chart</div>
                <div id="vs_chart" class="chart-container"></div>
            </div>
        </div>
    </div>

</div>

<script>
    // ------------------------------------------------------------------
    // 1. DATA INJECTION
    // ------------------------------------------------------------------
    const marketData = [{"week_str":"2025-W52","real_brand":"NaturaleBio","is_yaba_asin":"Y","clicks":335.36753,"click_share":22.7,"average_organic_rank":2.0,"price":8.89,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":0,"product_title":"NaturaleBio Organic Psyllium Husk - 99% Purity - 2..."},{"week_str":"2025-W52","real_brand":"NEW LEAF PRODUCTS","is_yaba_asin":"N","clicks":197.231565,"click_share":13.35,"average_organic_rank":3.0,"price":13.29,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"product_title":"Fibre Supplement 4000mg Psyllium Husk with Acidoph..."},{"week_str":"2025-W52","real_brand":"Natural Health 4 Life","is_yaba_asin":"N","clicks":174.479759,"click_share":11.81,"average_organic_rank":6.0,"price":17.49,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"product_title":"Natural Health 4 Life Vegetable Fibre Psyllium Hus..."},{"week_str":"2025-W52","real_brand":"WeightWorld","is_yaba_asin":"N","clicks":136.067619,"click_share":9.21,"average_organic_rank":7.0,"price":11.678571429,"weekly_number_of_days_with_deal":1,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"product_title":"WeightWorld Organic Psyllium Husk Capsules | 1400m..."},{"week_str":"2025-W52","real_brand":"NKD Living","is_yaba_asin":"N","clicks":135.476663,"click_share":9.17,"average_organic_rank":3.0,"price":9.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"product_title":"NKD Living Psyllium Husk Powder (500g) | Tested fo..."},{"week_str":"2025-W52","real_brand":"NKD Living","is_yaba_asin":"N","clicks":53.924735,"click_share":3.65,"average_organic_rank":4.0,"price":9.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"product_title":"NKD Living Whole Psyllium husks (500g)"},{"week_str":"2025-W52","real_brand":"Solgar","is_yaba_asin":"N","clicks":50.969955,"click_share":3.45,"average_organic_rank":11.0,"price":14.261428571,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":4,"product_title":"Solgar Psyllium Husks Fibre 500 Mg Vegetable Capsu..."},{"week_str":"2025-W52","real_brand":"The Worldwide Mint","is_yaba_asin":"N","clicks":63.970987,"click_share":4.33,"average_organic_rank":17.0,"price":5.45,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"product_title":"Psyllium Husk Powder 200g | 100% Pure & Natural | ..."},{"week_str":"2025-W52","real_brand":"REBIRTH WELLNESS BE YOURSELF | ONLY BETTER","is_yaba_asin":"N","clicks":26.59302,"click_share":1.8,"average_organic_rank":18.0,"price":9.95,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"product_title":"Psyllium Husk Fibre Supplement 4000mg with Probiot..."},{"week_str":"2025-W52","real_brand":"Wholefood Earth","is_yaba_asin":"N","clicks":18.171897,"click_share":1.23,"average_organic_rank":19.0,"price":8.881428571,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":5,"product_title":"Wholefood Earth Organic Psyllium Husk Powder 250g ..."},{"week_str":"2026-W01","real_brand":"NaturaleBio","is_yaba_asin":"Y","clicks":1581.901176,"click_share":23.34,"average_organic_rank":2.0,"price":8.89,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":4,"weekly_number_of_days_with_coupon":0,"product_title":"NaturaleBio Organic Psyllium Husk - 99% Purity - 2..."},{"week_str":"2026-W01","real_brand":"Unknown Brand","is_yaba_asin":"N","clicks":121.99752,"click_share":1.8,"average_organic_rank":21.0,"price":9.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"product_title":"Vinco Fibre Supplement 5000mg Psyllium Husk with A..."},{"week_str":"2026-W01","real_brand":"Horb√§ach","is_yaba_asin":"N","clicks":80.653916,"click_share":1.19,"average_organic_rank":12.0,"price":7.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"product_title":"Psyllium Husk Capsules 5000mg with Acidophilus | N..."},{"week_str":"2026-W01","real_brand":"NEW LEAF PRODUCTS","is_yaba_asin":"N","clicks":658.108844,"click_share":9.71,"average_organic_rank":3.0,"price":13.29,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"product_title":"Fibre Supplement 4000mg Psyllium Husk with Acidoph..."},{"week_str":"2026-W01","real_brand":"NKD Living","is_yaba_asin":"N","clicks":393.10312,"click_share":5.8,"average_organic_rank":3.0,"price":9.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"product_title":"NKD Living Whole Psyllium husks (500g)"},{"week_str":"2026-W01","real_brand":"NKD Living","is_yaba_asin":"N","clicks":398.525232,"click_share":5.88,"average_organic_rank":5.0,"price":9.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"product_title":"NKD Living Psyllium Husk Powder (500g) | Tested fo..."},{"week_str":"2026-W01","real_brand":"Natural Health 4 Life","is_yaba_asin":"N","clicks":870.248976,"click_share":12.84,"average_organic_rank":7.0,"price":17.62,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"product_title":"Natural Health 4 Life Vegetable Fibre Psyllium Hus..."},{"week_str":"2026-W01","real_brand":"The Worldwide Mint","is_yaba_asin":"N","clicks":478.491384,"click_share":7.06,"average_organic_rank":9.0,"price":5.45,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"product_title":"Psyllium Husk Powder 200g | 100% Pure & Natural | ..."},{"week_str":"2026-W01","real_brand":"WeightWorld","is_yaba_asin":"N","clicks":597.109084,"click_share":8.81,"average_organic_rank":5.0,"price":11.96,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"product_title":"WeightWorld Organic Psyllium Husk Capsules | 1400m..."},{"week_str":"2026-W01","real_brand":"Solgar","is_yaba_asin":"N","clicks":287.371936,"click_share":4.24,"average_organic_rank":13.0,"price":12.29,"weekly_number_of_days_with_deal":4,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":2,"product_title":"Solgar Psyllium Husks Fibre 500 Mg Vegetable Capsu..."}];

    const ourBrand = "NaturaleBio";
    
    // ------------------------------------------------------------------
    // 2. HELPER FUNCTIONS
    // ------------------------------------------------------------------
    function getTopCompetitors(data) {
        // Aggregate share by brand across all time
        const shares = {};
        data.forEach(d => {
            if (d.real_brand !== ourBrand) {
                shares[d.real_brand] = (shares[d.real_brand] || 0) + d.click_share;
            }
        });
        return Object.entries(shares)
            .sort((a,b) => b[1] - a[1])
            .slice(0,3)
            .map(x => x[0]);
    }

    const top3Competitors = getTopCompetitors(marketData);

    // ------------------------------------------------------------------
    // 3. GOOGLE CHARTS LOGIC
    // ------------------------------------------------------------------
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawAllCharts);

    function drawAllCharts() {
        drawTrendChart();
        drawCompetitivenessChart();
        drawEfficiencyChart();
        initInteractiveControls();
    }

    // Chart 1: Global Trend (Combo)
    function drawTrendChart() {
        // Aggregate by week
        const weeks = [...new Set(marketData.map(d => d.week_str))].sort();
        const chartData = [['Week', 'Total Market Clicks', 'Our Share (%)']];

        weeks.forEach(w => {
            const weekData = marketData.filter(d => d.week_str === w);
            const totalClicks = weekData.reduce((sum, d) => sum + d.clicks, 0);
            const ourData = weekData.find(d => d.is_yaba_asin === 'Y');
            const ourShare = ourData ? ourData.click_share : 0;
            
            // Normalize clicks for visibility (optional, but Google Charts handles dual axis)
            chartData.push([w, totalClicks, ourShare]);
        });

        const data = google.visualization.arrayToDataTable(chartData);
        const options = {
            seriesType: 'bars',
            series: {1: {type: 'line', targetAxisIndex: 1, color: '#4285F4', lineWidth: 3}},
            colors: ['#E8EAED'],
            vAxes: {
                0: {title: 'Total Clicks'},
                1: {title: 'Our Share (%)', textStyle: {color: '#4285F4'}}
            },
            legend: {position: 'bottom'},
            chartArea: {width: '85%', height: '75%'},
            bar: {groupWidth: '60%'}
        };

        const chart = new google.visualization.ComboChart(document.getElementById('trend_chart'));
        chart.draw(data, options);
    }

    // Chart 2: Competitiveness (Line)
    function drawCompetitivenessChart() {
        const weeks = [...new Set(marketData.map(d => d.week_str))].sort();
        const header = ['Week', 'NaturaleBio (Us)', ...top3Competitors, 'Rest of Market'];
        const rows = [];

        weeks.forEach(w => {
            const weekData = marketData.filter(d => d.week_str === w);
            
            // Calc shares
            const ourShare = weekData.filter(d => d.is_yaba_asin === 'Y')
                                     .reduce((s, d) => s + d.click_share, 0);
            
            const compShares = top3Competitors.map(c => 
                weekData.filter(d => d.real_brand === c).reduce((s, d) => s + d.click_share, 0)
            );

            // Rest
            const trackedShare = ourShare + compShares.reduce((a,b) => a+b, 0);
            // Assuming total share isn't 100 in data, we just map the rest of known brands
            const allKnownShare = weekData.reduce((s, d) => s + d.click_share, 0);
            const restShare = Math.max(0, allKnownShare - trackedShare);

            rows.push([w, ourShare, ...compShares, restShare]);
        });

        const data = google.visualization.arrayToDataTable([header, ...rows]);
        const options = {
            curveType: 'function',
            lineWidth: 2,
            colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853', '#9AA0A6'],
            legend: {position: 'bottom'},
            chartArea: {width: '85%', height: '75%'},
            vAxis: {title: 'Click Share (%)'}
        };

        const chart = new google.visualization.LineChart(document.getElementById('comp_chart'));
        chart.draw(data, options);
    }

    // Chart 3: Efficiency (Scatter)
    function drawEfficiencyChart() {
        const lastWeek = [...new Set(marketData.map(d => d.week_str))].sort().pop();
        const weekData = marketData.filter(d => d.week_str === lastWeek);

        // Header: [Rank, Share, Tooltip]
        // But we want series by brand.
        const chartData = [['Organic Rank', 'Click Share', {'type': 'string', 'role': 'style'}, {'type': 'string', 'role': 'tooltip'}]];

        weekData.forEach(d => {
            const isUs = d.is_yaba_asin === 'Y';
            const color = isUs ? '#4285F4' : (top3Competitors.includes(d.real_brand) ? '#EA4335' : '#9AA0A6');
            const pointSize = isUs ? 'point { size: 10; shape-type: star; fill-color: #4285F4; }' : null;
            
            chartData.push([
                d.average_organic_rank, 
                d.click_share, 
                pointSize || `point { fill-color: ${color} }`,
                `${d.real_brand} \nRank: ${d.average_organic_rank}\nShare: ${d.click_share}%`
            ]);
        });

        const data = google.visualization.arrayToDataTable(chartData);
        const options = {
            hAxis: {title: 'Organic Rank (Lower is Better)', direction: 1}, // 1 is normal, but rank 1 is left usually. 
            // In scatter, X increases to right. Rank 1 is left. Correct.
            vAxis: {title: 'Click Share (%)'},
            legend: 'none',
            chartArea: {width: '85%', height: '75%'}
        };

        const chart = new google.visualization.ScatterChart(document.getElementById('efficiency_chart'));
        chart.draw(data, options);
    }

    // ------------------------------------------------------------------
    // 4. INTERACTIVE LOGIC
    // ------------------------------------------------------------------
    function initInteractiveControls() {
        const weeks = [...new Set(marketData.map(d => d.week_str))].sort().reverse();
        const wSel = document.getElementById('weekSelector');
        weeks.forEach(w => {
            const opt = document.createElement('option');
            opt.value = w;
            opt.text = w;
            wSel.add(opt);
        });

        // Competitors (All brands except us)
        const brands = [...new Set(marketData.map(d => d.real_brand))].filter(b => b !== ourBrand).sort();
        const cSel = document.getElementById('compSelector');
        brands.forEach(b => {
            const opt = document.createElement('option');
            opt.value = b;
            opt.text = b;
            cSel.add(opt);
        });

        // Select first comp by default if available
        if(top3Competitors.length > 0) cSel.value = top3Competitors[0];
        
        updateInteractive();
    }

    function updateInteractive() {
        const week = document.getElementById('weekSelector').value;
        const compBrand = document.getElementById('compSelector').value;
        const weekData = marketData.filter(d => d.week_str === week);

        // Our Data
        const us = weekData.find(d => d.is_yaba_asin === 'Y') || {};
        // Comp Data (aggregated if multiple ASINs for brand, but usually we pick main one. Let's aggregate for safety)
        const compItems = weekData.filter(d => d.real_brand === compBrand);
        
        // Aggregate comp logic (weighted avg for price/rank usually tricky, let's take best rank and total share)
        const compStats = compItems.reduce((acc, curr) => {
            acc.click_share += curr.click_share;
            acc.clicks += curr.clicks;
            acc.priceSum += (curr.price * curr.clicks); // simple weight attempt or just take first
            // simplified:
            return acc;
        }, {click_share: 0, clicks: 0, priceSum: 0});
        
        // Find best rank ASIN for comp
        const bestComp = compItems.sort((a,b) => a.average_organic_rank - b.average_organic_rank)[0] || {};

        // DOM Updates - Us
        document.getElementById('our-share').innerText = (us.click_share || 0) + '%';
        document.getElementById('our-price').innerText = '¬£' + (us.price || 0).toFixed(2);
        document.getElementById('our-rank').innerText = '#' + (us.average_organic_rank || '-');
        document.getElementById('our-deals').innerText = (us.weekly_number_of_days_with_deal > 0 ? 'Yes' : 'No');

        // DOM Updates - Comp
        document.getElementById('comp-name').innerText = compBrand;
        document.getElementById('comp-share').innerText = (compStats.click_share || 0).toFixed(2) + '%';
        document.getElementById('comp-price').innerText = '¬£' + (bestComp.price || 0).toFixed(2);
        document.getElementById('comp-rank').innerText = '#' + (bestComp.average_organic_rank || '-');
        document.getElementById('comp-deals').innerText = (bestComp.weekly_number_of_days_with_deal > 0 ? 'Yes' : 'No');

        // Highlight winner
        const compCard = document.getElementById('comp-card');
        const usShare = us.click_share || 0;
        const cShare = compStats.click_share || 0;

        if (cShare > usShare) {
            compCard.classList.add('winner');
            compCard.style.borderColor = '#EA4335';
            compCard.style.backgroundColor = '#FEF2F2';
            document.querySelector('.product-card.winner').classList.remove('winner');
        } else {
            compCard.classList.remove('winner');
            compCard.style.borderColor = '#E8EAED';
            compCard.style.backgroundColor = 'white';
            document.querySelector('.product-card:first-child').classList.add('winner');
        }

        drawVsChart(us, compStats, compBrand);
    }

    function drawVsChart(us, comp, compName) {
        // Simple Bar Chart comparing metrics scaled to 100 for viz? No, just Side-by-Side Share
        const data = google.visualization.arrayToDataTable([
            ['Metric', 'NaturaleBio', compName],
            ['Click Share (%)', us.click_share || 0, comp.click_share || 0],
        ]);

        const options = {
            bars: 'horizontal',
            colors: ['#4285F4', '#EA4335'],
            legend: {position: 'top'},
            hAxis: {minValue: 0}
        };

        const chart = new google.visualization.BarChart(document.getElementById('vs_chart'));
        chart.draw(data, options);
    }

    // ------------------------------------------------------------------
    // 5. UTILS
    // ------------------------------------------------------------------
    function switchTab(tabId) {
        document.getElementById('static-tab').classList.add('hidden');
        document.getElementById('interactive-tab').classList.add('hidden');
        document.getElementById(tabId + '-tab').classList.remove('hidden');

        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
    }

    // Handle Resize
    window.addEventListener('resize', drawAllCharts);

</script>

</body>
</html>