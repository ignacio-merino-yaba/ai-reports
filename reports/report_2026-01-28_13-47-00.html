<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASIN Performance Report: Vitamin D3</title>
    <!-- Google Charts Loader -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        :root {
            --primary: #0071e3; /* Apple Blue */
            --primary-bg: #f5f5f7;
            --text-main: #1d1d1f;
            --text-sec: #86868b;
            --card-bg: #ffffff;
            --danger: #ff3b30;
            --success: #34c759;
            --border-radius: 20px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: var(--card-bg);
            padding: 20px 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
        }

        h1 { font-size: 24px; font-weight: 600; margin: 0; }
        .badge { 
            background: var(--primary); 
            color: white; 
            padding: 5px 12px; 
            border-radius: 12px; 
            font-size: 12px; 
            font-weight: 500;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 10px 20px;
            font-size: 15px;
            font-weight: 500;
            color: var(--text-sec);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        /* Grid System */
        .grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .col-12 { grid-column: span 12; }
        .col-8 { grid-column: span 8; }
        .col-6 { grid-column: span 6; }
        .col-4 { grid-column: span 4; }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
            transition: transform 0.2s;
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* KPIs */
        .kpi-value { font-size: 32px; font-weight: 700; color: var(--text-main); }
        .kpi-sub { font-size: 13px; color: var(--text-sec); margin-top: 5px; }
        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }

        /* Insights List */
        .insight-list { list-style: none; padding: 0; margin: 0; }
        .insight-item { 
            display: flex; 
            gap: 12px; 
            margin-bottom: 15px; 
            align-items: flex-start;
        }
        .insight-icon { color: var(--primary); font-size: 20px; margin-top: 2px; }
        .insight-text h4 { margin: 0 0 4px 0; font-size: 14px; font-weight: 600; }
        .insight-text p { margin: 0; font-size: 13px; color: var(--text-sec); line-height: 1.4; }

        /* Interactive Controls */
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        select {
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid #d2d2d7;
            background: white;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
        }

        /* Comparision Table */
        .comp-table { width: 100%; border-collapse: collapse; }
        .comp-table th { text-align: left; color: var(--text-sec); font-size: 12px; padding: 10px; border-bottom: 1px solid #eee; }
        .comp-table td { padding: 12px 10px; font-size: 14px; border-bottom: 1px solid #f5f5f7; }
        .comp-table td:first-child { font-weight: 500; }

        /* Helper Classes */
        .hidden { display: none; }
        
        /* Mobile */
        @media (max-width: 768px) {
            .col-8, .col-6, .col-4 { grid-column: span 12; }
            .controls { flex-direction: column; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1>AnÃ¡lisis de Rendimiento: Vitamin D3</h1>
            <div style="font-size: 13px; color: var(--text-sec); margin-top: 5px;">Parent ASIN Analysis â€¢ UK Market â€¢ Last 4 Weeks</div>
        </div>
        <div class="badge">Estrategia Q1</div>
    </header>

    <!-- Navigation -->
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('static')">Reporte Ejecutivo</button>
        <button class="tab-btn" onclick="switchTab('interactive')">Comparador Interactivo</button>
    </div>

    <!-- TAB 1: STATIC REPORT -->
    <div id="tab-static">
        <!-- Section 1: Top Line KPIs -->
        <div class="grid">
            <div class="card col-4">
                <div class="card-title"><span class="material-icons">ads_click</span> Tendencia Global</div>
                <div class="kpi-value" id="kpi-clicks">-</div>
                <div class="kpi-sub" id="kpi-clicks-sub">Clicks Totales (Mercado)</div>
            </div>
            <div class="card col-4">
                <div class="card-title"><span class="material-icons">pie_chart</span> Nuestra Cuota</div>
                <div class="kpi-value" id="kpi-share">-</div>
                <div class="kpi-sub" id="kpi-share-sub">Avg Click Share</div>
            </div>
            <div class="card col-4">
                <div class="card-title"><span class="material-icons">attach_money</span> Posicionamiento Precio</div>
                <div class="kpi-value" id="kpi-price">-</div>
                <div class="kpi-sub" id="kpi-price-sub">vs Media Mercado</div>
            </div>
        </div>

        <!-- Section 2: Charts -->
        <div class="grid">
            <div class="card col-8">
                <div class="card-title">Tendencia de Mercado vs Nuestra Visibilidad</div>
                <div id="chart_global" style="width: 100%; height: 300px;"></div>
            </div>
            <div class="card col-4">
                <div class="card-title">Insights Clave</div>
                <ul class="insight-list" id="insights-container">
                    <!-- Populated by JS -->
                </ul>
            </div>
        </div>

        <div class="grid">
            <div class="card col-12">
                <div class="card-title">Competitividad de Marca (Share of Click)</div>
                <div id="chart_competitors" style="width: 100%; height: 300px;"></div>
            </div>
        </div>

        <!-- Section 3: Efficiency -->
        <div class="grid">
            <div class="card col-6">
                <div class="card-title">Eficiencia: Rank OrgÃ¡nico vs Click Share</div>
                <div style="font-size:12px; color:#86868b; margin-bottom:10px;">Â¿Estamos convirtiendo visibilidad en clicks? (Arriba a la izquierda es mejor)</div>
                <div id="chart_efficiency" style="width: 100%; height: 350px;"></div>
            </div>
            <div class="card col-6">
                <div class="card-title">ðŸš€ Recomendaciones Accionables</div>
                <ul class="insight-list">
                    <li class="insight-item">
                        <span class="material-icons insight-icon" style="color: #34c759;">trending_up</span>
                        <div class="insight-text">
                            <h4>Defensa de Cuota</h4>
                            <p>WeightWorld estÃ¡ ganando terreno agresivamente. Se recomienda activar cupÃ³n del 5-10% para recuperar visibilidad inmediata en keywords principales.</p>
                        </div>
                    </li>
                    <li class="insight-item">
                        <span class="material-icons insight-icon" style="color: #0071e3;">search</span>
                        <div class="insight-text">
                            <h4>OptimizaciÃ³n de TÃ­tulo</h4>
                            <p>Nuestro Rank OrgÃ¡nico es sÃ³lido (Top 3-5), pero el Click Share estÃ¡ por debajo del potencial. Revisar imagen principal y primeras 60 caracteres del tÃ­tulo.</p>
                        </div>
                    </li>
                    <li class="insight-item">
                        <span class="material-icons insight-icon" style="color: #ff9500;">inventory_2</span>
                        <div class="insight-text">
                            <h4>Pack Size Strategy</h4>
                            <p>Los competidores (Nutrition Geeks) ganan con formatos de "1 Year Supply". Evaluar resaltar la duraciÃ³n del suministro en la imagen principal.</p>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- TAB 2: INTERACTIVE COMPARATOR -->
    <div id="tab-interactive" class="hidden">
        <div class="card">
            <div class="controls">
                <select id="select-week" onchange="updateComparator()">
                    <!-- Populated by JS -->
                </select>
                <select id="select-competitor" onchange="updateComparator()">
                    <!-- Populated by JS -->
                </select>
            </div>
            
            <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:20px;">
                <h2 id="comp-title" style="margin:0;">Incite Nutrition vs Competitor</h2>
                <span id="comp-date" style="color:var(--text-sec); font-size:14px;"></span>
            </div>

            <table class="comp-table">
                <thead>
                    <tr>
                        <th width="30%">MÃ©trica</th>
                        <th width="35%" style="color:#0071e3">Nosotros (Incite)</th>
                        <th width="35%" id="th-comp" style="color:#ff3b30">Competidor</th>
                    </tr>
                </thead>
                <tbody id="comp-tbody">
                    <!-- Populated by JS -->
                </tbody>
            </table>
        </div>
        
        <div class="grid" style="margin-top: 20px;">
             <div class="card col-12">
                 <div class="card-title">HistÃ³rico de Precios: Cara a Cara</div>
                 <div id="chart_price_comp" style="width: 100%; height: 250px;"></div>
             </div>
        </div>
    </div>

</div>

<script type="text/javascript">
    // ---------------------------------------------------------
    // 1. DATA INJECTION (PROCESSED FROM CSV)
    // ---------------------------------------------------------
    const marketData = [
  {"week_date": "2026-01-10", "real_brand": "Vita Premium", "product_title": "Vitamin D 4,000 IU Softgels, Maximum Strength Vita...", "is_yaba_asin": "N", "click_share": 5.32, "average_organic_rank": 4, "price": 8.025714286, "weekly_number_of_days_with_deal": 5, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 1067.42},
  {"week_date": "2026-01-17", "real_brand": "Vita Premium", "product_title": "Vitamin D 4,000 IU Softgels, Maximum Strength Vita...", "is_yaba_asin": "N", "click_share": 3.77, "average_organic_rank": 6, "price": 8.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 773.43},
  {"week_date": "2026-01-03", "real_brand": "Vita Premium", "product_title": "Vitamin D 4,000 IU Softgels, Maximum Strength Vita...", "is_yaba_asin": "N", "click_share": 6.44, "average_organic_rank": 4, "price": 7.64, "weekly_number_of_days_with_deal": 4, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 629.04},
  {"week_date": "2025-12-27", "real_brand": "Vita Premium", "product_title": "Vitamin D 4,000 IU Softgels, Maximum Strength Vita...", "is_yaba_asin": "N", "click_share": 6.82, "average_organic_rank": 4, "price": 8.604285714, "weekly_number_of_days_with_deal": 2, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 2, "est_clicks": 820.57},
  {"week_date": "2026-01-10", "real_brand": "Vitabiotics Ultra", "product_title": "Vitamin D Tablets 2000IU, Vitabiotics Ultra-96 Cou...", "is_yaba_asin": "N", "click_share": 1.91, "average_organic_rank": 24, "price": 3.79, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 383.22},
  {"week_date": "2026-01-17", "real_brand": "Zipvit", "product_title": "Zipvit Vitamin D3 4000 IU, 360 Maximum Strength Vi...", "is_yaba_asin": "N", "click_share": 1.72, "average_organic_rank": 17, "price": 7.802857143, "weekly_number_of_days_with_deal": 3, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 352.86},
  {"week_date": "2026-01-03", "real_brand": "Zipvit", "product_title": "Zipvit Vitamin D3 4000 IU, 360 Maximum Strength Vi...", "is_yaba_asin": "N", "click_share": 2.27, "average_organic_rank": 10, "price": 7.49, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 221.72},
  {"week_date": "2025-12-27", "real_brand": "Zipvit", "product_title": "Zipvit Vitamin D3 4000 IU, 360 Maximum Strength Vi...", "is_yaba_asin": "N", "click_share": 1.51, "average_organic_rank": 15, "price": 8.204285714, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 181.68},
  {"week_date": "2025-12-27", "real_brand": "Nu U Nutrition", "product_title": "Nu U Nutrition - Vitamin D 4000IU - 365 Softgel Ca...", "is_yaba_asin": "N", "click_share": 1.51, "average_organic_rank": 13, "price": 9.97, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 181.68},
  {"week_date": "2025-12-27", "real_brand": "WeightWorld", "product_title": "Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...", "is_yaba_asin": "N", "click_share": 18.05, "average_organic_rank": 1, "price": 8.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 6, "est_clicks": 2171.75},
  {"week_date": "2026-01-10", "real_brand": "WeightWorld", "product_title": "Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...", "is_yaba_asin": "N", "click_share": 19.32, "average_organic_rank": 1, "price": 8.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "est_clicks": 3876.43},
  {"week_date": "2026-01-17", "real_brand": "WeightWorld", "product_title": "Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...", "is_yaba_asin": "N", "click_share": 20.0, "average_organic_rank": 1, "price": 8.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "est_clicks": 4103.09},
  {"week_date": "2026-01-03", "real_brand": "WeightWorld", "product_title": "Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...", "is_yaba_asin": "N", "click_share": 17.88, "average_organic_rank": 1, "price": 8.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 4, "est_clicks": 1746.47},
  {"week_date": "2025-12-27", "real_brand": "G R O U N D E D COFFEE SCRUB", "product_title": "Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...", "is_yaba_asin": "N", "click_share": 4.56, "average_organic_rank": 6, "price": 5.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 548.65},
  {"week_date": "2026-01-03", "real_brand": "G R O U N D E D COFFEE SCRUB", "product_title": "Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...", "is_yaba_asin": "N", "click_share": 5.18, "average_organic_rank": 5, "price": 5.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 505.96},
  {"week_date": "2026-01-10", "real_brand": "G R O U N D E D COFFEE SCRUB", "product_title": "Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...", "is_yaba_asin": "N", "click_share": 4.09, "average_organic_rank": 6, "price": 5.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 820.63},
  {"week_date": "2026-01-17", "real_brand": "G R O U N D E D COFFEE SCRUB", "product_title": "Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...", "is_yaba_asin": "N", "click_share": 3.99, "average_organic_rank": 6, "price": 5.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 818.56},
  {"week_date": "2026-01-17", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D 1000iu - 1 Year Supply, 365 Easy-Swallow...", "is_yaba_asin": "N", "click_share": 2.22, "average_organic_rank": 7, "price": 6.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 455.44},
  {"week_date": "2026-01-10", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D 1000iu - 1 Year Supply, 365 Easy-Swallow...", "is_yaba_asin": "N", "click_share": 2.07, "average_organic_rank": 8, "price": 6.984285714, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 415.33},
  {"week_date": "2026-01-03", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D 1000iu - 1 Year Supply, 365 Easy-Swallow...", "is_yaba_asin": "N", "click_share": 2.02, "average_organic_rank": 10, "price": 6.97, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 197.3},
  {"week_date": "2026-01-03", "real_brand": "Nu U Nutrition", "product_title": "Vitamin D3 4000 IU - 400 Vegetarian Tablets - 13 M...", "is_yaba_asin": "N", "click_share": 2.3, "average_organic_rank": 9, "price": 6.49, "weekly_number_of_days_with_deal": 3, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 224.65},
  {"week_date": "2026-01-10", "real_brand": "Nu U Nutrition", "product_title": "Vitamin D3 4000 IU - 400 Vegetarian Tablets - 13 M...", "is_yaba_asin": "N", "click_share": 2.24, "average_organic_rank": 12, "price": 6.691428571, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 449.44},
  {"week_date": "2026-01-17", "real_brand": "Nu U Nutrition", "product_title": "Vitamin D3 4000 IU - 400 Vegetarian Tablets - 13 M...", "is_yaba_asin": "N", "click_share": 2.33, "average_organic_rank": 13, "price": 7.532857143, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 478.01},
  {"week_date": "2025-12-27", "real_brand": "Nu U Nutrition", "product_title": "Vitamin D3 4000 IU - 400 Vegetarian Tablets - 13 M...", "is_yaba_asin": "N", "click_share": 1.94, "average_organic_rank": 12, "price": 6.96, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 233.41},
  {"week_date": "2026-01-10", "real_brand": "Nutrition Geeks", "product_title": "Nutrition Geeks, Vitamin D 4000 iu - 1 Year Supply...", "is_yaba_asin": "N", "click_share": 3.92, "average_organic_rank": 18, "price": 7.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 786.52},
  {"week_date": "2026-01-17", "real_brand": "Nutrition Geeks", "product_title": "Nutrition Geeks, Vitamin D 4000 iu - 1 Year Supply...", "is_yaba_asin": "N", "click_share": 5.34, "average_organic_rank": 16, "price": 7.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 1095.52},
  {"week_date": "2025-12-27", "real_brand": "Nutrition Geeks", "product_title": "Nutrition Geeks, Vitamin D 4000 iu - 1 Year Supply...", "is_yaba_asin": "N", "click_share": 3.81, "average_organic_rank": 12, "price": 7.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 458.41},
  {"week_date": "2026-01-03", "real_brand": "Nutrition Geeks", "product_title": "Nutrition Geeks, Vitamin D 4000 iu - 1 Year Supply...", "is_yaba_asin": "N", "click_share": 3.42, "average_organic_rank": 22, "price": 7.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 334.05},
  {"week_date": "2026-01-03", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D3 4000 iu & Vitamin K2 MK7 100Î¼g - 1 Year...", "is_yaba_asin": "N", "click_share": 19.01, "average_organic_rank": 5, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 1856.84},
  {"week_date": "2026-01-10", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D3 4000 iu & Vitamin K2 MK7 100Î¼g - 1 Year...", "is_yaba_asin": "N", "click_share": 18.56, "average_organic_rank": 5, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 3723.94},
  {"week_date": "2026-01-17", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D3 4000 iu & Vitamin K2 MK7 100Î¼g - 1 Year...", "is_yaba_asin": "N", "click_share": 19.91, "average_organic_rank": 4, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 4084.63},
  {"week_date": "2025-12-27", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D3 4000 iu & Vitamin K2 MK7 100Î¼g - 1 Year...", "is_yaba_asin": "N", "click_share": 18.64, "average_organic_rank": 4, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 2242.74},
  {"week_date": "2026-01-03", "real_brand": "Vita Premium", "product_title": "Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...", "is_yaba_asin": "N", "click_share": 4.43, "average_organic_rank": 7, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 432.71},
  {"week_date": "2026-01-10", "real_brand": "Vita Premium", "product_title": "Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...", "is_yaba_asin": "N", "click_share": 3.55, "average_organic_rank": 7, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 712.28},
  {"week_date": "2026-01-17", "real_brand": "Vita Premium", "product_title": "Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...", "is_yaba_asin": "N", "click_share": 3.93, "average_organic_rank": 5, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 806.25},
  {"week_date": "2025-12-27", "real_brand": "Vita Premium", "product_title": "Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...", "is_yaba_asin": "N", "click_share": 3.85, "average_organic_rank": 6, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 463.22},
  {"week_date": "2025-12-27", "real_brand": "Incite Nutrition", "product_title": "Vitamin D3 4000 IU - 400 High Strength Vitamin D T...", "is_yaba_asin": "Y", "click_share": 6.98, "average_organic_rank": 3, "price": 7.847142857, "weekly_number_of_days_with_deal": 1, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 839.82},
  {"week_date": "2026-01-17", "real_brand": "Incite Nutrition", "product_title": "Vitamin D3 4000 IU - 400 High Strength Vitamin D T...", "is_yaba_asin": "Y", "click_share": 8.18, "average_organic_rank": 4, "price": 6.79, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 1678.16},
  {"week_date": "2026-01-10", "real_brand": "Incite Nutrition", "product_title": "Vitamin D3 4000 IU - 400 High Strength Vitamin D T...", "is_yaba_asin": "Y", "click_share": 9.01, "average_organic_rank": 4, "price": 6.961428571, "weekly_number_of_days_with_deal": 6, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 1807.79},
  {"week_date": "2026-01-03", "real_brand": "Incite Nutrition", "product_title": "Vitamin D3 4000 IU - 400 High Strength Vitamin D T...", "is_yaba_asin": "Y", "click_share": 5.27, "average_organic_rank": 5, "price": 7.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "est_clicks": 514.75}
];

    // ---------------------------------------------------------
    // 2. LOGIC & INITIALIZATION
    // ---------------------------------------------------------
    google.charts.load('current', {'packages':['corechart', 'line', 'scatter']});
    google.charts.setOnLoadCallback(initDashboard);

    // Globals
    const OUR_BRAND = "Incite Nutrition";
    const TOP_COMPETITORS = ['WeightWorld', 'Nutrition Geeks', 'Vita Premium'];
    let distinctWeeks = [];
    let distinctCompetitors = [];

    function initDashboard() {
        processData();
        renderKPIs();
        renderInsights();
        drawGlobalChart();
        drawCompetitivenessChart();
        drawEfficiencyChart();
        initInteractiveControls();
    }

    function switchTab(tabName) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelector(`button[onclick="switchTab('${tabName}')"]`).classList.add('active');
        
        document.getElementById('tab-static').classList.add('hidden');
        document.getElementById('tab-interactive').classList.add('hidden');
        document.getElementById(`tab-${tabName}`).classList.remove('hidden');
    }

    // Process Helpers
    function processData() {
        distinctWeeks = [...new Set(marketData.map(d => d.week_date))].sort();
        distinctCompetitors = [...new Set(marketData.filter(d => d.real_brand !== OUR_BRAND).map(d => d.real_brand))].sort();
    }

    // ---------------------------------------------------------
    // 3. KPI & INSIGHTS (Tab 1)
    // ---------------------------------------------------------
    function renderKPIs() {
        const lastWeek = distinctWeeks[distinctWeeks.length - 1];
        const prevWeek = distinctWeeks[distinctWeeks.length - 2];
        
        const currentData = marketData.filter(d => d.week_date === lastWeek);
        const prevData = marketData.filter(d => d.week_date === prevWeek);

        // KPI 1: Total Market Clicks
        const totalClicks = Math.round(currentData.reduce((sum, d) => sum + d.est_clicks, 0));
        const prevClicks = Math.round(prevData.reduce((sum, d) => sum + d.est_clicks, 0));
        const clickTrend = ((totalClicks - prevClicks) / prevClicks) * 100;
        
        const kpiClicks = document.getElementById('kpi-clicks');
        kpiClicks.innerText = totalClicks.toLocaleString();
        kpiClicks.className = `kpi-value ${clickTrend >= 0 ? 'trend-up' : 'trend-down'}`;
        document.getElementById('kpi-clicks-sub').innerText = `${clickTrend > 0 ? '+' : ''}${clickTrend.toFixed(1)}% vs semana anterior`;

        // KPI 2: Our Share
        const ourData = currentData.filter(d => d.real_brand === OUR_BRAND);
        const ourShare = ourData.reduce((sum, d) => sum + d.click_share, 0); // Assuming one parent, summing keywords/variants
        const prevOurData = prevData.filter(d => d.real_brand === OUR_BRAND);
        const prevShare = prevOurData.reduce((sum, d) => sum + d.click_share, 0);
        
        const kpiShare = document.getElementById('kpi-share');
        kpiShare.innerText = `${ourShare.toFixed(2)}%`;
        // Color logic: Green if share grows
        kpiShare.className = `kpi-value ${ourShare >= prevShare ? 'trend-up' : 'trend-down'}`; 

        // KPI 3: Price Position
        const avgMarketPrice = currentData.filter(d => d.real_brand !== OUR_BRAND).reduce((acc, val) => acc + val.price, 0) / currentData.filter(d => d.real_brand !== OUR_BRAND).length;
        const avgOurPrice = ourData.length > 0 ? ourData[0].price : 0;
        const priceDiff = ((avgOurPrice - avgMarketPrice) / avgMarketPrice) * 100;

        document.getElementById('kpi-price').innerText = `Â£${avgOurPrice.toFixed(2)}`;
        document.getElementById('kpi-price-sub').innerText = `${priceDiff.toFixed(1)}% vs Mercado (Â£${avgMarketPrice.toFixed(2)})`;
    }

    function renderInsights() {
        const ul = document.getElementById('insights-container');
        ul.innerHTML = `
            <li class="insight-item">
                <span class="material-icons insight-icon">trending_up</span>
                <div class="insight-text">
                    <h4>Mercado en Crecimiento</h4>
                    <p>La categorÃ­a muestra un aumento de demanda. Es el momento de ser agresivos para capturar el trÃ¡fico entrante.</p>
                </div>
            </li>
            <li class="insight-item">
                <span class="material-icons insight-icon">warning</span>
                <div class="insight-text">
                    <h4>Amenaza: WeightWorld</h4>
                    <p>Dominan con un 20% de Click Share consistente. Su estrategia de "Year Supply" estÃ¡ resonando fuerte.</p>
                </div>
            </li>
             <li class="insight-item">
                <span class="material-icons insight-icon">sell</span>
                <div class="insight-text">
                    <h4>Oportunidad de Precio</h4>
                    <p>Somos significativamente mÃ¡s baratos que la media. PodrÃ­amos testear subir precio ligeramente sin perder competitividad.</p>
                </div>
            </li>
        `;
    }

    // ---------------------------------------------------------
    // 4. GOOGLE CHARTS (Tab 1)
    // ---------------------------------------------------------
    function drawGlobalChart() {
        // Prepare Data: Week, Total Clicks (Bars), Our Share (Line)
        const rows = [['Semana', 'Volumen Clicks Mercado', 'Nuestra Cuota (%)']];
        
        distinctWeeks.forEach(week => {
            const weekData = marketData.filter(d => d.week_date === week);
            const totalClicks = weekData.reduce((s, d) => s + d.est_clicks, 0);
            const ourShare = weekData.filter(d => d.real_brand === OUR_BRAND).reduce((s, d) => s + d.click_share, 0);
            rows.push([week.substring(5), totalClicks, ourShare]);
        });

        const data = google.visualization.arrayToDataTable(rows);
        const options = {
            seriesType: 'bars',
            series: {1: {type: 'line', targetAxisIndex: 1, color: '#0071e3', lineWidth: 3}},
            colors: ['#e5e5ea'],
            vAxes: {
                0: {title: 'Est. Clicks', gridlines: {color: 'transparent'}},
                1: {title: 'Share %', format: '#\'%\''}
            },
            hAxis: {title: 'Semana'},
            legend: {position: 'bottom'},
            chartArea: {width: '80%', height: '70%'}
        };

        new google.visualization.ComboChart(document.getElementById('chart_global')).draw(data, options);
    }

    function drawCompetitivenessChart() {
        // Header
        const header = ['Semana', 'Nosotros (Incite)', ...TOP_COMPETITORS];
        const rows = [header];

        distinctWeeks.forEach(week => {
            const weekData = marketData.filter(d => d.week_date === week);
            const row = [week.substring(5)];
            
            // Us
            const usVal = weekData.filter(d => d.real_brand === OUR_BRAND).reduce((s, d) => s + d.click_share, 0);
            row.push(usVal);

            // Competitors
            TOP_COMPETITORS.forEach(comp => {
                const compVal = weekData.filter(d => d.real_brand === comp).reduce((s, d) => s + d.click_share, 0);
                row.push(compVal);
            });
            rows.push(row);
        });

        const data = google.visualization.arrayToDataTable(rows);
        const options = {
            curveType: 'function',
            colors: ['#0071e3', '#ff3b30', '#ff9500', '#af52de'],
            lineWidth: 2.5,
            chartArea: {width: '85%', height: '70%'},
            legend: {position: 'bottom'},
            vAxis: {title: 'Click Share %'},
            pointSize: 5
        };

        new google.visualization.LineChart(document.getElementById('chart_competitors')).draw(data, options);
    }

    function drawEfficiencyChart() {
        const lastWeek = distinctWeeks[distinctWeeks.length - 1];
        const weekData = marketData.filter(d => d.week_date === lastWeek);
        
        // Data: [ID, Rank, Share, Brand (Color), Size(Deals?)]
        const data = new google.visualization.DataTable();
        data.addColumn('number', 'Avg Rank');
        data.addColumn('number', 'Click Share');
        data.addColumn({type: 'string', role: 'style'}); // Color
        data.addColumn({type: 'string', role: 'tooltip'});

        weekData.forEach(d => {
            const isUs = d.real_brand === OUR_BRAND;
            const color = isUs ? '#0071e3' : (TOP_COMPETITORS.includes(d.real_brand) ? '#ff3b30' : '#ccc');
            const tooltip = `${d.real_brand}\nRank: ${d.average_organic_rank}\nShare: ${d.click_share}%\nPrecio: Â£${d.price}`;
            
            // Invert rank for X axis visual (Rank 1 is better, so usually left, but scatter puts 0 left. 
            // We'll trust the axis labels or just plot raw. 
            // Let's plot Raw Rank on X. Lower is better (Left).
            data.addRow([d.average_organic_rank, d.click_share, `point {fill-color: ${color}; size: 6; stroke-color: white;}`, tooltip]);
        });

        const options = {
            hAxis: {title: 'Ranking OrgÃ¡nico Promedio (Menor es Mejor)', direction: 1, viewWindow: {min: 0}},
            vAxis: {title: 'Click Share %'},
            legend: 'none',
            chartArea: {width: '85%', height: '75%'}
        };

        new google.visualization.ScatterChart(document.getElementById('chart_efficiency')).draw(data, options);
    }

    // ---------------------------------------------------------
    // 5. INTERACTIVE LOGIC (Tab 2)
    // ---------------------------------------------------------
    function initInteractiveControls() {
        const weekSel = document.getElementById('select-week');
        // Reverse order (newest first)
        [...distinctWeeks].reverse().forEach(w => {
            const opt = document.createElement('option');
            opt.value = w;
            opt.text = w;
            weekSel.appendChild(opt);
        });

        const compSel = document.getElementById('select-competitor');
        distinctCompetitors.forEach(c => {
            const opt = document.createElement('option');
            opt.value = c;
            opt.text = c;
            compSel.appendChild(opt);
        });

        // Set Default: Top Competitor
        if(distinctCompetitors.length > 0) compSel.value = "WeightWorld"; // Hardcoded top logic or distinctCompetitors[0]

        updateComparator();
    }

    function updateComparator() {
        const week = document.getElementById('select-week').value;
        const comp = document.getElementById('select-competitor').value;
        
        document.getElementById('comp-title').innerText = `${OUR_BRAND} vs ${comp}`;
        document.getElementById('comp-date').innerText = `Semana: ${week}`;
        document.getElementById('th-comp').innerText = comp;

        // Get Data
        const usData = marketData.filter(d => d.week_date === week && d.real_brand === OUR_BRAND);
        const compData = marketData.filter(d => d.week_date === week && d.real_brand === comp);

        // Aggregate if multiple rows (variants)
        const usMetrics = aggMetrics(usData);
        const compMetrics = aggMetrics(compData);

        // Render Table
        const tbody = document.getElementById('comp-tbody');
        tbody.innerHTML = `
            ${renderRow('Click Share', `${usMetrics.share.toFixed(2)}%`, `${compMetrics.share.toFixed(2)}%`, usMetrics.share > compMetrics.share)}
            ${renderRow('Precio Promedio', `Â£${usMetrics.price.toFixed(2)}`, `Â£${compMetrics.price.toFixed(2)}`, usMetrics.price < compMetrics.price)}
            ${renderRow('Ranking OrgÃ¡nico', usMetrics.rank.toFixed(1), compMetrics.rank.toFixed(1), usMetrics.rank < compMetrics.rank)}
            ${renderRow('DÃ­as con Deal', usMetrics.deals, compMetrics.deals, usMetrics.deals > compMetrics.deals)}
            ${renderRow('Est. Volumen Clicks', Math.round(usMetrics.estClicks), Math.round(compMetrics.estClicks), usMetrics.estClicks > compMetrics.estClicks)}
        `;

        drawPriceHistoryChart(comp);
    }

    function aggMetrics(rows) {
        if (rows.length === 0) return { share: 0, price: 0, rank: 0, deals: 0, estClicks: 0 };
        const share = rows.reduce((s, d) => s + d.click_share, 0);
        const price = rows.reduce((s, d) => s + d.price, 0) / rows.length;
        const rank = rows.reduce((s, d) => s + d.average_organic_rank, 0) / rows.length;
        const deals = Math.max(...rows.map(d => d.weekly_number_of_days_with_deal));
        const estClicks = rows.reduce((s, d) => s + d.est_clicks, 0);
        return { share, price, rank, deals, estClicks };
    }

    function renderRow(label, v1, v2, isV1Better) {
        const color = isV1Better ? 'var(--success)' : 'var(--text-main)'; // Simple visual cue
        return `<tr>
            <td>${label}</td>
            <td style="font-weight:600; color:${color}">${v1}</td>
            <td>${v2}</td>
        </tr>`;
    }

    function drawPriceHistoryChart(competitorName) {
        const rows = [['Semana', 'Nosotros', competitorName]];
        distinctWeeks.forEach(week => {
            const wData = marketData.filter(d => d.week_date === week);
            
            const usP = wData.filter(d => d.real_brand === OUR_BRAND).reduce((acc, v, i, arr) => acc + v.price/arr.length, 0);
            const compP = wData.filter(d => d.real_brand === competitorName).reduce((acc, v, i, arr) => acc + v.price/arr.length, 0);
            
            rows.push([week.substring(5), usP || 0, compP || 0]);
        });

        const data = google.visualization.arrayToDataTable(rows);
        const options = {
            title: '',
            curveType: 'function',
            colors: ['#0071e3', '#ff3b30'],
            vAxis: {format: 'Â£#'},
            legend: {position: 'top'}
        };

        new google.visualization.LineChart(document.getElementById('chart_price_comp')).draw(data, options);
    }

</script>

</body>
</html>