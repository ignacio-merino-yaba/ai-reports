<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Market Intelligence: Matcha Premium</title>
    
    <!-- Google Charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        /* RESET & BASE */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        body { background-color: #f5f5f7; color: #1d1d1f; padding: 20px; }
        
        /* LAYOUT */
        .container { max-width: 1200px; margin: 0 auto; }
        .header { margin-bottom: 30px; text-align: center; }
        .header h1 { font-size: 28px; font-weight: 600; color: #1d1d1f; margin-bottom: 8px; }
        .header p { font-size: 14px; color: #86868b; }

        /* TABS */
        .tabs { display: flex; justify-content: center; margin-bottom: 25px; background: #e8e8ed; padding: 4px; border-radius: 12px; width: fit-content; margin-left: auto; margin-right: auto; }
        .tab-btn { border: none; background: none; padding: 8px 24px; font-size: 14px; font-weight: 500; cursor: pointer; border-radius: 8px; color: #6e6e73; transition: all 0.2s; }
        .tab-btn.active { background: #fff; color: #1d1d1f; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        
        .tab-content { display: none; animation: fadeIn 0.4s ease; }
        .tab-content.active { display: block; }

        /* CARDS */
        .card { background: #fff; border-radius: 20px; padding: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.04); margin-bottom: 24px; }
        .card h2 { font-size: 18px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .card h2 .material-icons { font-size: 20px; color: #0071e3; }
        
        /* KPI GRID */
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .kpi-card { background: #fff; border-radius: 16px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); text-align: center; }
        .kpi-value { font-size: 24px; font-weight: 700; color: #1d1d1f; margin: 8px 0; }
        .kpi-label { font-size: 12px; color: #86868b; text-transform: uppercase; letter-spacing: 0.5px; }
        .trend-up { color: #34c759; font-size: 12px; font-weight: 600; }
        .trend-down { color: #ff3b30; font-size: 12px; font-weight: 600; }

        /* CHARTS CONTAINERS */
        .chart-container { width: 100%; height: 350px; }
        
        /* TEXT SECTIONS */
        .insight-section { margin-bottom: 16px; border-left: 4px solid #0071e3; padding-left: 16px; }
        .insight-title { font-weight: 600; font-size: 15px; margin-bottom: 4px; color: #1d1d1f; }
        .insight-text { font-size: 14px; color: #424245; line-height: 1.5; }
        .rec-list li { margin-bottom: 8px; font-size: 14px; color: #424245; }
        
        /* TABLE */
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { text-align: left; padding: 12px; border-bottom: 1px solid #e5e5e5; color: #86868b; font-weight: 500; }
        td { padding: 12px; border-bottom: 1px solid #f5f5f7; color: #1d1d1f; }
        
        /* CONTROLS */
        .controls { display: flex; gap: 12px; margin-bottom: 20px; }
        select { padding: 10px 16px; border-radius: 10px; border: 1px solid #d2d2d7; font-size: 14px; background: #fff; outline: none; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Parent ASIN Analysis: Matcha Premium</h1>
        <p>Market Intelligence Report • Last Updated: 2026-01-03</p>
    </div>

    <!-- TABS NAVIGATION -->
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('static')">Strategic Report</button>
        <button class="tab-btn" onclick="switchTab('interactive')">Interactive Comparator</button>
    </div>

    <!-- TAB 1: STATIC REPORT -->
    <div id="static" class="tab-content active">
        
        <!-- KPI HEADER -->
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-label">Market Volume (Est. Clicks)</div>
                <div class="kpi-value">15.6K</div>
                <div class="trend-down">▼ 55% vs prev week</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Our Share (NaturaleBio)</div>
                <div class="kpi-value">19.4%</div>
                <div class="trend-up">▲ 0.5% vs prev week</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Top Competitor</div>
                <div class="kpi-value">SuperSelf</div>
                <div class="trend-up">17.5% Share</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Efficiency Rank</div>
                <div class="kpi-value">#1</div>
                <div class="trend-up">Organic Pos</div>
            </div>
        </div>

        <!-- SECTION 1: TREND -->
        <div class="card">
            <h2><span class="material-icons">trending_up</span> 1. Global Parent Trend</h2>
            <div class="insight-section">
                <div class="insight-title">Massive Seasonal Contraction</div>
                <div class="insight-text">
                    The market experienced a drastic drop in total search volume from ~34.7k to ~15.6k clicks (-55%) between Week 51 and Week 01. This indicates strong post-holiday seasonality. Despite this, <strong>NaturaleBio (Our Brand)</strong> showed resilience, maintaining and slightly increasing click share from 18.9% to 19.4%, proving that our core organic positioning is stable even when demand fluctuates.
                </div>
            </div>
            <div id="chart_trend" class="chart-container"></div>
        </div>

        <!-- SECTION 2: COMPETITIVENESS -->
        <div class="card">
            <h2><span class="material-icons">pie_chart</span> 2. Brand Competitiveness</h2>
            <div class="insight-section">
                <div class="insight-title">SuperSelf Surges, Perfect Ted Stumbles</div>
                <div class="insight-text">
                    <strong>SuperSelf</strong> is the clear winner of the period, increasing their share from 11.4% to 17.5%. This growth correlates directly with their organic ranking improvement (Rank 5 → 3) on ASIN B08YK2RPBZ. Conversely, <strong>Perfect Ted</strong> lost significant ground (-3.2% share), driven by a collapse in ranking for their key ASIN B09DQ1PWGX (Rank 9 → 34).
                </div>
            </div>
            <div id="chart_share" class="chart-container"></div>
        </div>

        <!-- SECTION 3: LEVERS & EFFICIENCY -->
        <div class="card">
            <h2><span class="material-icons">speed</span> 3. Efficiency & Levers (Rank vs Share)</h2>
            <div class="insight-section">
                <div class="insight-title">Organic Rank is the Primary Driver</div>
                <div class="insight-text">
                    Our ASIN <strong>B06XQ5DCYJ</strong> remains the most efficient in the category, holding Rank #1 and capturing ~14% share alone. The chart below shows "Overperformers" (Top-left) vs "Underperformers" (Bottom-right). Note how Perfect Ted's ASIN B09DQ1PWGX drifted to the right (Rank 34), killing its efficiency. Pricing levers appear less impactful this week compared to rank position.
                </div>
            </div>
            <div id="chart_scatter" class="chart-container"></div>
        </div>

        <!-- SECTION 4: CONCLUSIONS -->
        <div class="card" style="border-left: 6px solid #34c759;">
            <h2><span class="material-icons">lightbulb</span> 5. Conclusions & Recommendations</h2>
            
            <h3 style="font-size:15px; margin:10px 0 5px 0;">Insights</h3>
            <ul class="rec-list" style="padding-left: 20px; margin-bottom: 20px;">
                <li><strong>Retention is Key:</strong> In a shrinking market (Jan slump), we successfully retained our customer base better than Perfect Ted.</li>
                <li><strong>Threat Alert:</strong> SuperSelf is aggressively climbing organic ranks without dropping price (£9.90 stable). They are now a direct threat to our #2 spot.</li>
                <li><strong>Anomaly:</strong> Perfect Ted's B09DQ1PWGX shows a price of ~£2.12 in Week 01. This is likely a data error or a liquidation event that destroyed their organic rank.</li>
            </ul>

            <h3 style="font-size:15px; margin:10px 0 5px 0;">Actionable Recommendations</h3>
            <ul class="rec-list" style="padding-left: 20px;">
                <li><strong>1. Defend vs SuperSelf:</strong> Monitor ASIN B06XQ5DCYJ closely. Consider a defensive Coupon (5%) to widen the gap against SuperSelf's rising B08YK2RPBZ.</li>
                <li><strong>2. Conquest Perfect Ted:</strong> Bid aggressively on "Perfect Ted" branded keywords. Their main ASIN is weak (Rank 34), offering a window to steal their loyalists.</li>
                <li><strong>3. Inventory Check:</strong> Ensure B079VQ52MK (Our secondary ASIN) stays in stock; it dipped slightly in share (5.3% → 3.2%).</li>
            </ul>
        </div>
    </div>

    <!-- TAB 2: INTERACTIVE -->
    <div id="interactive" class="tab-content">
        <div class="card">
            <h2><span class="material-icons">analytics</span> Dynamic Comparator</h2>
            <p style="margin-bottom: 15px; color:#666; font-size:13px;">Filter data to inspect specific weeks or competitors.</p>
            
            <div class="controls">
                <select id="weekSelect" onchange="drawInteractive()">
                    <option value="all">All Weeks</option>
                    <!-- Populated by JS -->
                </select>
                <select id="compSelect" onchange="drawInteractive()">
                    <option value="all">All Brands</option>
                    <!-- Populated by JS -->
                </select>
            </div>

            <div id="dynamic_table_div"></div>
        </div>
    </div>

</div>

<script type="text/javascript">
    // DATA INJECTION
    const marketData = [
        {"week_date": "2025-51", "parent_asin": "Matcha Premium", "asin": "B06XQ5DCYJ", "brand": "NaturaleBio", "is_yaba_asin": "Y", "click_share": 13.56, "clicks": 7477.43, "price": 12.28, "rank": 1, "deal_days": 0, "bs_days": 0, "ac_days": 7, "coupon_days": 0, "product_title": "NaturaleBio Japanese Organic Matcha Green Tea Powd..."},
        {"week_date": "2025-51", "parent_asin": "Matcha Premium", "asin": "B079VQ52MK", "brand": "NaturaleBio", "is_yaba_asin": "Y", "click_share": 5.37, "clicks": 2961.19, "price": 20.13, "rank": 3, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "product_title": "NaturaleBio Japanese Organic Matcha Green Tea Powd..."},
        {"week_date": "2025-51", "parent_asin": "Matcha Premium", "asin": "B08YK2RPBZ", "brand": "SuperSelf", "is_yaba_asin": "N", "click_share": 8.02, "clicks": 4422.49, "price": 9.9, "rank": 5, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 7, "product_title": "SuperSelf Organic Matcha Powder - Ceremonial Grade..."},
        {"week_date": "2025-51", "parent_asin": "Matcha Premium", "asin": "B09DQ1PWGX", "brand": "Perfect Ted", "is_yaba_asin": "N", "click_share": 8.86, "clicks": 4885.69, "price": 9.49, "rank": 9, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "product_title": "PerfectTed Organic Matcha Powder, Ceremonial Grade..."},
        {"week_date": "2025-51", "parent_asin": "Matcha Premium", "asin": "B06XTYYYJ8", "brand": "Heapwell Superfoods", "is_yaba_asin": "N", "click_share": 7.41, "clicks": 4086.11, "price": 9.99, "rank": 7, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "product_title": "Heapwell Matcha Powder - 50g | High Grade Japanese..."},
        {"week_date": "2025-51", "parent_asin": "Matcha Premium", "asin": "B08YRXQ2JH", "brand": "Double", "is_yaba_asin": "N", "click_share": 5.39, "clicks": 2972.22, "price": 6.98, "rank": 12, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "product_title": "Double Dragon | 100% Organic | Premium Matcha Gree..."},
        {"week_date": "2025-51", "parent_asin": "Matcha Premium", "asin": "B0F21VZMJQ", "brand": "Perfect Ted", "is_yaba_asin": "N", "click_share": 5.59, "clicks": 3082.50, "price": 16.99, "rank": 5, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "product_title": "PerfectTed Original Matcha Powder, Ceremonial Grad..."},
        {"week_date": "2025-51", "parent_asin": "Matcha Premium", "asin": "B082DKRSB4", "brand": "SuperSelf", "is_yaba_asin": "N", "click_share": 3.38, "clicks": 1863.84, "price": 15.58, "rank": 10, "deal_days": 6, "bs_days": 0, "ac_days": 0, "coupon_days": 7, "product_title": "SuperSelf Organic Matcha Powder - Ceremonial Grade..."},
        {"week_date": "2025-51", "parent_asin": "Matcha Premium", "asin": "B0D9M91WZD", "brand": "Perfect Ted", "is_yaba_asin": "N", "click_share": 3.3, "clicks": 1819.72, "price": 9.49, "rank": 11, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "product_title": "PerfectTed Vanilla Bean Matcha Powder, Ceremonial ..."},
        {"week_date": "2025-51", "parent_asin": "Matcha Premium", "asin": "B00HNDSOCI", "brand": "PureChimp", "is_yaba_asin": "Y", "click_share": 2.05, "clicks": 1130.43, "price": 14.95, "rank": 12, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 7, "product_title": "PureChimp Ceremonial Grade Matcha Powder 50g. 100%..."},
        {"week_date": "2026-01", "parent_asin": "Matcha Premium", "asin": "B06XQ5DCYJ", "brand": "NaturaleBio", "is_yaba_asin": "Y", "click_share": 14.18, "clicks": 3472.87, "price": 12.49, "rank": 1, "deal_days": 0, "bs_days": 0, "ac_days": 4, "coupon_days": 0, "product_title": "NaturaleBio Japanese Organic Matcha Green Tea Powd..."},
        {"week_date": "2026-01", "parent_asin": "Matcha Premium", "asin": "B08YK2RPBZ", "brand": "SuperSelf", "is_yaba_asin": "N", "click_share": 13.48, "clicks": 3301.43, "price": 9.9, "rank": 3, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 4, "product_title": "SuperSelf Organic Matcha Powder - Ceremonial Grade..."},
        {"week_date": "2026-01", "parent_asin": "Matcha Premium", "asin": "B0F21VZMJQ", "brand": "Perfect Ted", "is_yaba_asin": "N", "click_share": 7.54, "clicks": 1846.64, "price": 16.99, "rank": 4, "deal_days": 0, "bs_days": 0, "ac_days": 1, "coupon_days": 0, "product_title": "PerfectTed Original Matcha Powder, Ceremonial Grad..."},
        {"week_date": "2026-01", "parent_asin": "Matcha Premium", "asin": "B06XTYYYJ8", "brand": "Heapwell Superfoods", "is_yaba_asin": "N", "click_share": 7.28, "clicks": 1782.97, "price": 9.99, "rank": 6, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "product_title": "Heapwell Matcha Powder - 50g | High Grade Japanese..."},
        {"week_date": "2026-01", "parent_asin": "Matcha Premium", "asin": "B08YRXQ2JH", "brand": "Double", "is_yaba_asin": "N", "click_share": 4.92, "clicks": 1204.97, "price": 6.98, "rank": 11, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "product_title": "Double Dragon | 100% Organic | Premium Matcha Gree..."},
        {"week_date": "2026-01", "parent_asin": "Matcha Premium", "asin": "B09DQ1PWGX", "brand": "Perfect Ted", "is_yaba_asin": "N", "click_share": 4.68, "clicks": 1146.19, "price": 2.12, "rank": 34, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "product_title": "PerfectTed Organic Matcha Powder, Ceremonial Grade..."},
        {"week_date": "2026-01", "parent_asin": "Matcha Premium", "asin": "B082DKRSB4", "brand": "SuperSelf", "is_yaba_asin": "N", "click_share": 4.06, "clicks": 994.34, "price": 14.86, "rank": 7, "deal_days": 4, "bs_days": 0, "ac_days": 0, "coupon_days": 4, "product_title": "SuperSelf Organic Matcha Powder - Ceremonial Grade..."},
        {"week_date": "2026-01", "parent_asin": "Matcha Premium", "asin": "B079VQ52MK", "brand": "NaturaleBio", "is_yaba_asin": "Y", "click_share": 3.19, "clicks": 781.27, "price": 20.99, "rank": 7, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "product_title": "NaturaleBio Japanese Organic Matcha Green Tea Powd..."},
        {"week_date": "2026-01", "parent_asin": "Matcha Premium", "asin": "B0D9M91WZD", "brand": "Perfect Ted", "is_yaba_asin": "N", "click_share": 2.37, "clicks": 580.44, "price": 11.0, "rank": 11, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "product_title": "PerfectTed Vanilla Bean Matcha Powder, Ceremonial ..."},
        {"week_date": "2026-01", "parent_asin": "Matcha Premium", "asin": "B07B29VZ6W", "brand": "NaturaleBio", "is_yaba_asin": "Y", "click_share": 2.03, "clicks": 497.17, "price": 16.49, "rank": 10, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "product_title": "NaturaleBio Japanese Organic Matcha Green Tea Powd..."}
    ];

    // INITIALIZATION
    google.charts.load('current', {'packages':['corechart', 'table']});
    google.charts.setOnLoadCallback(initDashboard);

    function initDashboard() {
        populateControls();
        drawCharts();
    }

    // HELPER: Aggregate Data
    function aggregateByWeek(data) {
        const acc = {};
        data.forEach(d => {
            if (!acc[d.week_date]) acc[d.week_date] = { week: d.week_date, clicks: 0, our_clicks: 0, total_share: 0, our_share: 0 };
            acc[d.week_date].clicks += d.clicks;
            acc[d.week_date].total_share += d.click_share;
            if (d.brand === 'NaturaleBio') {
                acc[d.week_date].our_clicks += d.clicks;
                acc[d.week_date].our_share += d.click_share;
            }
        });
        return Object.values(acc).sort((a,b) => a.week.localeCompare(b.week));
    }

    function aggregateByBrandWeek(data) {
        const acc = {};
        data.forEach(d => {
            const key = d.week_date + '_' + d.brand;
            if (!acc[key]) acc[key] = { week: d.week_date, brand: d.brand, share: 0 };
            acc[key].share += d.click_share;
        });
        return Object.values(acc);
    }

    function drawCharts() {
        // CHART 1: TREND (Combo Chart)
        const aggData = aggregateByWeek(marketData);
        const trendTable = [['Week', 'Total Market Clicks', 'Our Click Share (%)']];
        aggData.forEach(d => {
            trendTable.push([d.week, d.clicks, d.our_share]);
        });
        
        const dataTrend = google.visualization.arrayToDataTable(trendTable);
        const optionsTrend = {
            seriesType: 'bars',
            series: {1: {type: 'line', targetAxisIndex: 1, color: '#0071e3', lineWidth: 3}},
            colors: ['#e5e5ea'],
            vAxes: {0: {title: 'Volume'}, 1: {title: 'Share %', format: '#\'%\''}},
            legend: {position: 'bottom'},
            chartArea: {width: '85%', height: '75%'},
            animation: { startup: true, duration: 800 }
        };
        new google.visualization.ComboChart(document.getElementById('chart_trend')).draw(dataTrend, optionsTrend);

        // CHART 2: BRAND SHARE (Line Chart)
        const brandDataRaw = aggregateByBrandWeek(marketData);
        // Pivot data for Google Charts
        const weeks = [...new Set(brandDataRaw.map(d => d.week))].sort();
        const topBrands = ['NaturaleBio', 'SuperSelf', 'Perfect Ted']; 
        
        const shareTable = [['Week', ...topBrands]];
        weeks.forEach(w => {
            const row = [w];
            topBrands.forEach(b => {
                const found = brandDataRaw.find(d => d.week === w && d.brand === b);
                row.push(found ? found.share : 0);
            });
            shareTable.push(row);
        });

        const dataShare = google.visualization.arrayToDataTable(shareTable);
        const optionsShare = {
            curveType: 'function',
            colors: ['#0071e3', '#34c759', '#ff3b30'], // Blue (Us), Green (Comp 1), Red (Comp 2)
            legend: {position: 'bottom'},
            vAxis: {title: 'Click Share %'},
            chartArea: {width: '85%', height: '75%'},
            lineWidth: 3,
            pointSize: 5
        };
        new google.visualization.LineChart(document.getElementById('chart_share')).draw(dataShare, optionsShare);

        // CHART 3: SCATTER (Rank vs Share)
        // Filter for latest week
        const latestWeek = weeks[weeks.length - 1];
        const scatterRaw = marketData.filter(d => d.week_date === latestWeek);
        const scatterTable = [['ID', 'Rank', 'Click Share', 'Brand', 'Size']];
        scatterRaw.forEach(d => {
            // Tooltip trick: put brand in label
            scatterTable.push([d.brand + ' (' + d.asin + ')', d.rank, d.click_share, d.brand, d.click_share]);
        });

        const dataScatter = google.visualization.arrayToDataTable(scatterTable);
        const optionsScatter = {
            hAxis: {title: 'Organic Rank (Lower is Better)', direction: 1, viewWindow: {min: 0}},
            vAxis: {title: 'Click Share %'},
            bubble: {textStyle: {fontSize: 11}},
            colors: ['#8e8e93', '#0071e3', '#ff3b30', '#34c759'], // Simple palette mapping
            legend: {position: 'right'},
            chartArea: {width: '80%', height: '80%'}
        };
        // Using BubbleChart to visualize 3D data (Rank, Share, Brand)
        new google.visualization.BubbleChart(document.getElementById('chart_scatter')).draw(dataScatter, optionsScatter);
    }

    // TAB LOGIC
    window.switchTab = function(tabId) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        
        document.getElementById(tabId).classList.add('active');
        event.target.classList.add('active');
        
        if (tabId === 'interactive') drawInteractive();
    };

    // INTERACTIVE LOGIC
    function populateControls() {
        const weeks = [...new Set(marketData.map(d => d.week_date))].sort();
        const brands = [...new Set(marketData.map(d => d.brand))].sort();
        
        const weekSel = document.getElementById('weekSelect');
        weeks.forEach(w => {
            const opt = document.createElement('option');
            opt.value = w;
            opt.text = w;
            weekSel.add(opt);
        });

        const brandSel = document.getElementById('compSelect');
        brands.forEach(b => {
            const opt = document.createElement('option');
            opt.value = b;
            opt.text = b;
            brandSel.add(opt);
        });
    }

    window.drawInteractive = function() {
        const weekVal = document.getElementById('weekSelect').value;
        const brandVal = document.getElementById('compSelect').value;

        let filtered = marketData;
        if (weekVal !== 'all') filtered = filtered.filter(d => d.week_date === weekVal);
        if (brandVal !== 'all') filtered = filtered.filter(d => d.brand === brandVal);

        const tableData = [['Week', 'Brand', 'ASIN', 'Title', 'Price', 'Rank', 'Share %', 'Coupons']];
        filtered.forEach(d => {
            tableData.push([
                d.week_date, 
                d.brand, 
                d.asin, 
                d.product_title.substring(0, 30) + '...',
                d.price, 
                d.rank, 
                d.click_share,
                d.coupon_days > 0 ? 'Yes' : 'No'
            ]);
        });

        const data = google.visualization.arrayToDataTable(tableData);
        const table = new google.visualization.Table(document.getElementById('dynamic_table_div'));
        table.draw(data, {showRowNumber: true, width: '100%', height: '100%'});
    };

</script>
</body>
</html>