<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Parent ASIN Intelligence Report</title>
    
    <!-- Google Charts Loader -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --google-blue: #4285F4;
            --google-red: #EA4335;
            --google-yellow: #FBBC05;
            --google-green: #34A853;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-700: #495057;
            --gray-900: #212529;
            --shadow-sm: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--gray-100);
            margin: 0;
            padding: 20px;
            color: var(--gray-900);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header */
        header {
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; font-size: 24px; font-weight: 700; color: var(--gray-900); }
        .subtitle { color: var(--gray-700); font-size: 14px; margin-top: 4px; }

        /* Tabs */
        .tabs { display: flex; gap: 12px; margin-bottom: 24px; }
        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: white;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: var(--shadow-sm);
            transition: all 0.2s;
            color: var(--gray-700);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .tab-btn.active {
            background: var(--google-blue);
            color: white;
        }
        .tab-btn:hover:not(.active) { background: var(--gray-200); }

        /* Content Sections */
        .section-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-sm);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--google-blue);
        }

        /* Charts */
        .chart-container {
            width: 100%;
            height: 400px;
        }

        /* Grid Layouts */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; }

        /* KPI Cards */
        .kpi-card {
            background: var(--gray-100);
            padding: 16px;
            border-radius: 12px;
            text-align: center;
        }
        .kpi-value { font-size: 24px; font-weight: 700; color: var(--gray-900); }
        .kpi-label { font-size: 12px; color: var(--gray-700); text-transform: uppercase; letter-spacing: 0.5px; }

        /* Insights List */
        .insight-list { list-style: none; padding: 0; }
        .insight-item {
            padding: 12px;
            border-left: 4px solid var(--google-blue);
            background: var(--gray-100);
            margin-bottom: 8px;
            border-radius: 0 8px 8px 0;
            font-size: 14px;
        }
        .insight-item.warning { border-color: var(--google-red); }
        .insight-item.success { border-color: var(--google-green); }

        /* Interactive Section */
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            background: white;
            padding: 16px;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
        }
        select {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
            font-size: 14px;
            min-width: 200px;
        }

        .comparison-vs {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 24px;
        }
        .brand-pill {
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 18px;
        }
        .pill-us { background: rgba(66, 133, 244, 0.1); color: var(--google-blue); }
        .pill-them { background: rgba(234, 67, 53, 0.1); color: var(--google-red); }

        /* Utility */
        .hidden { display: none; }
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        .badge-deal { background: #FCE8E6; color: #C5221F; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1>Market Intelligence Report: Parent ASIN Analysis</h1>
            <div class="subtitle" id="report-date-range">Analysing Last 5 Weeks</div>
        </div>
        <div style="text-align: right;">
            <div class="subtitle">Focus Brand</div>
            <div style="font-weight: 700; color: var(--google-blue);" id="our-brand-name">Detecting...</div>
        </div>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('static')">
            <span class="material-icons">assessment</span> Static Report
        </button>
        <button class="tab-btn" onclick="switchTab('interactive')">
            <span class="material-icons">compare_arrows</span> Interactive Comparator
        </button>
    </div>

    <!-- TAB 1: STATIC REPORT -->
    <div id="tab-static">
        <!-- Section 1: Global Trend -->
        <div class="section-card">
            <div class="section-title">
                <span class="material-icons">trending_up</span> 1. Tendencia Global del Parent (Clicks & Share)
            </div>
            <div id="chart_trend" class="chart-container"></div>
            <div class="insight-list" id="insights_trend"></div>
        </div>

        <!-- Section 2: Brand Competitiveness -->
        <div class="section-card">
            <div class="section-title">
                <span class="material-icons">pie_chart</span> 2. Competitividad de Marca (Click Share Evolution)
            </div>
            <div id="chart_share" class="chart-container"></div>
            <p style="font-size: 13px; color: #666; margin-top: 10px;">
                *Comparativa de Nuestra Marca vs Top 3 Competidores y Resto del Mercado.
            </p>
        </div>

        <!-- Section 3 & 4 Split -->
        <div class="grid-2">
            <!-- Section 3: Levers -->
            <div class="section-card">
                <div class="section-title">
                    <span class="material-icons">rocket_launch</span> 3. Palancas de Click Share
                </div>
                <div id="table_levers" style="width: 100%; min-height: 200px;"></div>
                <div class="insight-list" id="insights_levers" style="margin-top: 16px;"></div>
            </div>

            <!-- Section 4: Efficiency -->
            <div class="section-card">
                <div class="section-title">
                    <span class="material-icons">gps_fixed</span> 4. Eficiencia (Rank vs Share)
                </div>
                <div id="chart_efficiency" class="chart-container" style="height: 300px;"></div>
                <div class="insight-list" id="insights_efficiency"></div>
            </div>
        </div>

        <!-- Section 5: Conclusions -->
        <div class="section-card" style="border-left: 6px solid var(--google-yellow);">
            <div class="section-title">
                <span class="material-icons">lightbulb</span> 5. Conclusiones Clave y Recomendaciones
            </div>
            <div class="grid-2">
                <div>
                    <h4 style="margin-top:0;">Insights Clave</h4>
                    <ul class="insight-list" id="final_insights"></ul>
                </div>
                <div>
                    <h4 style="margin-top:0;">Recomendaciones Accionables</h4>
                    <ul class="insight-list" id="final_recommendations"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB 2: INTERACTIVE COMPARATOR -->
    <div id="tab-interactive" class="hidden">
        <div class="controls">
            <div>
                <label style="display:block; font-size:12px; color:#666; margin-bottom:4px;">Select Week</label>
                <select id="sel_week" onchange="updateInteractive()"></select>
            </div>
            <div>
                <label style="display:block; font-size:12px; color:#666; margin-bottom:4px;">Select Competitor</label>
                <select id="sel_comp" onchange="updateInteractive()"></select>
            </div>
        </div>

        <div class="comparison-vs">
            <div class="brand-pill pill-us" id="vs_us">Us</div>
            <span class="material-icons" style="color: #999;">cancel</span>
            <div class="brand-pill pill-them" id="vs_them">Them</div>
        </div>

        <div class="grid-3">
            <div class="kpi-card">
                <div class="kpi-label">Price Gap</div>
                <div class="kpi-value" id="kpi_price">--</div>
                <div style="font-size:12px; color:#666;" id="kpi_price_sub"></div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Share Gap</div>
                <div class="kpi-value" id="kpi_share">--</div>
                <div style="font-size:12px; color:#666;" id="kpi_share_sub"></div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Rank Gap</div>
                <div class="kpi-value" id="kpi_rank">--</div>
                <div style="font-size:12px; color:#666;" id="kpi_rank_sub"></div>
            </div>
        </div>

        <div class="section-card" style="margin-top: 24px;">
            <div class="section-title">Head-to-Head Attributes</div>
            <div id="table_comparison"></div>
        </div>
    </div>
</div>

<script>
    // ------------------------------------------------------------------
    // 1. DATA INJECTION (Synthetic Data used as placeholder)
    // ------------------------------------------------------------------
    const marketData = [{"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-01", "week_date": "2023-10-01", "keywords": "wireless earbuds", "competitor_brand": "YabaTech", "asin": "B00YABA001", "product_title": "YabaTech Wireless Earbuds Pro", "country_code": "US", "average_organic_rank": 3, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1418, "impression_share": 0.1702, "price": 49.99, "click_share_rank": 0, "weekly_search_volume": 10599, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/s?k=YabaTech+Wireless+Earbuds+Pro", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 1502}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-01", "week_date": "2023-10-01", "keywords": "wireless earbuds", "competitor_brand": "YabaTech", "asin": "B00YABA002", "product_title": "YabaTech Wireless Earbuds Lite", "country_code": "US", "average_organic_rank": 10, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.053, "impression_share": 0.0636, "price": 29.99, "click_share_rank": 0, "weekly_search_volume": 10599, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/s?k=YabaTech+Wireless+Earbuds+Lite", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 561}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-01", "week_date": "2023-10-01", "keywords": "wireless earbuds", "competitor_brand": "SonicBoom", "asin": "B00COMP001", "product_title": "SonicBoom Bass Master", "country_code": "US", "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1882, "impression_share": 0.2258, "price": 55.0, "click_share_rank": 0, "weekly_search_volume": 10599, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=SonicBoom+Bass+Master", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 1994}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-01", "week_date": "2023-10-01", "keywords": "wireless earbuds", "competitor_brand": "AudioX", "asin": "B00COMP002", "product_title": "AudioX Clear Sound", "country_code": "US", "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1287, "impression_share": 0.1544, "price": 45.0, "click_share_rank": 0, "weekly_search_volume": 10599, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=AudioX+Clear+Sound", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 1364}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-01", "week_date": "2023-10-01", "keywords": "wireless earbuds", "competitor_brand": "CheapBuds", "asin": "B00COMP003", "product_title": "Generic Buds White", "country_code": "US", "average_organic_rank": 21, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0863, "impression_share": 0.1036, "price": 15.0, "click_share_rank": 0, "weekly_search_volume": 10599, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=Generic+Buds+White", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 914}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-01", "week_date": "2023-10-01", "keywords": "wireless earbuds", "competitor_brand": null, "asin": "B00COMP004", "product_title": "Unknown Brand Sport Headphones", "country_code": "US", "average_organic_rank": 23, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0278, "impression_share": 0.0334, "price": 20.0, "click_share_rank": 0, "weekly_search_volume": 10599, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=Unknown+Brand+Sport+Headphones", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 294}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-08", "week_date": "2023-10-08", "keywords": "wireless earbuds", "competitor_brand": "YabaTech", "asin": "B00YABA001", "product_title": "YabaTech Wireless Earbuds Pro", "country_code": "US", "average_organic_rank": 5, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1601, "impression_share": 0.1921, "price": 49.99, "click_share_rank": 0, "weekly_search_volume": 10074, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/s?k=YabaTech+Wireless+Earbuds+Pro", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 1612}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-08", "week_date": "2023-10-08", "keywords": "wireless earbuds", "competitor_brand": "YabaTech", "asin": "B00YABA002", "product_title": "YabaTech Wireless Earbuds Lite", "country_code": "US", "average_organic_rank": 10, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0543, "impression_share": 0.0652, "price": 29.99, "click_share_rank": 0, "weekly_search_volume": 10074, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/s?k=YabaTech+Wireless+Earbuds+Lite", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 547}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-08", "week_date": "2023-10-08", "keywords": "wireless earbuds", "competitor_brand": "SonicBoom", "asin": "B00COMP001", "product_title": "SonicBoom Bass Master", "country_code": "US", "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.2033, "impression_share": 0.244, "price": 55.0, "click_share_rank": 0, "weekly_search_volume": 10074, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=SonicBoom+Bass+Master", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 2048}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-08", "week_date": "2023-10-08", "keywords": "wireless earbuds", "competitor_brand": "AudioX", "asin": "B00COMP002", "product_title": "AudioX Clear Sound", "country_code": "US", "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1226, "impression_share": 0.1471, "price": 45.0, "click_share_rank": 0, "weekly_search_volume": 10074, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=AudioX+Clear+Sound", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 1235}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-08", "week_date": "2023-10-08", "keywords": "wireless earbuds", "competitor_brand": "CheapBuds", "asin": "B00COMP003", "product_title": "Generic Buds White", "country_code": "US", "average_organic_rank": 19, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0862, "impression_share": 0.1034, "price": 15.0, "click_share_rank": 0, "weekly_search_volume": 10074, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=Generic+Buds+White", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 868}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-08", "week_date": "2023-10-08", "keywords": "wireless earbuds", "competitor_brand": null, "asin": "B00COMP004", "product_title": "Unknown Brand Sport Headphones", "country_code": "US", "average_organic_rank": 26, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0309, "impression_share": 0.0371, "price": 20.0, "click_share_rank": 0, "weekly_search_volume": 10074, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=Unknown+Brand+Sport+Headphones", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 311}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-15", "week_date": "2023-10-15", "keywords": "wireless earbuds", "competitor_brand": "YabaTech", "asin": "B00YABA001", "product_title": "YabaTech Wireless Earbuds Pro", "country_code": "US", "average_organic_rank": 1, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.2291, "impression_share": 0.2749, "price": 39.992, "click_share_rank": 0, "weekly_search_volume": 10565, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/s?k=YabaTech+Wireless+Earbuds+Pro", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 2420}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-15", "week_date": "2023-10-15", "keywords": "wireless earbuds", "competitor_brand": "YabaTech", "asin": "B00YABA002", "product_title": "YabaTech Wireless Earbuds Lite", "country_code": "US", "average_organic_rank": 9, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0759, "impression_share": 0.0911, "price": 23.992, "click_share_rank": 0, "weekly_search_volume": 10565, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/s?k=YabaTech+Wireless+Earbuds+Lite", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 801}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-15", "week_date": "2023-10-15", "keywords": "wireless earbuds", "competitor_brand": "SonicBoom", "asin": "B00COMP001", "product_title": "SonicBoom Bass Master", "country_code": "US", "average_organic_rank": 4, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1843, "impression_share": 0.2212, "price": 55.0, "click_share_rank": 0, "weekly_search_volume": 10565, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=SonicBoom+Bass+Master", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 1947}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-15", "week_date": "2023-10-15", "keywords": "wireless earbuds", "competitor_brand": "AudioX", "asin": "B00COMP002", "product_title": "AudioX Clear Sound", "country_code": "US", "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1306, "impression_share": 0.1567, "price": 45.0, "click_share_rank": 0, "weekly_search_volume": 10565, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=AudioX+Clear+Sound", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 1379}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-15", "week_date": "2023-10-15", "keywords": "wireless earbuds", "competitor_brand": "CheapBuds", "asin": "B00COMP003", "product_title": "Generic Buds White", "country_code": "US", "average_organic_rank": 20, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0822, "impression_share": 0.0986, "price": 15.0, "click_share_rank": 0, "weekly_search_volume": 10565, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=Generic+Buds+White", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 868}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-15", "week_date": "2023-10-15", "keywords": "wireless earbuds", "competitor_brand": null, "asin": "B00COMP004", "product_title": "Unknown Brand Sport Headphones", "country_code": "US", "average_organic_rank": 26, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.033, "impression_share": 0.0396, "price": 20.0, "click_share_rank": 0, "weekly_search_volume": 10565, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=Unknown+Brand+Sport+Headphones", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 348}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-22", "week_date": "2023-10-22", "keywords": "wireless earbuds", "competitor_brand": "YabaTech", "asin": "B00YABA001", "product_title": "YabaTech Wireless Earbuds Pro", "country_code": "US", "average_organic_rank": 4, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1587, "impression_share": 0.1904, "price": 49.99, "click_share_rank": 0, "weekly_search_volume": 10834, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/s?k=YabaTech+Wireless+Earbuds+Pro", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 1719}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-22", "week_date": "2023-10-22", "keywords": "wireless earbuds", "competitor_brand": "YabaTech", "asin": "B00YABA002", "product_title": "YabaTech Wireless Earbuds Lite", "country_code": "US", "average_organic_rank": 14, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0461, "impression_share": 0.0553, "price": 29.99, "click_share_rank": 0, "weekly_search_volume": 10834, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/s?k=YabaTech+Wireless+Earbuds+Lite", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 499}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-22", "week_date": "2023-10-22", "keywords": "wireless earbuds", "competitor_brand": "SonicBoom", "asin": "B00COMP001", "product_title": "SonicBoom Bass Master", "country_code": "US", "average_organic_rank": 4, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1914, "impression_share": 0.2297, "price": 55.0, "click_share_rank": 0, "weekly_search_volume": 10834, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=SonicBoom+Bass+Master", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 2073}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-22", "week_date": "2023-10-22", "keywords": "wireless earbuds", "competitor_brand": "AudioX", "asin": "B00COMP002", "product_title": "AudioX Clear Sound", "country_code": "US", "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1177, "impression_share": 0.1412, "price": 45.0, "click_share_rank": 0, "weekly_search_volume": 10834, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=AudioX+Clear+Sound", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 1275}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-22", "week_date": "2023-10-22", "keywords": "wireless earbuds", "competitor_brand": "CheapBuds", "asin": "B00COMP003", "product_title": "Generic Buds White", "country_code": "US", "average_organic_rank": 21, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0818, "impression_share": 0.0982, "price": 15.0, "click_share_rank": 0, "weekly_search_volume": 10834, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=Generic+Buds+White", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 886}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-22", "week_date": "2023-10-22", "keywords": "wireless earbuds", "competitor_brand": null, "asin": "B00COMP004", "product_title": "Unknown Brand Sport Headphones", "country_code": "US", "average_organic_rank": 23, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.029, "impression_share": 0.0348, "price": 20.0, "click_share_rank": 0, "weekly_search_volume": 10834, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=Unknown+Brand+Sport+Headphones", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 314}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-29", "week_date": "2023-10-29", "keywords": "wireless earbuds", "competitor_brand": "YabaTech", "asin": "B00YABA001", "product_title": "YabaTech Wireless Earbuds Pro", "country_code": "US", "average_organic_rank": 4, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1601, "impression_share": 0.1921, "price": 49.99, "click_share_rank": 0, "weekly_search_volume": 9781, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/s?k=YabaTech+Wireless+Earbuds+Pro", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 1565}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-29", "week_date": "2023-10-29", "keywords": "wireless earbuds", "competitor_brand": "YabaTech", "asin": "B00YABA002", "product_title": "YabaTech Wireless Earbuds Lite", "country_code": "US", "average_organic_rank": 10, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0468, "impression_share": 0.0562, "price": 29.99, "click_share_rank": 0, "weekly_search_volume": 9781, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/s?k=YabaTech+Wireless+Earbuds+Lite", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 457}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-29", "week_date": "2023-10-29", "keywords": "wireless earbuds", "competitor_brand": "SonicBoom", "asin": "B00COMP001", "product_title": "SonicBoom Bass Master", "country_code": "US", "average_organic_rank": 5, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 5, "click_share": 0.2825, "impression_share": 0.339, "price": 46.75, "click_share_rank": 0, "weekly_search_volume": 9781, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=SonicBoom+Bass+Master", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 2763}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-29", "week_date": "2023-10-29", "keywords": "wireless earbuds", "competitor_brand": "AudioX", "asin": "B00COMP002", "product_title": "AudioX Clear Sound", "country_code": "US", "average_organic_rank": 10, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1176, "impression_share": 0.1411, "price": 45.0, "click_share_rank": 0, "weekly_search_volume": 9781, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=AudioX+Clear+Sound", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 1150}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-29", "week_date": "2023-10-29", "keywords": "wireless earbuds", "competitor_brand": "CheapBuds", "asin": "B00COMP003", "product_title": "Generic Buds White", "country_code": "US", "average_organic_rank": 20, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0818, "impression_share": 0.0982, "price": 15.0, "click_share_rank": 0, "weekly_search_volume": 9781, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=Generic+Buds+White", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 800}, {"brand_aggregation": "Headphones", "parent_asin": "PARENT123", "reporting_date": "2023-10-29", "week_date": "2023-10-29", "keywords": "wireless earbuds", "competitor_brand": null, "asin": "B00COMP004", "product_title": "Unknown Brand Sport Headphones", "country_code": "US", "average_organic_rank": 24, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0323, "impression_share": 0.0388, "price": 20.0, "click_share_rank": 0, "weekly_search_volume": 9781, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/s?k=Unknown+Brand+Sport+Headphones", "grams": 200, "organic_or_not": "Organic", "container": "Box", "clicks": 315}];

    // ------------------------------------------------------------------
    // 2. DATA PROCESSING LOGIC
    // ------------------------------------------------------------------
    
    // Globals
    let processedData = [];
    let ourBrandName = "Unknown";
    let topCompetitors = [];
    let weeks = [];
    let allCompetitors = [];

    function init() {
        // 2.1 Brand Identification Logic
        marketData.forEach(row => {
            // Fix Null Brands
            if (!row.competitor_brand) {
                // Try to infer from title (simple heuristic)
                if (row.product_title) row.competitor_brand = "Unknown Brand"; // Simplified for prompt
                else row.competitor_brand = "Unknown Brand";
            }
            
            // Identify Our Brand
            if (row.is_yaba_asin === 'Y') {
                ourBrandName = row.competitor_brand;
            }
        });

        // 2.2 Global State setup
        weeks = [...new Set(marketData.map(d => d.week_date))].sort();
        document.getElementById('report-date-range').innerText = `Data from ${weeks[0]} to ${weeks[weeks.length-1]}`;
        document.getElementById('our-brand-name').innerText = ourBrandName;
        document.getElementById('vs_us').innerText = ourBrandName;

        // 2.3 Identify Top 3 Competitors (by Total Click Share Volume)
        const brandShares = {};
        marketData.forEach(row => {
            if (row.competitor_brand !== ourBrandName) {
                if (!brandShares[row.competitor_brand]) brandShares[row.competitor_brand] = 0;
                brandShares[row.competitor_brand] += row.click_share;
            }
        });
        topCompetitors = Object.entries(brandShares)
            .sort((a,b) => b[1] - a[1])
            .slice(0, 3)
            .map(entry => entry[0]);
            
        allCompetitors = Object.keys(brandShares);

        // Populate Interactive Dropdowns
        const weekSel = document.getElementById('sel_week');
        weeks.forEach(w => {
            let opt = document.createElement('option');
            opt.value = w;
            opt.innerText = w;
            weekSel.appendChild(opt);
        });
        weekSel.value = weeks[weeks.length-1]; // Select last week

        const compSel = document.getElementById('sel_comp');
        topCompetitors.forEach(c => {
            let opt = document.createElement('option');
            opt.value = c;
            opt.innerText = c;
            compSel.appendChild(opt);
        });

        // Load Charts
        google.charts.load('current', {'packages':['corechart', 'table']});
        google.charts.setOnLoadCallback(drawDashboard);
    }

    // ------------------------------------------------------------------
    // 3. DRAWING FUNCTIONS
    // ------------------------------------------------------------------
    
    function drawDashboard() {
        drawTrendChart();
        drawShareChart();
        drawLeversTable();
        drawEfficiencyChart();
        generateInsights();
        updateInteractive();
    }

    function drawTrendChart() {
        // Prepare Data: Week | Our Clicks | Comp Clicks | Our Share (Line)
        const dataMap = {};
        weeks.forEach(w => dataMap[w] = { us: 0, them: 0, share: 0 });

        marketData.forEach(row => {
            if (row.is_yaba_asin === 'Y') {
                dataMap[row.week_date].us += row.clicks;
                dataMap[row.week_date].share += row.click_share; // Approximate aggregation
            } else {
                dataMap[row.week_date].them += row.clicks;
            }
        });

        const chartData = [['Week', 'Our Clicks', 'Competitor Clicks', 'Our Click Share']];
        weeks.forEach(w => {
            chartData.push([w, dataMap[w].us, dataMap[w].them, dataMap[w].share]);
        });

        const data = google.visualization.arrayToDataTable(chartData);
        const options = {
            seriesType: 'bars',
            series: { 2: { type: 'line', targetAxisIndex: 1, color: '#EA4335', lineWidth: 3 } },
            colors: ['#4285F4', '#E0E0E0'],
            vAxes: { 0: {title: 'Clicks'}, 1: {title: 'Share', format: '#%'} },
            legend: { position: 'bottom' },
            animation: { startup: true, duration: 1000, easing: 'out' }
        };

        const chart = new google.visualization.ComboChart(document.getElementById('chart_trend'));
        chart.draw(data, options);
    }

    function drawShareChart() {
        // Prepare Data: Week | Our Brand | Comp 1 | Comp 2 | Comp 3 | Others
        const chartData = [['Week', ourBrandName, ...topCompetitors, 'Others']];
        
        weeks.forEach(w => {
            let row = [w, 0, 0, 0, 0, 0];
            marketData.filter(d => d.week_date === w).forEach(d => {
                if (d.competitor_brand === ourBrandName) row[1] += d.click_share;
                else if (d.competitor_brand === topCompetitors[0]) row[2] += d.click_share;
                else if (d.competitor_brand === topCompetitors[1]) row[3] += d.click_share;
                else if (d.competitor_brand === topCompetitors[2]) row[4] += d.click_share;
                else row[5] += d.click_share;
            });
            chartData.push(row);
        });

        const data = google.visualization.arrayToDataTable(chartData);
        const options = {
            curveType: 'function',
            colors: ['#4285F4', '#34A853', '#EA4335', '#FBBC05', '#999'],
            lineWidth: 2,
            vAxis: { format: '#%' },
            legend: { position: 'bottom' },
            pointSize: 5
        };

        const chart = new google.visualization.LineChart(document.getElementById('chart_share'));
        chart.draw(data, options);
    }

    function drawLeversTable() {
        // Aggregate Impact: When Deal > 0 vs Deal = 0
        // We calculate Average Click Share for Our Brand when Deal is Active vs Inactive
        
        let dealShareSum = 0, dealCount = 0;
        let noDealShareSum = 0, noDealCount = 0;
        
        marketData.filter(d => d.is_yaba_asin === 'Y').forEach(d => {
            if (d.weekly_number_of_days_with_deal > 0 || d.weekly_number_of_days_with_coupon > 0) {
                dealShareSum += d.click_share;
                dealCount++;
            } else {
                noDealShareSum += d.click_share;
                noDealCount++;
            }
        });

        const avgDeal = dealCount ? (dealShareSum/dealCount) : 0;
        const avgNoDeal = noDealCount ? (noDealShareSum/noDealCount) : 0;
        const lift = avgNoDeal ? ((avgDeal - avgNoDeal) / avgNoDeal) : 0;

        const data = google.visualization.arrayToDataTable([
            ['Scenario', 'Avg Click Share', { role: 'style' }],
            ['Baseline (No Promo)', avgNoDeal, 'color: #999'],
            ['With Promo (Deal/Cpn)', avgDeal, 'color: #34A853']
        ]);

        const options = {
            legend: { position: 'none' },
            vAxis: { format: '#%' },
            hAxis: { title: `Calculated Lift: ${(lift*100).toFixed(1)}%` }
        };

        const chart = new google.visualization.ColumnChart(document.getElementById('table_levers'));
        chart.draw(data, options);

        // Insight generation for this section
        const div = document.getElementById('insights_levers');
        if (lift > 0.1) div.innerHTML = `<li class="insight-item success">Promotions drive a significant <b>+${(lift*100).toFixed(0)}%</b> lift in Click Share.</li>`;
        else div.innerHTML = `<li class="insight-item warning">Promotions show low elasticity (Lift < 10%). Review discount depth.</li>`;
    }

    function drawEfficiencyChart() {
        // X: Rank, Y: Click Share, Color: Us vs Them (Last Week Only)
        const lastWeek = weeks[weeks.length-1];
        const dataRows = [['Rank', 'Click Share', {'type': 'string', 'role': 'style'}, {'type': 'string', 'role': 'tooltip'}]];
        
        marketData.filter(d => d.week_date === lastWeek).forEach(d => {
            const color = d.is_yaba_asin === 'Y' ? '#4285F4' : '#CCC';
            const tooltip = `${d.product_title}\nRank: ${d.average_organic_rank}\nShare: ${(d.click_share*100).toFixed(2)}%`;
            dataRows.push([d.average_organic_rank, d.click_share, `point { fill-color: ${color}; size: 10; }`, tooltip]);
        });

        const data = google.visualization.arrayToDataTable(dataRows);
        const options = {
            hAxis: { title: 'Organic Rank (Lower is Better)', direction: 1 },
            vAxis: { title: 'Click Share', format: '#%' },
            legend: 'none'
        };

        const chart = new google.visualization.ScatterChart(document.getElementById('chart_efficiency'));
        chart.draw(data, options);
    }

    // ------------------------------------------------------------------
    // 4. TEXT & INSIGHTS GENERATION
    // ------------------------------------------------------------------

    function generateInsights() {
        // Trend Insights
        const lastWeek = weeks[weeks.length-1];
        const prevWeek = weeks[weeks.length-2];
        
        let usClicksLast = 0, usClicksPrev = 0;
        let usShareLast = 0, usSharePrev = 0;
        
        marketData.forEach(d => {
            if (d.is_yaba_asin === 'Y') {
                if (d.week_date === lastWeek) { usClicksLast += d.clicks; usShareLast += d.click_share; }
                if (d.week_date === prevWeek) { usClicksPrev += d.clicks; usSharePrev += d.click_share; }
            }
        });

        const trendDiv = document.getElementById('insights_trend');
        let trendHtml = "";
        
        if (usClicksLast > usClicksPrev) trendHtml += `<li class="insight-item success">Positive Momentum: Clicks grew by ${Math.round((usClicksLast-usClicksPrev)/usClicksPrev*100)}% week-over-week.</li>`;
        else trendHtml += `<li class="insight-item warning">Warning: Clicks dropped by ${Math.round((usClicksPrev-usClicksLast)/usClicksPrev*100)}% last week.</li>`;
        
        if (usShareLast < usSharePrev) trendHtml += `<li class="insight-item warning">Market Share Loss: We lost visibility to competitors in the last period.</li>`;
        
        trendDiv.innerHTML = trendHtml;

        // Final Conclusions
        const concl = document.getElementById('final_insights');
        const recs = document.getElementById('final_recommendations');
        
        // Automated Text Generation based on data patterns
        concl.innerHTML = `
            <li class="insight-item">Our brand holds a <b>${(usShareLast*100).toFixed(1)}%</b> total click share in the most recent week.</li>
            <li class="insight-item">Top competitor <b>${topCompetitors[0]}</b> is the primary threat.</li>
            <li class="insight-item">${usShareLast > usSharePrev ? "We are currently gaining ground." : "We are losing ground to aggressive competitor moves."}</li>
            <li class="insight-item">Organic Rank correlation suggests visibility is the primary driver of share for this parent.</li>
            <li class="insight-item">Deals effectiveness is ${usShareLast > 0.2 ? "high" : "moderate"} in this category.</li>
        `;

        recs.innerHTML = `
            <li class="insight-item success"><b>Protect Top ASINs:</b> Ensure defensive ads on branded keywords against ${topCompetitors[0]}.</li>
            <li class="insight-item success"><b>Price/Promo:</b> Activate coupons on underperforming variants to regain rank efficiency.</li>
            <li class="insight-item success"><b>Content:</b> Review main image for variants with high rank but low click share (CTR issue).</li>
        `;
    }

    // ------------------------------------------------------------------
    // 5. INTERACTIVE LOGIC
    // ------------------------------------------------------------------

    function updateInteractive() {
        const week = document.getElementById('sel_week').value;
        const comp = document.getElementById('sel_comp').value;
        
        document.getElementById('vs_them').innerText = comp;

        // Filter Data
        const usData = marketData.filter(d => d.week_date === week && d.competitor_brand === ourBrandName);
        const themData = marketData.filter(d => d.week_date === week && d.competitor_brand === comp);

        if (usData.length === 0 || themData.length === 0) return;

        // Calculate Weighted Avgs
        const calcAvg = (data, field) => data.reduce((sum, d) => sum + d[field] * d.clicks, 0) / data.reduce((sum, d) => sum + d.clicks, 0);
        const calcSum = (data, field) => data.reduce((sum, d) => sum + d[field], 0);

        const usPrice = calcAvg(usData, 'price');
        const themPrice = calcAvg(themData, 'price');
        const usShare = calcSum(usData, 'click_share');
        const themShare = calcSum(themData, 'click_share');
        const usRank = calcAvg(usData, 'average_organic_rank');
        const themRank = calcAvg(themData, 'average_organic_rank');

        // Render Cards
        const renderGap = (id, u, t, isInv, format='$') => {
            const diff = u - t;
            const el = document.getElementById(id);
            const sub = document.getElementById(id+'_sub');
            
            let valStr = format === '$' ? diff.toFixed(2) : (diff*100).toFixed(1)+'%';
            if (format === '#') valStr = diff.toFixed(1);

            el.innerText = (diff > 0 ? "+" : "") + valStr;
            
            // Color Logic
            let good = isInv ? diff < 0 : diff > 0;
            el.style.color = good ? 'var(--google-green)' : 'var(--google-red)';
            
            sub.innerText = `Us: ${format==='$'?'$':''}${u.toFixed(2)} vs Them: ${format==='$'?'$':''}${t.toFixed(2)}`;
        };

        renderGap('kpi_price', usPrice, themPrice, true, '$'); // Lower price usually better for conversion, simplistic view
        renderGap('kpi_share', usShare, themShare, false, '%');
        renderGap('kpi_rank', usRank, themRank, true, '#');

        // Render Comparison Table
        const tableData = [
            ['Metric', 'Us', 'Them'],
            ['Deal Days', calcSum(usData, 'weekly_number_of_days_with_deal'), calcSum(themData, 'weekly_number_of_days_with_deal')],
            ['Coupon Days', calcSum(usData, 'weekly_number_of_days_with_coupon'), calcSum(themData, 'weekly_number_of_days_with_coupon')],
            ['Best Seller Badges', calcSum(usData, 'weekly_number_of_days_with_best_seller_badge'), calcSum(themData, 'weekly_number_of_days_with_best_seller_badge')],
            ['Amazon Choice', calcSum(usData, 'weekly_number_of_days_with_amazon_choice_badge'), calcSum(themData, 'weekly_number_of_days_with_amazon_choice_badge')],
        ];
        
        const data = google.visualization.arrayToDataTable(tableData);
        const table = new google.visualization.Table(document.getElementById('table_comparison'));
        table.draw(data, {showRowNumber: false, width: '100%', height: '100%'});
    }

    function switchTab(tab) {
        if(tab === 'static') {
            document.getElementById('tab-static').classList.remove('hidden');
            document.getElementById('tab-interactive').classList.add('hidden');
            document.querySelectorAll('.tab-btn')[0].classList.add('active');
            document.querySelectorAll('.tab-btn')[1].classList.remove('active');
        } else {
            document.getElementById('tab-static').classList.add('hidden');
            document.getElementById('tab-interactive').classList.remove('hidden');
            document.querySelectorAll('.tab-btn')[0].classList.remove('active');
            document.querySelectorAll('.tab-btn')[1].classList.add('active');
            updateInteractive(); // Force redraw
        }
    }

    // Initialize
    init();

</script>
</body>
</html>