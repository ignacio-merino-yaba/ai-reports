<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Inteligencia de Mercado: Cacao Powder</title>
    
    <!-- Google Charts Loader -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Google Fonts (Roboto) -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #4285F4; /* Google Blue */
            --success-color: #34A853; /* Google Green */
            --warning-color: #FBBC05; /* Google Yellow */
            --danger-color: #EA4335;  /* Google Red */
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #202124;
            --gray-text: #5f6368;
            --border-radius: 16px;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: var(--card-bg);
            padding: 24px 0;
            margin-bottom: 24px;
            box-shadow: 0 1px 2px rgba(60,64,67,0.3), 0 2px 6px 2px rgba(60,64,67,0.15);
            border-bottom-left-radius: var(--border-radius);
            border-bottom-right-radius: var(--border-radius);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 24px;
            font-weight: 400;
            color: var(--text-color);
            margin: 0;
        }

        .brand-badge {
            background-color: #e8f0fe;
            color: var(--primary-color);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 500;
            color: var(--gray-text);
            cursor: pointer;
            border-radius: 24px;
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            transition: all 0.3s cubic-bezier(.25,.8,.25,1);
        }

        .card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.15), 0 8px 16px rgba(0,0,0,0.1);
        }

        .card-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray-text);
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .metric-item {
            background: #f1f3f4;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .metric-label {
            font-size: 12px;
            color: var(--gray-text);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Insights List */
        .insight-list {
            list-style: none;
            padding: 0;
        }

        .insight-item {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #eee;
        }

        .insight-icon {
            color: var(--warning-color);
        }

        .insight-content strong {
            display: block;
            margin-bottom: 4px;
            color: var(--text-color);
        }

        .insight-content p {
            margin: 0;
            font-size: 14px;
            color: var(--gray-text);
            line-height: 1.5;
        }

        /* Recommendations */
        .rec-item {
            background: #e6f4ea;
            border-left: 4px solid var(--success-color);
            padding: 12px 16px;
            margin-bottom: 12px;
            border-radius: 4px;
            font-size: 14px;
        }

        /* Interactive Controls */
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
        }

        select {
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid #dadce0;
            font-size: 14px;
            background: white;
            color: var(--text-color);
            outline: none;
        }

        /* Hidden/Visible Logic */
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive Charts */
        .chart-container {
            width: 100%;
            min-height: 350px;
        }
    </style>
</head>
<body>

    <header>
        <div class="header-content">
            <div>
                <span style="font-size: 12px; text-transform: uppercase; color: var(--gray-text);">Market Intelligence Report</span>
                <h1>Análisis Parent ASIN: <span style="font-weight: 700;">Cacao Powder</span></h1>
            </div>
            <div class="brand-badge">
                Mi Marca: NaturaleBio
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Navigation -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('report')">Reporte Estratégico</button>
            <button class="tab-btn" onclick="switchTab('interactive')">Comparador Interactivo</button>
        </div>

        <!-- TAB 1: STATIC REPORT -->
        <div id="report" class="tab-content active">
            
            <!-- 1. Tendencia Global -->
            <div class="card">
                <div class="card-title">
                    <span class="material-icons">show_chart</span>
                    1. Tendencia Global (Últimas Semanas)
                </div>
                <div class="metrics-grid">
                    <div class="metric-item">
                        <div class="metric-value" style="color: var(--danger-color);">-45%</div>
                        <div class="metric-label">Volumen de Búsqueda (WoW)</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value" style="color: var(--danger-color);">-0.86 pp</div>
                        <div class="metric-label">NaturaleBio Click Share</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">4.0%</div>
                        <div class="metric-label">Share Actual</div>
                    </div>
                </div>
                <div id="trend_chart" class="chart-container"></div>
                <p style="font-size: 13px; color: #666; margin-top: 10px;">
                    <em>Análisis:</em> Fuerte contracción del mercado post-navidad (semana 01 vs 52). En este contexto de baja demanda, <strong>NaturaleBio pierde tracción</strong> significativamente frente a competidores que mantuvieron precios estables o activaron cupones.
                </p>
            </div>

            <!-- 2. Competitividad -->
            <div class="card">
                <div class="card-title">
                    <span class="material-icons">people_outline</span>
                    2. Competitividad de Marca (Share %)
                </div>
                <div id="competitor_chart" class="chart-container"></div>
                <p style="font-size: 13px; color: #666; margin-top: 10px;">
                    <em>Insight:</em> <strong>Kaba</strong> domina y crece (casi 9% share) usando cupones activos. <strong>Alnatura</strong> crece orgánicamente. NaturaleBio cae al 4to lugar en visibilidad.
                </p>
            </div>

            <!-- 3 & 4. Palancas y Eficiencia -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                <div class="card">
                    <div class="card-title">
                        <span class="material-icons">tune</span>
                        3. Palancas de Crecimiento
                    </div>
                    <ul class="insight-list">
                        <li class="insight-item">
                            <span class="material-icons insight-icon" style="color: var(--danger-color);">trending_up</span>
                            <div class="insight-content">
                                <strong>Precio (Impacto Negativo)</strong>
                                <p>NaturaleBio aumentó precio de ~32.7€ a ~34.8€ (+6%) en una semana de baja demanda. Resultado: pérdida directa de Rank y Clicks.</p>
                            </div>
                        </li>
                        <li class="insight-item">
                            <span class="material-icons insight-icon" style="color: var(--success-color);">local_offer</span>
                            <div class="insight-content">
                                <strong>Cupones (Efectivos)</strong>
                                <p>El competidor líder (Kaba) activó cupones en la última semana, capturando cuota de mercado a pesar de la caída del volumen general.</p>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="card">
                    <div class="card-title">
                        <span class="material-icons">scatter_plot</span>
                        4. Eficiencia (Rank vs Share)
                    </div>
                    <div id="efficiency_chart" class="chart-container" style="min-height: 250px;"></div>
                    <p style="font-size: 12px; color: #666; text-align: center;">
                        Eje X: Ranking Orgánico (Menor es mejor) | Eje Y: Click Share
                    </p>
                </div>
            </div>

            <!-- 5. Conclusiones y Recomendaciones -->
            <div class="card" style="border-left: 6px solid var(--primary-color);">
                <div class="card-title">
                    <span class="material-icons">lightbulb</span>
                    5. Conclusiones y Acciones Recomendadas
                </div>
                
                <h3 style="font-size: 16px; margin-top: 0;">Insights Clave</h3>
                <ul class="insight-list">
                    <li class="insight-item">
                        <span class="material-icons insight-icon">warning</span>
                        <div class="insight-content">
                            <strong>Elasticidad Precio Crítica:</strong> El mercado castigó inmediatamente la subida de precio de NaturaleBio (+2€) con una caída de ranking (5 &rarr; 7) y share.
                        </div>
                    </li>
                    <li class="insight-item">
                        <span class="material-icons insight-icon">trending_down</span>
                        <div class="insight-content">
                            <strong>Contracción Estacional:</strong> El volumen de búsqueda se redujo a la mitad tras Navidad. En mercados pequeños, la conversión es vital y los precios altos disuaden.
                        </div>
                    </li>
                    <li class="insight-item">
                        <span class="material-icons insight-icon">verified</span>
                        <div class="insight-content">
                            <strong>Dominio de Tickets Bajos:</strong> Competidores como Kaba (~3€/400g) y Alnatura ganan terreno vs formatos bulk caros (NaturaleBio ~34€/1kg) en esta temporada.
                        </div>
                    </li>
                    <li class="insight-item">
                        <span class="material-icons insight-icon">star</span>
                        <div class="insight-content">
                            <strong>Kaba como Best Practice:</strong> Mantiene Rank 1 y Share 9% combinando precio bajo y activación táctica de cupones.
                        </div>
                    </li>
                    <li class="insight-item">
                        <span class="material-icons insight-icon">visibility_off</span>
                        <div class="insight-content">
                            <strong>Eficiencia Perdida:</strong> NaturaleBio es un "Underperformer" esta semana: tiene buen ranking (7) pero captura menos clicks de lo esperado para esa posición.
                        </div>
                    </li>
                </ul>

                <h3 style="font-size: 16px; margin-top: 20px;">Recomendaciones Accionables (Next Steps)</h3>
                <div class="rec-item">
                    <strong>1. Revertir Subida de Precio:</strong> Ajustar inmediatamente el precio a niveles de la semana anterior (aprox 32.7€) para recuperar Organic Rank Top 5.
                </div>
                <div class="rec-item">
                    <strong>2. Activar Cupón Defensivo:</strong> Lanzar un cupón de 5-10% de descuento ("Coupons Days") durante las próximas 2 semanas para contrarrestar la agresividad de Kaba.
                </div>
                <div class="rec-item">
                    <strong>3. Revisar Estrategia de Formatos:</strong> El mercado prefiere formatos pequeños (400g) post-fiestas. Si existe variante de menor gramaje, priorizar su visibilidad orgánica o ADS sobre el saco de 1kg.
                </div>
            </div>
        </div>

        <!-- TAB 2: INTERACTIVE -->
        <div id="interactive" class="tab-content">
            <div class="card">
                <div class="card-title">
                    <span class="material-icons">compare_arrows</span>
                    Comparador Dinámico
                </div>
                
                <div class="controls">
                    <select id="weekSelect" onchange="updateInteractive()">
                        <option value="all">Todas las Semanas</option>
                        <!-- Populated by JS -->
                    </select>
                    <select id="competitorSelect" onchange="updateInteractive()">
                        <option value="all">Todos los Competidores</option>
                        <!-- Populated by JS -->
                    </select>
                </div>

                <div id="table_chart" class="chart-container"></div>
            </div>
        </div>
    </div>

    <!-- DATA & LOGIC -->
    <script type="text/javascript">
        // --- 1. PROCESSED DATA INJECTION ---
        const marketData = [
            {"week": "2025-52", "date": "2025-12-27", "asin": "B000W45AZY", "brand": "Caotina", "is_me": false, "clicks": 162.39, "click_share": 2.93, "price": 9.72, "rank": 12, "coupon": 0},
            {"week": "2025-52", "date": "2025-12-27", "asin": "B0D5R1W596", "brand": "Suchard Express", "is_me": false, "clicks": 280.44, "click_share": 5.06, "price": 3.27, "rank": 5, "coupon": 0},
            {"week": "2025-52", "date": "2025-12-27", "asin": "B07DFPSNGJ", "brand": "NaturaleBio", "is_me": true, "clicks": 267.13, "click_share": 4.82, "price": 32.77, "rank": 5, "coupon": 0},
            {"week": "2025-52", "date": "2025-12-27", "asin": "B0D5QZYXPW", "brand": "Kaba", "is_me": false, "clicks": 482.72, "click_share": 8.71, "price": 2.77, "rank": 1, "coupon": 0},
            {"week": "2025-52", "date": "2025-12-27", "asin": "B01M6BB18S", "brand": "Alnatura", "is_me": false, "clicks": 423.42, "click_share": 7.64, "price": 4.91, "rank": 2, "coupon": 0},
            
            {"week": "2026-01", "date": "2026-01-03", "asin": "B000W45AZY", "brand": "Caotina", "is_me": false, "clicks": 0, "click_share": 0, "price": 0, "rank": 0, "coupon": 0}, 
            {"week": "2026-01", "date": "2026-01-03", "asin": "B0D5R1W596", "brand": "Suchard Express", "is_me": false, "clicks": 153.73, "click_share": 5.03, "price": 3.47, "rank": 5, "coupon": 0},
            {"week": "2026-01", "date": "2026-01-03", "asin": "B07DFPSNGJ", "brand": "NaturaleBio", "is_me": true, "clicks": 121.03, "click_share": 3.96, "price": 34.80, "rank": 7, "coupon": 0},
            {"week": "2026-01", "date": "2026-01-03", "asin": "B0D5QZYXPW", "brand": "Kaba", "is_me": false, "clicks": 272.01, "click_share": 8.90, "price": 3.25, "rank": 1, "coupon": 2},
            {"week": "2026-01", "date": "2026-01-03", "asin": "B01M6BB18S", "brand": "Alnatura", "is_me": false, "clicks": 268.34, "click_share": 8.78, "price": 5.21, "rank": 2, "coupon": 0}
        ];

        const volumeData = {
            "2025-52": 5542.21,
            "2026-01": 3056.30
        };

        // --- 2. GOOGLE CHARTS SETUP ---
        google.charts.load('current', {'packages':['corechart', 'table']});
        google.charts.setOnLoadCallback(initDashboard);

        function initDashboard() {
            drawTrendChart();
            drawCompetitorChart();
            drawEfficiencyChart();
            populateControls();
            updateInteractive();
        }

        // --- 3. CHART FUNCTIONS ---

        function drawTrendChart() {
            // Aggregate data by week
            const weeks = Object.keys(volumeData).sort();
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Semana');
            data.addColumn('number', 'Volumen Mercado');
            data.addColumn('number', 'NaturaleBio Share %');
            data.addColumn('number', 'Competidores Share % (Promedio Top 3)');

            const rows = weeks.map(week => {
                const myShare = marketData.find(d => d.week === week && d.is_me)?.click_share || 0;
                
                // Calc avg of top 3 competitors (Kaba, Alnatura, Suchard)
                const compShares = marketData
                    .filter(d => d.week === week && !d.is_me && ['Kaba', 'Alnatura', 'Suchard Express'].includes(d.brand))
                    .map(d => d.click_share);
                const avgCompShare = compShares.length ? compShares.reduce((a,b)=>a+b,0)/compShares.length : 0;

                return [week, volumeData[week], myShare, avgCompShare];
            });

            data.addRows(rows);

            const options = {
                seriesType: 'bars',
                series: {
                    1: {type: 'line', targetAxisIndex: 1, color: '#4285F4', lineWidth: 3},
                    2: {type: 'line', targetAxisIndex: 1, color: '#EA4335', lineDashStyle: [4, 4]}
                },
                vAxes: {
                    0: {title: 'Volumen Búsquedas', textStyle: {color: '#999'}},
                    1: {title: 'Click Share %', format: '#\'%\''}
                },
                legend: {position: 'bottom'},
                chartArea: {width: '80%', height: '70%'},
                colors: ['#e0e0e0']
            };

            const chart = new google.visualization.ComboChart(document.getElementById('trend_chart'));
            chart.draw(data, options);
        }

        function drawCompetitorChart() {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Semana');
            data.addColumn('number', 'NaturaleBio');
            data.addColumn('number', 'Kaba');
            data.addColumn('number', 'Alnatura');
            data.addColumn('number', 'Suchard Express');

            const weeks = Object.keys(volumeData).sort();
            const rows = weeks.map(week => {
                const getShare = (brand) => {
                    const entry = marketData.find(d => d.week === week && d.brand === brand);
                    return entry ? entry.click_share : 0;
                };
                return [week, getShare('NaturaleBio'), getShare('Kaba'), getShare('Alnatura'), getShare('Suchard Express')];
            });

            data.addRows(rows);

            const options = {
                curveType: 'function',
                legend: { position: 'bottom' },
                vAxis: { title: 'Click Share %' },
                chartArea: {width: '85%', height: '75%'},
                colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853'],
                lineWidth: 3,
                pointSize: 5
            };

            const chart = new google.visualization.LineChart(document.getElementById('competitor_chart'));
            chart.draw(data, options);
        }

        function drawEfficiencyChart() {
            // Only last week data
            const lastWeek = "2026-01";
            const currentData = marketData.filter(d => d.week === lastWeek && d.click_share > 0);

            const data = new google.visualization.DataTable();
            data.addColumn('number', 'Organic Rank');
            data.addColumn('number', 'Click Share');
            data.addColumn({type: 'string', role: 'style'}); // Color role
            data.addColumn({type: 'string', role: 'tooltip'});

            const rows = currentData.map(d => {
                const color = d.is_me ? '#4285F4' : '#999';
                const pointShape = d.is_me ? 'circle' : 'triangle'; 
                return [
                    d.rank, 
                    d.click_share, 
                    `point { size: ${d.is_me ? 10 : 5}; fill-color: ${color}; shape-type: ${pointShape} }`,
                    `${d.brand}: Rank ${d.rank}, Share ${d.click_share}%`
                ];
            });

            data.addRows(rows);

            const options = {
                hAxis: { title: 'Organic Rank (Invertido)', direction: -1 }, // Rank 1 is right/better or left? Usually left. Let's make 1 be left.
                vAxis: { title: 'Click Share %' },
                legend: 'none',
                chartArea: {width: '80%', height: '80%'}
            };

            // Fix hAxis to show Rank 1 on left if direction is 1, but scatter standard is low-to-high. 
            // To make Rank 1 "better" (top right or top left?), let's imply efficiency: Low Rank (X) should have High Share (Y).
            // So default numeric axis is fine. Rank 1 is close to Y axis.

            const chart = new google.visualization.ScatterChart(document.getElementById('efficiency_chart'));
            chart.draw(data, options);
        }

        // --- 4. INTERACTIVE LOGIC ---
        function populateControls() {
            const weeks = [...new Set(marketData.map(d => d.week))].sort();
            const brands = [...new Set(marketData.map(d => d.brand))].sort();
            
            const weekSel = document.getElementById('weekSelect');
            const brandSel = document.getElementById('competitorSelect');

            weeks.forEach(w => weekSel.add(new Option(w, w)));
            brands.forEach(b => brandSel.add(new Option(b, b)));
        }

        function updateInteractive() {
            const weekVal = document.getElementById('weekSelect').value;
            const brandVal = document.getElementById('competitorSelect').value;

            let filtered = marketData;
            if (weekVal !== 'all') filtered = filtered.filter(d => d.week === weekVal);
            if (brandVal !== 'all') filtered = filtered.filter(d => d.brand === brandVal);

            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Semana');
            data.addColumn('string', 'Marca');
            data.addColumn('number', 'Precio (€)');
            data.addColumn('number', 'Rank Org.');
            data.addColumn('number', 'Share %');
            data.addColumn('number', 'Días Cupón');

            filtered.forEach(d => {
                data.addRow([d.week, d.brand, d.price, d.rank, d.click_share, d.coupon]);
            });

            const table = new google.visualization.Table(document.getElementById('table_chart'));
            table.draw(data, {showRowNumber: true, width: '100%', height: '100%'});
        }

        // --- 5. UTILS ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            // Find button that calls this function with this id? simpler:
            const index = tabId === 'report' ? 0 : 1;
            document.querySelectorAll('.tab-btn')[index].classList.add('active');
        }
    </script>
</body>
</html>