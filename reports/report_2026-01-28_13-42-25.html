<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Market Intelligence Report</title>
    <!-- Google Charts -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #4285F4; /* Google Blue */
            --secondary: #34A853; /* Google Green */
            --danger: #EA4335; /* Google Red */
            --warning: #FBBC05; /* Google Yellow */
            --gray-100: #f1f3f4;
            --gray-200: #e8eaed;
            --gray-700: #5f6368;
            --gray-900: #202124;
            --shadow: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
            --card-radius: 8px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--gray-100);
            color: var(--gray-900);
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
        }

        /* Layout & Header */
        header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { font-size: 1.25rem; font-weight: 600; margin: 0; color: var(--gray-900); }
        h2 { font-size: 1.1rem; font-weight: 500; margin-bottom: 1rem; color: var(--gray-700); }
        
        .badge {
            background: #e8f0fe;
            color: var(--primary);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Tabs */
        .tabs { display: flex; gap: 1rem; margin-top: 1rem; padding: 0 2rem; border-bottom: 1px solid var(--gray-200); background: white; }
        .tab-btn {
            padding: 1rem;
            border: none;
            background: none;
            color: var(--gray-700);
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }

        /* Container */
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .section { display: none; }
        .section.active { display: block; }

        /* Cards & Grid */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-bottom: 1.5rem; }
        
        .card {
            background: white;
            border-radius: var(--card-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            height: 100%;
            box-sizing: border-box;
        }

        .metric-card { text-align: center; }
        .metric-val { font-size: 2rem; font-weight: 700; color: var(--primary); margin: 0.5rem 0; }
        .metric-label { font-size: 0.875rem; color: var(--gray-700); text-transform: uppercase; letter-spacing: 0.5px; }

        /* Insights Box */
        .insights-box {
            background: #f8f9fa;
            border-left: 4px solid var(--primary);
            padding: 1rem;
            margin-top: 2rem;
        }
        .insights-box h3 { margin-top: 0; color: var(--primary); display: flex; align-items: center; gap: 0.5rem; }
        .insight-item { margin-bottom: 0.5rem; font-size: 0.95rem; line-height: 1.5; }
        .rec-item { font-weight: 500; color: var(--gray-900); }

        /* Interactive Controls */
        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            background: white;
            padding: 1rem;
            border-radius: var(--card-radius);
            box-shadow: var(--shadow);
            align-items: center;
        }
        select {
            padding: 0.5rem;
            border: 1px solid var(--gray-200);
            border-radius: 4px;
            font-family: inherit;
        }

        /* Charts */
        .chart_div { width: 100%; height: 300px; }
        .table_div { width: 100%; }

        @media (max-width: 768px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<header>
    <div style="display:flex; align-items:center; gap:10px;">
        <span class="material-icons" style="color:var(--primary);">analytics</span>
        <h1>Market Intelligence: Parent ASIN Analysis</h1>
    </div>
    <div class="badge" id="brand-badge">Brand: Loading...</div>
</header>

<div class="tabs">
    <button class="tab-btn active" onclick="switchTab('static')">1. Reporte Estrat√©gico</button>
    <button class="tab-btn" onclick="switchTab('interactive')">2. Comparador Interactivo</button>
</div>

<main class="container">
    
    <!-- STATIC REPORT -->
    <div id="static" class="section active">
        
        <!-- Section 1: Tendencia Global -->
        <div class="card" style="margin-bottom: 1.5rem;">
            <h2>1. Tendencia Global del Parent (Tracci√≥n vs Competencia)</h2>
            <div id="chart_global_trend" class="chart_div"></div>
            <p style="font-size:0.9rem; color:var(--gray-700); margin-top:1rem;">
                *Barras: Volumen Clics (Estimado). L√≠neas: Click Share %. Azul: Nuestra Marca (Agregado). Rojo: Competencia (Agregado).
            </p>
        </div>

        <!-- Section 2: Competitividad -->
        <div class="grid-2">
            <div class="card">
                <h2>2. Competitividad de Marca (Click Share %)</h2>
                <div id="chart_brand_comp" class="chart_div"></div>
            </div>
            <div class="card">
                <h2>Top Competidores (√öltima Semana)</h2>
                <div id="table_top_competitors" class="table_div"></div>
            </div>
        </div>

        <!-- Section 3: Palancas -->
        <div class="card" style="margin-bottom: 1.5rem;">
            <h2>3. üöÄ An√°lisis de Palancas (Precio, Deals, Badges)</h2>
            <div class="grid-3">
                <div class="metric-card">
                    <div class="metric-label">Impacto Precio</div>
                    <div id="metric_price_corr" class="metric-val">--</div>
                    <div style="font-size:0.8rem">Correlaci√≥n Precio vs Share</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Efecto Amazon Choice</div>
                    <div id="metric_ac_impact" class="metric-val">--</div>
                    <div style="font-size:0.8rem">Diff Share (Con vs Sin)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Efecto Best Seller</div>
                    <div id="metric_bs_impact" class="metric-val">--</div>
                    <div style="font-size:0.8rem">Diff Share (Con vs Sin)</div>
                </div>
            </div>
        </div>

        <!-- Section 4: Eficiencia -->
        <div class="card" style="margin-bottom: 1.5rem;">
            <h2>4. üëÅÔ∏è Eficiencia: Organic Rank vs Click Share</h2>
            <div id="chart_efficiency" class="chart_div"></div>
            <p style="font-size:0.9rem; color:var(--gray-700); margin-top:1rem;">
                *Eje X: Rank Org√°nico (Invertido, 1 es mejor). Eje Y: Click Share %. Puntos por encima de la tendencia son "Sobreperformers".
            </p>
        </div>

        <!-- Section 5: Insights -->
        <div class="insights-box card">
            <h3><span class="material-icons">lightbulb</span> Conclusiones y Recomendaciones Accionables</h3>
            <div id="insights_container">
                <!-- JS Generated Content -->
            </div>
        </div>
    </div>

    <!-- INTERACTIVE COMPARATOR -->
    <div id="interactive" class="section">
        <div class="controls">
            <div>
                <label>Semana:</label>
                <select id="select_week" onchange="updateInteractive()"></select>
            </div>
            <div>
                <label>Comparar con:</label>
                <select id="select_comp" onchange="updateInteractive()"></select>
            </div>
        </div>

        <div class="grid-2">
            <div class="card metric-card">
                <h3 id="our_asin_title" style="color:var(--primary)">Nuestra Marca</h3>
                <div class="grid-2" style="margin:0;">
                    <div>
                        <div class="metric-val" id="val_our_share">0%</div>
                        <div class="metric-label">Click Share</div>
                    </div>
                    <div>
                        <div class="metric-val" id="val_our_price">‚Ç¨0</div>
                        <div class="metric-label">Precio</div>
                    </div>
                </div>
                <div style="margin-top:10px; font-size:0.9rem;" id="our_badges"></div>
            </div>
            <div class="card metric-card">
                <h3 id="comp_asin_title" style="color:var(--danger)">Competidor</h3>
                 <div class="grid-2" style="margin:0;">
                    <div>
                        <div class="metric-val" id="val_comp_share">0%</div>
                        <div class="metric-label">Click Share</div>
                    </div>
                    <div>
                        <div class="metric-val" id="val_comp_price">‚Ç¨0</div>
                        <div class="metric-label">Precio</div>
                    </div>
                </div>
                <div style="margin-top:10px; font-size:0.9rem;" id="comp_badges"></div>
            </div>
        </div>
        
        <div class="card">
            <h2>Evoluci√≥n Comparativa (Semana a Semana)</h2>
            <div id="chart_interactive_line" class="chart_div"></div>
        </div>
    </div>

</main>

<script>
    // --- DATA INJECTION ---
    // Using Python pre-processed logic logic to structure this data
    const rawData = [{"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2025-12-27", "week_date": "2025-12-27T00:00:00", "keywords": "olio di cocco", "competitor_brand": "by Amazon", "asin": "B07W8PPQQM", "product_title": "by Amazon - Olio di cocco vergine biologico, 950 m...", "country_code": "it", "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 7, "click_share": 19.28, "impression_share": 6.28, "price": 13.312857143, "click_share_rank": 1, "weekly_search_volume": 7932.05, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "by Amazon", "estimated_clicks": 1529.29924, "week_label": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2025-12-27", "week_date": "2025-12-27T00:00:00", "keywords": "olio di cocco", "competitor_brand": NaN, "asin": "B08HK4YWGH", "product_title": "Eco nature, Olio di cocco bio, 200g", "country_code": "it", "average_organic_rank": 4, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 8.81, "impression_share": 3.67, "price": 4.5, "click_share_rank": 3, "weekly_search_volume": 7932.05, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "Eco nature", "estimated_clicks": 698.8136049999999, "week_label": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2025-12-27", "week_date": "2025-12-27T00:00:00", "keywords": "olio di cocco", "competitor_brand": "Plan\u00e8te au Naturel", "asin": "B0D6S1L6PL", "product_title": "Olio di Cocco Bio 150 ml - Plan\u00e8te au Naturel - Cr...", "country_code": "it", "average_organic_rank": 4, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 7.55, "impression_share": 3.66, "price": 5.9, "click_share_rank": 4, "weekly_search_volume": 7932.05, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "Plan\u00e8te au Naturel", "estimated_clicks": 598.869775, "week_label": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2025-12-27", "week_date": "2025-12-27T00:00:00", "keywords": "olio di cocco", "competitor_brand": "BENVOLIO", "asin": "B0CH11HMCS", "product_title": "BENVOLIO - Olio di Cocco Biologico Deodorato | 950...", "country_code": "it", "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 4.23, "impression_share": 3.63, "price": 10.9, "click_share_rank": 8, "weekly_search_volume": 7932.05, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "BENVOLIO", "estimated_clicks": 335.525715, "week_label": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2025-12-27", "week_date": "2025-12-27T00:00:00", "keywords": "olio di cocco", "competitor_brand": "CocoNativo", "asin": "B073P974FR", "product_title": "CocoNativo Biologico Extra Vergine Olio di Cocco, ...", "country_code": "it", "average_organic_rank": 8, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 6.22, "impression_share": 6.16, "price": 18.95, "click_share_rank": 5, "weekly_search_volume": 7932.05, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "CocoNativo", "estimated_clicks": 493.37351, "week_label": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2025-12-27", "week_date": "2025-12-27T00:00:00", "keywords": "olio di cocco", "competitor_brand": NaN, "asin": "B0FVM32PSK", "product_title": "Pipkin Olio di Cocco 100% Biologico e Puro 1L \u2013 Na...", "country_code": "it", "average_organic_rank": 9, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 2.54, "impression_share": 6.4, "price": 14.99, "click_share_rank": 9, "weekly_search_volume": 7932.05, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "Pipkin", "estimated_clicks": 201.47407, "week_label": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2025-12-27", "week_date": "2025-12-27T00:00:00", "keywords": "olio di cocco", "competitor_brand": "Crudolio", "asin": "B09G757HB2", "product_title": "CRUDOLIO - Olio Di Cocco Vergine Bio 200ml. | Spre...", "country_code": "it", "average_organic_rank": 11, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 2.34, "impression_share": 3.47, "price": 7.99, "click_share_rank": 10, "weekly_search_volume": 7932.05, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "Crudolio", "estimated_clicks": 185.60997, "week_label": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2025-12-27", "week_date": "2025-12-27T00:00:00", "keywords": "olio di cocco", "competitor_brand": "NaturaleBio", "asin": "B01M0LGD6A", "product_title": "NaturaleBio Organic Virgin Coconut Oil 200 ml. Raw...", "country_code": "it", "average_organic_rank": 1, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 1, "weekly_number_of_days_with_coupon": 0, "click_share": 11.25, "impression_share": 3.25, "price": 8.99, "click_share_rank": 2, "weekly_search_volume": 7932.05, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "NaturaleBio", "estimated_clicks": 892.355625, "week_label": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2025-12-27", "week_date": "2025-12-27T00:00:00", "keywords": "olio di cocco", "competitor_brand": "NaturaleBio", "asin": "B01JA3S1F8", "product_title": "NaturaleBio Olio di Cocco Biologico Vergine 500 ml...", "country_code": "it", "average_organic_rank": 5, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 6.12, "impression_share": 3.63, "price": 13.99, "click_share_rank": 6, "weekly_search_volume": 7932.05, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "NaturaleBio", "estimated_clicks": 485.44146000000005, "week_label": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2025-12-27", "week_date": "2025-12-27T00:00:00", "keywords": "olio di cocco", "competitor_brand": "NaturaleBio", "asin": "B01JIB2T32", "product_title": "NaturaleBio Olio di Cocco Biologico Vergine 1000 m...", "country_code": "it", "average_organic_rank": 6, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 4.8, "impression_share": 3.63, "price": 19.49, "click_share_rank": 7, "weekly_search_volume": 7932.05, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "NaturaleBio", "estimated_clicks": 380.7384, "week_label": "2025-51"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2026-01-03", "week_date": "2026-01-03T00:00:00", "keywords": "olio di cocco", "competitor_brand": "by Amazon", "asin": "B07W8PPQQM", "product_title": "by Amazon - Olio di cocco vergine biologico, 950 m...", "country_code": "it", "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 3, "weekly_number_of_days_with_coupon": 1, "click_share": 18.98, "impression_share": 6.7, "price": 13.33, "click_share_rank": 1, "weekly_search_volume": 5123.86, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "by Amazon", "estimated_clicks": 972.508628, "week_label": "2026-00"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2026-01-03", "week_date": "2026-01-03T00:00:00", "keywords": "olio di cocco", "competitor_brand": NaN, "asin": "B08HK4YWGH", "product_title": "Eco nature, Olio di cocco bio, 200g", "country_code": "it", "average_organic_rank": 3, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 8.67, "impression_share": 3.69, "price": 4.5, "click_share_rank": 3, "weekly_search_volume": 5123.86, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "Eco nature", "estimated_clicks": 444.23866200000003, "week_label": "2026-00"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2026-01-03", "week_date": "2026-01-03T00:00:00", "keywords": "olio di cocco", "competitor_brand": "Plan\u00e8te au Naturel", "asin": "B0D6S1L6PL", "product_title": "Olio di Cocco Bio 150 ml - Plan\u00e8te au Naturel - Cr...", "country_code": "it", "average_organic_rank": 4, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 7.29, "impression_share": 3.68, "price": 5.9, "click_share_rank": 4, "weekly_search_volume": 5123.86, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "Plan\u00e8te au Naturel", "estimated_clicks": 373.52939399999995, "week_label": "2026-00"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2026-01-03", "week_date": "2026-01-03T00:00:00", "keywords": "olio di cocco", "competitor_brand": "BENVOLIO", "asin": "B0CH11HMCS", "product_title": "BENVOLIO - Olio di Cocco Biologico Deodorato | 950...", "country_code": "it", "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 4.26, "impression_share": 3.66, "price": 10.9, "click_share_rank": 7, "weekly_search_volume": 5123.86, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "BENVOLIO", "estimated_clicks": 218.276436, "week_label": "2026-00"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2026-01-03", "week_date": "2026-01-03T00:00:00", "keywords": "olio di cocco", "competitor_brand": NaN, "asin": "B0FVM32PSK", "product_title": "Pipkin Olio di Cocco 100% Biologico e Puro 1L \u2013 Na...", "country_code": "it", "average_organic_rank": 9, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 2.87, "impression_share": 6.81, "price": 14.99, "click_share_rank": 9, "weekly_search_volume": 5123.86, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "Pipkin", "estimated_clicks": 147.05478200000002, "week_label": "2026-00"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2026-01-03", "week_date": "2026-01-03T00:00:00", "keywords": "olio di cocco", "competitor_brand": "CocoNativo", "asin": "B073P974FR", "product_title": "CocoNativo Biologico Extra Vergine Olio di Cocco, ...", "country_code": "it", "average_organic_rank": 9, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 6.62, "impression_share": 6.56, "price": 18.95, "click_share_rank": 5, "weekly_search_volume": 5123.86, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "CocoNativo", "estimated_clicks": 339.199532, "week_label": "2026-00"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2026-01-03", "week_date": "2026-01-03T00:00:00", "keywords": "olio di cocco", "competitor_brand": "Monte Nativo", "asin": "B07TMGBPL7", "product_title": "Olio di Cocco Biologico Extra Vergin Monte Nativo ...", "country_code": "it", "average_organic_rank": 14, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 1.52, "impression_share": 3.72, "price": 17.95, "click_share_rank": 10, "weekly_search_volume": 5123.86, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "Monte Nativo", "estimated_clicks": 77.88267200000001, "week_label": "2026-00"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2026-01-03", "week_date": "2026-01-03T00:00:00", "keywords": "olio di cocco", "competitor_brand": "NaturaleBio", "asin": "B01M0LGD6A", "product_title": "NaturaleBio Organic Virgin Coconut Oil 200 ml. Raw...", "country_code": "it", "average_organic_rank": 1, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 1, "weekly_number_of_days_with_coupon": 0, "click_share": 13.51, "impression_share": 3.67, "price": 8.99, "click_share_rank": 2, "weekly_search_volume": 5123.86, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "NaturaleBio", "estimated_clicks": 692.2334860000001, "week_label": "2026-00"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2026-01-03", "week_date": "2026-01-03T00:00:00", "keywords": "olio di cocco", "competitor_brand": "NaturaleBio", "asin": "B01JA3S1F8", "product_title": "NaturaleBio Olio di Cocco Biologico Vergine 500 ml...", "country_code": "it", "average_organic_rank": 6, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 4.11, "impression_share": 3.66, "price": 13.99, "click_share_rank": 8, "weekly_search_volume": 5123.86, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "NaturaleBio", "estimated_clicks": 210.59064600000003, "week_label": "2026-00"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "reporting_date": "2026-01-03", "week_date": "2026-01-03T00:00:00", "keywords": "olio di cocco", "competitor_brand": "NaturaleBio", "asin": "B01JIB2T32", "product_title": "NaturaleBio Olio di Cocco Biologico Vergine 1000 m...", "country_code": "it", "average_organic_rank": 6, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 4.52, "impression_share": 3.66, "price": 19.49, "click_share_rank": 6, "weekly_search_volume": 5123.86, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.it/s?k=olio+di+cocco", "resolved_brand": "NaturaleBio", "estimated_clicks": 231.598472, "week_label": "2026-00"}];

    // --- LOGIC ---
    let OUR_BRAND = "";
    
    google.charts.load('current', {'packages':['corechart', 'table']});
    google.charts.setOnLoadCallback(initDashboard);

    function initDashboard() {
        processData();
        renderStaticReport();
        populateInteractiveControls();
        document.getElementById('brand-badge').textContent = "Brand: " + OUR_BRAND;
    }

    function processData() {
        // 1. Identify Our Brand
        const usRow = rawData.find(d => d.is_yaba_asin === 'Y');
        OUR_BRAND = usRow ? usRow.resolved_brand : "Unknown";
    }

    function renderStaticReport() {
        drawGlobalTrend();
        drawBrandCompetitiveness();
        drawEfficiency();
        calculateLevers();
        generateInsights();
    }

    // --- CHART 1: GLOBAL TREND ---
    function drawGlobalTrend() {
        // Aggregate by week: Clicks (Us vs Comp), Share (Us vs Comp)
        const weeks = [...new Set(rawData.map(d => d.reporting_date))].sort();
        
        const trendData = weeks.map(week => {
            const weekData = rawData.filter(d => d.reporting_date === week);
            
            const usData = weekData.filter(d => d.is_yaba_asin === 'Y');
            const compData = weekData.filter(d => d.is_yaba_asin === 'N');

            const usClicks = usData.reduce((sum, d) => sum + d.estimated_clicks, 0);
            const compClicks = compData.reduce((sum, d) => sum + d.estimated_clicks, 0);
            
            // Weighted Share calculation is complex, simplified to sum of click share for parent view
            const usShare = usData.reduce((sum, d) => sum + d.click_share, 0);
            const compShare = compData.reduce((sum, d) => sum + d.click_share, 0);

            return [week, usClicks, compClicks, usShare, compShare];
        });

        const data = new google.visualization.DataTable();
        data.addColumn('string', 'Week');
        data.addColumn('number', 'Clicks (Nosotros)');
        data.addColumn('number', 'Clicks (Comp)');
        data.addColumn('number', 'Share % (Nosotros)');
        data.addColumn('number', 'Share % (Comp)');
        data.addRows(trendData);

        const options = {
            vAxes: {
                0: {title: 'Volumen Clics Estimados'},
                1: {title: 'Click Share %', format: '#\'%\''}
            },
            hAxis: {title: 'Semana'},
            seriesType: 'bars',
            series: {
                0: {color: '#4285F4', targetAxisIndex: 0},
                1: {color: '#EA4335', targetAxisIndex: 0},
                2: {type: 'line', color: '#1967D2', targetAxisIndex: 1, lineWidth: 3},
                3: {type: 'line', color: '#B31412', targetAxisIndex: 1, lineWidth: 3}
            },
            isStacked: true,
            legend: {position: 'bottom'}
        };

        const chart = new google.visualization.ComboChart(document.getElementById('chart_global_trend'));
        chart.draw(data, options);
    }

    // --- CHART 2: BRAND COMPETITIVENESS ---
    function drawBrandCompetitiveness() {
        const weeks = [...new Set(rawData.map(d => d.reporting_date))].sort();
        
        // Find top competitors by avg share
        const brandShares = {};
        rawData.forEach(d => {
            if (d.resolved_brand === OUR_BRAND) return;
            if (!brandShares[d.resolved_brand]) brandShares[d.resolved_brand] = 0;
            brandShares[d.resolved_brand] += d.click_share;
        });
        
        const sortedBrands = Object.entries(brandShares).sort((a,b) => b[1] - a[1]);
        const top3 = sortedBrands.slice(0, 3).map(b => b[0]);

        const chartRows = weeks.map(week => {
            const weekData = rawData.filter(d => d.reporting_date === week);
            
            // Helper to sum share for a brand in a week
            const getShare = (brand) => weekData.filter(d => d.resolved_brand === brand).reduce((s, x) => s + x.click_share, 0);

            const usShare = getShare(OUR_BRAND);
            const c1Share = getShare(top3[0] || "");
            const c2Share = getShare(top3[1] || "");
            const c3Share = getShare(top3[2] || "");
            
            // Rest calculation
            const allShare = weekData.reduce((s, x) => s + x.click_share, 0);
            const restShare = allShare - (usShare + c1Share + c2Share + c3Share);

            return [week, usShare, c1Share, c2Share, c3Share, restShare < 0 ? 0 : restShare];
        });

        const data = new google.visualization.DataTable();
        data.addColumn('string', 'Week');
        data.addColumn('number', OUR_BRAND);
        data.addColumn('number', top3[0] || 'Comp 1');
        data.addColumn('number', top3[1] || 'Comp 2');
        data.addColumn('number', top3[2] || 'Comp 3');
        data.addColumn('number', 'Otros');
        data.addRows(chartRows);

        const options = {
            title: 'Evoluci√≥n Click Share % por Marca',
            curveType: 'function',
            legend: { position: 'bottom' },
            colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853', '#9AA0A6'],
            lineWidth: 3,
            vAxis: { format: '#\'%\'' }
        };

        const chart = new google.visualization.LineChart(document.getElementById('chart_brand_comp'));
        chart.draw(data, options);

        // Draw Table
        const lastWeek = weeks[weeks.length -1];
        const lastWeekData = rawData.filter(d => d.reporting_date === lastWeek);
        const uniqueBrands = [...new Set(lastWeekData.map(d => d.resolved_brand))];
        const tableDataArr = uniqueBrands.map(b => {
             const share = lastWeekData.filter(d => d.resolved_brand === b).reduce((s, x) => s + x.click_share, 0);
             const avgPrice = lastWeekData.filter(d => d.resolved_brand === b).reduce((s, x, _, arr) => s + x.price/arr.length, 0);
             return [b, share, avgPrice];
        }).sort((a,b) => b[1] - a[1]).slice(0, 5);

        const tableData = new google.visualization.DataTable();
        tableData.addColumn('string', 'Marca');
        tableData.addColumn('number', 'Share %');
        tableData.addColumn('number', 'Precio Medio');
        tableData.addRows(tableDataArr);

        const table = new google.visualization.Table(document.getElementById('table_top_competitors'));
        table.draw(tableData, {width: '100%', height: '100%'});
    }

    // --- CHART 3: EFFICIENCY ---
    function drawEfficiency() {
        const lastWeek = [...new Set(rawData.map(d => d.reporting_date))].sort().pop();
        const dataForScatter = rawData.filter(d => d.reporting_date === lastWeek).map(d => {
            return [
                d.average_organic_rank, 
                d.click_share, 
                d.is_yaba_asin === 'Y' ? `color: #4285F4` : `color: #EA4335`,
                d.product_title // Tooltip
            ];
        });

        const data = new google.visualization.DataTable();
        data.addColumn('number', 'Rank Org√°nico');
        data.addColumn('number', 'Click Share %');
        data.addColumn({type: 'string', role: 'style'});
        data.addColumn({type: 'string', role: 'tooltip'});
        data.addRows(dataForScatter);

        const options = {
            hAxis: {title: 'Rank Org√°nico (Menor es mejor)', direction: -1}, // Invert to show rank 1 on right or use standard? Usually rank 1 is left. Let's keep standard 1 -> 10.
            vAxis: {title: 'Click Share %'},
            legend: 'none',
            pointSize: 10,
            hAxis: { viewWindow: {min: 0} } // Ensure 0 is visible
        };
        // Fix direction
        options.hAxis.direction = 1; 

        const chart = new google.visualization.ScatterChart(document.getElementById('chart_efficiency'));
        chart.draw(data, options);
    }

    // --- METRICS: LEVERS ---
    function calculateLevers() {
        // Price correlation (simple direction)
        const priceHighShare = rawData.sort((a,b) => b.click_share - a.click_share).slice(0, 10);
        const avgPriceHigh = priceHighShare.reduce((s,x) => s+x.price,0)/10;
        const totalAvgPrice = rawData.reduce((s,x) => s+x.price,0)/rawData.length;
        
        const priceLabel = avgPriceHigh > totalAvgPrice ? "M√°s alto que media" : "M√°s bajo que media";
        document.getElementById('metric_price_corr').innerText = priceLabel;

        // Amazon Choice Impact
        const withAC = rawData.filter(d => d.weekly_number_of_days_with_amazon_choice_badge > 0);
        const withoutAC = rawData.filter(d => d.weekly_number_of_days_with_amazon_choice_badge === 0);
        const avgShareAC = withAC.length ? withAC.reduce((s,x)=>s+x.click_share,0)/withAC.length : 0;
        const avgShareNoAC = withoutAC.length ? withoutAC.reduce((s,x)=>s+x.click_share,0)/withoutAC.length : 0;
        const liftAC = ((avgShareAC - avgShareNoAC)).toFixed(2);
        
        const acEl = document.getElementById('metric_ac_impact');
        acEl.innerText = (liftAC > 0 ? "+" : "") + liftAC + "%";
        acEl.style.color = liftAC > 0 ? "var(--secondary)" : "var(--gray-700)";

        // Best Seller Impact (Assuming > 0 days)
        const withBS = rawData.filter(d => d.weekly_number_of_days_with_best_seller_badge > 0);
        const withoutBS = rawData.filter(d => d.weekly_number_of_days_with_best_seller_badge === 0);
        // If no data for BS
        if (withBS.length === 0) {
            document.getElementById('metric_bs_impact').innerText = "N/A";
        } else {
             const avgShareBS = withBS.reduce((s,x)=>s+x.click_share,0)/withBS.length;
             const avgShareNoBS = withoutBS.reduce((s,x)=>s+x.click_share,0)/withoutBS.length;
             const liftBS = (avgShareBS - avgShareNoBS).toFixed(2);
             document.getElementById('metric_bs_impact').innerText = (liftBS > 0 ? "+" : "") + liftBS + "%";
        }
    }

    // --- INSIGHTS ---
    function generateInsights() {
        const weeks = [...new Set(rawData.map(d => d.reporting_date))].sort();
        const lastWeek = weeks[weeks.length-1];
        const prevWeek = weeks[weeks.length-2];

        // Calc global share change for Us
        const getShare = (w, brand) => rawData.filter(d => d.reporting_date === w && d.resolved_brand === brand).reduce((s,x)=>s+x.click_share,0);
        
        const ourShareLast = getShare(lastWeek, OUR_BRAND);
        const ourSharePrev = prevWeek ? getShare(prevWeek, OUR_BRAND) : ourShareLast;
        const diff = ourShareLast - ourSharePrev;
        
        const insightsHTML = `
            <div class="insight-item">1. <strong>Tendencia Global:</strong> Nuestra marca ${diff >= 0 ? 'gan√≥' : 'perdi√≥'} cuota de mercado (${Math.abs(diff).toFixed(2)}%) en la √∫ltima semana, alcanzando un ${ourShareLast.toFixed(2)}% total.</div>
            <div class="insight-item">2. <strong>Liderazgo:</strong> El competidor principal sigue siendo "${document.querySelector('#table_top_competitors table tr:nth-child(2) td') ? document.querySelector('#table_top_competitors table tr:nth-child(2) td').innerText : 'Unknown'}", aunque nuestra visibilidad es ${ourShareLast > 15 ? 'fuerte' : 'moderada'}.</div>
            <div class="insight-item">3. <strong>Eficiencia Org√°nica:</strong> ${ourShareLast > 20 ? 'Estamos capitalizando bien nuestro ranking org√°nico.' : 'Tenemos rankings altos (Top 5) pero el Click Share podr√≠a ser mayor (revisar imagen/precio).'}</div>
            <div class="insight-item">4. <strong>Impacto Badges:</strong> Los productos con etiqueta Amazon Choice mostraron un diferencial de share de ${document.getElementById('metric_ac_impact').innerText}, validando su importancia.</div>
            <div class="insight-item">5. <strong>Precios:</strong> El mercado premia opciones ${document.getElementById('metric_price_corr').innerText.includes('bajo') ? 'econ√≥micas' : 'premium'} esta semana.</div>
            
            <h4 style="margin:1rem 0 0.5rem 0; color:var(--primary);">Recomendaciones</h4>
            <div class="insight-item rec-item">‚û°Ô∏è <strong>Acci√≥n 1:</strong> ${diff < 0 ? 'Revisar competitividad de precio en ASINs principales.' : 'Mantener estrategia actual, potenciar variantes secundarias.'}</div>
            <div class="insight-item rec-item">‚û°Ô∏è <strong>Acci√≥n 2:</strong> Intentar capturar Amazon Choice en variantes sin badge (B01JA... etc) mediante optimizaci√≥n de keywords.</div>
            <div class="insight-item rec-item">‚û°Ô∏è <strong>Acci√≥n 3:</strong> Monitorear al competidor "by Amazon" que mantiene una posici√≥n dominante.</div>
        `;
        document.getElementById('insights_container').innerHTML = insightsHTML;
    }

    // --- INTERACTIVE SECTION ---
    function switchTab(tabId) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.target.classList.add('active');
        if (tabId === 'interactive') updateInteractive();
    }

    function populateInteractiveControls() {
        // Weeks
        const weeks = [...new Set(rawData.map(d => d.reporting_date))].sort().reverse();
        const weekSel = document.getElementById('select_week');
        weeks.forEach(w => {
            let opt = document.createElement('option');
            opt.value = w;
            opt.innerText = w;
            weekSel.appendChild(opt);
        });

        // Competitors
        const comps = [...new Set(rawData.filter(d => d.is_yaba_asin === 'N').map(d => d.resolved_brand))].sort();
        const compSel = document.getElementById('select_comp');
        comps.forEach(c => {
            let opt = document.createElement('option');
            opt.value = c;
            opt.innerText = c;
            compSel.appendChild(opt);
        });
        // Select first meaningful competitor
        if (comps.includes('by Amazon')) compSel.value = 'by Amazon';
    }

    function updateInteractive() {
        const week = document.getElementById('select_week').value;
        const comp = document.getElementById('select_comp').value;
        
        // Data for selected week
        const weekData = rawData.filter(d => d.reporting_date === week);
        
        // Aggregate Metrics for Us vs Comp
        const calcMetrics = (brandData) => {
            if (!brandData.length) return { share: 0, price: 0, badges: [] };
            const share = brandData.reduce((s,x) => s+x.click_share, 0);
            const price = brandData.reduce((s,x) => s+x.price, 0) / brandData.length;
            const badges = [];
            if (brandData.some(d => d.weekly_number_of_days_with_amazon_choice_badge > 0)) badges.push("Amazon Choice");
            if (brandData.some(d => d.weekly_number_of_days_with_best_seller_badge > 0)) badges.push("Best Seller");
            if (brandData.some(d => d.weekly_number_of_days_with_deal > 0)) badges.push("Deal");
            return { share, price, badges };
        };

        const usData = weekData.filter(d => d.resolved_brand === OUR_BRAND);
        const compData = weekData.filter(d => d.resolved_brand === comp);

        const usM = calcMetrics(usData);
        const compM = calcMetrics(compData);

        // Update DOM
        document.getElementById('val_our_share').innerText = usM.share.toFixed(2) + "%";
        document.getElementById('val_our_price').innerText = "‚Ç¨" + usM.price.toFixed(2);
        document.getElementById('our_badges').innerText = usM.badges.length ? usM.badges.join(", ") : "Sin Badges";

        document.getElementById('comp_asin_title').innerText = comp;
        document.getElementById('val_comp_share').innerText = compM.share.toFixed(2) + "%";
        document.getElementById('val_comp_price').innerText = "‚Ç¨" + compM.price.toFixed(2);
        document.getElementById('comp_badges').innerText = compM.badges.length ? compM.badges.join(", ") : "Sin Badges";

        // Draw Interactive Chart (History of Us vs Selected Comp)
        drawInteractiveChart(comp);
    }

    function drawInteractiveChart(compBrand) {
        const weeks = [...new Set(rawData.map(d => d.reporting_date))].sort();
        const rows = weeks.map(w => {
            const wData = rawData.filter(d => d.reporting_date === w);
            const usS = wData.filter(d => d.resolved_brand === OUR_BRAND).reduce((s,x)=>s+x.click_share,0);
            const compS = wData.filter(d => d.resolved_brand === compBrand).reduce((s,x)=>s+x.click_share,0);
            return [w, usS, compS];
        });

        const data = new google.visualization.DataTable();
        data.addColumn('string', 'Week');
        data.addColumn('number', OUR_BRAND);
        data.addColumn('number', compBrand);
        data.addRows(rows);

        const options = {
            title: `Hist√≥rico: ${OUR_BRAND} vs ${compBrand}`,
            curveType: 'function',
            legend: { position: 'bottom' },
            colors: ['#4285F4', '#EA4335'],
            vAxis: { format: '#\'%\'' }
        };

        const chart = new google.visualization.LineChart(document.getElementById('chart_interactive_line'));
        chart.draw(data, options);
    }

</script>
</body>
</html>