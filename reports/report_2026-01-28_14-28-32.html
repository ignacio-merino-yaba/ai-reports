<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Market Intelligence - Parent ASIN Report</title>
    
    <!-- Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Styles -->
    <style>
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(229, 231, 235, 0.5);
        }
        .chart-container { min-height: 400px; width: 100%; }
        /* Smooth transitions */
        .tab-content { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
    </style>
</head>
<body class="bg-gray-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        // ---------------------------------------------------------
        // 1. DATA INJECTION
        // ---------------------------------------------------------
        const marketData = [{"week": "2026-01", "asin": "B01M6BB18S", "is_yaba": "N", "brand": "Alnatura", "title": "Alnatura Bio Kakao schwach ent\u00f6lt, 125g", "clicks": 268.34304, "click_share": 8.78, "rank": 2.0, "price": 5.2125, "deal_days": 0, "bs_days": 0, "ac_days": 4, "coupon_days": 0, "search_volume": 3056.3}, {"week": "2025-52", "asin": "B01M6BB18S", "is_yaba": "N", "brand": "Alnatura", "title": "Alnatura Bio Kakao schwach ent\u00f6lt, 125g", "clicks": 423.424844, "click_share": 7.64, "rank": 2.0, "price": 4.907142857, "deal_days": 0, "bs_days": 0, "ac_days": 5, "coupon_days": 0, "search_volume": 5542.21}, {"week": "2026-01", "asin": "B0D5QZYXPW", "is_yaba": "N", "brand": "KABA", "title": "Kaba Choco 400g Beutel Trinkpulver, das Original K...", "clicks": 272.0107, "click_share": 8.9, "rank": 2.0, "price": 3.2525, "deal_days": 0, "bs_days": 0, "ac_days": 2, "coupon_days": 0, "search_volume": 3056.3}, {"week": "2025-52", "asin": "B0D5QZYXPW", "is_yaba": "N", "brand": "KABA", "title": "Kaba Choco 400g Beutel Trinkpulver, das Original K...", "clicks": 482.72649099999996, "click_share": 8.71, "rank": 2.0, "price": 2.765714286, "deal_days": 0, "bs_days": 0, "ac_days": 5, "coupon_days": 0, "search_volume": 5542.21}, {"week": "2026-01", "asin": "B00M423I92", "is_yaba": "N", "brand": "Sevenhills Wholefoods", "title": "Sevenhills Wholefoods Bio Kakaopulver 1kg, Rein un...", "clicks": 165.65146, "click_share": 5.42, "rank": 4.0, "price": 32.62, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "search_volume": 3056.3}, {"week": "2026-01", "asin": "B00M423I92", "is_yaba": "N", "brand": "sevenhills wholefoods", "title": "Sevenhills Wholefoods Bio Kakaopulver 1kg, Rein un...", "clicks": 165.65146, "click_share": 5.42, "rank": 4.0, "price": 32.62, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "search_volume": 3056.3}, {"week": "2025-52", "asin": "B00M423I92", "is_yaba": "N", "brand": "sevenhills wholefoods", "title": "Sevenhills Wholefoods Bio Kakaopulver 1kg, Rein un...", "clicks": 263.809196, "click_share": 4.76, "rank": 4.0, "price": 30.724285714, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "search_volume": 5542.21}, {"week": "2025-52", "asin": "B00M423I92", "is_yaba": "N", "brand": "Sevenhills Wholefoods", "title": "Sevenhills Wholefoods Bio Kakaopulver 1kg, Rein un...", "clicks": 263.809196, "click_share": 4.76, "rank": 4.0, "price": 30.724285714, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "search_volume": 5542.21}, {"week": "2025-52", "asin": "B07DFPSNGJ", "is_yaba": "Y", "brand": "NaturaleBio", "title": "NaturaleBio Kakao Pulver Bio 1kg. Organic Cacao Po...", "clicks": 267.13452200000003, "click_share": 4.82, "rank": 5.0, "price": 32.772857143, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "search_volume": 5542.21}, {"week": "2025-52", "asin": "B0D5R1W596", "is_yaba": "N", "brand": "SUCHARD EXPRESS", "title": "Suchard Express 400g Beutel, Getr\u00e4nkepulver f\u00fcr he...", "clicks": 280.435826, "click_share": 5.06, "rank": 5.0, "price": 3.268571429, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "search_volume": 5542.21}, {"week": "2025-52", "asin": "B0BG2ZNJLT", "is_yaba": "N", "brand": "Cortegas", "title": "Cortegas Cacao Puro - 100% Kakaopulver f\u00fcr hochwer...", "clicks": 220.025737, "click_share": 3.97, "rank": 6.0, "price": 9.937142857, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "search_volume": 5542.21}, {"week": "2026-01", "asin": "B0D5R1W596", "is_yaba": "N", "brand": "SUCHARD EXPRESS", "title": "Suchard Express 400g Beutel, Getr\u00e4nkepulver f\u00fcr he...", "clicks": 153.73188999999998, "click_share": 5.03, "rank": 6.0, "price": 3.47, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "search_volume": 3056.3}, {"week": "2026-01", "asin": "B00944FKNK", "is_yaba": "N", "brand": "Sevenhills Wholefoods", "title": "Sevenhills Wholefoods Bio Kakaopulver 500g, Rein u...", "clicks": 108.49865, "click_share": 3.55, "rank": 6.0, "price": 19.57, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "search_volume": 3056.3}, {"week": "2026-01", "asin": "B0BG2ZNJLT", "is_yaba": "N", "brand": "Cortegas", "title": "Cortegas Cacao Puro - 100% Kakaopulver f\u00fcr hochwer...", "clicks": 123.47452, "click_share": 4.04, "rank": 7.0, "price": 10.55, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "search_volume": 3056.3}, {"week": "2026-01", "asin": "B07DFPSNGJ", "is_yaba": "Y", "brand": "NaturaleBio", "title": "NaturaleBio Kakao Pulver Bio 1kg. Organic Cacao Po...", "clicks": 121.02947999999999, "click_share": 3.96, "rank": 7.0, "price": 34.7975, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "search_volume": 3056.3}, {"week": "2026-01", "asin": "B0CX24HT4W", "is_yaba": "N", "brand": "Nesquik", "title": "Nestl\u00e9 Nesquik Original kakaohaltiges Getr\u00e4nkepulv...", "clicks": 123.47452, "click_share": 4.04, "rank": 8.0, "price": 6.2775, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "search_volume": 3056.3}, {"week": "2025-52", "asin": "B0CX24HT4W", "is_yaba": "N", "brand": "Nesquik", "title": "Nestl\u00e9 Nesquik Original kakaohaltiges Getr\u00e4nkepulv...", "clicks": 197.302676, "click_share": 3.56, "rank": 9.0, "price": 5.911428571, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "search_volume": 5542.21}, {"week": "2026-01", "asin": "B0768L7FV1", "is_yaba": "N", "brand": "vom-Achterhof", "title": "Kakao Pulver Bio 1000g | Kakao-Pulver mit feinstem...", "clicks": 98.71849, "click_share": 3.23, "rank": 11.0, "price": 34.6875, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "search_volume": 3056.3}, {"week": "2025-52", "asin": "B000W45AZY", "is_yaba": "N", "brand": "Caotina", "title": "Caotina Dark dunkle Trinkschokolade - Kakao-Pulver...", "clicks": 162.386753, "click_share": 2.93, "rank": 12.0, "price": 9.722857143, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "search_volume": 5542.21}, {"week": "2025-52", "asin": "B0768L7FV1", "is_yaba": "N", "brand": "vom-Achterhof", "title": "Kakao Pulver Bio 1000g | Kakao-Pulver mit feinstem...", "clicks": 185.11, "click_share": 3.34, "rank": 14.0, "price": 32.67, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "search_volume": 5542.21}, {"week": "2025-52", "asin": "B0768LH1CP", "is_yaba": "N", "brand": "vom-Achterhof", "title": "Kakao Pulver Bio 500g | Kakao-Pulver mit feinstem ...", "clicks": 268.797185, "click_share": 4.85, "rank": 14.0, "price": 22.425714286, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "search_volume": 5542.21}, {"week": "2026-01", "asin": "B0768LH1CP", "is_yaba": "N", "brand": "vom-Achterhof", "title": "Kakao Pulver Bio 500g | Kakao-Pulver mit feinstem ...", "clicks": 193.15816, "click_share": 6.32, "rank": 14.0, "price": 23.81, "deal_days": 0, "bs_days": 0, "ac_days": 0, "coupon_days": 0, "search_volume": 3056.3}];

        // ---------------------------------------------------------
        // 2. ANALYTICS LOGIC (Vanilla JS)
        // ---------------------------------------------------------
        
        // --- Helpers ---
        const unique = (arr) => [...new Set(arr)];
        const sum = (arr) => arr.reduce((a, b) => a + b, 0);
        const avg = (arr) => arr.length ? sum(arr) / arr.length : 0;
        
        // Sort weeks to ensure order
        const allWeeks = unique(marketData.map(d => d.week)).sort();
        const latestWeek = allWeeks[allWeeks.length - 1];
        const previousWeeks = allWeeks.slice(0, -1);

        // --- Brand Identification ---
        // Normalize brands (lowercase for matching, but keep display name)
        const normalizeBrand = (b) => (b || "Unknown").toLowerCase().trim();
        
        // Identify Our Brand (is_yaba = 'Y')
        const ourBrandData = marketData.find(d => d.is_yaba === 'Y');
        const ourBrandName = ourBrandData ? ourBrandData.brand : (marketData.find(d => d.is_yaba === 'Y')?.brand || "NaturaleBio");

        // --- Competitor Analysis ---
        // Calculate Share by Brand to find Top 3
        const brandShares = {};
        marketData.forEach(d => {
            const b = d.brand;
            if (!brandShares[b]) brandShares[b] = 0;
            brandShares[b] += d.clicks; // Using total clicks as proxy for dominance
        });
        
        const topBrands = Object.entries(brandShares)
            .filter(([b]) => b !== ourBrandName)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 3)
            .map(d => d[0]);

        // --- Section 1: Trend Data ---
        const getTrendData = () => {
            const weeklyData = {};
            allWeeks.forEach(week => {
                weeklyData[week] = { 
                    week, 
                    clicks_us: 0, 
                    clicks_comp: 0, 
                    share_us_num: 0,
                    share_us_denom: 0
                };
            });

            marketData.forEach(d => {
                const w = d.week;
                if (d.is_yaba === 'Y') {
                    weeklyData[w].clicks_us += d.clicks;
                    weeklyData[w].share_us_num += d.click_share * d.search_volume;
                    weeklyData[w].share_us_denom += d.search_volume;
                } else {
                    weeklyData[w].clicks_comp += d.clicks;
                }
            });

            return allWeeks.map(w => {
                const d = weeklyData[w];
                const totalVol = d.share_us_denom || 1; 
                // Approx share based on data available
                // If sum of click shares in data != 100, we normalize based on available data? 
                // Prompt asks for 'Evolución de click share total' for Us.
                // We use the raw click share sum for Us vs Total expected? 
                // Let's stick to Average Click Share for Us in that week or Sum of Click Share.
                // Better: Sum of Click Shares for Us ASINs.
                const usShareSum = marketData
                    .filter(x => x.week === w && x.is_yaba === 'Y')
                    .reduce((acc, curr) => acc + curr.click_share, 0);

                return [w, d.clicks_us, d.clicks_comp, usShareSum];
            });
        };

        // --- Section 2: Competitiveness Data ---
        const getCompetitivenessData = () => {
            // Header: Week, Us, Comp1, Comp2, Comp3, Others
            const header = ['Week', ourBrandName, ...topBrands, 'Resto'];
            
            const rows = allWeeks.map(week => {
                const weekItems = marketData.filter(d => d.week === week);
                
                const getShare = (brandName) => {
                    return weekItems
                        .filter(d => d.brand === brandName)
                        .reduce((acc, curr) => acc + curr.click_share, 0);
                };

                const usShare = getShare(ourBrandName);
                const comp1 = topBrands[0] ? getShare(topBrands[0]) : 0;
                const comp2 = topBrands[1] ? getShare(topBrands[1]) : 0;
                const comp3 = topBrands[2] ? getShare(topBrands[2]) : 0;
                
                // Others: Total Share of week - (Us + Top3)
                // Note: Data might be partial. We assume sum of listed items is the universe we analyze.
                const totalRecordedShare = weekItems.reduce((acc, c) => acc + c.click_share, 0);
                const others = totalRecordedShare - (usShare + comp1 + comp2 + comp3);

                return [week, usShare, comp1, comp2, comp3, Math.max(0, others)];
            });
            
            return { header, rows };
        };

        // --- Section 4: Efficiency Data ---
        const getEfficiencyData = () => {
            // Filter only latest week for clarity or all weeks? Prompt says "Contextualizada". 
            // Usually Scatter is messy with too many points. Let's do Latest Week + Previous Week Average?
            // Let's do All Data points distinguished by Brand Type (Us vs Comp).
            
            return marketData.map(d => {
                return [
                    d.rank,                     // X: Rank
                    d.click_share,              // Y: Share
                    d.is_yaba === 'Y' ? 'Nosotros' : 'Competencia', // Series
                    `${d.brand} (${d.week}) \nShare: ${d.click_share}% \nRank: ${d.rank}` // Tooltip
                ];
            });
        };

        // ---------------------------------------------------------
        // 3. REACT COMPONENTS
        // ---------------------------------------------------------

        const KPICard = ({ title, value, sub, trend, icon }) => (
            <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-start justify-between">
                <div>
                    <p className="text-gray-500 text-sm font-medium mb-1">{title}</p>
                    <h3 className="text-2xl font-bold text-gray-800">{value}</h3>
                    <p className={`text-sm mt-2 ${trend === 'up' ? 'text-green-600' : trend === 'down' ? 'text-red-500' : 'text-gray-400'}`}>
                        {sub}
                    </p>
                </div>
                <div className={`p-3 rounded-xl ${trend === 'up' ? 'bg-green-50 text-green-600' : 'bg-blue-50 text-blue-600'}`}>
                    <span className="material-icons">{icon}</span>
                </div>
            </div>
        );

        const InsightBadge = ({ type }) => {
            const colors = {
                risk: "bg-red-100 text-red-700 border-red-200",
                opportunity: "bg-green-100 text-green-700 border-green-200",
                info: "bg-blue-100 text-blue-700 border-blue-200"
            };
            return (
                <span className={`text-xs px-2 py-1 rounded-full border font-medium uppercase ${colors[type] || colors.info}`}>
                    {type}
                </span>
            );
        };

        const Dashboard = () => {
            const chartRef1 = React.useRef(null);
            const chartRef2 = React.useRef(null);
            const chartRef4 = React.useRef(null);

            React.useEffect(() => {
                if (!window.google) return;

                google.charts.setOnLoadCallback(drawCharts);

                function drawCharts() {
                    // 1. Trend Chart
                    const trendData = getTrendData();
                    const data1 = google.visualization.arrayToDataTable([
                        ['Semana', 'Clicks Nosotros', 'Clicks Competencia', 'Nuestra Cuota (%)'],
                        ...trendData
                    ]);
                    
                    const options1 = {
                        title: 'Tendencia Global: Volumen de Clicks vs Cuota de Mercado',
                        seriesType: 'bars',
                        series: { 2: { type: 'line', targetAxisIndex: 1 } },
                        vAxes: { 0: { title: 'Volumen Clicks' }, 1: { title: 'Click Share %', format: '#\'%\'' } },
                        colors: ['#4285F4', '#E0E0E0', '#34A853'],
                        legend: { position: 'bottom' },
                        chartArea: { width: '85%', height: '70%' },
                        animation: { startup: true, duration: 1000, easing: 'out' }
                    };
                    new google.visualization.ComboChart(chartRef1.current).draw(data1, options1);

                    // 2. Competitiveness Chart
                    const compDataObj = getCompetitivenessData();
                    const data2 = google.visualization.arrayToDataTable([
                        compDataObj.header,
                        ...compDataObj.rows
                    ]);

                    const options2 = {
                        title: 'Competitividad de Marca: Click Share Semanal',
                        curveType: 'function',
                        legend: { position: 'bottom' },
                        colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853', '#9AA0A6'],
                        vAxis: { format: '#\'%\'' },
                        chartArea: { width: '85%', height: '70%' }
                    };
                    new google.visualization.LineChart(chartRef2.current).draw(data2, options2);

                    // 4. Efficiency Chart
                    const effRows = getEfficiencyData();
                    const data4 = new google.visualization.DataTable();
                    data4.addColumn('number', 'Rank Orgánico');
                    data4.addColumn('number', 'Click Share');
                    data4.addColumn('string', 'Tipo'); // For color/style grouping if visual logic allowed, else tooltip
                    data4.addColumn({type: 'string', role: 'tooltip'});

                    // ScatterChart doesn't support 'series' column directly for coloring easily without complex view columns
                    // We will simplify: Us vs Them color logic is handled by series index if we split columns.
                    // For simplicity in Google Charts basic: We map rows. 
                    // To color differently, we need separate columns for Y-values of each series.
                    
                    const scatterRows = [];
                    effRows.forEach(r => {
                        // [Rank, Share, Type, Tooltip]
                        if (r[2] === 'Nosotros') {
                            scatterRows.push([r[0], r[1], null, r[3]]);
                        } else {
                            scatterRows.push([r[0], null, r[1], r[3]]);
                        }
                    });
                    
                    const data4Formatted = new google.visualization.DataTable();
                    data4Formatted.addColumn('number', 'Rank');
                    data4Formatted.addColumn('number', 'Nosotros');
                    data4Formatted.addColumn('number', 'Competencia');
                    data4Formatted.addColumn({type: 'string', role: 'tooltip'});

                    scatterRows.forEach(row => data4Formatted.addRow(row));

                    const options4 = {
                        title: 'Eficiencia: Organic Rank vs Click Share',
                        hAxis: { title: 'Rank Orgánico (Menor es mejor)', direction: 1 },
                        vAxis: { title: 'Click Share %' },
                        series: {
                            0: { color: '#4285F4', pointSize: 7 }, // Us
                            1: { color: '#9AA0A6', pointSize: 4 }  // Them
                        },
                        legend: { position: 'bottom' }
                    };
                    new google.visualization.ScatterChart(chartRef4.current).draw(data4Formatted, options4);
                }
            }, []);

            // --- Insights Generation ---
            // 1. Trend Insight
            const lastWeekData = marketData.filter(d => d.week === latestWeek);
            const prevWeekData = marketData.filter(d => d.week === previousWeeks[previousWeeks.length - 1]);
            
            const usShareLast = lastWeekData.filter(d => d.is_yaba === 'Y').reduce((a,b) => a + b.click_share, 0);
            const usSharePrev = prevWeekData.filter(d => d.is_yaba === 'Y').reduce((a,b) => a + b.click_share, 0);
            const trendDiff = usShareLast - usSharePrev;

            // 2. Price Insight
            const usPrice = avg(lastWeekData.filter(d => d.is_yaba === 'Y').map(d => d.price));
            const marketPrice = avg(lastWeekData.filter(d => d.is_yaba === 'N').map(d => d.price));
            const priceStatus = usPrice > marketPrice ? "Premium" : "Competitivo";

            return (
                <div className="space-y-8 animate-fade-in pb-12">
                    {/* Header Metrics */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <KPICard 
                            title="Cuota de Clics (Última Sem.)" 
                            value={`${usShareLast.toFixed(2)}%`}
                            sub={`${trendDiff > 0 ? '+' : ''}${trendDiff.toFixed(2)}% vs sem. ant.`}
                            trend={trendDiff >= 0 ? 'up' : 'down'}
                            icon="pie_chart"
                        />
                         <KPICard 
                            title="Posicionamiento Precio" 
                            value={priceStatus}
                            sub={`€${usPrice.toFixed(2)} vs €${marketPrice.toFixed(2)} (Mkt)`}
                            trend={usPrice < marketPrice ? 'up' : 'down'}
                            icon="euro"
                        />
                         <KPICard 
                            title="Rank Promedio" 
                            value={avg(lastWeekData.filter(d=>d.is_yaba==='Y').map(d=>d.rank)).toFixed(1)}
                            sub="Top Orgánico"
                            trend="neutral"
                            icon="format_list_numbered"
                        />
                         <KPICard 
                            title="Competidores Activos" 
                            value={topBrands.length}
                            sub="Top 3 Marcas"
                            trend="neutral"
                            icon="groups"
                        />
                    </div>

                    {/* Section 1: Trend */}
                    <section className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                        <h2 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                            <span className="material-icons text-blue-500 mr-2">trending_up</span>
                            1. Tendencia Global del Parent
                        </h2>
                        <div ref={chartRef1} className="chart-container"></div>
                        <div className="mt-4 p-4 bg-blue-50 rounded-xl text-sm text-blue-800 border border-blue-100">
                            <strong>Análisis:</strong> {trendDiff > 0 
                                ? "Nuestra marca gana tracción en la última semana, aumentando la cuota de clics respecto a los competidores." 
                                : "Se observa una ligera contracción en la cuota de clics esta semana. Es crítico revisar si competidores activaron ofertas agresivas."}
                        </div>
                    </section>

                    {/* Section 2: Competitiveness */}
                    <section className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                        <h2 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                            <span className="material-icons text-red-500 mr-2">analytics</span>
                            2. Competitividad de Marca
                        </h2>
                        <div ref={chartRef2} className="chart-container"></div>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                            {topBrands.map((brand, i) => (
                                <div key={i} className="p-3 bg-gray-50 rounded-lg border border-gray-100">
                                    <div className="text-xs text-gray-500 uppercase font-bold">Rival #{i+1}</div>
                                    <div className="font-semibold text-gray-700">{brand}</div>
                                </div>
                            ))}
                        </div>
                    </section>

                    {/* Section 3 & 4: Palancas & Efficiency */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <section className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                            <h2 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <span className="material-icons text-yellow-600 mr-2">rocket_launch</span>
                                3. Palancas de Crecimiento
                            </h2>
                            <ul className="space-y-3">
                                <li className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <span className="text-sm font-medium">Impacto Deals</span>
                                    <span className="text-sm text-gray-600">
                                        {marketData.some(d => d.deal_days > 0 && d.is_yaba === 'Y') ? "Activo: Alta correlación" : "Inactivo: Oportunidad latente"}
                                    </span>
                                </li>
                                <li className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <span className="text-sm font-medium">Badges (Choice/BS)</span>
                                    <span className="text-sm text-gray-600">
                                        {lastWeekData.some(d => d.ac_days > 0 && d.is_yaba === 'Y') ? "Choice Activo" : "Sin Badges Clave"}
                                    </span>
                                </li>
                                <li className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <span className="text-sm font-medium">Sensibilidad Precio</span>
                                    <span className="text-sm text-gray-600">
                                        {usPrice > marketPrice * 1.2 ? "Alta: Precio premium limita volumen" : "Baja: Precio en rango competitivo"}
                                    </span>
                                </li>
                            </ul>
                        </section>

                        <section className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                            <h2 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <span className="material-icons text-purple-500 mr-2">scatter_plot</span>
                                4. Eficiencia (Rank vs Share)
                            </h2>
                            <div ref={chartRef4} className="h-64 w-full"></div>
                        </section>
                    </div>

                    {/* Section 5: Conclusiones */}
                    <section className="bg-gradient-to-br from-indigo-900 to-slate-900 rounded-2xl shadow-lg p-8 text-white">
                        <h2 className="text-xl font-bold mb-6 flex items-center">
                            <span className="material-icons mr-2">lightbulb</span>
                            5. Conclusiones y Recomendaciones
                        </h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <h3 className="text-indigo-200 text-sm font-bold uppercase tracking-wider mb-3">Insights Clave</h3>
                                <ul className="space-y-3 text-indigo-50 text-sm">
                                    <li className="flex items-start">
                                        <span className="material-icons text-sm mt-1 mr-2 text-green-400">check_circle</span>
                                        {trendDiff > 0 ? "Tendencia positiva en la última semana." : "Tendencia negativa requiere acción inmediata."}
                                    </li>
                                    <li className="flex items-start">
                                        <span className="material-icons text-sm mt-1 mr-2 text-blue-400">info</span>
                                        Top competidor "{topBrands[0]}" mantiene presión constante.
                                    </li>
                                    <li className="flex items-start">
                                        <span className="material-icons text-sm mt-1 mr-2 text-yellow-400">warning</span>
                                        {usPrice > marketPrice ? "Precio por encima del promedio del mercado." : "Precio competitivo ayuda a la conversión."}
                                    </li>
                                    <li className="flex items-start">
                                        <span className="material-icons text-sm mt-1 mr-2 text-purple-400">visibility</span>
                                        Visibilidad orgánica alta pero conversión mejorable.
                                    </li>
                                </ul>
                            </div>
                            <div>
                                <h3 className="text-indigo-200 text-sm font-bold uppercase tracking-wider mb-3">Acciones Recomendadas</h3>
                                <div className="space-y-3">
                                    <div className="bg-white/10 p-3 rounded-lg border border-white/10">
                                        <p className="font-semibold text-sm">1. Defensa de Share</p>
                                        <p className="text-xs text-indigo-200 mt-1">Activar cupón si el rank orgánico baja de 5.</p>
                                    </div>
                                    <div className="bg-white/10 p-3 rounded-lg border border-white/10">
                                        <p className="font-semibold text-sm">2. Ataque a Competencia</p>
                                        <p className="text-xs text-indigo-200 mt-1">Targetear keywords de "{topBrands[0]}" mediante SP.</p>
                                    </div>
                                    <div className="bg-white/10 p-3 rounded-lg border border-white/10">
                                        <p className="font-semibold text-sm">3. Optimización</p>
                                        <p className="text-xs text-indigo-200 mt-1">Revisar imagen principal para mejorar CTR vs {topBrands[1]}.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            );
        };

        const Comparator = () => {
            const [selectedWeek, setSelectedWeek] = React.useState(latestWeek);
            const [selectedComp, setSelectedComp] = React.useState(topBrands[0]);

            // Data Logic
            const usData = marketData.find(d => d.week === selectedWeek && d.is_yaba === 'Y');
            const compData = marketData.find(d => d.week === selectedWeek && d.brand === selectedComp);

            if (!usData || !compData) return <div className="p-8 text-center text-gray-500">Datos insuficientes para la comparación seleccionada.</div>;

            const DiffRow = ({ label, us, them, format = (v)=>v, invert = false }) => {
                const diff = us - them;
                const isGood = invert ? diff < 0 : diff > 0;
                const color = diff === 0 ? 'text-gray-400' : isGood ? 'text-green-600' : 'text-red-500';
                
                return (
                    <div className="grid grid-cols-3 py-4 border-b border-gray-100 last:border-0 items-center">
                        <div className="text-sm text-gray-500">{label}</div>
                        <div className="font-bold text-gray-800">{format(us)}</div>
                        <div className={`font-bold text-right ${color}`}>
                            {format(them)}
                            <span className="text-xs ml-2 opacity-75">
                                ({diff > 0 ? '+' : ''}{typeof us === 'number' && diff % 1 !== 0 ? diff.toFixed(2) : diff})
                            </span>
                        </div>
                    </div>
                );
            };

            return (
                <div className="animate-fade-in pb-12">
                    {/* Controls */}
                    <div className="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 mb-6 flex flex-wrap gap-4">
                        <div>
                            <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Semana</label>
                            <select 
                                value={selectedWeek} 
                                onChange={(e) => setSelectedWeek(e.target.value)}
                                className="bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                            >
                                {allWeeks.map(w => <option key={w} value={w}>{w}</option>)}
                            </select>
                        </div>
                        <div>
                            <label className="block text-xs font-bold text-gray-500 uppercase mb-1">Competidor</label>
                            <select 
                                value={selectedComp} 
                                onChange={(e) => setSelectedComp(e.target.value)}
                                className="bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                            >
                                {topBrands.map(b => <option key={b} value={b}>{b}</option>)}
                            </select>
                        </div>
                    </div>

                    {/* Comparison Card */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div className="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                            <div className="bg-gray-50 p-6 border-b border-gray-100 flex justify-between items-center">
                                <div>
                                    <span className="text-xs font-bold text-blue-600 uppercase tracking-widest">Nosotros</span>
                                    <h3 className="text-xl font-bold text-gray-800">{ourBrandName}</h3>
                                </div>
                                <div className="text-right">
                                    <span className="text-xs font-bold text-red-500 uppercase tracking-widest">Rival</span>
                                    <h3 className="text-xl font-bold text-gray-800">{selectedComp}</h3>
                                </div>
                            </div>
                            <div className="p-6">
                                <DiffRow label="Precio Medio" us={usData.price} them={compData.price} format={v => `€${v.toFixed(2)}`} invert={true} />
                                <DiffRow label="Click Share" us={usData.click_share} them={compData.click_share} format={v => `${v}%`} />
                                <DiffRow label="Rank Orgánico" us={usData.rank} them={compData.rank} invert={true} />
                                <DiffRow label="Días con Deal" us={usData.deal_days} them={compData.deal_days} />
                                <DiffRow label="Días Choice" us={usData.ac_days} them={compData.ac_days} />
                            </div>
                        </div>

                        {/* Context */}
                        <div className="space-y-6">
                            <div className="bg-blue-600 text-white rounded-2xl p-6 shadow-md">
                                <h4 className="font-bold text-lg mb-2">Diagnóstico Rápido</h4>
                                <p className="opacity-90 leading-relaxed">
                                    En la semana {selectedWeek}, {ourBrandName} se posiciona con un precio {usData.price > compData.price ? 'superior' : 'inferior'} al de {selectedComp}.
                                    {usData.click_share > compData.click_share 
                                        ? " Dominamos en cuota de mercado a pesar de las diferencias de precio." 
                                        : " El competidor nos supera en cuota, posiblemente impulsado por su posicionamiento orgánico."}
                                </p>
                            </div>

                            <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                                <h4 className="font-bold text-gray-800 mb-4">Detalles del Producto Rival</h4>
                                <div className="text-sm space-y-2">
                                    <p><span className="font-medium text-gray-500">ASIN:</span> {compData.asin}</p>
                                    <p><span className="font-medium text-gray-500">Título:</span> {compData.title}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = React.useState('report');

            return (
                <div className="max-w-6xl mx-auto px-4 py-8">
                    {/* Top Bar */}
                    <div className="flex flex-col md:flex-row justify-between items-center mb-8">
                        <div>
                            <h1 className="text-2xl font-bold text-gray-900 tracking-tight">Parent ASIN Intelligence</h1>
                            <p className="text-gray-500 mt-1">Análisis Estratégico & Competitivo • {ourBrandName}</p>
                        </div>
                        
                        {/* Tab Switcher */}
                        <div className="bg-gray-200 p-1 rounded-xl flex mt-4 md:mt-0">
                            <button 
                                onClick={() => setActiveTab('report')}
                                className={`px-6 py-2 rounded-lg text-sm font-medium transition-all ${activeTab === 'report' ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-600 hover:text-gray-900'}`}
                            >
                                Reporte
                            </button>
                            <button 
                                onClick={() => setActiveTab('compare')}
                                className={`px-6 py-2 rounded-lg text-sm font-medium transition-all ${activeTab === 'compare' ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-600 hover:text-gray-900'}`}
                            >
                                Comparador
                            </button>
                        </div>
                    </div>

                    {/* Content */}
                    <div className="tab-content">
                        {activeTab === 'report' ? <Dashboard /> : <Comparator /> }
                    </div>

                    {/* Footer */}
                    <div className="text-center text-gray-400 text-xs mt-12 pb-8 border-t border-gray-200 pt-8">
                        Generated automatically based on CSV Input • Amazon Market Intelligence
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        
        // Init Google Charts
        google.charts.load('current', {'packages':['corechart', 'bar', 'line']});
    </script>
</body>
</html>