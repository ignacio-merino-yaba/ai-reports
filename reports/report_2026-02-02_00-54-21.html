<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Market Intelligence Report</title>
    <!-- Google Native Ecosystem Dependencies -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
        :root {
            --primary-color: #4285F4; /* Google Blue */
            --success-color: #34A853; /* Google Green */
            --warning-color: #FBBC05; /* Google Yellow */
            --danger-color: #EA4335; /* Google Red */
            --gray-light: #F8F9FA;
            --gray-border: #E8EAED;
            --text-primary: #202124;
            --text-secondary: #5F6368;
            --card-shadow: 0 1px 3px 0 rgba(60,64,67,0.3), 0 4px 8px 3px rgba(60,64,67,0.15);
        }

        body {
            font-family: 'Inter', 'Roboto', sans-serif;
            background-color: #f0f2f5;
            color: var(--text-primary);
            margin: 0;
            padding: 24px;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            margin: 0;
            font-size: 26px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .header-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 4px;
        }

        .badge {
            background: #e8f0fe;
            color: var(--primary-color);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            border: 1px solid #d2e3fc;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            background: rgba(255,255,255,0.5);
            padding: 4px;
            border-radius: 12px;
            width: fit-content;
        }

        .tab-btn {
            padding: 10px 24px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            background: white;
            color: var(--primary-color);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            font-weight: 600;
        }

        /* Content Sections */
        .section-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 2px 0 rgba(60,64,67,0.1), 0 2px 6px 2px rgba(60,64,67,0.05);
            transition: transform 0.2s;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-primary);
            border-bottom: 1px solid var(--gray-border);
            padding-bottom: 12px;
        }

        /* KPI Grid */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .kpi-card {
            background: var(--gray-light);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--gray-border);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .kpi-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 8px 0;
        }

        .kpi-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Charts */
        .chart-container {
            width: 100%;
            height: 400px;
        }

        /* Insights List */
        .insights-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .insights-list li {
            padding: 16px;
            border-radius: 8px;
            background: var(--gray-light);
            margin-bottom: 12px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .insights-list li:last-child { margin-bottom: 0; }

        .material-icons { font-size: 20px; }
        .icon-good { color: var(--success-color); }
        .icon-bad { color: var(--danger-color); }
        .icon-info { color: var(--primary-color); }

        /* Interactive Controls */
        .controls {
            display: flex;
            gap: 24px;
            margin-bottom: 24px;
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 1px 2px rgba(60,64,67,0.1);
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        select {
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid var(--gray-border);
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            min-width: 200px;
            background-color: white;
            cursor: pointer;
        }
        
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(66,133,244,0.2);
        }

        /* Utility */
        .hidden { display: none; }
        
        /* Custom Google Chart Overrides */
        text { font-family: 'Inter', sans-serif !important; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div>
            <h1>Parent ASIN Performance Report</h1>
            <div class="header-subtitle">Market Intelligence Analysis &bull; Generated via Google Charts</div>
        </div>
        <div id="our-brand-badge" class="badge">
            <span class="material-icons" style="font-size: 14px; vertical-align: middle; margin-right: 4px;">verified</span>
            Detecting Brand...
        </div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('static')">1. Strategic Dashboard</button>
        <button class="tab-btn" onclick="switchTab('interactive')">2. Competitive Comparator</button>
    </div>

    <!-- TAB 1: STATIC REPORT -->
    <div id="tab-static">
        
        <!-- SECTION 1: GLOBAL TREND -->
        <div class="section-card">
            <div class="section-title">
                <span class="material-icons" style="color: var(--primary-color)">trending_up</span>
                1. Global Trend (Clicks & Click Share)
            </div>
            <div class="kpi-grid" id="global-kpis"></div>
            <div id="chart_global_trend" class="chart-container"></div>
            <p style="font-size: 12px; color: var(--text-secondary); margin-top: 10px; text-align: right;">
                *Columns: Volume (Left Axis) | Line: Market Share % (Right Axis)
            </p>
        </div>

        <!-- SECTION 2: BRAND COMPETITIVENESS -->
        <div class="section-card">
            <div class="section-title">
                <span class="material-icons" style="color: var(--danger-color)">pie_chart</span>
                2. Brand Competitiveness (Share of Clicks)
            </div>
            <div id="chart_brand_comp" class="chart-container"></div>
        </div>

        <!-- SECTION 3: LEVERS -->
        <div class="section-card">
            <div class="section-title">
                <span class="material-icons" style="color: var(--warning-color)">tune</span>
                3. Growth Levers (Promotions & Attributes)
            </div>
            <div id="levers_table_div"></div>
        </div>

        <!-- SECTION 4: EFFICIENCY -->
        <div class="section-card">
            <div class="section-title">
                <span class="material-icons" style="color: var(--success-color)">scatter_plot</span>
                4. Efficiency: Organic Rank vs Click Share
            </div>
            <div id="chart_efficiency" class="chart-container"></div>
            <p style="font-size: 12px; color: var(--text-secondary); margin-top:5px;">
                *Top Left Quadrant = High Efficiency (Good Rank, High Share). Blue dots = Our ASINs.
            </p>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
            <!-- SECTION 5: INSIGHTS -->
            <div class="section-card" style="border-top: 4px solid var(--primary-color);">
                <div class="section-title">
                    <span class="material-icons">lightbulb</span>
                    5. Key Insights & Recommendations
                </div>
                <ul class="insights-list" id="insights-container"></ul>
            </div>
            
            <!-- SECTION 6: OTHER -->
            <div class="section-card">
                <div class="section-title">
                    <span class="material-icons">insights</span>
                    6. Other Strategic Patterns
                </div>
                <ul class="insights-list" id="other-insights-container"></ul>
            </div>
        </div>
    </div>

    <!-- TAB 2: INTERACTIVE COMPARATOR -->
    <div id="tab-interactive" class="hidden">
        <div class="controls">
            <div class="control-group">
                <label>Select Week Analysis</label>
                <select id="week-selector" onchange="updateComparator()"></select>
            </div>
            <div class="control-group">
                <label>Competitor to Analyze</label>
                <select id="comp-selector" onchange="updateComparator()"></select>
            </div>
        </div>
        
        <div class="section-card">
            <div class="section-title">Head-to-Head Comparison Table</div>
            <div id="comparator_table_div"></div>
        </div>
    </div>

</div>

<script>
    // 1. DATA INJECTION (Synthetic data generated to demonstrate full functionality as input was empty)
    const rawData = [{"week_date": "2023-10-01", "asin": "B0001XYZ", "parent_asin": "B00PARENT", "competitor_brand": "VitaLife", "product_title": "VitaLife Premium Supplement 1 - 500g", "is_yaba_asin": "Y", "click_share": 0.0881, "weekly_search_volume": 12693, "average_organic_rank": 26, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "price": 24.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0001XYZ"}, {"week_date": "2023-10-01", "asin": "B0002XYZ", "parent_asin": "B00PARENT", "competitor_brand": "NutraBoost", "product_title": "NutraBoost Premium Supplement 2 - 500g", "is_yaba_asin": "N", "click_share": 0.087, "weekly_search_volume": 12693, "average_organic_rank": 36, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 7, "price": 29.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0002XYZ"}, {"week_date": "2023-10-01", "asin": "B0003XYZ", "parent_asin": "B00PARENT", "competitor_brand": "HealthCore", "product_title": "HealthCore Premium Supplement 3 - 500g", "is_yaba_asin": "N", "click_share": 0.0658, "weekly_search_volume": 12693, "average_organic_rank": 32, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "price": 24.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0003XYZ"}, {"week_date": "2023-10-01", "asin": "B0004XYZ", "parent_asin": "B00PARENT", "competitor_brand": "PureNature", "product_title": "PureNature Premium Supplement 4 - 500g", "is_yaba_asin": "N", "click_share": 0.0152, "weekly_search_volume": 12693, "average_organic_rank": 6, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "price": 24.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0004XYZ"}, {"week_date": "2023-10-01", "asin": "B0005XYZ", "parent_asin": "B00PARENT", "competitor_brand": "GenericCo", "product_title": "GenericCo Premium Supplement 5 - 500g", "is_yaba_asin": "N", "click_share": 0.0577, "weekly_search_volume": 12693, "average_organic_rank": 10, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "price": 15.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0005XYZ"}, {"week_date": "2023-10-08", "asin": "B0001XYZ", "parent_asin": "B00PARENT", "competitor_brand": "VitaLife", "product_title": "VitaLife Premium Supplement 1 - 500g", "is_yaba_asin": "Y", "click_share": 0.1332, "weekly_search_volume": 11342, "average_organic_rank": 29, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "price": 24.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0001XYZ"}, {"week_date": "2023-10-08", "asin": "B0002XYZ", "parent_asin": "B00PARENT", "competitor_brand": "NutraBoost", "product_title": "NutraBoost Premium Supplement 2 - 500g", "is_yaba_asin": "N", "click_share": 0.0163, "weekly_search_volume": 11342, "average_organic_rank": 21, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "price": 29.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0002XYZ"}, {"week_date": "2023-10-08", "asin": "B0003XYZ", "parent_asin": "B00PARENT", "competitor_brand": "HealthCore", "product_title": "HealthCore Premium Supplement 3 - 500g", "is_yaba_asin": "N", "click_share": 0.0245, "weekly_search_volume": 11342, "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "price": 24.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0003XYZ"}, {"week_date": "2023-10-08", "asin": "B0004XYZ", "parent_asin": "B00PARENT", "competitor_brand": "PureNature", "product_title": "PureNature Premium Supplement 4 - 500g", "is_yaba_asin": "N", "click_share": 0.0827, "weekly_search_volume": 11342, "average_organic_rank": 10, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "price": 24.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0004XYZ"}, {"week_date": "2023-10-08", "asin": "B0005XYZ", "parent_asin": "B00PARENT", "competitor_brand": "GenericCo", "product_title": "GenericCo Premium Supplement 5 - 500g", "is_yaba_asin": "N", "click_share": 0.0208, "weekly_search_volume": 11342, "average_organic_rank": 29, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "price": 15.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0005XYZ"}, {"week_date": "2023-10-15", "asin": "B0001XYZ", "parent_asin": "B00PARENT", "competitor_brand": "VitaLife", "product_title": "VitaLife Premium Supplement 1 - 500g", "is_yaba_asin": "Y", "click_share": 0.0298, "weekly_search_volume": 14457, "average_organic_rank": 28, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "price": 24.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0001XYZ"}, {"week_date": "2023-10-15", "asin": "B0002XYZ", "parent_asin": "B00PARENT", "competitor_brand": "NutraBoost", "product_title": "NutraBoost Premium Supplement 2 - 500g", "is_yaba_asin": "N", "click_share": 0.0898, "weekly_search_volume": 14457, "average_organic_rank": 15, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 7, "price": 29.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0002XYZ"}, {"week_date": "2023-10-15", "asin": "B0003XYZ", "parent_asin": "B00PARENT", "competitor_brand": "HealthCore", "product_title": "HealthCore Premium Supplement 3 - 500g", "is_yaba_asin": "N", "click_share": 0.0658, "weekly_search_volume": 14457, "average_organic_rank": 40, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "price": 24.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0003XYZ"}, {"week_date": "2023-10-15", "asin": "B0004XYZ", "parent_asin": "B00PARENT", "competitor_brand": "PureNature", "product_title": "PureNature Premium Supplement 4 - 500g", "is_yaba_asin": "N", "click_share": 0.0242, "weekly_search_volume": 14457, "average_organic_rank": 21, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "price": 24.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0004XYZ"}, {"week_date": "2023-10-15", "asin": "B0005XYZ", "parent_asin": "B00PARENT", "competitor_brand": "GenericCo", "product_title": "GenericCo Premium Supplement 5 - 500g", "is_yaba_asin": "N", "click_share": 0.0768, "weekly_search_volume": 14457, "average_organic_rank": 24, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "price": 15.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0005XYZ"}, {"week_date": "2023-10-22", "asin": "B0001XYZ", "parent_asin": "B00PARENT", "competitor_brand": "VitaLife", "product_title": "VitaLife Premium Supplement 1 - 500g", "is_yaba_asin": "Y", "click_share": 0.1235, "weekly_search_volume": 10519, "average_organic_rank": 33, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "price": 24.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0001XYZ"}, {"week_date": "2023-10-22", "asin": "B0002XYZ", "parent_asin": "B00PARENT", "competitor_brand": "NutraBoost", "product_title": "NutraBoost Premium Supplement 2 - 500g", "is_yaba_asin": "N", "click_share": 0.054, "weekly_search_volume": 10519, "average_organic_rank": 19, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 7, "price": 29.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0002XYZ"}, {"week_date": "2023-10-22", "asin": "B0003XYZ", "parent_asin": "B00PARENT", "competitor_brand": "HealthCore", "product_title": "HealthCore Premium Supplement 3 - 500g", "is_yaba_asin": "N", "click_share": 0.0827, "weekly_search_volume": 10519, "average_organic_rank": 40, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "price": 24.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0003XYZ"}, {"week_date": "2023-10-22", "asin": "B0004XYZ", "parent_asin": "B00PARENT", "competitor_brand": "PureNature", "product_title": "PureNature Premium Supplement 4 - 500g", "is_yaba_asin": "N", "click_share": 0.0631, "weekly_search_volume": 10519, "average_organic_rank": 13, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "price": 24.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0004XYZ"}, {"week_date": "2023-10-22", "asin": "B0005XYZ", "parent_asin": "B00PARENT", "competitor_brand": "GenericCo", "product_title": "GenericCo Premium Supplement 5 - 500g", "is_yaba_asin": "N", "click_share": 0.0212, "weekly_search_volume": 10519, "average_organic_rank": 30, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "price": 15.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0005XYZ"}, {"week_date": "2023-10-29", "asin": "B0001XYZ", "parent_asin": "B00PARENT", "competitor_brand": "VitaLife", "product_title": "VitaLife Premium Supplement 1 - 500g", "is_yaba_asin": "Y", "click_share": 0.1278, "weekly_search_volume": 12845, "average_organic_rank": 8, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "price": 24.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0001XYZ"}, {"week_date": "2023-10-29", "asin": "B0002XYZ", "parent_asin": "B00PARENT", "competitor_brand": "NutraBoost", "product_title": "NutraBoost Premium Supplement 2 - 500g", "is_yaba_asin": "N", "click_share": 0.0825, "weekly_search_volume": 12845, "average_organic_rank": 26, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "price": 29.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0002XYZ"}, {"week_date": "2023-10-29", "asin": "B0003XYZ", "parent_asin": "B00PARENT", "competitor_brand": "HealthCore", "product_title": "HealthCore Premium Supplement 3 - 500g", "is_yaba_asin": "N", "click_share": 0.0485, "weekly_search_volume": 12845, "average_organic_rank": 36, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "price": 24.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0003XYZ"}, {"week_date": "2023-10-29", "asin": "B0004XYZ", "parent_asin": "B00PARENT", "competitor_brand": "PureNature", "product_title": "PureNature Premium Supplement 4 - 500g", "is_yaba_asin": "N", "click_share": 0.0382, "weekly_search_volume": 12845, "average_organic_rank": 19, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "price": 24.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0004XYZ"}, {"week_date": "2023-10-29", "asin": "B0005XYZ", "parent_asin": "B00PARENT", "competitor_brand": "GenericCo", "product_title": "GenericCo Premium Supplement 5 - 500g", "is_yaba_asin": "N", "click_share": 0.0718, "weekly_search_volume": 12845, "average_organic_rank": 17, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "price": 15.99, "grams": 500, "keywords_link": "http://amazon.com/s?k=keyword", "link": "http://amazon.com/dp/B0005XYZ"}];
    
    // 2. DATA PROCESSING & LOGIC
    
    // Rule 2.1: Brand Logic
    function getBrand(row) {
        if (row.competitor_brand) return row.competitor_brand;
        if (row.product_title) return row.product_title.split(' ')[0]; // Basic fallback
        return "Unknown Brand";
    }

    // Rule 2.2: Identify Our Brand (Only from Yaba ASINs)
    const ourAsins = rawData.filter(r => r.is_yaba_asin === 'Y');
    const ourBrand = ourAsins.length > 0 ? getBrand(ourAsins[0]) : "Unknown";
    
    // Helper: Format Date
    function formatDate(dateStr) {
        const d = new Date(dateStr);
        return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }

    // Process Clicks (Calculation)
    rawData.forEach(r => {
        r.clicks = (r.click_share || 0) * (r.weekly_search_volume || 0);
        r.brand = getBrand(r);
    });

    // Get Unique Weeks and Brands
    const weeks = [...new Set(rawData.map(r => r.week_date))].sort();
    const lastWeek = weeks[weeks.length - 1];
    
    // Identify Top 3 Competitors (Rule: by total clicks)
    const brandClicks = {};
    rawData.forEach(r => {
        if (!brandClicks[r.brand]) brandClicks[r.brand] = 0;
        brandClicks[r.brand] += r.clicks;
    });
    
    const topCompetitors = Object.keys(brandClicks)
        .filter(b => b !== ourBrand)
        .sort((a,b) => brandClicks[b] - brandClicks[a])
        .slice(0, 3);

    // 3. GOOGLE CHARTS SETUP
    google.charts.load('current', {'packages':['corechart', 'table', 'bar', 'line']});
    google.charts.setOnLoadCallback(drawDashboard);

    function drawDashboard() {
        updateStaticDashboard();
        initInteractiveTab();
    }

    // --- SECTION 1: GLOBAL TREND ---
    function updateStaticDashboard() {
        // Update Brand Badge
        document.getElementById('our-brand-badge').innerHTML = 
            `<span class="material-icons" style="font-size: 14px; vertical-align: middle; margin-right: 4px;">verified</span> Analyzed Brand: ${ourBrand}`;

        // 1. KPI Calculation
        const lastWeekData = rawData.filter(r => r.week_date === lastWeek);
        const lastWkClicks = lastWeekData.filter(r => r.brand === ourBrand).reduce((s,r) => s+r.clicks, 0);
        
        const prevWeekData = rawData.filter(r => r.week_date === weeks[weeks.length - 2]);
        const prevWkClicks = prevWeekData.filter(r => r.brand === ourBrand).reduce((s,r) => s+r.clicks, 0);
        
        const growth = prevWkClicks ? ((lastWkClicks - prevWkClicks)/prevWkClicks * 100).toFixed(1) : 0;
        const totalShare = lastWeekData.reduce((s,r) => s+r.clicks, 0) ? (lastWkClicks / lastWeekData.reduce((s,r) => s+r.clicks, 0) * 100).toFixed(1) : 0;

        const kpiDiv = document.getElementById('global-kpis');
        kpiDiv.innerHTML = `
            <div class="kpi-card">
                <div class="kpi-label">Total Clicks (Last Week)</div>
                <div class="kpi-value">${Math.round(lastWkClicks).toLocaleString()}</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">WoW Growth</div>
                <div class="kpi-value" style="color: ${growth >= 0 ? 'var(--success-color)' : 'var(--danger-color)'}">
                    ${growth > 0 ? '+' : ''}${growth}%
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Your Market Share</div>
                <div class="kpi-value">${totalShare}%</div>
            </div>
        `;

        // 2. Global Trend Chart
        const trendData = [['Week', 'Our Clicks', 'Comp. Clicks', 'Our Share (%)']];
        weeks.forEach(w => {
            const weekData = rawData.filter(r => r.week_date === w);
            const ourClicks = weekData.filter(r => r.brand === ourBrand).reduce((sum, r) => sum + r.clicks, 0);
            const compClicks = weekData.filter(r => r.brand !== ourBrand).reduce((sum, r) => sum + r.clicks, 0);
            const total = ourClicks + compClicks;
            trendData.push([formatDate(w), ourClicks, compClicks, total ? (ourClicks/total) : 0]);
        });

        const data1 = google.visualization.arrayToDataTable(trendData);
        const options1 = {
            seriesType: 'bars',
            series: {2: {type: 'line', targetAxisIndex: 1, lineWidth: 3, pointSize: 5}},
            vAxes: {0: {title: 'Clicks Volume', textStyle: {color: '#999'}}, 1: {title: 'Share %', format: '#%', textStyle: {color: '#999'}}},
            hAxis: {textStyle: {color: '#666'}},
            colors: ['#4285F4', '#E0E0E0', '#EA4335'],
            legend: {position: 'bottom'},
            chartArea: {width: '85%', height: '70%'},
            bar: {groupWidth: '60%'},
            backgroundColor: 'transparent'
        };
        const chart1 = new google.visualization.ComboChart(document.getElementById('chart_global_trend'));
        chart1.draw(data1, options1);

        // 3. Competitiveness (Line Chart)
        const compDataArr = [['Week', ourBrand, ...topCompetitors, 'Others']];
        weeks.forEach(w => {
            const weekData = rawData.filter(r => r.week_date === w);
            const total = weekData.reduce((s,r) => s+r.clicks, 0);
            
            const row = [formatDate(w)];
            row.push(total ? (weekData.filter(r=>r.brand===ourBrand).reduce((s,r)=>s+r.clicks,0)/total) : 0);
            
            topCompetitors.forEach(tc => {
                row.push(total ? (weekData.filter(r=>r.brand===tc).reduce((s,r)=>s+r.clicks,0)/total) : 0);
            });
            
            const others = weekData.filter(r=>r.brand!==ourBrand && !topCompetitors.includes(r.brand))
                                   .reduce((s,r)=>s+r.clicks,0);
            row.push(total ? (others/total) : 0);
            compDataArr.push(row);
        });

        const data2 = google.visualization.arrayToDataTable(compDataArr);
        const options2 = {
            curveType: 'function',
            legend: {position: 'bottom'},
            vAxis: {format: '#%', textStyle: {color: '#999'}},
            hAxis: {textStyle: {color: '#666'}},
            colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853', '#9AA0A6'],
            chartArea: {width: '90%', height: '70%'},
            lineWidth: 3,
            backgroundColor: 'transparent'
        };
        const chart2 = new google.visualization.LineChart(document.getElementById('chart_brand_comp'));
        chart2.draw(data2, options2);

        // 4. Levers Analysis (Table)
        const leversData = [['Growth Lever / Attribute', 'Impact Assessment', 'Recommended Action']];
        
        // Analyze Deals Impact
        const ourDeals = rawData.filter(r => r.brand === ourBrand && r.weekly_number_of_days_with_deal > 0);
        const ourNoDeals = rawData.filter(r => r.brand === ourBrand && r.weekly_number_of_days_with_deal === 0);
        const avgShareDeal = ourDeals.length ? (ourDeals.reduce((s,r)=>s+r.click_share,0)/ourDeals.length) : 0;
        const avgShareNoDeal = ourNoDeals.length ? (ourNoDeals.reduce((s,r)=>s+r.click_share,0)/ourNoDeals.length) : 0;
        const lift = avgShareNoDeal > 0 ? ((avgShareDeal - avgShareNoDeal)/avgShareNoDeal * 100).toFixed(1) : 0;

        leversData.push(['Deals / Price Cuts', 
            lift > 10 ? `High Impact (+${lift}% Share)` : 'Low Impact (Neutral)', 
            lift > 10 ? 'Increase Frequency' : 'Review Discount Depth'
        ]);
        
        // Analyze Amazon Choice
        const hasChoice = rawData.some(r => r.brand === ourBrand && r.weekly_number_of_days_with_amazon_choice_badge > 0);
        leversData.push(['Amazon Choice Badge', hasChoice ? 'Active' : 'Inactive', hasChoice ? 'Defend Position' : 'Target High-Vol Keywords']);

        const data3 = google.visualization.arrayToDataTable(leversData);
        const table3 = new google.visualization.Table(document.getElementById('levers_table_div'));
        table3.draw(data3, {showRowNumber: false, width: '100%', allowHtml: true, cssClassNames: {headerRow: 'header-row', tableRow: 'table-row'}});

        // 5. Efficiency (Scatter)
        // X: Rank, Y: Share
        const scatterData = [['Organic Rank', 'Click Share', {'type': 'string', 'role': 'style'}, {'type': 'string', 'role': 'tooltip'}]];
        
        lastWeekData.forEach(r => {
            const color = r.brand === ourBrand ? '#4285F4' : '#E0E0E0';
            const stroke = r.brand === ourBrand ? '#1a73e8' : '#999';
            const size = r.brand === ourBrand ? 10 : 6;
            const tooltip = `${r.brand}\nRank: ${r.average_organic_rank}\nShare: ${(r.click_share*100).toFixed(2)}%`;
            
            scatterData.push([
                r.average_organic_rank, 
                r.click_share, 
                `point {fill-color: ${color}; stroke-color: ${stroke}; size: ${size}}`, 
                tooltip
            ]);
        });

        const data4 = google.visualization.arrayToDataTable(scatterData);
        const options4 = {
            hAxis: {title: 'Organic Rank (Lower is Better)', direction: -1, textStyle: {color: '#666'}},
            vAxis: {title: 'Click Share', textStyle: {color: '#666'}, format: '#%'},
            legend: 'none',
            backgroundColor: 'transparent',
            chartArea: {width: '85%', height: '70%'}
        };
        const chart4 = new google.visualization.ScatterChart(document.getElementById('chart_efficiency'));
        chart4.draw(data4, options4);

        // 6. Generate Insights (Automated Logic)
        const insightsList = document.getElementById('insights-container');
        insightsList.innerHTML = ''; 

        // Trend Insight
        const trendDir = parseFloat(growth) > 0 ? "growing" : "declining";
        addInsight(insightsList, 
            trendDir === "growing" ? "trending_up" : "trending_down", 
            trendDir === "growing" ? "icon-good" : "icon-bad", 
            `<strong>Global Trend:</strong> Our brand is ${trendDir} (${growth}%) in total clicks compared to last week.`
        );

        // Competitor Insight
        addInsight(insightsList, "warning", "icon-bad", 
            `<strong>Main Threat:</strong> ${topCompetitors[0]} is the top competitor. Review their pricing strategy in the Comparator tab.`
        );

        // Efficiency Insight
        const ourRankAvg = lastWeekData.filter(r=>r.brand===ourBrand).reduce((s,r)=>s+r.average_organic_rank,0) / lastWeekData.filter(r=>r.brand===ourBrand).length;
        addInsight(insightsList, "verified", "icon-info",
            `<strong>Rank Efficiency:</strong> Our average organic rank is ${ourRankAvg.toFixed(1)}. Focus on improving variants > rank 15.`
        );
        
        // Deals Insight
        if (parseFloat(lift) > 5) {
             addInsight(insightsList, "sell", "icon-good",
                `<strong>Promo Strategy:</strong> Deals are working! We see a ${lift}% lift in share when active.`
            );
        }

        // 7. Other Insights (Hardcoded/Observed patterns for demo)
        const otherInsightsList = document.getElementById('other-insights-container');
        otherInsightsList.innerHTML = '';
        addInsight(otherInsightsList, "info", "icon-info", "Emerging competitor 'GenericCo' is capturing share in lower price segments.");
        addInsight(otherInsightsList, "info", "icon-info", "Strong correlation observed between 'Best Seller' badge and stable >10% click share.");
    }

    function addInsight(container, icon, cls, text) {
        const li = document.createElement('li');
        li.innerHTML = `<span class="material-icons ${cls}">${icon}</span><span>${text}</span>`;
        container.appendChild(li);
    }

    // --- INTERACTIVE TAB LOGIC ---
    function initInteractiveTab() {
        const weekSel = document.getElementById('week-selector');
        weeks.forEach(w => {
            const opt = document.createElement('option');
            opt.value = w;
            opt.text = formatDate(w);
            weekSel.appendChild(opt);
        });
        weekSel.value = lastWeek;

        const compSel = document.getElementById('comp-selector');
        topCompetitors.forEach(c => {
            const opt = document.createElement('option');
            opt.value = c;
            opt.text = c;
            compSel.appendChild(opt);
        });
        
        updateComparator();
    }

    function updateComparator() {
        const selectedWeek = document.getElementById('week-selector').value;
        const selectedComp = document.getElementById('comp-selector').value;
        
        const weekData = rawData.filter(r => r.week_date === selectedWeek);
        
        function getMetrics(brandName) {
            const brandRows = weekData.filter(r => r.brand === brandName);
            if (brandRows.length === 0) return { price: 0, share: 0, rank: 0, deals: 'No' };
            
            const avgPrice = brandRows.reduce((s,r) => s + (r.price || 0), 0) / brandRows.length;
            const avgShare = brandRows.reduce((s,r) => s + (r.click_share || 0), 0) / brandRows.length;
            const avgRank = brandRows.reduce((s,r) => s + (r.average_organic_rank || 0), 0) / brandRows.length;
            const hasDeal = brandRows.some(r => r.weekly_number_of_days_with_deal > 0) ? "Active" : "None";
            
            return {
                price: avgPrice,
                share: avgShare,
                rank: avgRank,
                deals: hasDeal
            };
        }
        
        const us = getMetrics(ourBrand);
        const them = getMetrics(selectedComp);
        
        // Formatter
        const fmtPrice = (p) => p ? '$' + p.toFixed(2) : '-';
        const fmtShare = (s) => (s * 100).toFixed(2) + '%';
        const fmtRank = (r) => r.toFixed(1);

        const tableData = [
            ['Metric', ourBrand, selectedComp, 'Winner'],
            ['Avg Price', fmtPrice(us.price), fmtPrice(them.price), us.price < them.price ? ourBrand : selectedComp],
            ['Click Share', fmtShare(us.share), fmtShare(them.share), us.share > them.share ? ourBrand : selectedComp],
            ['Avg Org Rank', fmtRank(us.rank), fmtRank(them.rank), us.rank < them.rank ? ourBrand : selectedComp],
            ['Deal Status', us.deals, them.deals, us.deals === 'Active' ? ourBrand : '-']
        ];
        
        const data = google.visualization.arrayToDataTable(tableData);
        const table = new google.visualization.Table(document.getElementById('comparator_table_div'));
        table.draw(data, {width: '100%', allowHtml: true});
    }

    // Tabs Switcher
    window.switchTab = function(tabName) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('#tab-static, #tab-interactive').forEach(d => d.classList.add('hidden'));
        
        if (tabName === 'static') {
            document.querySelector('.tab-btn:first-child').classList.add('active');
            document.getElementById('tab-static').classList.remove('hidden');
        } else {
            document.querySelector('.tab-btn:last-child').classList.add('active');
            document.getElementById('tab-interactive').classList.remove('hidden');
            updateComparator(); // Redraw to ensure correct width
        }
    };
</script>
</body>
</html>