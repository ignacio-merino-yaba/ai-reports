<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASIN Performance Report: Matcha Premium</title>
    
    <!-- 1. Google Ecosystem Dependencies -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- 2. Styling (Tailwind via CDN for layout + Custom CSS for Google/Apple feel) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Base Apple/Google Hybrid Style */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #F5F5F7; color: #1D1D1F; }
        
        /* Cards */
        .card { background: white; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); padding: 24px; margin-bottom: 24px; transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        
        /* Typography */
        h1 { font-weight: 700; letter-spacing: -0.025em; color: #1D1D1F; }
        h2 { font-weight: 600; letter-spacing: -0.015em; color: #333; margin-bottom: 16px; font-size: 1.25rem; display: flex; align-items: center; gap: 8px; }
        .stat-value { font-size: 2rem; font-weight: 700; color: #1D1D1F; }
        .stat-label { font-size: 0.875rem; color: #6E6E73; font-weight: 500; text-transform: uppercase; letter-spacing: 0.05em; }
        
        /* Tabs */
        .tabs { display: flex; gap: 8px; margin-bottom: 24px; background: #E5E5EA; padding: 4px; border-radius: 12px; width: fit-content; }
        .tab-btn { padding: 8px 24px; border-radius: 8px; font-weight: 600; font-size: 0.9rem; cursor: pointer; border: none; background: transparent; color: #6E6E73; transition: all 0.2s; }
        .tab-btn.active { background: white; color: #0071E3; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        
        /* Google Charts Container */
        .chart-container { width: 100%; height: 350px; }
        
        /* Insights Box */
        .insight-box { border-left: 4px solid #34A853; background: #F6FFED; padding: 16px; border-radius: 0 8px 8px 0; margin-bottom: 12px; }
        .rec-box { border-left: 4px solid #4285F4; background: #E8F0FE; padding: 16px; border-radius: 0 8px 8px 0; margin-bottom: 12px; }
        
        /* Utility */
        .text-our-brand { color: #4285F4; font-weight: bold; }
        .text-competitor { color: #EA4335; font-weight: bold; }
        .badge { display: inline-flex; align-items: center; padding: 2px 8px; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; }
        .badge-green { background: #E6F4EA; color: #137333; }
        .badge-red { background: #FCE8E6; color: #C5221F; }
        
        /* Comparison Grid */
        .comp-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
        .vs-badge { background: #000; color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 700; }

        /* Hidden logic for tabs */
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body class="p-6 max-w-7xl mx-auto">

    <!-- Header -->
    <header class="mb-8 flex justify-between items-center">
        <div>
            <div class="flex items-center gap-2 mb-2">
                <span class="material-icons text-blue-600">analytics</span>
                <span class="text-sm font-bold text-blue-600 uppercase tracking-wider">Market Intelligence</span>
            </div>
            <h1 class="text-3xl">Parent ASIN Analysis: Matcha Premium</h1>
            <p class="text-gray-500 mt-1">Reporting Period: Last 4 Weeks (Ending 2026-01-03)</p>
        </div>
        <div class="text-right hidden md:block">
            <div class="stat-value text-blue-600" id="headerShare">--%</div>
            <div class="stat-label">Our Click Share (Last Wk)</div>
        </div>
    </header>

    <!-- Navigation -->
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('report')">Strategic Report</button>
        <button class="tab-btn" onclick="switchTab('compare')">Interactive Comparator</button>
    </div>

    <!-- MAIN REPORT TAB -->
    <div id="report" class="tab-content active">
        
        <!-- 1. Global Trend -->
        <div class="card">
            <h2><span class="material-icons">trending_up</span> 1. Global Parent Trend</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="col-span-2">
                    <div id="trend_chart" class="chart-container"></div>
                </div>
                <div class="flex flex-col justify-center space-y-4">
                    <div class="p-4 bg-gray-50 rounded-xl">
                        <div class="text-sm text-gray-500">Total Market Volume</div>
                        <div class="text-2xl font-bold" id="trendVol">--</div>
                        <div class="text-xs text-red-500 flex items-center mt-1"><span class="material-icons text-xs">arrow_downward</span> Declining Trend</div>
                    </div>
                    <div class="p-4 bg-blue-50 rounded-xl border border-blue-100">
                        <div class="text-sm text-blue-600">Our Visibility (Share)</div>
                        <div class="text-2xl font-bold text-blue-700" id="trendShare">--%</div>
                        <div class="text-xs text-blue-600 mt-1">Vs Competitors</div>
                    </div>
                    <p class="text-sm text-gray-600 leading-relaxed">
                        <strong>Analysis:</strong> The category search volume is contracting significantly in the last week. Despite this, our share has remained resilient, suggesting high brand loyalty or effective bottom-funnel conversion relative to competitors who are losing traffic faster.
                    </p>
                </div>
            </div>
        </div>

        <!-- 2. Brand Competitiveness -->
        <div class="card">
            <h2><span class="material-icons">emoji_events</span> 2. Brand Competitiveness (Share of Voice)</h2>
            <div id="brand_chart" class="chart-container"></div>
            <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="insight-box">
                    <strong>Dominance:</strong> <span class="text-competitor">NORITUAL LAB</span> leads the market consistently, holding the highest average click share.
                </div>
                <div class="insight-box" style="border-left-color: #4285F4; background: #F0F5FF;">
                    <strong>Our Position:</strong> <span class="text-our-brand">NATURALEBIO</span> maintains a strong 2nd/3rd position, showing stability even without aggressive deals in the final week.
                </div>
            </div>
        </div>

        <!-- 3. Levers & 4. Efficiency -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Efficiency Chart -->
            <div class="card">
                <h2><span class="material-icons">speed</span> 4. Efficiency: Rank vs. Share</h2>
                <div id="eff_chart" class="chart-container"></div>
                <p class="text-xs text-gray-500 mt-2 text-center">X: Organic Rank (Lower is better) | Y: Click Share</p>
                <div class="mt-4 text-sm text-gray-600">
                    <p><strong>Overperformers:</strong> ASINs in top-left quadrant (Low Rank, High Share). Our main ASIN is highly efficient given its rank.</p>
                </div>
            </div>

            <!-- Levers Analysis -->
            <div class="card">
                <h2><span class="material-icons">tune</span> 3. Impact Levers</h2>
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center gap-2">
                            <span class="material-icons text-green-600">sell</span>
                            <span>Price Sensitivity</span>
                        </div>
                        <span class="badge badge-green">High Impact</span>
                    </div>
                    <p class="text-sm text-gray-600 px-2">Competitors with price < €16 gain disproportionate share. Our Premium pricing (>€24) limits mass volume but protects margin.</p>
                    
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center gap-2">
                            <span class="material-icons text-red-500">local_offer</span>
                            <span>Deals Impact</span>
                        </div>
                        <span class="badge badge-red">Negative / Mixed</span>
                    </div>
                     <p class="text-sm text-gray-600 px-2">Data indicates weeks with Deals did NOT drive incremental share for our ASINs compared to baseline weeks.</p>
                </div>
            </div>
        </div>

        <!-- 5. Conclusions -->
        <div class="card bg-gray-900 text-white">
            <h2 class="text-white"><span class="material-icons text-yellow-400">lightbulb</span> 5. Conclusions & Recommendations</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-4">
                <div>
                    <h3 class="font-bold text-yellow-400 mb-2 uppercase text-xs tracking-widest">Key Insights</h3>
                    <ul class="space-y-2 text-sm text-gray-300 list-disc pl-5">
                        <li><strong>Market Contraction:</strong> Search volume dropped ~50% in the last week; efficiency is now more critical than volume.</li>
                        <li><strong>Competitor Threat:</strong> NORITUAL LAB dominates via organic ranking (Avg Rank 2.0).</li>
                        <li><strong>Price Barrier:</strong> We are priced ~60% higher than the volume leaders (Ceremonial/Noritual).</li>
                        <li><strong>Deal Inefficiency:</strong> Recent promotions did not yield share gains; potential ad/promo fatigue.</li>
                        <li><strong>Brand Loyalty:</strong> Despite high price, we hold ~15-20% share, indicating a strong loyal customer base.</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold text-blue-400 mb-2 uppercase text-xs tracking-widest">Actionable Recommendations</h3>
                    <ul class="space-y-3">
                        <li class="flex gap-3">
                            <span class="material-icons text-blue-400 text-sm mt-1">check_circle</span>
                            <span class="text-sm"><strong>Defend Ranking:</strong> Focus PPC on branded keywords to protect the #2 position during low-volume periods.</span>
                        </li>
                        <li class="flex gap-3">
                            <span class="material-icons text-blue-400 text-sm mt-1">check_circle</span>
                            <span class="text-sm"><strong>Optimize Listing:</strong> Competitor "Noritual" uses "Ceremonial" heavily. Test adding "Ceremonial Grade" to main title if applicable.</span>
                        </li>
                        <li class="flex gap-3">
                            <span class="material-icons text-blue-400 text-sm mt-1">check_circle</span>
                            <span class="text-sm"><strong>Price Test:</strong> Run a 1-week test at €22.99 (psychological threshold) to see if share elasticity unlocks rank #3 -> #2.</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- COMPARATOR TAB -->
    <div id="compare" class="tab-content">
        <div class="card">
            <h2><span class="material-icons">compare_arrows</span> Head-to-Head Comparator</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Select Week</label>
                    <select id="weekSelector" class="w-full p-2 border rounded-lg mt-1 bg-gray-50" onchange="updateComparator()"></select>
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-500 uppercase">Select Competitor</label>
                    <select id="compSelector" class="w-full p-2 border rounded-lg mt-1 bg-gray-50" onchange="updateComparator()"></select>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Our Stats -->
                <div class="bg-blue-50 p-6 rounded-2xl border border-blue-100">
                    <div class="flex items-center gap-2 mb-4">
                        <span class="text-blue-600 font-bold text-lg">NATURALEBIO (Us)</span>
                        <span class="text-xs bg-blue-200 text-blue-800 px-2 py-0.5 rounded">You</span>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <div class="text-sm text-gray-500">Click Share</div>
                            <div class="text-2xl font-bold text-blue-900" id="usShare">--%</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-500">Avg Price</div>
                            <div class="text-xl font-bold text-gray-800" id="usPrice">€--</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-500">Org Rank</div>
                            <div class="text-xl font-bold text-gray-800" id="usRank">--</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-500">Active Badges</div>
                            <div class="flex gap-1 mt-1" id="usBadges">--</div>
                        </div>
                    </div>
                </div>

                <!-- Competitor Stats -->
                <div class="bg-red-50 p-6 rounded-2xl border border-red-100">
                    <div class="flex items-center gap-2 mb-4">
                        <span class="text-red-600 font-bold text-lg" id="compNameDisplay">Competitor</span>
                        <span class="text-xs bg-red-200 text-red-800 px-2 py-0.5 rounded">Rival</span>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <div class="text-sm text-gray-500">Click Share</div>
                            <div class="text-2xl font-bold text-red-900" id="compShare">--%</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-500">Avg Price</div>
                            <div class="text-xl font-bold text-gray-800" id="compPrice">€--</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-500">Org Rank</div>
                            <div class="text-xl font-bold text-gray-800" id="compRank">--</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-500">Active Badges</div>
                            <div class="flex gap-1 mt-1" id="compBadges">--</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="comparison_chart" class="chart-container mt-6"></div>
        </div>
    </div>

    <!-- DATA & LOGIC -->
    <script>
        // --- 1. DATA INJECTION ---
        const marketData = [{"week_date":1766188800000,"parent_asin":"Matcha Premium","asin":"B0CNRX8G5S","product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","final_brand":"NORITUAL LAB","is_yaba_asin":"N","price":24.03,"click_share":16.66,"average_organic_rank":2.0,"estimated_clicks":10138.45966,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":7.0,"week_date_str":"2025-12-20"},{"week_date":1766188800000,"parent_asin":"Matcha Premium","asin":"B07SZFD3P9","product_title":"NaturaleBio Matcha Ceremonial Grade 100g. Original...","final_brand":"NATURALEBIO","is_yaba_asin":"Y","price":26.748571429,"click_share":2.95,"average_organic_rank":22.0,"estimated_clicks":1795.22545,"weekly_number_of_days_with_deal":7.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-20"},{"week_date":1766188800000,"parent_asin":"Matcha Premium","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...","final_brand":"SPECIAL LEAVES","is_yaba_asin":"N","price":10.44,"click_share":3.48,"average_organic_rank":14.0,"estimated_clicks":2117.75748,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":7.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-20"},{"week_date":1766188800000,"parent_asin":"Matcha Premium","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...","final_brand":"MATCHA","is_yaba_asin":"N","price":10.44,"click_share":3.48,"average_organic_rank":14.0,"estimated_clicks":2117.75748,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":7.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-20"},{"week_date":1766188800000,"parent_asin":"Matcha Premium","asin":"B07MD4LB49","product_title":"VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A...","final_brand":"VAHDAM","is_yaba_asin":"N","price":9.005714286,"click_share":3.49,"average_organic_rank":8.0,"estimated_clicks":2123.84299,"weekly_number_of_days_with_deal":5.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-20"},{"week_date":1766188800000,"parent_asin":"Matcha Premium","asin":"B0G1T7N675","product_title":"Ceremonial Matcha Pulver BIO-Qualit\u00e4t 50g ideal zu...","final_brand":"CEREMONIAL","is_yaba_asin":"N","price":8.898571429,"click_share":2.56,"average_organic_rank":12.0,"estimated_clicks":1557.89056,"weekly_number_of_days_with_deal":7.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-20"},{"week_date":1766188800000,"parent_asin":"Matcha Premium","asin":"B06XQ5DCYJ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","final_brand":"NATURALEBIO","is_yaba_asin":"Y","price":14.084285714,"click_share":11.18,"average_organic_rank":2.0,"estimated_clicks":6803.60018,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-20"},{"week_date":1766188800000,"parent_asin":"Matcha Premium","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","final_brand":"NORITUAL LAB","is_yaba_asin":"N","price":15.635714286,"click_share":8.85,"average_organic_rank":5.0,"estimated_clicks":5385.67635,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-20"},{"week_date":1766188800000,"parent_asin":"Matcha Premium","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","final_brand":"CEREMONIAL","is_yaba_asin":"N","price":15.635714286,"click_share":8.85,"average_organic_rank":5.0,"estimated_clicks":5385.67635,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-20"},{"week_date":1766188800000,"parent_asin":"Matcha Premium","asin":"B079VQ52MK","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","final_brand":"NATURALEBIO","is_yaba_asin":"Y","price":23.075714286,"click_share":3.69,"average_organic_rank":5.0,"estimated_clicks":2245.55319,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-20"},{"week_date":1766188800000,"parent_asin":"Matcha Premium","asin":"B06XQ69YCQ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","final_brand":"NATURALEBIO","is_yaba_asin":"Y","price":9.2,"click_share":3.85,"average_organic_rank":5.0,"estimated_clicks":2342.92135,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-20"},{"week_date":1766188800000,"parent_asin":"Matcha Premium","asin":"B0F5BVFRC1","product_title":"Jean & Len Handcreme I Love You So Matcha, f\u00fcr nor...","final_brand":"JEAN","is_yaba_asin":"N","price":3.095714286,"click_share":1.92,"average_organic_rank":12.0,"estimated_clicks":1168.41792,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-20"},{"week_date":1766793600000,"parent_asin":"Matcha Premium","asin":"B06XQ5DCYJ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","final_brand":"NATURALEBIO","is_yaba_asin":"Y","price":15.058571429,"click_share":11.66,"average_organic_rank":2.0,"estimated_clicks":5562.759796,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-27"},{"week_date":1766793600000,"parent_asin":"Matcha Premium","asin":"B079VQ52MK","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","final_brand":"NATURALEBIO","is_yaba_asin":"Y","price":24.855714286,"click_share":3.49,"average_organic_rank":5.0,"estimated_clicks":1665.011294,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-27"},{"week_date":1766793600000,"parent_asin":"Matcha Premium","asin":"B07K1WBH4K","product_title":"VAHDAM, Vanille Matcha Gr\u00fcner Tee Pulver (100g, 50...","final_brand":"VAHDAM","is_yaba_asin":"N","price":9.895714286,"click_share":1.47,"average_organic_rank":20.0,"estimated_clicks":701.308482,"weekly_number_of_days_with_deal":3.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-27"},{"week_date":1766793600000,"parent_asin":"Matcha Premium","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...","final_brand":"SPECIAL LEAVES","is_yaba_asin":"N","price":10.71,"click_share":3.4,"average_organic_rank":13.0,"estimated_clicks":1622.07404,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":7.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-27"},{"week_date":1766793600000,"parent_asin":"Matcha Premium","asin":"B06XQ69YCQ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","final_brand":"NATURALEBIO","is_yaba_asin":"Y","price":10.538571429,"click_share":3.75,"average_organic_rank":4.0,"estimated_clicks":1789.05225,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-27"},{"week_date":1766793600000,"parent_asin":"Matcha Premium","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...","final_brand":"MATCHA","is_yaba_asin":"N","price":10.71,"click_share":3.4,"average_organic_rank":13.0,"estimated_clicks":1622.07404,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":7.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-27"},{"week_date":1766793600000,"parent_asin":"Matcha Premium","asin":"B08XVX8V1T","product_title":"Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...","final_brand":"BIOKONTOR","is_yaba_asin":"N","price":12.367142857,"click_share":2.44,"average_organic_rank":10.0,"estimated_clicks":1164.076664,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-27"},{"week_date":1766793600000,"parent_asin":"Matcha Premium","asin":"B0CNRX8G5S","product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","final_brand":"NORITUAL LAB","is_yaba_asin":"N","price":24.648571429,"click_share":18.77,"average_organic_rank":2.0,"estimated_clicks":8954.802862,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":7.0,"week_date_str":"2025-12-27"},{"week_date":1766793600000,"parent_asin":"Matcha Premium","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","final_brand":"NORITUAL LAB","is_yaba_asin":"N","price":16.037142857,"click_share":8.42,"average_organic_rank":6.0,"estimated_clicks":4017.018652,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-27"},{"week_date":1766793600000,"parent_asin":"Matcha Premium","asin":"B07MD4LB49","product_title":"VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A...","final_brand":"VAHDAM","is_yaba_asin":"N","price":9.895714286,"click_share":4.19,"average_organic_rank":7.0,"estimated_clicks":1998.967714,"weekly_number_of_days_with_deal":3.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-27"},{"week_date":1766793600000,"parent_asin":"Matcha Premium","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","final_brand":"CEREMONIAL","is_yaba_asin":"N","price":16.037142857,"click_share":8.42,"average_organic_rank":6.0,"estimated_clicks":4017.018652,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-27"},{"week_date":1766793600000,"parent_asin":"Matcha Premium","asin":"B08XVX8V1T","product_title":"Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...","final_brand":"BIO","is_yaba_asin":"N","price":12.367142857,"click_share":2.44,"average_organic_rank":10.0,"estimated_clicks":1164.076664,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-27"},{"week_date":1766793600000,"parent_asin":"Matcha Premium","asin":"B07SZFD3P9","product_title":"NaturaleBio Matcha Ceremonial Grade 100g. Original...","final_brand":"NATURALEBIO","is_yaba_asin":"Y","price":30.704285714,"click_share":2.93,"average_organic_rank":23.0,"estimated_clicks":1397.846158,"weekly_number_of_days_with_deal":1.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2025-12-27"},{"week_date":1767398400000,"parent_asin":"Matcha Premium","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...","final_brand":"MATCHA","is_yaba_asin":"N","price":10.39,"click_share":3.0,"average_organic_rank":16.0,"estimated_clicks":810.333,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":4.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2026-01-03"},{"week_date":1767398400000,"parent_asin":"Matcha Premium","asin":"B0F9B1LWQQ","product_title":"UNREAL\u00ae 100g Ceremonial Bio Matcha \u2013 100% Japanisc...","final_brand":"UNREAL\u00ae","is_yaba_asin":"N","price":31.2725,"click_share":1.57,"average_organic_rank":19.0,"estimated_clicks":424.07427,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2026-01-03"},{"week_date":1767398400000,"parent_asin":"Matcha Premium","asin":"B07MD4LB49","product_title":"VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A...","final_brand":"VAHDAM","is_yaba_asin":"N","price":10.43,"click_share":3.15,"average_organic_rank":9.0,"estimated_clicks":850.84965,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2026-01-03"},{"week_date":1767398400000,"parent_asin":"Matcha Premium","asin":"B07SZFD3P9","product_title":"NaturaleBio Matcha Ceremonial Grade 100g. Original...","final_brand":"NATURALEBIO","is_yaba_asin":"Y","price":30.27,"click_share":2.68,"average_organic_rank":0.0,"estimated_clicks":723.89748,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2026-01-03"},{"week_date":1767398400000,"parent_asin":"Matcha Premium","asin":"B08XVX8V1T","product_title":"Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...","final_brand":"BIO","is_yaba_asin":"N","price":11.9975,"click_share":2.39,"average_organic_rank":10.0,"estimated_clicks":645.56529,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2026-01-03"},{"week_date":1767398400000,"parent_asin":"Matcha Premium","asin":"B06XQ5DCYJ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","final_brand":"NATURALEBIO","is_yaba_asin":"Y","price":14.6075,"click_share":12.9,"average_organic_rank":2.0,"estimated_clicks":3484.4319,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2026-01-03"},{"week_date":1767398400000,"parent_asin":"Matcha Premium","asin":"B08XVX8V1T","product_title":"Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...","final_brand":"BIOKONTOR","is_yaba_asin":"N","price":11.9975,"click_share":2.39,"average_organic_rank":10.0,"estimated_clicks":645.56529,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2026-01-03"},{"week_date":1767398400000,"parent_asin":"Matcha Premium","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","final_brand":"NORITUAL LAB","is_yaba_asin":"N","price":15.5575,"click_share":7.38,"average_organic_rank":6.0,"estimated_clicks":1993.41918,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2026-01-03"},{"week_date":1767398400000,"parent_asin":"Matcha Premium","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","final_brand":"CEREMONIAL","is_yaba_asin":"N","price":15.5575,"click_share":7.38,"average_organic_rank":6.0,"estimated_clicks":1993.41918,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2026-01-03"},{"week_date":1767398400000,"parent_asin":"Matcha Premium","asin":"B0CNRX8G5S","product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","final_brand":"NORITUAL LAB","is_yaba_asin":"N","price":23.91,"click_share":19.34,"average_organic_rank":2.0,"estimated_clicks":5223.94674,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":4.0,"week_date_str":"2026-01-03"},{"week_date":1767398400000,"parent_asin":"Matcha Premium","asin":"B079VQ52MK","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","final_brand":"NATURALEBIO","is_yaba_asin":"Y","price":24.5275,"click_share":3.66,"average_organic_rank":5.0,"estimated_clicks":988.60626,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2026-01-03"},{"week_date":1767398400000,"parent_asin":"Matcha Premium","asin":"B06XQ69YCQ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","final_brand":"NATURALEBIO","is_yaba_asin":"Y","price":10.2225,"click_share":3.35,"average_organic_rank":5.0,"estimated_clicks":904.87185,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2026-01-03"},{"week_date":1767398400000,"parent_asin":"Matcha Premium","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...","final_brand":"SPECIAL LEAVES","is_yaba_asin":"N","price":10.39,"click_share":3.0,"average_organic_rank":16.0,"estimated_clicks":810.333,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":4.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"week_date_str":"2026-01-03"}];
        
        const insights = {"our_brand": "NATURALEBIO", "top_competitors": ["NORITUAL LAB", "CEREMONIAL", "VAHDAM"], "latest_week": "2026-00", "avg_share_deal_impact": -3.4522222222222227, "coupon_impact": 0, "market_trend": "Declining"};
        
        // --- 2. GOOGLE CHARTS LOGIC ---
        google.charts.load('current', {'packages':['corechart', 'bar']});
        google.charts.setOnLoadCallback(initDashboard);

        function initDashboard() {
            drawTrendChart();
            drawBrandCompetitivenessChart();
            drawEfficiencyChart();
            populateSelectors();
            
            // Set Initial Header Stat (Latest Week Our Share)
            const latestWeek = marketData[marketData.length - 1].week_date_str;
            const latestData = marketData.filter(d => d.week_date_str === latestWeek);
            const ourClicks = latestData.filter(d => d.is_yaba_asin === 'Y').reduce((sum, d) => sum + d.estimated_clicks, 0);
            const totalClicks = latestData.reduce((sum, d) => sum + d.estimated_clicks, 0);
            const share = (ourClicks / totalClicks * 100).toFixed(1);
            
            document.getElementById('headerShare').innerText = share + '%';
            document.getElementById('trendShare').innerText = share + '%';
            document.getElementById('trendVol').innerText = Math.round(totalClicks).toLocaleString();
        }

        // --- CHART 1: Global Trend (Volume + Share) ---
        function drawTrendChart() {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Week');
            data.addColumn('number', 'Market Clicks (Vol)');
            data.addColumn('number', 'Our Click Share (%)');

            // Aggregate by Week
            const weeks = [...new Set(marketData.map(d => d.week_date_str))];
            const rows = weeks.map(week => {
                const weekData = marketData.filter(d => d.week_date_str === week);
                const totalClicks = weekData.reduce((sum, d) => sum + d.estimated_clicks, 0);
                const ourClicks = weekData.filter(d => d.is_yaba_asin === 'Y').reduce((sum, d) => sum + d.estimated_clicks, 0);
                const share = totalClicks > 0 ? (ourClicks / totalClicks * 100) : 0;
                return [week, totalClicks, share];
            });

            data.addRows(rows);

            const options = {
                seriesType: 'bars',
                series: { 1: {type: 'line', targetAxisIndex: 1, color: '#4285F4', pointSize: 5} },
                colors: ['#E0E0E0'],
                vAxes: {
                    0: {title: 'Clicks Volume', gridlines: {color: 'transparent'}},
                    1: {title: 'Our Share (%)', format: '#\'%\'', gridlines: {count: 4}}
                },
                legend: {position: 'bottom'},
                chartArea: {width: '80%', height: '70%'}
            };

            const chart = new google.visualization.ComboChart(document.getElementById('trend_chart'));
            chart.draw(data, options);
        }

        // --- CHART 2: Competitor Share Lines ---
        function drawBrandCompetitivenessChart() {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Week');
            data.addColumn('number', insights.our_brand); // Us
            insights.top_competitors.forEach(comp => data.addColumn('number', comp));
            data.addColumn('number', 'Rest');

            const weeks = [...new Set(marketData.map(d => d.week_date_str))];
            
            const rows = weeks.map(week => {
                const weekData = marketData.filter(d => d.week_date_str === week);
                const totalClicks = weekData.reduce((sum, d) => sum + d.estimated_clicks, 0);
                
                // Helper to get share for a specific brand name
                const getShare = (brandName) => {
                    const brandClicks = weekData.filter(d => d.final_brand === brandName).reduce((sum, d) => sum + d.estimated_clicks, 0);
                    return totalClicks > 0 ? (brandClicks / totalClicks * 100) : 0;
                };

                const ourShare = getShare(insights.our_brand);
                const compShares = insights.top_competitors.map(c => getShare(c));
                
                // Rest of market
                const trackedShare = ourShare + compShares.reduce((a, b) => a + b, 0);
                const restShare = 100 - trackedShare;

                return [week, ourShare, ...compShares, restShare];
            });

            data.addRows(rows);

            const options = {
                curveType: 'function',
                lineWidth: 3,
                colors: ['#4285F4', '#EA4335', '#FBBC04', '#34A853', '#9AA0A6'], // Google Colors
                legend: {position: 'bottom'},
                vAxis: {format: '#\'%\''},
                chartArea: {width: '85%', height: '70%'}
            };

            const chart = new google.visualization.LineChart(document.getElementById('brand_chart'));
            chart.draw(data, options);
        }

        // --- CHART 3: Efficiency (Scatter) ---
        function drawEfficiencyChart() {
            const data = new google.visualization.DataTable();
            data.addColumn('number', 'Organic Rank');
            data.addColumn('number', 'Click Share');
            data.addColumn({type: 'string', role: 'style'}); // Color
            data.addColumn({type: 'string', role: 'tooltip'});

            // Filter for latest week only
            const latestWeek = marketData[marketData.length - 1].week_date_str;
            const weekData = marketData.filter(d => d.week_date_str === latestWeek);

            const rows = weekData.map(d => {
                const isUs = d.is_yaba_asin === 'Y';
                const color = isUs ? 'point { size: 12; fill-color: #4285F4; }' : 'point { size: 6; fill-color: #BDBDBD; }';
                const label = `${d.final_brand} | ${d.product_title.substring(0, 30)}...`;
                return [d.average_organic_rank, d.click_share, color, label];
            });

            data.addRows(rows);

            const options = {
                hAxis: {title: 'Organic Rank (Lower is Better)', direction: 1},
                vAxis: {title: 'Click Share (%)'},
                legend: 'none',
                chartArea: {width: '85%', height: '80%'}
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('eff_chart'));
            chart.draw(data, options);
        }

        // --- INTERACTIVE LOGIC ---
        function populateSelectors() {
            const weekSel = document.getElementById('weekSelector');
            const compSel = document.getElementById('compSelector');
            
            const weeks = [...new Set(marketData.map(d => d.week_date_str))].reverse();
            weeks.forEach(w => {
                const opt = document.createElement('option');
                opt.value = w;
                opt.innerText = w;
                weekSel.appendChild(opt);
            });

            const brands = [...new Set(marketData.filter(d => d.is_yaba_asin === 'N').map(d => d.final_brand))];
            brands.forEach(b => {
                const opt = document.createElement('option');
                opt.value = b;
                opt.innerText = b;
                compSel.appendChild(opt);
            });
            
            // Trigger first load
            if(brands.length > 0) updateComparator();
        }

        function updateComparator() {
            const week = document.getElementById('weekSelector').value;
            const competitor = document.getElementById('compSelector').value;
            document.getElementById('compNameDisplay').innerText = competitor;

            // Filter Data
            const weekData = marketData.filter(d => d.week_date_str === week);
            const ourData = weekData.filter(d => d.is_yaba_asin === 'Y');
            const compData = weekData.filter(d => d.final_brand === competitor);

            // Calc Stats Helper
            const calcStats = (dataArr) => {
                if (!dataArr.length) return {share: 0, price: 0, rank: 0, badges: []};
                const totalClicks = weekData.reduce((s, d) => s + d.estimated_clicks, 0);
                const brandClicks = dataArr.reduce((s, d) => s + d.estimated_clicks, 0);
                const share = (brandClicks / totalClicks * 100);
                const avgPrice = dataArr.reduce((s, d) => s + d.price, 0) / dataArr.length; // Simple avg for now
                const avgRank = dataArr.reduce((s, d) => s + d.average_organic_rank, 0) / dataArr.length;
                
                // Check Badges
                let badges = [];
                if (dataArr.some(d => d.weekly_number_of_days_with_deal > 0)) badges.push("Deal");
                if (dataArr.some(d => d.weekly_number_of_days_with_amazon_choice_badge > 0)) badges.push("Choice");
                
                return {share, price: avgPrice, rank: avgRank, badges};
            };

            const usStats = calcStats(ourData);
            const compStats = calcStats(compData);

            // Update DOM
            document.getElementById('usShare').innerText = usStats.share.toFixed(1) + '%';
            document.getElementById('usPrice').innerText = '€' + usStats.price.toFixed(2);
            document.getElementById('usRank').innerText = usStats.rank.toFixed(1);
            document.getElementById('usBadges').innerHTML = usStats.badges.length ? usStats.badges.map(b => `<span class="badge badge-green">${b}</span>`).join('') : '<span class="text-xs text-gray-400">None</span>';

            document.getElementById('compShare').innerText = compStats.share.toFixed(1) + '%';
            document.getElementById('compPrice').innerText = '€' + compStats.price.toFixed(2);
            document.getElementById('compRank').innerText = compStats.rank.toFixed(1);
            document.getElementById('compBadges').innerHTML = compStats.badges.length ? compStats.badges.map(b => `<span class="badge badge-red">${b}</span>`).join('') : '<span class="text-xs text-gray-400">None</span>';

            // Draw Comparison Bar Chart
            drawComparisonChart(usStats, compStats);
        }

        function drawComparisonChart(us, comp) {
            const data = google.visualization.arrayToDataTable([
                ['Metric', 'Us', 'Competitor'],
                ['Click Share (%)', us.share, comp.share],
                ['Price (€)', us.price, comp.price],
                ['Rank (Inv)', 30 - us.rank, 30 - comp.rank] // Invert rank for visual (higher bar = better)
            ]);

            const options = {
                title: 'Relative Performance (Rank Inverted: Higher is Better)',
                bars: 'horizontal',
                colors: ['#4285F4', '#EA4335'],
                legend: {position: 'top'},
                chartArea: {width: '70%'}
            };

            const chart = new google.visualization.BarChart(document.getElementById('comparison_chart'));
            chart.draw(data, options);
        }

        // --- TABS LOGIC ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
            
            // Redraw charts to fix hidden div sizing issues
            if (tabId === 'report') {
                drawTrendChart();
                drawBrandCompetitivenessChart();
                drawEfficiencyChart();
            } else {
                updateComparator();
            }
        }
    </script>
</body>
</html>