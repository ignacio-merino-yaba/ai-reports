<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Intelligence Report - NaturaleBio</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
        .card { @apply bg-white rounded-2xl shadow-sm border border-slate-100 p-6; }
        .metric-value { @apply text-3xl font-bold tracking-tight text-slate-900; }
        .metric-label { @apply text-sm font-medium text-slate-500 uppercase tracking-wider; }
        .badge { @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { LineChart, Line, AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, ScatterChart, Scatter, ZAxis } = Recharts;
        const { TrendingUp, TrendingDown, Activity, Award, ShoppingCart, Percent, Search, ShieldCheck, AlertCircle, Zap, ArrowRight, BarChart2 } = lucide;

        // INJECTED DATA
        const marketData = {"meta": {"parent_asin": "Coconut oil", "our_brand": "NaturaleBio", "last_week": "2026-01", "top_competitors": ["by Amazon", "Eco nature", "Plan\u00e8te au Naturel"]}, "kpi": {"total_clicks": 1130.0, "clicks_growth": -35.8, "share_last_week": 30.6}, "trends": [{"week": "2025-51", "us_clicks": 1730.0, "comp_clicks": 5898.0, "us_share": 22.68}, {"week": "2025-52", "us_clicks": 1760.0, "comp_clicks": 4045.0, "us_share": 30.31}, {"week": "2026-01", "us_clicks": 1130.0, "comp_clicks": 2562.0, "us_share": 30.6}], "brand_competitiveness": [{"week": "2025-51", "NaturaleBio": 16.16, "by Amazon": 20.19, "Eco nature": 8.7, "Plan\u00e8te au Naturel": 7.99, "Rest of Market": 18.209999999999997}, {"week": "2025-52", "NaturaleBio": 22.17, "by Amazon": 19.28, "Eco nature": 8.81, "Plan\u00e8te au Naturel": 7.55, "Rest of Market": 15.329999999999998}, {"week": "2026-01", "NaturaleBio": 22.14, "by Amazon": 18.98, "Eco nature": 8.67, "Plan\u00e8te au Naturel": 7.29, "Rest of Market": 15.27}], "efficiency": [{"asin": "B07W8PPQQM", "brand": "by Amazon", "is_us": false, "rank": 2, "click_share": 18.98, "efficiency": 2.83, "title": "by Amazon - Olio di cocco verg..."}, {"asin": "B01M0LGD6A", "brand": "NaturaleBio", "is_us": true, "rank": 1, "click_share": 13.51, "efficiency": 3.68, "title": "NaturaleBio Organic Virgin Coc..."}, {"asin": "B08HK4YWGH", "brand": "Eco nature", "is_us": false, "rank": 3, "click_share": 8.67, "efficiency": 2.35, "title": "Eco nature, Olio di cocco bio,..."}, {"asin": "B0D6S1L6PL", "brand": "Plan\u00e8te au Naturel", "is_us": false, "rank": 4, "click_share": 7.29, "efficiency": 1.98, "title": "Olio di Cocco Bio 150 ml - Pla..."}, {"asin": "B073P974FR", "brand": "CocoNativo", "is_us": false, "rank": 9, "click_share": 6.62, "efficiency": 1.01, "title": "CocoNativo Biologico Extra Ver..."}, {"asin": "B01JIB2T32", "brand": "NaturaleBio", "is_us": true, "rank": 6, "click_share": 4.52, "efficiency": 1.23, "title": "NaturaleBio Olio di Cocco Biol..."}, {"asin": "B0CH11HMCS", "brand": "BENVOLIO", "is_us": false, "rank": 7, "click_share": 4.26, "efficiency": 1.16, "title": "BENVOLIO - Olio di Cocco Biolo..."}, {"asin": "B01JA3S1F8", "brand": "NaturaleBio", "is_us": true, "rank": 6, "click_share": 4.11, "efficiency": 1.12, "title": "NaturaleBio Olio di Cocco Biol..."}, {"asin": "B0FVM32PSK", "brand": "Pipkin", "is_us": false, "rank": 9, "click_share": 2.87, "efficiency": 0.42, "title": "Pipkin Olio di Cocco 100% Biol..."}, {"asin": "B07TMGBPL7", "brand": "Monte Nativo", "is_us": false, "rank": 14, "click_share": 1.52, "efficiency": 0.41, "title": "Olio di Cocco Biologico Extra ..."}], "raw_data": [{"week_date": "2025-51", "brand_real": "Matt Forsan", "asin": "B018SC2MU2", "product_title": "Matt Forsan, Olio di Cocco, Nutriente per Corpo e ...", "price": 5.2, "click_share": 2.9, "average_organic_rank": 10, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "N", "impression_share": 3.66}, {"week_date": "2025-51", "brand_real": "NaturaleBio", "asin": "B01JA3S1F8", "product_title": "NaturaleBio Olio di Cocco Biologico Vergine 500 ml...", "price": 13.99, "click_share": 5.94, "average_organic_rank": 6, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "Y", "impression_share": 3.62}, {"week_date": "2026-01", "brand_real": "NaturaleBio", "asin": "B01JA3S1F8", "product_title": "NaturaleBio Olio di Cocco Biologico Vergine 500 ml...", "price": 13.99, "click_share": 4.11, "average_organic_rank": 6, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "Y", "impression_share": 3.66}, {"week_date": "2025-52", "brand_real": "NaturaleBio", "asin": "B01JA3S1F8", "product_title": "NaturaleBio Olio di Cocco Biologico Vergine 500 ml...", "price": 13.99, "click_share": 6.12, "average_organic_rank": 5, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "Y", "impression_share": 3.63}, {"week_date": "2025-52", "brand_real": "NaturaleBio", "asin": "B01JIB2T32", "product_title": "NaturaleBio Olio di Cocco Biologico Vergine 1000 m...", "price": 19.49, "click_share": 4.8, "average_organic_rank": 6, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "Y", "impression_share": 3.63}, {"week_date": "2025-51", "brand_real": "NaturaleBio", "asin": "B01JIB2T32", "product_title": "NaturaleBio Olio di Cocco Biologico Vergine 1000 m...", "price": 19.49, "click_share": 5.69, "average_organic_rank": 5, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "Y", "impression_share": 3.61}, {"week_date": "2026-01", "brand_real": "NaturaleBio", "asin": "B01JIB2T32", "product_title": "NaturaleBio Olio di Cocco Biologico Vergine 1000 m...", "price": 19.49, "click_share": 4.52, "average_organic_rank": 6, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "Y", "impression_share": 3.66}, {"week_date": "2026-01", "brand_real": "NaturaleBio", "asin": "B01M0LGD6A", "product_title": "NaturaleBio Organic Virgin Coconut Oil 200 ml. Raw...", "price": 8.99, "click_share": 13.51, "average_organic_rank": 1, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "Y", "impression_share": 3.67}, {"week_date": "2025-52", "brand_real": "NaturaleBio", "asin": "B01M0LGD6A", "product_title": "NaturaleBio Organic Virgin Coconut Oil 200 ml. Raw...", "price": 8.99, "click_share": 11.25, "average_organic_rank": 1, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "Y", "impression_share": 3.25}, {"week_date": "2025-51", "brand_real": "NaturaleBio", "asin": "B01M0LGD6A", "product_title": "NaturaleBio Organic Virgin Coconut Oil 200 ml. Raw...", "price": 7.192, "click_share": 4.53, "average_organic_rank": 1, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "Y", "impression_share": 1.68}, {"week_date": "2026-01", "brand_real": "CocoNativo", "asin": "B073P974FR", "product_title": "CocoNativo Biologico Extra Vergine Olio di Cocco, ...", "price": 18.95, "click_share": 6.62, "average_organic_rank": 9, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "N", "impression_share": 6.56}, {"week_date": "2025-52", "brand_real": "CocoNativo", "asin": "B073P974FR", "product_title": "CocoNativo Biologico Extra Vergine Olio di Cocco, ...", "price": 18.95, "click_share": 6.22, "average_organic_rank": 8, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "N", "impression_share": 6.16}, {"week_date": "2025-51", "brand_real": "CocoNativo", "asin": "B073P974FR", "product_title": "CocoNativo Biologico Extra Vergine Olio di Cocco, ...", "price": 18.95, "click_share": 7.31, "average_organic_rank": 8, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "N", "impression_share": 6.54}, {"week_date": "2026-01", "brand_real": "Monte Nativo", "asin": "B07TMGBPL7", "product_title": "Olio di Cocco Biologico Extra Vergin Monte Nativo ...", "price": 17.95, "click_share": 1.52, "average_organic_rank": 14, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "N", "impression_share": 3.72}, {"week_date": "2026-01", "brand_real": "Eco nature", "asin": "B08HK4YWGH", "product_title": "Eco nature, Olio di cocco bio, 200g", "price": 4.5, "click_share": 8.67, "average_organic_rank": 3, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "N", "impression_share": 3.69}, {"week_date": "2025-52", "brand_real": "Eco nature", "asin": "B08HK4YWGH", "product_title": "Eco nature, Olio di cocco bio, 200g", "price": 4.5, "click_share": 8.81, "average_organic_rank": 4, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "N", "impression_share": 3.67}, {"week_date": "2025-51", "brand_real": "Eco nature", "asin": "B08HK4YWGH", "product_title": "Eco nature, Olio di cocco bio, 200g", "price": 4.5, "click_share": 8.7, "average_organic_rank": 4, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "N", "impression_share": 3.65}, {"week_date": "2025-52", "brand_real": "Crudolio", "asin": "B09G757HB2", "product_title": "CRUDOLIO - Olio Di Cocco Vergine Bio 200ml. | Spre...", "price": 7.99, "click_share": 2.34, "average_organic_rank": 11, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "N", "impression_share": 3.47}, {"week_date": "2026-01", "brand_real": "BENVOLIO", "asin": "B0CH11HMCS", "product_title": "BENVOLIO - Olio di Cocco Biologico Deodorato | 950...", "price": 10.9, "click_share": 4.26, "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "N", "impression_share": 3.66}, {"week_date": "2025-51", "brand_real": "BENVOLIO", "asin": "B0CH11HMCS", "product_title": "BENVOLIO - Olio di Cocco Biologico Deodorato | 950...", "price": 10.9, "click_share": 5.85, "average_organic_rank": 6, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "N", "impression_share": 3.61}, {"week_date": "2025-52", "brand_real": "BENVOLIO", "asin": "B0CH11HMCS", "product_title": "BENVOLIO - Olio di Cocco Biologico Deodorato | 950...", "price": 10.9, "click_share": 4.23, "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "N", "impression_share": 3.63}, {"week_date": "2025-52", "brand_real": "Plan\u00e8te au Naturel", "asin": "B0D6S1L6PL", "product_title": "Olio di Cocco Bio 150 ml - Plan\u00e8te au Naturel - Cr...", "price": 5.9, "click_share": 7.55, "average_organic_rank": 4, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "N", "impression_share": 3.66}, {"week_date": "2026-01", "brand_real": "Plan\u00e8te au Naturel", "asin": "B0D6S1L6PL", "product_title": "Olio di Cocco Bio 150 ml - Plan\u00e8te au Naturel - Cr...", "price": 5.9, "click_share": 7.29, "average_organic_rank": 4, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "N", "impression_share": 3.68}, {"week_date": "2025-51", "brand_real": "Plan\u00e8te au Naturel", "asin": "B0D6S1L6PL", "product_title": "Olio di Cocco Bio 150 ml - Plan\u00e8te au Naturel - Cr...", "price": 5.9, "click_share": 7.99, "average_organic_rank": 3, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "N", "impression_share": 3.64}, {"week_date": "2025-51", "brand_real": "Pipkin", "asin": "B0FVM32PSK", "product_title": "Pipkin Olio di Cocco 100% Biologico e Puro 1L \u2013 Na...", "price": 14.99, "click_share": 2.15, "average_organic_rank": 15, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "N", "impression_share": 4.75}, {"week_date": "2025-52", "brand_real": "Pipkin", "asin": "B0FVM32PSK", "product_title": "Pipkin Olio di Cocco 100% Biologico e Puro 1L \u2013 Na...", "price": 14.99, "click_share": 2.54, "average_organic_rank": 9, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "N", "impression_share": 6.4}, {"week_date": "2026-01", "brand_real": "Pipkin", "asin": "B0FVM32PSK", "product_title": "Pipkin Olio di Cocco 100% Biologico e Puro 1L \u2013 Na...", "price": 14.99, "click_share": 2.87, "average_organic_rank": 9, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "is_yaba_asin": "N", "impression_share": 6.81}, {"week_date": "2026-01", "brand_real": "by Amazon", "asin": "B07W8PPQQM", "product_title": "by Amazon - Olio di cocco vergine biologico, 950 m...", "price": 13.33, "click_share": 18.98, "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 1, "is_yaba_asin": "N", "impression_share": 6.7}, {"week_date": "2025-52", "brand_real": "by Amazon", "asin": "B07W8PPQQM", "product_title": "by Amazon - Olio di cocco vergine biologico, 950 m...", "price": 13.312857143, "click_share": 19.28, "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 7, "is_yaba_asin": "N", "impression_share": 6.28}, {"week_date": "2025-51", "brand_real": "by Amazon", "asin": "B07W8PPQQM", "product_title": "by Amazon - Olio di cocco vergine biologico, 950 m...", "price": 13.39, "click_share": 20.19, "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 7, "is_yaba_asin": "N", "impression_share": 6.99}], "insights": {"trend_text": "El parent ASIN muestra un decrecimiento del 35.8% en clics estimados la última semana (2026-01).", "brand_text": "Nuestra marca NaturaleBio compite principalmente con by Amazon, Eco nature, Planète au Naturel. En la última semana, nuestra cuota fue del 30.6%.", "levers_text": "Impacto de cupones: Neutro/Negativo (nan% lift). Correlación Precio-Share: -0.54."}};

        const colors = {
            primary: '#2563eb', // Blue
            secondary: '#64748b', // Slate
            accent: '#f59e0b', // Amber
            danger: '#ef4444', // Red
            success: '#10b981', // Green
            comp1: '#ef4444',
            comp2: '#f97316',
            comp3: '#8b5cf6',
            rest: '#cbd5e1'
        };

        const MetricCard = ({ title, value, subvalue, trend, icon: Icon }) => (
            <div className="card hover:shadow-md transition-shadow">
                <div className="flex justify-between items-start mb-4">
                    <div className="p-2 bg-blue-50 rounded-lg">
                        <Icon className="w-6 h-6 text-blue-600" />
                    </div>
                    {trend && (
                        <div className={`badge ${trend > 0 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                            {trend > 0 ? <TrendingUp size={14} className="mr-1" /> : <TrendingDown size={14} className="mr-1" />}
                            {Math.abs(trend)}%
                        </div>
                    )}
                </div>
                <h3 className="metric-label mb-1">{title}</h3>
                <div className="metric-value">{value}</div>
                {subvalue && <p className="text-sm text-slate-500 mt-1">{subvalue}</p>}
            </div>
        );

        const InsightSection = ({ title, icon: Icon, children }) => (
            <div className="mb-8">
                <div className="flex items-center gap-2 mb-3">
                    <Icon className="w-5 h-5 text-blue-600" />
                    <h3 className="text-lg font-bold text-slate-900">{title}</h3>
                </div>
                <div className="bg-white rounded-xl p-4 border border-slate-200 text-slate-700 leading-relaxed shadow-sm">
                    {children}
                </div>
            </div>
        );

        const InteractiveReport = () => {
            const weeks = [...new Set(marketData.raw_data.map(d => d.week_date))].sort();
            const competitors = [...new Set(marketData.raw_data.filter(d => d.is_yaba_asin === 'N').map(d => d.brand_real))].sort();
            
            const [selectedWeek, setSelectedWeek] = React.useState(weeks[weeks.length - 1]);
            const [selectedComp, setSelectedComp] = React.useState(competitors[0] || '');

            const ourData = marketData.raw_data.filter(d => d.week_date === selectedWeek && d.is_yaba_asin === 'Y');
            const compData = marketData.raw_data.filter(d => d.week_date === selectedWeek && d.brand_real === selectedComp);

            // Metrics calculation
            const getAvg = (data, field) => {
                if (!data.length) return 0;
                return (data.reduce((acc, curr) => acc + curr[field], 0) / data.length).toFixed(2);
            };

            return (
                <div className="space-y-6 animate-fade-in">
                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-wrap gap-4 items-center justify-between">
                        <div className="flex gap-4">
                            <div>
                                <label className="block text-xs font-semibold text-slate-500 uppercase mb-1">Semana</label>
                                <select 
                                    className="bg-slate-50 border border-slate-200 text-slate-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-40 p-2.5"
                                    value={selectedWeek}
                                    onChange={(e) => setSelectedWeek(e.target.value)}
                                >
                                    {weeks.map(w => <option key={w} value={w}>{w}</option>)}
                                </select>
                            </div>
                            <div>
                                <label className="block text-xs font-semibold text-slate-500 uppercase mb-1">Competidor</label>
                                <select 
                                    className="bg-slate-50 border border-slate-200 text-slate-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-48 p-2.5"
                                    value={selectedComp}
                                    onChange={(e) => setSelectedComp(e.target.value)}
                                >
                                    {competitors.map(c => <option key={c} value={c}>{c}</option>)}
                                </select>
                            </div>
                        </div>
                        <div className="text-right">
                            <p className="text-sm text-slate-500">Comparando</p>
                            <p className="font-bold text-slate-900 text-lg">{marketData.meta.our_brand} <span className="text-slate-400 font-light mx-1">vs</span> {selectedComp}</p>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {/* Our Card */}
                        <div className="card border-l-4 border-l-blue-500">
                            <h3 className="text-xl font-bold mb-4 text-slate-800">{marketData.meta.our_brand}</h3>
                            <div className="space-y-4">
                                <div className="flex justify-between py-2 border-b border-slate-100">
                                    <span className="text-slate-500">Click Share Promedio</span>
                                    <span className="font-bold text-slate-900">{getAvg(ourData, 'click_share')}%</span>
                                </div>
                                <div className="flex justify-between py-2 border-b border-slate-100">
                                    <span className="text-slate-500">Precio Promedio</span>
                                    <span className="font-bold text-slate-900">€{getAvg(ourData, 'price')}</span>
                                </div>
                                <div className="flex justify-between py-2 border-b border-slate-100">
                                    <span className="text-slate-500">Rank Orgánico</span>
                                    <span className="font-bold text-slate-900">{getAvg(ourData, 'average_organic_rank')}</span>
                                </div>
                                <div className="mt-4">
                                    <h4 className="text-xs font-semibold uppercase text-slate-500 mb-2">ASINs Activos</h4>
                                    <div className="flex flex-wrap gap-2">
                                        {ourData.map(d => (
                                            <span key={d.asin} className="badge bg-blue-100 text-blue-800" title={d.product_title}>
                                                {d.asin}
                                            </span>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Comp Card */}
                        <div className="card border-l-4 border-l-red-500">
                            <h3 className="text-xl font-bold mb-4 text-slate-800">{selectedComp}</h3>
                            <div className="space-y-4">
                                <div className="flex justify-between py-2 border-b border-slate-100">
                                    <span className="text-slate-500">Click Share Promedio</span>
                                    <span className="font-bold text-slate-900">{getAvg(compData, 'click_share')}%</span>
                                </div>
                                <div className="flex justify-between py-2 border-b border-slate-100">
                                    <span className="text-slate-500">Precio Promedio</span>
                                    <span className="font-bold text-slate-900">€{getAvg(compData, 'price')}</span>
                                </div>
                                <div className="flex justify-between py-2 border-b border-slate-100">
                                    <span className="text-slate-500">Rank Orgánico</span>
                                    <span className="font-bold text-slate-900">{getAvg(compData, 'average_organic_rank')}</span>
                                </div>
                                <div className="mt-4">
                                    <h4 className="text-xs font-semibold uppercase text-slate-500 mb-2">ASINs Activos</h4>
                                    <div className="flex flex-wrap gap-2">
                                        {compData.map(d => (
                                            <span key={d.asin} className="badge bg-red-100 text-red-800" title={d.product_title}>
                                                {d.asin}
                                            </span>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const StaticReport = () => {
            // Efficiency data formatting for bubble chart
            const bubbleData = marketData.efficiency.map(e => ({
                x: e.rank,
                y: e.click_share,
                z: e.efficiency,
                name: e.brand,
                isUs: e.is_us,
                fill: e.is_us ? colors.primary : colors.secondary
            }));

            return (
                <div className="space-y-8 animate-fade-in">
                    
                    {/* KPI ROW */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <MetricCard 
                            title="Total Clicks (Est.)" 
                            value={marketData.kpi.total_clicks} 
                            subvalue="Última Semana" 
                            trend={marketData.kpi.clicks_growth}
                            icon={Activity}
                        />
                        <MetricCard 
                            title="Market Share (Us)" 
                            value={`${marketData.kpi.share_last_week}%`} 
                            subvalue={`Parent: ${marketData.meta.parent_asin}`}
                            trend={null}
                            icon={Percent}
                        />
                        <MetricCard 
                            title="Top Competidor" 
                            value={marketData.meta.top_competitors[0]} 
                            subvalue="Mayor cuota ajena"
                            trend={null}
                            icon={Award}
                        />
                    </div>

                    {/* SECTION 1: GLOBAL TREND */}
                    <div className="card">
                        <h2 className="text-xl font-bold mb-6 text-slate-900 flex items-center gap-2">
                            <BarChart2 className="text-blue-600" /> Tendencia Global del Parent
                        </h2>
                        <div className="h-72 w-full">
                            <ResponsiveContainer width="100%" height="100%">
                                <AreaChart data={marketData.trends}>
                                    <defs>
                                        <linearGradient id="colorUs" x1="0" y1="0" x2="0" y2="1">
                                            <stop offset="5%" stopColor={colors.primary} stopOpacity={0.8}/>
                                            <stop offset="95%" stopColor={colors.primary} stopOpacity={0}/>
                                        </linearGradient>
                                        <linearGradient id="colorComp" x1="0" y1="0" x2="0" y2="1">
                                            <stop offset="5%" stopColor={colors.secondary} stopOpacity={0.8}/>
                                            <stop offset="95%" stopColor={colors.secondary} stopOpacity={0}/>
                                        </linearGradient>
                                    </defs>
                                    <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
                                    <XAxis dataKey="week" axisLine={false} tickLine={false} />
                                    <YAxis axisLine={false} tickLine={false} />
                                    <Tooltip contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }} />
                                    <Legend />
                                    <Area type="monotone" dataKey="us_clicks" name="Nuestros Clicks" stroke={colors.primary} fillOpacity={1} fill="url(#colorUs)" />
                                    <Area type="monotone" dataKey="comp_clicks" name="Competencia Clicks" stroke={colors.secondary} fillOpacity={1} fill="url(#colorComp)" />
                                </AreaChart>
                            </ResponsiveContainer>
                        </div>
                        <p className="mt-4 text-sm text-slate-600 italic border-l-4 border-blue-500 pl-3">
                            {marketData.insights.trend_text}
                        </p>
                    </div>

                    {/* SECTION 2: BRAND COMPETITIVENESS */}
                    <div className="card">
                        <h2 className="text-xl font-bold mb-6 text-slate-900 flex items-center gap-2">
                            <ShieldCheck className="text-blue-600" /> Competitividad de Marca (Click Share %)
                        </h2>
                        <div className="h-72 w-full">
                            <ResponsiveContainer width="100%" height="100%">
                                <LineChart data={marketData.brand_competitiveness}>
                                    <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" />
                                    <XAxis dataKey="week" axisLine={false} tickLine={false} />
                                    <YAxis axisLine={false} tickLine={false} />
                                    <Tooltip contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }} />
                                    <Legend />
                                    <Line type="monotone" dataKey={marketData.meta.our_brand} stroke={colors.primary} strokeWidth={3} dot={{r: 4}} />
                                    <Line type="monotone" dataKey={marketData.meta.top_competitors[0]} stroke={colors.comp1} strokeWidth={2} />
                                    <Line type="monotone" dataKey={marketData.meta.top_competitors[1]} stroke={colors.comp2} strokeWidth={2} />
                                    <Line type="monotone" dataKey={marketData.meta.top_competitors[2]} stroke={colors.comp3} strokeWidth={2} />
                                    <Line type="monotone" dataKey="Rest of Market" stroke={colors.rest} strokeDasharray="5 5" />
                                </LineChart>
                            </ResponsiveContainer>
                        </div>
                        <p className="mt-4 text-sm text-slate-600 italic border-l-4 border-blue-500 pl-3">
                            {marketData.insights.brand_text}
                        </p>
                    </div>

                    {/* SECTION 3 & 4: LEVERS AND EFFICIENCY */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div className="card">
                            <h2 className="text-xl font-bold mb-4 text-slate-900 flex items-center gap-2">
                                <Zap className="text-blue-600" /> Palancas de Click Share
                            </h2>
                            <ul className="space-y-4 text-sm text-slate-700">
                                <li className="flex items-start gap-2">
                                    <span className="bg-blue-100 p-1 rounded text-blue-600"><Percent size={16}/></span>
                                    <span><strong>Precio:</strong> {marketData.insights.levers_text} (Correlación negativa implica que bajar precio aumenta share).</span>
                                </li>
                                <li className="flex items-start gap-2">
                                    <span className="bg-yellow-100 p-1 rounded text-yellow-600"><Award size={16}/></span>
                                    <span><strong>Badges:</strong> ASINs con Best Seller (como el nuestro) mantienen alta eficiencia.</span>
                                </li>
                                <li className="flex items-start gap-2">
                                    <span className="bg-green-100 p-1 rounded text-green-600"><ShoppingCart size={16}/></span>
                                    <span><strong>Promociones:</strong> Deals puntuales no mostraron actividad significativa esta semana en el parent.</span>
                                </li>
                            </ul>
                        </div>

                        <div className="card">
                            <h2 className="text-xl font-bold mb-4 text-slate-900 flex items-center gap-2">
                                <Search className="text-blue-600" /> Eficiencia (Rank vs Share)
                            </h2>
                            <div className="h-48 w-full">
                                <ResponsiveContainer width="100%" height="100%">
                                    <ScatterChart margin={{ top: 20, right: 20, bottom: 20, left: 20 }}>
                                        <CartesianGrid />
                                        <XAxis type="number" dataKey="x" name="Organic Rank" reversed={true} allowDecimals={false} label={{ value: 'Posición (Inv)', position: 'insideBottom', offset: -10 }} />
                                        <YAxis type="number" dataKey="y" name="Click Share" unit="%" />
                                        <Tooltip cursor={{ strokeDasharray: '3 3' }} content={({ active, payload }) => {
                                            if (active && payload && payload.length) {
                                                const data = payload[0].payload;
                                                return (
                                                    <div className="bg-white p-3 border border-slate-100 shadow-lg rounded-lg text-xs">
                                                        <p className="font-bold">{data.name}</p>
                                                        <p>Rank: {data.x}</p>
                                                        <p>Share: {data.y}%</p>
                                                        <p className="text-slate-400 mt-1">{data.isUs ? 'Nuestro ASIN' : 'Competidor'}</p>
                                                    </div>
                                                );
                                            }
                                            return null;
                                        }} />
                                        <Scatter name="ASINs" data={bubbleData} fill="#8884d8">
                                            {bubbleData.map((entry, index) => (
                                                <cell key={`cell-${index}`} fill={entry.fill} />
                                            ))}
                                        </Scatter>
                                    </ScatterChart>
                                </ResponsiveContainer>
                            </div>
                            <p className="text-xs text-slate-500 mt-2 text-center">Eje X: Ranking (Invertido) | Eje Y: Click Share | Azul: Nosotros</p>
                        </div>
                    </div>

                    {/* SECTION 5: CONCLUSIONS */}
                    <div className="card bg-slate-900 text-white border-none">
                        <h2 className="text-xl font-bold mb-6 text-white flex items-center gap-2">
                            <AlertCircle className="text-blue-400" /> Insights & Recomendaciones
                        </h2>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <h3 className="text-blue-400 font-bold mb-3 uppercase text-xs tracking-wider">Conclusiones Clave</h3>
                                <ul className="space-y-3 text-sm text-slate-300">
                                    <li className="flex gap-2"><ArrowRight size={16} className="text-blue-500 mt-0.5 shrink-0"/> La tendencia global de clicks ha caído, sugiriendo una contracción estacional o de demanda en la categoría.</li>
                                    <li className="flex gap-2"><ArrowRight size={16} className="text-blue-500 mt-0.5 shrink-0"/> Nuestra marca mantiene el liderazgo en Share, resistente ante la caída de tráfico.</li>
                                    <li className="flex gap-2"><ArrowRight size={16} className="text-blue-500 mt-0.5 shrink-0"/> "by Amazon" es el competidor más peligroso por su alta eficiencia orgánica.</li>
                                    <li className="flex gap-2"><ArrowRight size={16} className="text-blue-500 mt-0.5 shrink-0"/> El precio es una palanca sensible; nuestros ASINs con precio premium sufren más en ranking.</li>
                                    <li className="flex gap-2"><ArrowRight size={16} className="text-blue-500 mt-0.5 shrink-0"/> ASIN B01M0LGD6A es nuestro 'Hero Product' con máxima eficiencia.</li>
                                </ul>
                            </div>
                            <div>
                                <h3 className="text-green-400 font-bold mb-3 uppercase text-xs tracking-wider">Acciones Recomendadas</h3>
                                <ul className="space-y-3 text-sm text-slate-300">
                                    <li className="flex gap-2"><span className="text-green-500 font-bold">1.</span> Defender posición del Hero ASIN (B01M0LGD6A) ante la agresión de Amazon Brand.</li>
                                    <li className="flex gap-2"><span className="text-green-500 font-bold">2.</span> Evaluar elasticidad de precio en variantes de 500ml/1L para recuperar volumen de clicks.</li>
                                    <li className="flex gap-2"><span className="text-green-500 font-bold">3.</span> Activar cupones agresivos (5-10%) en semanas de baja demanda para capturar tráfico indeciso.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = React.useState('static');

            return (
                <div className="max-w-6xl mx-auto p-4 md:p-8">
                    {/* Header */}
                    <div className="mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4">
                        <div>
                            <h1 className="text-3xl font-bold text-slate-900 tracking-tight">Parent Analysis: {marketData.meta.parent_asin}</h1>
                            <p className="text-slate-500">Reporte de Inteligencia de Mercado | Última actualización: {marketData.meta.last_week}</p>
                        </div>
                        <div className="flex bg-white p-1 rounded-xl border border-slate-200 shadow-sm">
                            <button 
                                onClick={() => setActiveTab('static')}
                                className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${activeTab === 'static' ? 'bg-blue-600 text-white shadow-sm' : 'text-slate-600 hover:bg-slate-50'}`}
                            >
                                Reporte Estático
                            </button>
                            <button 
                                onClick={() => setActiveTab('interactive')}
                                className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${activeTab === 'interactive' ? 'bg-blue-600 text-white shadow-sm' : 'text-slate-600 hover:bg-slate-50'}`}
                            >
                                Comparador Interactivo
                            </button>
                        </div>
                    </div>

                    {/* Content */}
                    <div className="min-h-[600px]">
                        {activeTab === 'static' ? <StaticReport /> : <InteractiveReport /> }
                    </div>
                    
                    <footer className="mt-12 text-center text-xs text-slate-400 py-4 border-t border-slate-200">
                        Generated by AI Market Intelligence Specialist. Data confidential.
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    
    <script>
        // Start Lucide Icons on load just in case, though React handles it mostly
        lucide.createIcons();
    </script>
</body>
</html>