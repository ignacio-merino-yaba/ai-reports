<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Inteligencia de Mercado - Parent ASIN</title>
    
    <!-- Google Charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #0071e3; /* Apple/Tech Blue */
            --secondary: #86868b;
            --success: #34c759;
            --danger: #ff3b30;
            --warning: #ffcc00;
            --bg: #f5f5f7;
            --card-bg: #ffffff;
            --border: #d2d2d7;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --radius: 20px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: #1d1d1f;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Header */
        header {
            margin-bottom: 40px;
        }
        h1 {
            font-size: 32px;
            font-weight: 700;
            margin: 0;
        }
        .subtitle {
            color: var(--secondary);
            font-size: 16px;
            margin-top: 8px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: rgba(118, 118, 128, 0.12);
            padding: 4px;
            border-radius: 12px;
            width: fit-content;
            margin-bottom: 30px;
        }
        .tab-btn {
            padding: 8px 20px;
            border: none;
            background: transparent;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            color: #1d1d1f;
        }
        .tab-btn.active {
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Cards & Grid */
        .grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 24px;
        }
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }
        .card-full { grid-column: span 12; }
        .card-half { grid-column: span 6; }
        .card-third { grid-column: span 4; }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .card-title {
            font-size: 18px;
            font-weight: 600;
        }

        /* Metrics */
        .metric-big {
            font-size: 36px;
            font-weight: 700;
        }
        .metric-label {
            color: var(--secondary);
            font-size: 14px;
            font-weight: 500;
        }
        .trend-up { color: var(--success); font-size: 14px; font-weight: 600; display: flex; align-items: center; }
        .trend-down { color: var(--danger); font-size: 14px; font-weight: 600; display: flex; align-items: center; }

        /* Tables */
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: var(--secondary); font-weight: 500; font-size: 12px; padding-bottom: 12px; border-bottom: 1px solid var(--border); }
        td { padding: 12px 0; font-size: 14px; border-bottom: 1px solid #eee; }
        
        /* Selectors */
        select {
            appearance: none;
            background-color: #f2f2f7;
            border: none;
            padding: 10px 30px 10px 14px;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            cursor: pointer;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%230071e3%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 10px top 50%;
            background-size: 10px;
        }

        /* Insight Box */
        .insight-box {
            background: #fbfbfd;
            border-left: 4px solid var(--primary);
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 4px;
        }
        .insight-title { font-weight: 600; margin-bottom: 4px; display: flex; align-items: center; gap: 8px; }
        .insight-text { font-size: 14px; color: #444; line-height: 1.5; }

        /* Chart Containers */
        .chart-container {
            width: 100%;
            height: 300px;
        }
        
        /* Helpers */
        .hidden { display: none; }
        .flex-center { display: flex; align-items: center; justify-content: center; height: 100%; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
        .badge-blue { background: #e3f2fd; color: #1565c0; }
        .badge-green { background: #e8f5e9; color: #2e7d32; }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>An√°lisis de Mercado Parent ASIN</h1>
            <div class="subtitle" id="date-range">Cargando fechas...</div>
        </header>

        <!-- Navigation -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('report')">Reporte Estrat√©gico</button>
            <button class="tab-btn" onclick="switchTab('compare')">Comparador Interactivo</button>
        </div>

        <!-- ==================== TAB 1: REPORT ==================== -->
        <div id="tab-report" class="tab-content">
            
            <!-- Section 1: Global Trend -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">1. Tendencia Global del Parent</span>
                    <div class="badge badge-blue">√öltimas 5 Semanas</div>
                </div>
                <div class="grid">
                    <div class="card-third">
                        <div class="metric-label">Total Clicks (√öltima Semana)</div>
                        <div class="metric-big" id="metric-total-clicks">-</div>
                        <div id="metric-clicks-trend" class="trend-up">-</div>
                        <br>
                        <div class="metric-label">Cuota de Mercado Total</div>
                        <div class="metric-big" id="metric-total-share">-</div>
                        <div id="metric-share-trend" class="trend-down">-</div>
                    </div>
                    <div class="card-full" style="grid-column: span 8;">
                        <div id="chart_global_trend" class="chart-container"></div>
                    </div>
                </div>
                <div class="insight-box" style="margin-top: 20px;">
                    <div class="insight-title"><i class="material-icons">lightbulb</i>An√°lisis de Tendencia</div>
                    <div class="insight-text" id="text-global-trend">Analizando datos...</div>
                </div>
            </div>

            <!-- Section 2: Competitiveness -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">2. Competitividad de Marca (Share of Voice)</span>
                </div>
                <div id="chart_competitiveness" class="chart-container" style="height: 350px;"></div>
                <p style="font-size: 12px; color: #888; text-align: center; margin-top: 10px;">Comparativa de Click Share semanal: Nuestra Marca vs Top 3 Competidores vs Resto</p>
            </div>

            <div class="grid">
                <!-- Section 3: Levers -->
                <div class="card card-half">
                    <div class="card-header">
                        <span class="card-title">3. üöÄ Impacto de Palancas (Promociones)</span>
                    </div>
                    <div id="chart_levers" class="chart-container"></div>
                </div>

                <!-- Section 4: Efficiency -->
                <div class="card card-half">
                    <div class="card-header">
                        <span class="card-title">4. üëÅÔ∏è Eficiencia: Rank Org√°nico vs Click Share</span>
                    </div>
                    <div id="chart_efficiency" class="chart-container"></div>
                </div>
            </div>

            <!-- Section 5: Insights & Recommendations -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">5. üí° Conclusiones y Recomendaciones</span>
                </div>
                <div class="grid">
                    <div class="card-half">
                        <h3 style="font-size: 16px; margin-bottom: 12px;">Insights Clave</h3>
                        <div id="insights-container"></div>
                    </div>
                    <div class="card-half" style="background: #f0fdf4; padding: 16px; border-radius: 12px;">
                        <h3 style="font-size: 16px; margin-bottom: 12px; color: #166534;">Recomendaciones Accionables</h3>
                        <ul id="recommendations-container" style="padding-left: 20px; color: #14532d; font-size: 14px; line-height: 1.6;"></ul>
                    </div>
                </div>
            </div>
            
            <!-- Section 6: Other Insights -->
            <div class="card">
                 <div class="card-header">
                    <span class="card-title">6. Otros Hallazgos</span>
                </div>
                <div class="insight-text" id="other-insights">
                    Analizando patrones de keywords long-tail y competidores emergentes...
                </div>
            </div>
        </div>

        <!-- ==================== TAB 2: COMPARATOR ==================== -->
        <div id="tab-compare" class="tab-content hidden">
            <div class="card" style="position: sticky; top: 20px; z-index: 100;">
                <div class="card-header" style="margin-bottom: 0;">
                    <span class="card-title">Comparador Cara a Cara</span>
                    <div style="display: flex; gap: 16px;">
                        <select id="select-week" onchange="updateComparator()"></select>
                        <select id="select-competitor" onchange="updateComparator()"></select>
                    </div>
                </div>
            </div>

            <div class="grid">
                <!-- Our Brand -->
                <div class="card card-half" style="border-top: 4px solid var(--primary);">
                    <div class="card-header">
                        <span class="card-title" id="comp-my-brand">Nuestra Marca</span>
                    </div>
                    <div class="grid" style="grid-template-columns: repeat(2, 1fr); gap: 12px;">
                        <div>
                            <div class="metric-label">Precio Promedio</div>
                            <div class="metric-big" id="my-price">-</div>
                        </div>
                        <div>
                            <div class="metric-label">Click Share</div>
                            <div class="metric-big" id="my-share">-</div>
                        </div>
                        <div>
                            <div class="metric-label">Rank Org√°nico</div>
                            <div class="metric-big" id="my-rank">-</div>
                        </div>
                        <div>
                            <div class="metric-label">D√≠as con Deal</div>
                            <div class="metric-big" id="my-deals">-</div>
                        </div>
                    </div>
                </div>

                <!-- Competitor -->
                <div class="card card-half" style="border-top: 4px solid var(--danger);">
                    <div class="card-header">
                        <span class="card-title" id="comp-their-brand">Competidor</span>
                    </div>
                    <div class="grid" style="grid-template-columns: repeat(2, 1fr); gap: 12px;">
                        <div>
                            <div class="metric-label">Precio Promedio</div>
                            <div class="metric-big" id="their-price">-</div>
                        </div>
                        <div>
                            <div class="metric-label">Click Share</div>
                            <div class="metric-big" id="their-share">-</div>
                        </div>
                        <div>
                            <div class="metric-label">Rank Org√°nico</div>
                            <div class="metric-big" id="their-rank">-</div>
                        </div>
                        <div>
                            <div class="metric-label">D√≠as con Deal</div>
                            <div class="metric-big" id="their-deals">-</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Tabla Detallada de Variantes (Semana Seleccionada)</span>
                </div>
                <div id="table_comparison_div"></div>
            </div>
        </div>

    </div>

    <script>
        // ================= DATOS INYECTADOS =================
        // Se inyecta el JSON generado por Python
        const marketData = [{"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-01", "week_date": "2023-10-01", "keywords": "test keyword", "competitor_brand": "MyBrand", "asin": "MyBrand_ASIN_1", "product_title": "MyBrand Product 1 Description", "country_code": "US", "average_organic_rank": 16, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 6.88, "impression_share": 8.26, "price": 40.85, "click_share_rank": 0, "weekly_search_volume": 4357, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/MyBrand_ASIN_1", "clicks": 299, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-01", "week_date": "2023-10-01", "keywords": "test keyword", "competitor_brand": "MyBrand", "asin": "MyBrand_ASIN_2", "product_title": "MyBrand Product 2 Description", "country_code": "US", "average_organic_rank": 8, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 20.35, "impression_share": 24.42, "price": 43.19, "click_share_rank": 0, "weekly_search_volume": 1289, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/MyBrand_ASIN_2", "clicks": 262, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-01", "week_date": "2023-10-01", "keywords": "test keyword", "competitor_brand": "CompA", "asin": "CompA_ASIN_1", "product_title": "CompA Product 1 Description", "country_code": "US", "average_organic_rank": 10, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 16.27, "impression_share": 19.53, "price": 27.24, "click_share_rank": 0, "weekly_search_volume": 1667, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompA_ASIN_1", "clicks": 271, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-01", "week_date": "2023-10-01", "keywords": "test keyword", "competitor_brand": "CompA", "asin": "CompA_ASIN_2", "product_title": "CompA Product 2 Description", "country_code": "US", "average_organic_rank": 15, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 8.71, "impression_share": 10.45, "price": 32.74, "click_share_rank": 0, "weekly_search_volume": 1969, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompA_ASIN_2", "clicks": 171, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-01", "week_date": "2023-10-01", "keywords": "test keyword", "competitor_brand": "CompB", "asin": "CompB_ASIN_1", "product_title": "CompB Product 1 Description", "country_code": "US", "average_organic_rank": 21, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 7, "click_share": 0.1, "impression_share": 0.12, "price": 46.22, "click_share_rank": 0, "weekly_search_volume": 3619, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompB_ASIN_1", "clicks": 3, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-01", "week_date": "2023-10-01", "keywords": "test keyword", "competitor_brand": "CompB", "asin": "CompB_ASIN_2", "product_title": "CompB Product 2 Description", "country_code": "US", "average_organic_rank": 29, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1, "impression_share": 0.12, "price": 43.14, "click_share_rank": 0, "weekly_search_volume": 4771, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompB_ASIN_2", "clicks": 4, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-01", "week_date": "2023-10-01", "keywords": "test keyword", "competitor_brand": "CompC", "asin": "CompC_ASIN_1", "product_title": "CompC Product 1 Description", "country_code": "US", "average_organic_rank": 47, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "click_share": 0.1, "impression_share": 0.12, "price": 44.25, "click_share_rank": 0, "weekly_search_volume": 3280, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompC_ASIN_1", "clicks": 3, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-01", "week_date": "2023-10-01", "keywords": "test keyword", "competitor_brand": "CompC", "asin": "CompC_ASIN_2", "product_title": "CompC Product 2 Description", "country_code": "US", "average_organic_rank": 24, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1, "impression_share": 0.12, "price": 31.83, "click_share_rank": 0, "weekly_search_volume": 4358, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompC_ASIN_2", "clicks": 4, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-01", "week_date": "2023-10-01", "keywords": "test keyword", "competitor_brand": "CompD", "asin": "CompD_ASIN_1", "product_title": "CompD Product 1 Description", "country_code": "US", "average_organic_rank": 40, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 7, "click_share": 0.1, "impression_share": 0.12, "price": 48.06, "click_share_rank": 0, "weekly_search_volume": 4279, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompD_ASIN_1", "clicks": 4, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-01", "week_date": "2023-10-01", "keywords": "test keyword", "competitor_brand": "CompD", "asin": "CompD_ASIN_2", "product_title": "CompD Product 2 Description", "country_code": "US", "average_organic_rank": 25, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 7, "click_share": 0.1, "impression_share": 0.12, "price": 31.13, "click_share_rank": 0, "weekly_search_volume": 2085, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompD_ASIN_2", "clicks": 2, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-08", "week_date": "2023-10-08", "keywords": "test keyword", "competitor_brand": "MyBrand", "asin": "MyBrand_ASIN_1", "product_title": "MyBrand Product 1 Description", "country_code": "US", "average_organic_rank": 10, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 16.48, "impression_share": 19.78, "price": 40.75, "click_share_rank": 0, "weekly_search_volume": 4914, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/MyBrand_ASIN_1", "clicks": 809, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-08", "week_date": "2023-10-08", "keywords": "test keyword", "competitor_brand": "MyBrand", "asin": "MyBrand_ASIN_2", "product_title": "MyBrand Product 2 Description", "country_code": "US", "average_organic_rank": 15, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "click_share": 9.17, "impression_share": 11.0, "price": 32.11, "click_share_rank": 0, "weekly_search_volume": 3538, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/MyBrand_ASIN_2", "clicks": 324, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-08", "week_date": "2023-10-08", "keywords": "test keyword", "competitor_brand": "CompA", "asin": "CompA_ASIN_1", "product_title": "CompA Product 1 Description", "country_code": "US", "average_organic_rank": 15, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 9.29, "impression_share": 11.15, "price": 27.67, "click_share_rank": 0, "weekly_search_volume": 1475, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompA_ASIN_1", "clicks": 137, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-08", "week_date": "2023-10-08", "keywords": "test keyword", "competitor_brand": "CompA", "asin": "CompA_ASIN_2", "product_title": "CompA Product 2 Description", "country_code": "US", "average_organic_rank": 12, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 9.68, "impression_share": 11.62, "price": 35.79, "click_share_rank": 0, "weekly_search_volume": 2038, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompA_ASIN_2", "clicks": 197, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-08", "week_date": "2023-10-08", "keywords": "test keyword", "competitor_brand": "CompB", "asin": "CompB_ASIN_1", "product_title": "CompB Product 1 Description", "country_code": "US", "average_organic_rank": 49, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1, "impression_share": 0.12, "price": 31.81, "click_share_rank": 0, "weekly_search_volume": 3617, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompB_ASIN_1", "clicks": 3, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-08", "week_date": "2023-10-08", "keywords": "test keyword", "competitor_brand": "CompB", "asin": "CompB_ASIN_2", "product_title": "CompB Product 2 Description", "country_code": "US", "average_organic_rank": 26, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "click_share": 0.1, "impression_share": 0.12, "price": 27.67, "click_share_rank": 0, "weekly_search_volume": 2187, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompB_ASIN_2", "clicks": 2, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-08", "week_date": "2023-10-08", "keywords": "test keyword", "competitor_brand": "CompC", "asin": "CompC_ASIN_1", "product_title": "CompC Product 1 Description", "country_code": "US", "average_organic_rank": 40, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1, "impression_share": 0.12, "price": 31.06, "click_share_rank": 0, "weekly_search_volume": 2862, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompC_ASIN_1", "clicks": 2, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-08", "week_date": "2023-10-08", "keywords": "test keyword", "competitor_brand": "CompC", "asin": "CompC_ASIN_2", "product_title": "CompC Product 2 Description", "country_code": "US", "average_organic_rank": 24, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "click_share": 0.1, "impression_share": 0.12, "price": 24.34, "click_share_rank": 0, "weekly_search_volume": 2577, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompC_ASIN_2", "clicks": 2, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-08", "week_date": "2023-10-08", "keywords": "test keyword", "competitor_brand": "CompD", "asin": "CompD_ASIN_1", "product_title": "CompD Product 1 Description", "country_code": "US", "average_organic_rank": 14, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 10.39, "impression_share": 12.47, "price": 31.09, "click_share_rank": 0, "weekly_search_volume": 4492, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompD_ASIN_1", "clicks": 466, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-08", "week_date": "2023-10-08", "keywords": "test keyword", "competitor_brand": "CompD", "asin": "CompD_ASIN_2", "product_title": "CompD Product 2 Description", "country_code": "US", "average_organic_rank": 21, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "click_share": 0.1, "impression_share": 0.12, "price": 37.13, "click_share_rank": 0, "weekly_search_volume": 4272, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompD_ASIN_2", "clicks": 4, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-15", "week_date": "2023-10-15", "keywords": "test keyword", "competitor_brand": "MyBrand", "asin": "MyBrand_ASIN_1", "product_title": "MyBrand Product 1 Description", "country_code": "US", "average_organic_rank": 10, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 13.91, "impression_share": 16.69, "price": 40.08, "click_share_rank": 0, "weekly_search_volume": 3280, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/MyBrand_ASIN_1", "clicks": 456, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-15", "week_date": "2023-10-15", "keywords": "test keyword", "competitor_brand": "MyBrand", "asin": "MyBrand_ASIN_2", "product_title": "MyBrand Product 2 Description", "country_code": "US", "average_organic_rank": 16, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "click_share": 5.4, "impression_share": 6.48, "price": 49.33, "click_share_rank": 0, "weekly_search_volume": 2085, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/MyBrand_ASIN_2", "clicks": 112, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-15", "week_date": "2023-10-15", "keywords": "test keyword", "competitor_brand": "CompA", "asin": "CompA_ASIN_1", "product_title": "CompA Product 1 Description", "country_code": "US", "average_organic_rank": 19, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 1.76, "impression_share": 2.11, "price": 31.97, "click_share_rank": 0, "weekly_search_volume": 3171, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompA_ASIN_1", "clicks": 55, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-15", "week_date": "2023-10-15", "keywords": "test keyword", "competitor_brand": "CompA", "asin": "CompA_ASIN_2", "product_title": "CompA Product 2 Description", "country_code": "US", "average_organic_rank": 16, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 5.14, "impression_share": 6.17, "price": 37.58, "click_share_rank": 0, "weekly_search_volume": 4769, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompA_ASIN_2", "clicks": 245, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-15", "week_date": "2023-10-15", "keywords": "test keyword", "competitor_brand": "CompB", "asin": "CompB_ASIN_1", "product_title": "CompB Product 1 Description", "country_code": "US", "average_organic_rank": 17, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 7.42, "impression_share": 8.91, "price": 27.53, "click_share_rank": 0, "weekly_search_volume": 4817, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompB_ASIN_1", "clicks": 357, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-15", "week_date": "2023-10-15", "keywords": "test keyword", "competitor_brand": "CompB", "asin": "CompB_ASIN_2", "product_title": "CompB Product 2 Description", "country_code": "US", "average_organic_rank": 20, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 7, "click_share": 0.1, "impression_share": 0.12, "price": 32.7, "click_share_rank": 0, "weekly_search_volume": 4843, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompB_ASIN_2", "clicks": 4, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-15", "week_date": "2023-10-15", "keywords": "test keyword", "competitor_brand": "CompC", "asin": "CompC_ASIN_1", "product_title": "CompC Product 1 Description", "country_code": "US", "average_organic_rank": 33, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "click_share": 0.1, "impression_share": 0.12, "price": 32.07, "click_share_rank": 0, "weekly_search_volume": 4700, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompC_ASIN_1", "clicks": 4, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-15", "week_date": "2023-10-15", "keywords": "test keyword", "competitor_brand": "CompC", "asin": "CompC_ASIN_2", "product_title": "CompC Product 2 Description", "country_code": "US", "average_organic_rank": 14, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 8.52, "impression_share": 10.22, "price": 31.95, "click_share_rank": 0, "weekly_search_volume": 2866, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompC_ASIN_2", "clicks": 244, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-15", "week_date": "2023-10-15", "keywords": "test keyword", "competitor_brand": "CompD", "asin": "CompD_ASIN_1", "product_title": "CompD Product 1 Description", "country_code": "US", "average_organic_rank": 26, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1, "impression_share": 0.12, "price": 40.73, "click_share_rank": 0, "weekly_search_volume": 1269, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompD_ASIN_1", "clicks": 1, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-15", "week_date": "2023-10-15", "keywords": "test keyword", "competitor_brand": "CompD", "asin": "CompD_ASIN_2", "product_title": "CompD Product 2 Description", "country_code": "US", "average_organic_rank": 40, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1, "impression_share": 0.12, "price": 43.12, "click_share_rank": 0, "weekly_search_volume": 4381, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompD_ASIN_2", "clicks": 4, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-22", "week_date": "2023-10-22", "keywords": "test keyword", "competitor_brand": "MyBrand", "asin": "MyBrand_ASIN_1", "product_title": "MyBrand Product 1 Description", "country_code": "US", "average_organic_rank": 20, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "click_share": 1.76, "impression_share": 2.11, "price": 42.14, "click_share_rank": 0, "weekly_search_volume": 2058, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/MyBrand_ASIN_1", "clicks": 36, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-22", "week_date": "2023-10-22", "keywords": "test keyword", "competitor_brand": "MyBrand", "asin": "MyBrand_ASIN_2", "product_title": "MyBrand Product 2 Description", "country_code": "US", "average_organic_rank": 10, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 14.88, "impression_share": 17.86, "price": 31.95, "click_share_rank": 0, "weekly_search_volume": 1243, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/MyBrand_ASIN_2", "clicks": 184, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-22", "week_date": "2023-10-22", "keywords": "test keyword", "competitor_brand": "CompA", "asin": "CompA_ASIN_1", "product_title": "CompA Product 1 Description", "country_code": "US", "average_organic_rank": 3, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 7, "click_share": 25.13, "impression_share": 30.15, "price": 44.25, "click_share_rank": 0, "weekly_search_volume": 2360, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompA_ASIN_1", "clicks": 593, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-22", "week_date": "2023-10-22", "keywords": "test keyword", "competitor_brand": "CompA", "asin": "CompA_ASIN_2", "product_title": "CompA Product 2 Description", "country_code": "US", "average_organic_rank": 16, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 8.01, "impression_share": 9.61, "price": 43.12, "click_share_rank": 0, "weekly_search_volume": 3317, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompA_ASIN_2", "clicks": 265, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-22", "week_date": "2023-10-22", "keywords": "test keyword", "competitor_brand": "CompB", "asin": "CompB_ASIN_1", "product_title": "CompB Product 1 Description", "country_code": "US", "average_organic_rank": 26, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "click_share": 0.1, "impression_share": 0.12, "price": 40.89, "click_share_rank": 0, "weekly_search_volume": 2732, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompB_ASIN_1", "clicks": 2, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-22", "week_date": "2023-10-22", "keywords": "test keyword", "competitor_brand": "CompB", "asin": "CompB_ASIN_2", "product_title": "CompB Product 2 Description", "country_code": "US", "average_organic_rank": 15, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 8.24, "impression_share": 9.89, "price": 48.33, "click_share_rank": 0, "weekly_search_volume": 1261, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompB_ASIN_2", "clicks": 103, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-22", "week_date": "2023-10-22", "keywords": "test keyword", "competitor_brand": "CompC", "asin": "CompC_ASIN_1", "product_title": "CompC Product 1 Description", "country_code": "US", "average_organic_rank": 20, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 3.24, "impression_share": 3.89, "price": 31.96, "click_share_rank": 0, "weekly_search_volume": 1699, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompC_ASIN_1", "clicks": 55, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-22", "week_date": "2023-10-22", "keywords": "test keyword", "competitor_brand": "CompC", "asin": "CompC_ASIN_2", "product_title": "CompC Product 2 Description", "country_code": "US", "average_organic_rank": 47, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "click_share": 0.1, "impression_share": 0.12, "price": 30.64, "click_share_rank": 0, "weekly_search_volume": 2085, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompC_ASIN_2", "clicks": 2, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-22", "week_date": "2023-10-22", "keywords": "test keyword", "competitor_brand": "CompD", "asin": "CompD_ASIN_1", "product_title": "CompD Product 1 Description", "country_code": "US", "average_organic_rank": 33, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1, "impression_share": 0.12, "price": 40.09, "click_share_rank": 0, "weekly_search_volume": 1414, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompD_ASIN_1", "clicks": 1, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-22", "week_date": "2023-10-22", "keywords": "test keyword", "competitor_brand": "CompD", "asin": "CompD_ASIN_2", "product_title": "CompD Product 2 Description", "country_code": "US", "average_organic_rank": 26, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "click_share": 0.1, "impression_share": 0.12, "price": 28.52, "click_share_rank": 0, "weekly_search_volume": 1032, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompD_ASIN_2", "clicks": 1, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-29", "week_date": "2023-10-29", "keywords": "test keyword", "competitor_brand": "MyBrand", "asin": "MyBrand_ASIN_1", "product_title": "MyBrand Product 1 Description", "country_code": "US", "average_organic_rank": 15, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 7.55, "impression_share": 9.06, "price": 31.97, "click_share_rank": 0, "weekly_search_volume": 3254, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/MyBrand_ASIN_1", "clicks": 245, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-29", "week_date": "2023-10-29", "keywords": "test keyword", "competitor_brand": "MyBrand", "asin": "MyBrand_ASIN_2", "product_title": "MyBrand Product 2 Description", "country_code": "US", "average_organic_rank": 20, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 3.86, "impression_share": 4.63, "price": 26.6, "click_share_rank": 0, "weekly_search_volume": 4906, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/MyBrand_ASIN_2", "clicks": 189, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-29", "week_date": "2023-10-29", "keywords": "test keyword", "competitor_brand": "CompA", "asin": "CompA_ASIN_1", "product_title": "CompA Product 1 Description", "country_code": "US", "average_organic_rank": 19, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.35, "impression_share": 0.42, "price": 40.23, "click_share_rank": 0, "weekly_search_volume": 1228, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompA_ASIN_1", "clicks": 4, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-29", "week_date": "2023-10-29", "keywords": "test keyword", "competitor_brand": "CompA", "asin": "CompA_ASIN_2", "product_title": "CompA Product 2 Description", "country_code": "US", "average_organic_rank": 11, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 14.8, "impression_share": 17.76, "price": 27.27, "click_share_rank": 0, "weekly_search_volume": 4272, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompA_ASIN_2", "clicks": 632, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-29", "week_date": "2023-10-29", "keywords": "test keyword", "competitor_brand": "CompB", "asin": "CompB_ASIN_1", "product_title": "CompB Product 1 Description", "country_code": "US", "average_organic_rank": 26, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1, "impression_share": 0.12, "price": 31.95, "click_share_rank": 0, "weekly_search_volume": 3280, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompB_ASIN_1", "clicks": 3, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-29", "week_date": "2023-10-29", "keywords": "test keyword", "competitor_brand": "CompB", "asin": "CompB_ASIN_2", "product_title": "CompB Product 2 Description", "country_code": "US", "average_organic_rank": 19, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 2.22, "impression_share": 2.66, "price": 27.94, "click_share_rank": 0, "weekly_search_volume": 1279, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompB_ASIN_2", "clicks": 28, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-29", "week_date": "2023-10-29", "keywords": "test keyword", "competitor_brand": "CompC", "asin": "CompC_ASIN_1", "product_title": "CompC Product 1 Description", "country_code": "US", "average_organic_rank": 39, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1, "impression_share": 0.12, "price": 40.59, "click_share_rank": 0, "weekly_search_volume": 4153, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompC_ASIN_1", "clicks": 4, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-29", "week_date": "2023-10-29", "keywords": "test keyword", "competitor_brand": "CompC", "asin": "CompC_ASIN_2", "product_title": "CompC Product 2 Description", "country_code": "US", "average_organic_rank": 16, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 4.54, "impression_share": 5.45, "price": 42.14, "click_share_rank": 0, "weekly_search_volume": 3574, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompC_ASIN_2", "clicks": 162, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-29", "week_date": "2023-10-29", "keywords": "test keyword", "competitor_brand": "CompD", "asin": "CompD_ASIN_1", "product_title": "CompD Product 1 Description", "country_code": "US", "average_organic_rank": 32, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1, "impression_share": 0.12, "price": 23.3, "click_share_rank": 0, "weekly_search_volume": 2026, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompD_ASIN_1", "clicks": 2, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}, {"brand_aggregation": "TestCategory", "parent_asin": "PARENT_123", "reporting_date": "2023-10-29", "week_date": "2023-10-29", "keywords": "test keyword", "competitor_brand": "CompD", "asin": "CompD_ASIN_2", "product_title": "CompD Product 2 Description", "country_code": "US", "average_organic_rank": 48, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1, "impression_share": 0.12, "price": 28.61, "click_share_rank": 0, "weekly_search_volume": 3811, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/CompD_ASIN_2", "clicks": 3, "grams": 500, "organic_or_not": "Organic", "container": "Bottle"}];

        // ================= CONFIG & HELPERS =================
        google.charts.load('current', {'packages':['corechart', 'table']});
        google.charts.setOnLoadCallback(initReport);

        function getBrand(row) {
            if (row.competitor_brand) return row.competitor_brand;
            // Fallback logic
            if (row.product_title) {
                const words = row.product_title.split(' ');
                return words[0] || "Unknown Brand";
            }
            return "Unknown Brand";
        }

        // Identify OUR BRAND
        const ourBrandRows = marketData.filter(r => r.is_yaba_asin === 'Y');
        const MY_BRAND = ourBrandRows.length > 0 ? getBrand(ourBrandRows[0]) : "Our Brand";

        // Get Weeks
        const weeks = [...new Set(marketData.map(r => r.week_date))].sort();
        const latestWeek = weeks[weeks.length - 1];
        
        // Identify Competitors (Top 3 by Volume)
        const brandVols = {};
        marketData.forEach(r => {
            const b = getBrand(r);
            if (b === MY_BRAND) return;
            const clicks = r.clicks || (r.weekly_search_volume * r.click_share / 100);
            brandVols[b] = (brandVols[b] || 0) + clicks;
        });
        const topCompetitors = Object.entries(brandVols)
            .sort((a,b) => b[1] - a[1])
            .slice(0,3)
            .map(e => e[0]);

        // ================= INIT =================
        function initReport() {
            document.getElementById('date-range').innerText = `Periodo: ${weeks[0]} - ${latestWeek}`;
            renderGlobalTrend();
            renderCompetitiveness();
            renderLevers();
            renderEfficiency();
            generateInsights();
            initComparator();
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.remove('hidden');
            document.querySelector(`button[onclick="switchTab('${tabId}')"]`).classList.add('active');
            if (tabId === 'compare') {
                updateComparator(); // Force redraw table
            }
        }

        // ================= SECTION 1: TREND =================
        function renderGlobalTrend() {
            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Semana');
            dataTable.addColumn('number', 'Clicks Totales');
            dataTable.addColumn('number', 'Nuestro Share (%)');
            dataTable.addColumn('number', 'Share Competencia (%)');

            let trendData = [];

            weeks.forEach(w => {
                const weekRows = marketData.filter(r => r.week_date === w);
                
                let totalClicks = 0;
                let myClicks = 0;
                let compClicks = 0;

                weekRows.forEach(r => {
                    // Calculamos clicks si no existen, o usamos el dato
                    const c = r.clicks || (r.weekly_search_volume * r.click_share / 100);
                    totalClicks += c;
                    if (r.is_yaba_asin === 'Y') myClicks += c;
                    else compClicks += c;
                });

                const myShare = totalClicks > 0 ? (myClicks / totalClicks) * 100 : 0;
                const compShare = totalClicks > 0 ? (compClicks / totalClicks) * 100 : 0;

                trendData.push([w, Math.round(totalClicks), myShare, compShare]);
            });

            dataTable.addRows(trendData);

            // Calculate Metrics for KPI Cards
            const lastW = trendData[trendData.length - 1];
            const prevW = trendData.length > 1 ? trendData[trendData.length - 2] : lastW;

            const clickDiff = ((lastW[1] - prevW[1]) / prevW[1]) * 100;
            const shareDiff = lastW[2] - prevW[2]; // absolute diff points

            document.getElementById('metric-total-clicks').innerText = lastW[1].toLocaleString();
            document.getElementById('metric-total-share').innerText = lastW[2].toFixed(1) + '%';
            
            setTrend('metric-clicks-trend', clickDiff, '%');
            setTrend('metric-share-trend', shareDiff, 'pp');

            // Text Gen
            const trendText = `La tendencia de clicks ${clickDiff >= 0 ? 'sube' : 'baja'} un ${Math.abs(clickDiff).toFixed(1)}% la √∫ltima semana. Nuestra marca ${shareDiff >= 0 ? 'gana' : 'pierde'} ${Math.abs(shareDiff).toFixed(1)} puntos porcentuales de visibilidad.`;
            document.getElementById('text-global-trend').innerText = trendText;

            const options = {
                seriesType: 'bars',
                series: { 
                    1: {type: 'line', targetAxisIndex: 1, color: '#0071e3', lineWidth: 3},
                    2: {type: 'line', targetAxisIndex: 1, color: '#ea4335', lineDashStyle: [4, 4]} 
                },
                vAxes: { 0: {title: 'Volumen Clicks'}, 1: {title: '% Share', format: '#\'%\''} },
                legend: { position: 'bottom' },
                colors: ['#e0e0e0'],
                chartArea: { width: '80%', height: '70%' },
                bar: { groupWidth: '40%' }
            };

            const chart = new google.visualization.ComboChart(document.getElementById('chart_global_trend'));
            chart.draw(dataTable, options);
        }

        // ================= SECTION 2: COMPETITIVENESS =================
        function renderCompetitiveness() {
            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Semana');
            dataTable.addColumn('number', MY_BRAND);
            topCompetitors.forEach(c => dataTable.addColumn('number', c));
            dataTable.addColumn('number', 'Resto');

            const rows = [];
            weeks.forEach(w => {
                const weekRows = marketData.filter(r => r.week_date === w);
                const totalVol = weekRows.reduce((sum, r) => sum + (r.clicks || (r.weekly_search_volume * r.click_share / 100)), 0);

                if (totalVol === 0) {
                    rows.push([w, 0, ...topCompetitors.map(()=>0), 0]);
                    return;
                }

                // Calc Share per brand
                const getShare = (brandName) => {
                    const brandClicks = weekRows
                        .filter(r => getBrand(r) === brandName)
                        .reduce((sum, r) => sum + (r.clicks || (r.weekly_search_volume * r.click_share / 100)), 0);
                    return (brandClicks / totalVol) * 100;
                };

                const myShare = getShare(MY_BRAND);
                const compShares = topCompetitors.map(c => getShare(c));
                const knownShare = myShare + compShares.reduce((a,b)=>a+b, 0);
                const restShare = Math.max(0, 100 - knownShare);

                rows.push([w, myShare, ...compShares, restShare]);
            });

            dataTable.addRows(rows);

            const options = {
                curveType: 'function',
                legend: { position: 'bottom' },
                colors: ['#0071e3', '#ea4335', '#fbbc04', '#34a853', '#9aa0a6'],
                vAxis: { title: 'Click Share (%)' },
                chartArea: { width: '85%', height: '70%' },
                lineWidth: 3
            };

            const chart = new google.visualization.LineChart(document.getElementById('chart_competitiveness'));
            chart.draw(dataTable, options);
        }

        // ================= SECTION 3: LEVERS =================
        function renderLevers() {
            // Compare Avg Click Share when Deal/Badge exists vs Not
            const leverData = [
                ['Palanca', 'Con Palanca', 'Sin Palanca']
            ];

            const calcLever = (filterFn) => {
                const withLever = marketData.filter(r => filterFn(r) && r.click_share > 0);
                const withoutLever = marketData.filter(r => !filterFn(r) && r.click_share > 0);
                
                const avgWith = withLever.length ? withLever.reduce((s, r)=>s+r.click_share,0)/withLever.length : 0;
                const avgWithout = withoutLever.length ? withoutLever.reduce((s, r)=>s+r.click_share,0)/withoutLever.length : 0;
                return [avgWith, avgWithout];
            };

            const dealStats = calcLever(r => r.weekly_number_of_days_with_deal > 0);
            const badgeStats = calcLever(r => r.weekly_number_of_days_with_best_seller_badge > 0 || r.weekly_number_of_days_with_amazon_choice_badge > 0);
            const couponStats = calcLever(r => r.weekly_number_of_days_with_coupon > 0);

            leverData.push(['Deals', dealStats[0], dealStats[1]]);
            leverData.push(['Badges', badgeStats[0], badgeStats[1]]);
            leverData.push(['Cupones', couponStats[0], couponStats[1]]);

            const data = google.visualization.arrayToDataTable(leverData);
            const options = {
                seriesType: 'bars',
                vAxis: { title: 'Avg Click Share (%)' },
                colors: ['#0071e3', '#e0e0e0'],
                legend: { position: 'top' }
            };

            const chart = new google.visualization.ColumnChart(document.getElementById('chart_levers'));
            chart.draw(data, options);
        }

        // ================= SECTION 4: EFFICIENCY =================
        function renderEfficiency() {
            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('number', 'Rank Org√°nico');
            dataTable.addColumn('number', 'Click Share');
            dataTable.addColumn({type: 'string', role: 'style'});
            dataTable.addColumn({type: 'string', role: 'tooltip'});

            // Filter latest week
            const currentData = marketData.filter(r => r.week_date === latestWeek);

            currentData.forEach(r => {
                const isMe = r.is_yaba_asin === 'Y';
                const color = isMe ? '#0071e3' : '#ea4335';
                const tooltip = `${getBrand(r)} (Rank: ${r.average_organic_rank}, Share: ${r.click_share}%)`;
                dataTable.addRow([r.average_organic_rank, r.click_share, `point { fill-color: ${color}; size: 6; }`, tooltip]);
            });

            const options = {
                hAxis: { title: 'Rank Org√°nico (Menor es mejor)', direction: -1 }, // Invertido
                vAxis: { title: 'Click Share (%)' },
                legend: 'none',
                chartArea: { width: '80%', height: '80%' }
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('chart_efficiency'));
            chart.draw(dataTable, options);
        }

        // ================= SECTION 5: INSIGHTS =================
        function generateInsights() {
            const insights = [];
            const recs = [];

            // 1. Trend Insight
            const wData = marketData.filter(r => r.week_date === latestWeek);
            const myShare = wData.filter(r => r.is_yaba_asin === 'Y').reduce((s,r)=>s+r.click_share,0);
            
            if (myShare < 10) insights.push("üî¥ Baja visibilidad general (<10% share) en la √∫ltima semana.");
            else if (myShare > 30) insights.push("üü¢ Dominio fuerte de la categor√≠a (>30% share).");
            
            // 2. Price Insight
            const myPrice = avg(wData.filter(r => r.is_yaba_asin === 'Y').map(r=>r.price));
            const marketPrice = avg(wData.filter(r => r.is_yaba_asin === 'N').map(r=>r.price));
            
            if (myPrice > marketPrice * 1.2) {
                insights.push(`üí∞ Tu precio ($${myPrice.toFixed(2)}) es un 20% superior al promedio del mercado ($${marketPrice.toFixed(2)}).`);
                recs.push("Considera aplicar un cup√≥n para reducir la barrera de entrada por precio alto.");
            } else {
                 insights.push(`üè∑Ô∏è Posicionamiento de precio competitivo ($${myPrice.toFixed(2)} vs $${marketPrice.toFixed(2)} mercado).`);
            }

            // 3. Efficiency
            const inefficient = wData.filter(r => r.is_yaba_asin === 'Y' && r.average_organic_rank < 10 && r.click_share < 5);
            if (inefficient.length > 0) {
                insights.push(`‚ö†Ô∏è ${inefficient.length} ASINs tienen buen ranking org√°nico (Top 10) pero bajo click share.`);
                recs.push("Revisa imagen principal y t√≠tulo de los ASINs Top Rank para mejorar CTR.");
            }

            // 4. Promo
            const myDeals = wData.filter(r => r.is_yaba_asin === 'Y' && r.weekly_number_of_days_with_deal > 0);
            if (myDeals.length === 0) {
                recs.push("Activa 'Deal Days' o descuentos flash para reactivar el tr√°fico esta semana.");
            }

            // Populate HTML
            const iContainer = document.getElementById('insights-container');
            const rContainer = document.getElementById('recommendations-container');
            
            // Fallbacks
            if (insights.length < 3) insights.push("Analiza competidores emergentes en el gr√°fico de eficiencia.");
            if (recs.length < 2) recs.push("Optimiza palabras clave en backend para ASINs con bajo tr√°fico.");

            iContainer.innerHTML = insights.map(i => `<div class="insight-box"><div class="insight-text">${i}</div></div>`).join('');
            rContainer.innerHTML = recs.map(r => `<li>${r}</li>`).join('');
        }

        // ================= TAB 2: COMPARATOR =================
        function initComparator() {
            // Populate Selectors
            const weekSel = document.getElementById('select-week');
            const compSel = document.getElementById('select-competitor');

            weeks.slice().reverse().forEach(w => {
                const opt = document.createElement('option');
                opt.value = w;
                opt.text = w;
                weekSel.add(opt);
            });

            topCompetitors.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.text = c;
                compSel.add(opt);
            });

            updateComparator();
        }

        function updateComparator() {
            const week = document.getElementById('select-week').value;
            const comp = document.getElementById('select-competitor').value;

            document.getElementById('comp-my-brand').innerText = MY_BRAND;
            document.getElementById('comp-their-brand').innerText = comp;

            const weekData = marketData.filter(r => r.week_date === week);
            const myData = weekData.filter(r => r.is_yaba_asin === 'Y');
            const compData = weekData.filter(r => getBrand(r) === comp);

            // Metrics Helper
            const calcM = (arr) => {
                if (!arr.length) return { price: 0, share: 0, rank: 0, deals: 0 };
                return {
                    price: avg(arr.map(r=>r.price)).toFixed(2),
                    share: arr.reduce((s,r)=>s+r.click_share,0).toFixed(1),
                    rank: avg(arr.map(r=>r.average_organic_rank)).toFixed(0),
                    deals: arr.reduce((s,r)=>s+r.weekly_number_of_days_with_deal,0)
                };
            };

            const mMe = calcM(myData);
            const mThem = calcM(compData);

            // Render Metrics
            document.getElementById('my-price').innerText = '$' + mMe.price;
            document.getElementById('my-share').innerText = mMe.share + '%';
            document.getElementById('my-rank').innerText = '#' + mMe.rank;
            document.getElementById('my-deals').innerText = mMe.deals;

            document.getElementById('their-price').innerText = '$' + mThem.price;
            document.getElementById('their-share').innerText = mThem.share + '%';
            document.getElementById('their-rank').innerText = '#' + mThem.rank;
            document.getElementById('their-deals').innerText = mThem.deals;

            // Render Table
            renderComparisonTable(myData, compData);
        }

        function renderComparisonTable(myData, compData) {
            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'ASIN');
            dataTable.addColumn('string', 'T√≠tulo');
            dataTable.addColumn('string', 'Marca');
            dataTable.addColumn('number', 'Precio');
            dataTable.addColumn('number', 'Share (%)');
            dataTable.addColumn('number', 'Rank');

            [...myData, ...compData].forEach(r => {
                dataTable.addRow([r.asin, r.product_title.substring(0, 40)+'...', getBrand(r), r.price, r.click_share, r.average_organic_rank]);
            });

            const table = new google.visualization.Table(document.getElementById('table_comparison_div'));
            table.draw(dataTable, {showRowNumber: true, width: '100%', height: '100%'});
        }

        // Utils
        function avg(arr) { return arr.length ? arr.reduce((a,b)=>a+b,0)/arr.length : 0; }
        
        function setTrend(id, val, suffix) {
            const el = document.getElementById(id);
            const icon = val >= 0 ? 'trending_up' : 'trending_down';
            const color = (id.includes('rank') ? val < 0 : val >= 0) ? 'var(--success)' : 'var(--danger)'; // Logic dependent on metric
            
            // Logic: More share/clicks = good (green). 
            const isPositive = val >= 0;
            
            el.innerHTML = `<i class="material-icons" style="font-size:16px; margin-right:4px;">${icon}</i> ${Math.abs(val).toFixed(1)}${suffix}`;
            el.style.color = isPositive ? 'var(--success)' : 'var(--danger)';
            el.className = isPositive ? 'trend-up' : 'trend-down';
        }

    </script>
</body>
</html>