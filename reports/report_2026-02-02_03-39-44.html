<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon ASIN Intelligence Report</title>
    
    <!-- Google Charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #4285F4; /* Google Blue */
            --success: #34A853; /* Google Green */
            --warning: #FBBC05; /* Google Yellow */
            --danger: #EA4335;  /* Google Red */
            --gray: #5f6368;
            --bg-light: #f8f9fa;
            --card-bg: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 16px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light);
            color: #202124;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
        }

        /* Layout & Typography */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        h1, h2, h3 {
            margin: 0;
            font-weight: 600;
        }

        h1 { font-size: 24px; margin-bottom: 8px; }
        h2 { font-size: 18px; margin-bottom: 16px; color: var(--gray); }
        h3 { font-size: 16px; margin-bottom: 12px; color: #202124; }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 24px;
            margin-bottom: 24px;
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        /* Grid System */
        .grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 24px;
        }
        .col-12 { grid-column: span 12; }
        .col-6 { grid-column: span 6; }
        .col-4 { grid-column: span 4; }
        .col-8 { grid-column: span 8; }

        @media (max-width: 768px) {
            .col-6, .col-4, .col-8 { grid-column: span 12; }
        }

        /* Metrics */
        .metric-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
        }
        .metric-label {
            font-size: 14px;
            color: var(--gray);
            margin-top: 4px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 12px;
        }
        .tab-btn {
            background: none;
            border: none;
            padding: 10px 20px;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            border-radius: 20px;
            color: var(--gray);
            transition: all 0.2s;
        }
        .tab-btn.active {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 2px 4px rgba(66, 133, 244, 0.3);
        }

        /* Insights List */
        .insight-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 16px;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 12px;
        }
        .insight-icon {
            color: var(--primary);
            background: #e8f0fe;
            padding: 8px;
            border-radius: 50%;
        }
        .insight-text { font-size: 14px; line-height: 1.5; }
        .rec-item { border-left: 4px solid var(--success); }

        /* Controls */
        select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #dadce0;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            outline: none;
        }

        /* Utility */
        .text-green { color: var(--success); }
        .text-red { color: var(--danger); }
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .badge-organic { background: #e6f4ea; color: var(--success); }
        
        #dashboard-view { display: block; }
        #comparator-view { display: none; }
        
        .chart-container { height: 350px; width: 100%; }
        .chart-container-sm { height: 250px; width: 100%; }

    </style>
</head>
<body>

<div class="container">
    <header style="margin-bottom: 32px;">
        <h1>ASIN Performance Intelligence</h1>
        <h2 id="report-subtitle">Analyzing Parent ASIN Market Context</h2>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('dashboard')">Reporte Estratégico</button>
            <button class="tab-btn" onclick="switchTab('comparator')">Comparador Interactivo</button>
        </div>
    </header>

    <!-- TAB 1: DASHBOARD -->
    <div id="dashboard-view">
        
        <!-- Section 1: Global Trend -->
        <div class="card">
            <h3>1. Tendencia Global del Parent (Tracción y Visibilidad)</h3>
            <div id="chart_global_trend" class="chart-container"></div>
            <div id="global_trend_insight" style="margin-top: 16px; font-size: 14px; color: var(--gray);"></div>
        </div>

        <div class="grid">
            <!-- Section 2: Competitiveness -->
            <div class="card col-8">
                <h3>2. Competitividad de Marca (Click Share sem)</h3>
                <div id="chart_brand_comp" class="chart-container"></div>
            </div>
            
            <!-- Key Metrics Summary -->
            <div class="card col-4">
                <h3>Última Semana</h3>
                <div style="margin-top: 20px;">
                    <div class="metric-label">Nuestra Cuota de Clics</div>
                    <div id="metric_our_share" class="metric-value">--%</div>
                </div>
                <div style="margin-top: 20px;">
                    <div class="metric-label">Posición Orgánica Promedio</div>
                    <div id="metric_organic_rank" class="metric-value">--</div>
                </div>
                <div style="margin-top: 20px;">
                    <div class="metric-label">Competidor Top</div>
                    <div id="metric_top_competitor" style="font-size: 18px; font-weight: 600; color: #202124;">--</div>
                </div>
            </div>
        </div>

        <!-- Section 3: Palancas (Levers) -->
        <div class="grid">
             <div class="card col-6">
                <h3>3. Impacto de Palancas (Deals & Badges)</h3>
                <p style="font-size:12px; color:var(--gray)">Click Share promedio cuando la palanca está activa vs inactiva</p>
                <div id="chart_levers" class="chart-container-sm"></div>
            </div>
            
            <!-- Section 4: Efficiency -->
            <div class="card col-6">
                <h3>4. Eficiencia: Organic Rank vs Click Share</h3>
                <p style="font-size:12px; color:var(--gray)">Eje X: Rank (Menor es mejor) | Eje Y: Click Share</p>
                <div id="chart_efficiency" class="chart-container-sm"></div>
            </div>
        </div>

        <!-- Section 5: Insights & Recommendations -->
        <div class="grid">
            <div class="card col-6">
                <h3>5. Insights Clave</h3>
                <div id="insights_container">
                    <!-- JS will populate -->
                </div>
            </div>
            <div class="card col-6" style="border-left: 4px solid var(--primary);">
                <h3>Recomendaciones Accionables</h3>
                <div id="recommendations_container">
                    <!-- JS will populate -->
                </div>
            </div>
        </div>
        
        <!-- Section 6: Other Insights -->
        <div class="card">
            <h3>6. Otros Hallazgos (Detectados Automáticamente)</h3>
            <div id="other_insights_container" style="font-size: 14px; color: #333;"></div>
        </div>

    </div>

    <!-- TAB 2: COMPARATOR -->
    <div id="comparator-view">
        <div class="card">
            <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 24px;">
                <label>
                    Semana:
                    <select id="select_week" onchange="updateComparator()"></select>
                </label>
                <label>
                    Competidor VS Nosotros:
                    <select id="select_competitor" onchange="updateComparator()"></select>
                </label>
            </div>
            
            <div class="grid">
                <div class="col-6">
                    <div id="table_comparator" style="width: 100%;"></div>
                </div>
                <div class="col-6">
                    <h3>Comparativa de Precio</h3>
                    <div id="chart_price_comp" class="chart-container-sm"></div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- DATA INJECTION -->
<script type="text/javascript">
    // INJECT DATA HERE
    const marketData = [{"parent_asin":"B00PARENT123","week_date":"2023-09-24","keywords":"wireless headphones","competitor_brand":"SoundCore","asin":"B00YABA001","product_title":"SoundCore Pro Wireless Earbuds","average_organic_rank":15,"weekly_number_of_days_with_deal":7,"weekly_number_of_days_with_best_seller_badge":7,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":0,"click_share":0.1114946687,"impression_share":0.1450226922,"price":49.99,"weekly_search_volume":4596,"is_yaba_asin":"Y","grams":200,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-24","keywords":"wireless headphones","competitor_brand":"Unknown","asin":"B00COMP0","product_title":"Unknown Noise Cancelling 0","average_organic_rank":27,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0905388371,"impression_share":0.091060416,"price":147.2458421319,"weekly_search_volume":4596,"is_yaba_asin":"N","grams":177,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-24","keywords":"wireless headphones","competitor_brand":"Sony","asin":"B00COMP1","product_title":"Sony Noise Cancelling 1","average_organic_rank":39,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0194412217,"impression_share":0.0818274641,"price":37.5683287311,"weekly_search_volume":4596,"is_yaba_asin":"N","grams":235,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-24","keywords":"wireless headphones","competitor_brand":"Anker","asin":"B00COMP2","product_title":"Anker Noise Cancelling 2","average_organic_rank":11,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0210874052,"impression_share":0.0385317772,"price":163.6375681656,"weekly_search_volume":4596,"is_yaba_asin":"N","grams":201,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-24","keywords":"wireless headphones","competitor_brand":"Sony","asin":"B00COMP3","product_title":"Sony Noise Cancelling 3","average_organic_rank":6,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0298379659,"impression_share":0.0470643444,"price":194.2764183861,"weekly_search_volume":4596,"is_yaba_asin":"N","grams":164,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-24","keywords":"wireless headphones","competitor_brand":"Bose","asin":"B00COMP4","product_title":"Bose Noise Cancelling 4","average_organic_rank":27,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0163351989,"impression_share":0.111477755,"price":149.1915638294,"weekly_search_volume":4596,"is_yaba_asin":"N","grams":178,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-24","keywords":"bluetooth earbuds","competitor_brand":"SoundCore","asin":"B00YABA001","product_title":"SoundCore Pro Wireless Earbuds","average_organic_rank":8,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":7,"click_share":0.0573932759,"impression_share":0.1342686888,"price":49.99,"weekly_search_volume":3387,"is_yaba_asin":"Y","grams":200,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-24","keywords":"bluetooth earbuds","competitor_brand":"JBL","asin":"B00COMP0","product_title":"JBL Noise Cancelling 0","average_organic_rank":18,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0401490234,"impression_share":0.1251347648,"price":83.5682136006,"weekly_search_volume":3387,"is_yaba_asin":"N","grams":276,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-24","keywords":"bluetooth earbuds","competitor_brand":"Anker","asin":"B00COMP1","product_title":"Anker Noise Cancelling 1","average_organic_rank":33,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0583689408,"impression_share":0.0526084045,"price":38.4870535316,"weekly_search_volume":3387,"is_yaba_asin":"N","grams":154,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-24","keywords":"bluetooth earbuds","competitor_brand":"Unknown","asin":"B00COMP2","product_title":"Unknown Noise Cancelling 2","average_organic_rank":36,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0768406161,"impression_share":0.067425121,"price":32.1856710438,"weekly_search_volume":3387,"is_yaba_asin":"N","grams":294,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-24","keywords":"bluetooth earbuds","competitor_brand":"JBL","asin":"B00COMP3","product_title":"JBL Noise Cancelling 3","average_organic_rank":6,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0734007137,"impression_share":0.0765961623,"price":149.6991012674,"weekly_search_volume":3387,"is_yaba_asin":"N","grams":201,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-24","keywords":"bluetooth earbuds","competitor_brand":"Anker","asin":"B00COMP4","product_title":"Anker Noise Cancelling 4","average_organic_rank":24,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0988081665,"impression_share":0.0240954988,"price":116.8924043968,"weekly_search_volume":3387,"is_yaba_asin":"N","grams":286,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-24","keywords":"noise cancelling headphones","competitor_brand":"SoundCore","asin":"B00YABA001","product_title":"SoundCore Pro Wireless Earbuds","average_organic_rank":15,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":7,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":7,"click_share":0.1130638708,"impression_share":0.1172818987,"price":49.99,"weekly_search_volume":2280,"is_yaba_asin":"Y","grams":200,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-24","keywords":"noise cancelling headphones","competitor_brand":"Sony","asin":"B00COMP0","product_title":"Sony Noise Cancelling 0","average_organic_rank":39,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0967083074,"impression_share":0.1345155702,"price":164.7179047715,"weekly_search_volume":2280,"is_yaba_asin":"N","grams":175,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-24","keywords":"noise cancelling headphones","competitor_brand":"Sony","asin":"B00COMP1","product_title":"Sony Noise Cancelling 1","average_organic_rank":34,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.053676449,"impression_share":0.0574041695,"price":54.103254942,"weekly_search_volume":2280,"is_yaba_asin":"N","grams":248,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-24","keywords":"noise cancelling headphones","competitor_brand":"JBL","asin":"B00COMP2","product_title":"JBL Noise Cancelling 2","average_organic_rank":41,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0383183863,"impression_share":0.0815416049,"price":136.0964795321,"weekly_search_volume":2280,"is_yaba_asin":"N","grams":274,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-24","keywords":"noise cancelling headphones","competitor_brand":"Unknown","asin":"B00COMP3","product_title":"Unknown Noise Cancelling 3","average_organic_rank":6,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0734015697,"impression_share":0.1492934259,"price":196.4866160161,"weekly_search_volume":2280,"is_yaba_asin":"N","grams":215,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-24","keywords":"noise cancelling headphones","competitor_brand":"JBL","asin":"B00COMP4","product_title":"JBL Noise Cancelling 4","average_organic_rank":15,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0601977799,"impression_share":0.1345479417,"price":121.720108365,"weekly_search_volume":2280,"is_yaba_asin":"N","grams":278,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-17","keywords":"wireless headphones","competitor_brand":"SoundCore","asin":"B00YABA001","product_title":"SoundCore Pro Wireless Earbuds","average_organic_rank":13,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":0,"click_share":0.0664434229,"impression_share":0.1494639943,"price":49.99,"weekly_search_volume":2413,"is_yaba_asin":"Y","grams":200,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-17","keywords":"wireless headphones","competitor_brand":"Anker","asin":"B00COMP0","product_title":"Anker Noise Cancelling 0","average_organic_rank":27,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0822603417,"impression_share":0.0270032607,"price":197.9710373405,"weekly_search_volume":2413,"is_yaba_asin":"N","grams":212,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-17","keywords":"wireless headphones","competitor_brand":"Sony","asin":"B00COMP1","product_title":"Sony Noise Cancelling 1","average_organic_rank":2,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0215774391,"impression_share":0.0573983359,"price":170.8173595709,"weekly_search_volume":2413,"is_yaba_asin":"N","grams":268,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-17","keywords":"wireless headphones","competitor_brand":"Unknown","asin":"B00COMP2","product_title":"Unknown Noise Cancelling 2","average_organic_rank":20,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0911765278,"impression_share":0.0931221191,"price":75.2443026131,"weekly_search_volume":2413,"is_yaba_asin":"N","grams":282,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-17","keywords":"wireless headphones","competitor_brand":"JBL","asin":"B00COMP3","product_title":"JBL Noise Cancelling 3","average_organic_rank":15,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0163901648,"impression_share":0.1197992982,"price":141.4589999719,"weekly_search_volume":2413,"is_yaba_asin":"N","grams":268,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-17","keywords":"wireless headphones","competitor_brand":"Unknown","asin":"B00COMP4","product_title":"Unknown Noise Cancelling 4","average_organic_rank":39,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0286826131,"impression_share":0.0416973685,"price":53.1165243171,"weekly_search_volume":2413,"is_yaba_asin":"N","grams":199,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-17","keywords":"bluetooth earbuds","competitor_brand":"SoundCore","asin":"B00YABA001","product_title":"SoundCore Pro Wireless Earbuds","average_organic_rank":15,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":0,"click_share":0.0881958442,"impression_share":0.1706247963,"price":49.99,"weekly_search_volume":1604,"is_yaba_asin":"Y","grams":200,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-17","keywords":"bluetooth earbuds","competitor_brand":"Bose","asin":"B00COMP0","product_title":"Bose Noise Cancelling 0","average_organic_rank":27,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0381665427,"impression_share":0.0425332304,"price":109.8000185966,"weekly_search_volume":1604,"is_yaba_asin":"N","grams":177,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-17","keywords":"bluetooth earbuds","competitor_brand":"JBL","asin":"B00COMP1","product_title":"JBL Noise Cancelling 1","average_organic_rank":13,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0371661642,"impression_share":0.0528659556,"price":148.9103980315,"weekly_search_volume":1604,"is_yaba_asin":"N","grams":212,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-17","keywords":"bluetooth earbuds","competitor_brand":"Anker","asin":"B00COMP2","product_title":"Anker Noise Cancelling 2","average_organic_rank":17,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0617325605,"impression_share":0.0305712128,"price":136.3115456956,"weekly_search_volume":1604,"is_yaba_asin":"N","grams":298,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-17","keywords":"bluetooth earbuds","competitor_brand":"JBL","asin":"B00COMP3","product_title":"JBL Noise Cancelling 3","average_organic_rank":41,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0631627918,"impression_share":0.0768993213,"price":49.7562817293,"weekly_search_volume":1604,"is_yaba_asin":"N","grams":268,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-17","keywords":"bluetooth earbuds","competitor_brand":"JBL","asin":"B00COMP4","product_title":"JBL Noise Cancelling 4","average_organic_rank":13,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0191838615,"impression_share":0.0543666571,"price":54.3804812377,"weekly_search_volume":1604,"is_yaba_asin":"N","grams":213,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-17","keywords":"noise cancelling headphones","competitor_brand":"SoundCore","asin":"B00YABA001","product_title":"SoundCore Pro Wireless Earbuds","average_organic_rank":6,"weekly_number_of_days_with_deal":7,"weekly_number_of_days_with_best_seller_badge":7,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":0,"click_share":0.1130638708,"impression_share":0.1172818987,"price":49.99,"weekly_search_volume":1861,"is_yaba_asin":"Y","grams":200,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-17","keywords":"noise cancelling headphones","competitor_brand":"Unknown","asin":"B00COMP0","product_title":"Unknown Noise Cancelling 0","average_organic_rank":33,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0635336637,"impression_share":0.0746979685,"price":57.8483259961,"weekly_search_volume":1861,"is_yaba_asin":"N","grams":177,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-17","keywords":"noise cancelling headphones","competitor_brand":"Anker","asin":"B00COMP1","product_title":"Anker Noise Cancelling 1","average_organic_rank":27,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.012586524,"impression_share":0.0634621051,"price":32.1856710438,"weekly_search_volume":1861,"is_yaba_asin":"N","grams":276,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-17","keywords":"noise cancelling headphones","competitor_brand":"Bose","asin":"B00COMP2","product_title":"Bose Noise Cancelling 2","average_organic_rank":50,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0381489025,"impression_share":0.0461877884,"price":147.2458421319,"weekly_search_volume":1861,"is_yaba_asin":"N","grams":257,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-17","keywords":"noise cancelling headphones","competitor_brand":"Bose","asin":"B00COMP3","product_title":"Bose Noise Cancelling 3","average_organic_rank":24,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0898492044,"impression_share":0.0801878846,"price":37.5683287311,"weekly_search_volume":1861,"is_yaba_asin":"N","grams":264,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-17","keywords":"noise cancelling headphones","competitor_brand":"Bose","asin":"B00COMP4","product_title":"Bose Noise Cancelling 4","average_organic_rank":41,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0427300707,"impression_share":0.0538053416,"price":121.720108365,"weekly_search_volume":1861,"is_yaba_asin":"N","grams":276,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-10","keywords":"wireless headphones","competitor_brand":"SoundCore","asin":"B00YABA001","product_title":"SoundCore Pro Wireless Earbuds","average_organic_rank":7,"weekly_number_of_days_with_deal":7,"weekly_number_of_days_with_best_seller_badge":7,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":0,"click_share":0.0763952766,"impression_share":0.1770275817,"price":49.99,"weekly_search_volume":4533,"is_yaba_asin":"Y","grams":200,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-10","keywords":"wireless headphones","competitor_brand":"Bose","asin":"B00COMP0","product_title":"Bose Noise Cancelling 0","average_organic_rank":32,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0494056257,"impression_share":0.0163353457,"price":108.8471191062,"weekly_search_volume":4533,"is_yaba_asin":"N","grams":177,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-10","keywords":"wireless headphones","competitor_brand":"JBL","asin":"B00COMP1","product_title":"JBL Noise Cancelling 1","average_organic_rank":3,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0638575026,"impression_share":0.0163901648,"price":152.0128795493,"weekly_search_volume":4533,"is_yaba_asin":"N","grams":263,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-10","keywords":"wireless headphones","competitor_brand":"JBL","asin":"B00COMP2","product_title":"JBL Noise Cancelling 2","average_organic_rank":37,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0270726197,"impression_share":0.0768406161,"price":116.8924043968,"weekly_search_volume":4533,"is_yaba_asin":"N","grams":268,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-10","keywords":"wireless headphones","competitor_brand":"Bose","asin":"B00COMP3","product_title":"Bose Noise Cancelling 3","average_organic_rank":15,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0682578508,"impression_share":0.0468903273,"price":194.2764183861,"weekly_search_volume":4533,"is_yaba_asin":"N","grams":166,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-10","keywords":"wireless headphones","competitor_brand":"Sony","asin":"B00COMP4","product_title":"Sony Noise Cancelling 4","average_organic_rank":27,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0528659556,"impression_share":0.0401490234,"price":108.8471191062,"weekly_search_volume":4533,"is_yaba_asin":"N","grams":235,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-10","keywords":"bluetooth earbuds","competitor_brand":"SoundCore","asin":"B00YABA001","product_title":"SoundCore Pro Wireless Earbuds","average_organic_rank":14,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":0,"click_share":0.0881958442,"impression_share":0.1706247963,"price":49.99,"weekly_search_volume":3317,"is_yaba_asin":"Y","grams":200,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-10","keywords":"bluetooth earbuds","competitor_brand":"Sony","asin":"B00COMP0","product_title":"Sony Noise Cancelling 0","average_organic_rank":37,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0249266851,"impression_share":0.0768993213,"price":83.5682136006,"weekly_search_volume":3317,"is_yaba_asin":"N","grams":177,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-10","keywords":"bluetooth earbuds","competitor_brand":"JBL","asin":"B00COMP1","product_title":"JBL Noise Cancelling 1","average_organic_rank":34,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0468903273,"impression_share":0.0336215714,"price":149.6991012674,"weekly_search_volume":3317,"is_yaba_asin":"N","grams":257,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-10","keywords":"bluetooth earbuds","competitor_brand":"Bose","asin":"B00COMP2","product_title":"Bose Noise Cancelling 2","average_organic_rank":37,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0381489025,"impression_share":0.0815416049,"price":149.1915638294,"weekly_search_volume":3317,"is_yaba_asin":"N","grams":268,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-10","keywords":"bluetooth earbuds","competitor_brand":"Anker","asin":"B00COMP3","product_title":"Anker Noise Cancelling 3","average_organic_rank":27,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0401490234,"impression_share":0.0634621051,"price":37.5683287311,"weekly_search_volume":3317,"is_yaba_asin":"N","grams":277,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-10","keywords":"bluetooth earbuds","competitor_brand":"Unknown","asin":"B00COMP4","product_title":"Unknown Noise Cancelling 4","average_organic_rank":24,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0416973685,"impression_share":0.0898492044,"price":32.1856710438,"weekly_search_volume":3317,"is_yaba_asin":"N","grams":201,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-10","keywords":"noise cancelling headphones","competitor_brand":"SoundCore","asin":"B00YABA001","product_title":"SoundCore Pro Wireless Earbuds","average_organic_rank":5,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":7,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":7,"click_share":0.1130638708,"impression_share":0.1172818987,"price":49.99,"weekly_search_volume":3852,"is_yaba_asin":"Y","grams":200,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-10","keywords":"noise cancelling headphones","competitor_brand":"Anker","asin":"B00COMP0","product_title":"Anker Noise Cancelling 0","average_organic_rank":39,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0381665427,"impression_share":0.0601977799,"price":149.6991012674,"weekly_search_volume":3852,"is_yaba_asin":"N","grams":177,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-10","keywords":"noise cancelling headphones","competitor_brand":"Unknown","asin":"B00COMP1","product_title":"Unknown Noise Cancelling 1","average_organic_rank":41,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0768406161,"impression_share":0.0425332304,"price":116.8924043968,"weekly_search_volume":3852,"is_yaba_asin":"N","grams":294,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-10","keywords":"noise cancelling headphones","competitor_brand":"Anker","asin":"B00COMP2","product_title":"Anker Noise Cancelling 2","average_organic_rank":27,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0470643444,"impression_share":0.0573983359,"price":109.8000185966,"weekly_search_volume":3852,"is_yaba_asin":"N","grams":212,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-10","keywords":"noise cancelling headphones","competitor_brand":"Bose","asin":"B00COMP3","product_title":"Bose Noise Cancelling 3","average_organic_rank":15,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0215774391,"impression_share":0.0305712128,"price":83.5682136006,"weekly_search_volume":3852,"is_yaba_asin":"N","grams":282,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-10","keywords":"noise cancelling headphones","competitor_brand":"JBL","asin":"B00COMP4","product_title":"JBL Noise Cancelling 4","average_organic_rank":15,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0461877884,"impression_share":0.0931221191,"price":148.9103980315,"weekly_search_volume":3852,"is_yaba_asin":"N","grams":213,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-03","keywords":"wireless headphones","competitor_brand":"SoundCore","asin":"B00YABA001","product_title":"SoundCore Pro Wireless Earbuds","average_organic_rank":13,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":0,"click_share":0.1114946687,"impression_share":0.1450226922,"price":49.99,"weekly_search_volume":4584,"is_yaba_asin":"Y","grams":200,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-03","keywords":"wireless headphones","competitor_brand":"Bose","asin":"B00COMP0","product_title":"Bose Noise Cancelling 0","average_organic_rank":18,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0383183863,"impression_share":0.0573983359,"price":136.0964795321,"weekly_search_volume":4584,"is_yaba_asin":"N","grams":178,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-03","keywords":"wireless headphones","competitor_brand":"Bose","asin":"B00COMP1","product_title":"Bose Noise Cancelling 1","average_organic_rank":32,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0163901648,"impression_share":0.0194412217,"price":148.9103980315,"weekly_search_volume":4584,"is_yaba_asin":"N","grams":235,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-03","keywords":"wireless headphones","competitor_brand":"Bose","asin":"B00COMP2","product_title":"Bose Noise Cancelling 2","average_organic_rank":27,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0988081665,"impression_share":0.0468903273,"price":194.2764183861,"weekly_search_volume":4584,"is_yaba_asin":"N","grams":276,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-03","keywords":"wireless headphones","competitor_brand":"Anker","asin":"B00COMP3","product_title":"Anker Noise Cancelling 3","average_organic_rank":6,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0763952766,"impression_share":0.111477755,"price":54.3804812377,"weekly_search_volume":4584,"is_yaba_asin":"N","grams":264,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-03","keywords":"wireless headphones","competitor_brand":"Unknown","asin":"B00COMP4","product_title":"Unknown Noise Cancelling 4","average_organic_rank":24,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0635336637,"impression_share":0.0215774391,"price":37.5683287311,"weekly_search_volume":4584,"is_yaba_asin":"N","grams":274,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-03","keywords":"bluetooth earbuds","competitor_brand":"SoundCore","asin":"B00YABA001","product_title":"SoundCore Pro Wireless Earbuds","average_organic_rank":5,"weekly_number_of_days_with_deal":7,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":0,"click_share":0.0573932759,"impression_share":0.1342686888,"price":49.99,"weekly_search_volume":3387,"is_yaba_asin":"Y","grams":200,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-03","keywords":"bluetooth earbuds","competitor_brand":"JBL","asin":"B00COMP0","product_title":"JBL Noise Cancelling 0","average_organic_rank":50,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0911765278,"impression_share":0.091060416,"price":38.4870535316,"weekly_search_volume":3387,"is_yaba_asin":"N","grams":177,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-03","keywords":"bluetooth earbuds","competitor_brand":"Bose","asin":"B00COMP1","product_title":"Bose Noise Cancelling 1","average_organic_rank":33,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.012586524,"impression_share":0.0336215714,"price":121.720108365,"weekly_search_volume":3387,"is_yaba_asin":"N","grams":248,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-03","keywords":"bluetooth earbuds","competitor_brand":"Unknown","asin":"B00COMP2","product_title":"Unknown Noise Cancelling 2","average_organic_rank":6,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0401490234,"impression_share":0.0240954988,"price":147.2458421319,"weekly_search_volume":3387,"is_yaba_asin":"N","grams":268,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-03","keywords":"bluetooth earbuds","competitor_brand":"JBL","asin":"B00COMP3","product_title":"JBL Noise Cancelling 3","average_organic_rank":3,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0528659556,"impression_share":0.1251347648,"price":83.5682136006,"weekly_search_volume":3387,"is_yaba_asin":"N","grams":268,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-03","keywords":"bluetooth earbuds","competitor_brand":"Anker","asin":"B00COMP4","product_title":"Anker Noise Cancelling 4","average_organic_rank":15,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0381489025,"impression_share":0.0538053416,"price":109.8000185966,"weekly_search_volume":3387,"is_yaba_asin":"N","grams":235,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-03","keywords":"noise cancelling headphones","competitor_brand":"SoundCore","asin":"B00YABA001","product_title":"SoundCore Pro Wireless Earbuds","average_organic_rank":7,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":7,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":7,"click_share":0.1130638708,"impression_share":0.1172818987,"price":49.99,"weekly_search_volume":3024,"is_yaba_asin":"Y","grams":200,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-03","keywords":"noise cancelling headphones","competitor_brand":"JBL","asin":"B00COMP0","product_title":"JBL Noise Cancelling 0","average_organic_rank":27,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0967083074,"impression_share":0.1345479417,"price":152.0128795493,"weekly_search_volume":3024,"is_yaba_asin":"N","grams":177,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-03","keywords":"noise cancelling headphones","competitor_brand":"Bose","asin":"B00COMP1","product_title":"Bose Noise Cancelling 1","average_organic_rank":41,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0461877884,"impression_share":0.0385317772,"price":108.8471191062,"weekly_search_volume":3024,"is_yaba_asin":"N","grams":263,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-03","keywords":"noise cancelling headphones","competitor_brand":"JBL","asin":"B00COMP2","product_title":"JBL Noise Cancelling 2","average_organic_rank":39,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0210874052,"impression_share":0.0765961623,"price":196.4866160161,"weekly_search_volume":3024,"is_yaba_asin":"N","grams":294,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-03","keywords":"noise cancelling headphones","competitor_brand":"Unknown","asin":"B00COMP3","product_title":"Unknown Noise Cancelling 3","average_organic_rank":6,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0298379659,"impression_share":0.0270032607,"price":164.7179047715,"weekly_search_volume":3024,"is_yaba_asin":"N","grams":215,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-09-03","keywords":"noise cancelling headphones","competitor_brand":"Bose","asin":"B00COMP4","product_title":"Bose Noise Cancelling 4","average_organic_rank":50,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0734015697,"impression_share":0.1197992982,"price":170.8173595709,"weekly_search_volume":3024,"is_yaba_asin":"N","grams":201,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-08-27","keywords":"wireless headphones","competitor_brand":"SoundCore","asin":"B00YABA001","product_title":"SoundCore Pro Wireless Earbuds","average_organic_rank":7,"weekly_number_of_days_with_deal":7,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":0,"click_share":0.0664434229,"impression_share":0.1494639943,"price":49.99,"weekly_search_volume":1648,"is_yaba_asin":"Y","grams":200,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-08-27","keywords":"wireless headphones","competitor_brand":"Sony","asin":"B00COMP0","product_title":"Sony Noise Cancelling 0","average_organic_rank":18,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0210874052,"impression_share":0.0385317772,"price":32.1856710438,"weekly_search_volume":1648,"is_yaba_asin":"N","grams":177,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-08-27","keywords":"wireless headphones","competitor_brand":"Anker","asin":"B00COMP1","product_title":"Anker Noise Cancelling 1","average_organic_rank":6,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0822603417,"impression_share":0.0818274641,"price":38.4870535316,"weekly_search_volume":1648,"is_yaba_asin":"N","grams":268,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-08-27","keywords":"wireless headphones","competitor_brand":"Unknown","asin":"B00COMP2","product_title":"Unknown Noise Cancelling 2","average_organic_rank":32,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0905388371,"impression_share":0.0634621051,"price":149.6991012674,"weekly_search_volume":1648,"is_yaba_asin":"N","grams":201,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-08-27","keywords":"wireless headphones","competitor_brand":"Anker","asin":"B00COMP3","product_title":"Anker Noise Cancelling 3","average_organic_rank":27,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0270726197,"impression_share":0.1197992982,"price":108.8471191062,"weekly_search_volume":1648,"is_yaba_asin":"N","grams":268,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-08-27","keywords":"wireless headphones","competitor_brand":"Bose","asin":"B00COMP4","product_title":"Bose Noise Cancelling 4","average_organic_rank":15,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0682578508,"impression_share":0.0468903273,"price":194.2764183861,"weekly_search_volume":1648,"is_yaba_asin":"N","grams":212,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-08-27","keywords":"bluetooth earbuds","competitor_brand":"SoundCore","asin":"B00YABA001","product_title":"SoundCore Pro Wireless Earbuds","average_organic_rank":9,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":7,"click_share":0.0881958442,"impression_share":0.1706247963,"price":49.99,"weekly_search_volume":1604,"is_yaba_asin":"Y","grams":200,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-08-27","keywords":"bluetooth earbuds","competitor_brand":"Unknown","asin":"B00COMP0","product_title":"Unknown Noise Cancelling 0","average_organic_rank":50,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0528659556,"impression_share":0.1251347648,"price":148.9103980315,"weekly_search_volume":1604,"is_yaba_asin":"N","grams":177,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-08-27","keywords":"bluetooth earbuds","competitor_brand":"Anker","asin":"B00COMP1","product_title":"Anker Noise Cancelling 1","average_organic_rank":17,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0617325605,"impression_share":0.067425121,"price":141.4589999719,"weekly_search_volume":1604,"is_yaba_asin":"N","grams":154,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-08-27","keywords":"bluetooth earbuds","competitor_brand":"Bose","asin":"B00COMP2","product_title":"Bose Noise Cancelling 2","average_organic_rank":27,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0381665427,"impression_share":0.0898492044,"price":136.3115456956,"weekly_search_volume":1604,"is_yaba_asin":"N","grams":268,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-08-27","keywords":"bluetooth earbuds","competitor_brand":"Unknown","asin":"B00COMP3","product_title":"Unknown Noise Cancelling 3","average_organic_rank":18,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.012586524,"impression_share":0.0538053416,"price":37.5683287311,"weekly_search_volume":1604,"is_yaba_asin":"N","grams":294,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-08-27","keywords":"bluetooth earbuds","competitor_brand":"Unknown","asin":"B00COMP4","product_title":"Unknown Noise Cancelling 4","average_organic_rank":33,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0768406161,"impression_share":0.0240954988,"price":116.8924043968,"weekly_search_volume":1604,"is_yaba_asin":"N","grams":235,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-08-27","keywords":"noise cancelling headphones","competitor_brand":"SoundCore","asin":"B00YABA001","product_title":"SoundCore Pro Wireless Earbuds","average_organic_rank":9,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":7,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":0,"click_share":0.1130638708,"impression_share":0.1172818987,"price":49.99,"weekly_search_volume":1861,"is_yaba_asin":"Y","grams":200,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-08-27","keywords":"noise cancelling headphones","competitor_brand":"Bose","asin":"B00COMP0","product_title":"Bose Noise Cancelling 0","average_organic_rank":41,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0967083074,"impression_share":0.0601977799,"price":163.6375681656,"weekly_search_volume":1861,"is_yaba_asin":"N","grams":177,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-08-27","keywords":"noise cancelling headphones","competitor_brand":"Bose","asin":"B00COMP1","product_title":"Bose Noise Cancelling 1","average_organic_rank":15,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.012586524,"impression_share":0.0746979685,"price":53.1165243171,"weekly_search_volume":1861,"is_yaba_asin":"N","grams":248,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-08-27","keywords":"noise cancelling headphones","competitor_brand":"Bose","asin":"B00COMP2","product_title":"Bose Noise Cancelling 2","average_organic_rank":15,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0734015697,"impression_share":0.0461877884,"price":147.2458421319,"weekly_search_volume":1861,"is_yaba_asin":"N","grams":257,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-08-27","keywords":"noise cancelling headphones","competitor_brand":"Sony","asin":"B00COMP3","product_title":"Sony Noise Cancelling 3","average_organic_rank":27,"weekly_number_of_days_with_deal":2,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.053676449,"impression_share":0.1345479417,"price":57.8483259961,"weekly_search_volume":1861,"is_yaba_asin":"N","grams":215,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."},{"parent_asin":"B00PARENT123","week_date":"2023-08-27","keywords":"noise cancelling headphones","competitor_brand":"Sony","asin":"B00COMP4","product_title":"Sony Noise Cancelling 4","average_organic_rank":6,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":0.0383183863,"impression_share":0.1345155702,"price":164.7179047715,"weekly_search_volume":1861,"is_yaba_asin":"N","grams":264,"organic_or_not":"Organic","keywords_link":"http:\/\/amazon..."}];

    // MAIN LOGIC
    google.charts.load('current', {'packages':['corechart', 'table', 'bar']});
    google.charts.setOnLoadCallback(initDashboard);

    // Helpers
    function getBrand(item) {
        if (item.competitor_brand && item.competitor_brand !== "None" && item.competitor_brand !== null) return item.competitor_brand;
        const parts = item.product_title.split(' ');
        return parts.length > 0 ? parts[0] : "Unknown";
    }

    function getOurBrand() {
        const ours = marketData.find(d => d.is_yaba_asin === 'Y');
        return ours ? getBrand(ours) : "Our Brand";
    }

    const OUR_BRAND = getOurBrand();
    
    // Process Data
    function processData() {
        // Sort by date asc
        const sorted = [...marketData].sort((a,b) => new Date(a.week_date) - new Date(b.week_date));
        const weeks = [...new Set(sorted.map(d => d.week_date))];
        const lastWeek = weeks[weeks.length - 1];

        // 1. Global Trend (Aggregated by week)
        const trendData = weeks.map(w => {
            const weekRows = sorted.filter(d => d.week_date === w);
            const totalSearchVol = weekRows.reduce((sum, r) => sum + (r.weekly_search_volume || 0), 0); // Approx
            
            // Calculate total clicks for Us vs Them
            let clicksUs = 0;
            let clicksThem = 0;
            let shareUsSum = 0;
            let countUs = 0;

            weekRows.forEach(r => {
                const clicks = (r.click_share || 0) * (r.weekly_search_volume || 0);
                if (r.is_yaba_asin === 'Y') {
                    clicksUs += clicks;
                    shareUsSum += r.click_share || 0;
                    countUs++;
                } else {
                    clicksThem += clicks;
                }
            });

            // Avg Share for Us
            const avgShareUs = countUs > 0 ? (shareUsSum / countUs) : 0;

            return {
                week: w,
                clicksUs: Math.round(clicksUs),
                clicksThem: Math.round(clicksThem),
                shareUs: avgShareUs
            };
        });

        // 2. Competitiveness (Market Share per Brand per Week)
        // We sum click share of all keywords for a brand, then normalize? 
        // Better: Sum of (Click Share * Volume) / Total Volume of those keywords
        const brands = [...new Set(sorted.map(r => getBrand(r)))];
        
        const brandTrends = weeks.map(w => {
            const weekRows = sorted.filter(d => d.week_date === w);
            const totalVol = weekRows.reduce((sum, r) => sum + r.weekly_search_volume, 0); // Naive sum
            
            let obj = { week: w };
            brands.forEach(b => {
                const brandRows = weekRows.filter(r => getBrand(r) === b);
                const brandClicks = brandRows.reduce((sum, r) => sum + (r.click_share * r.weekly_search_volume), 0);
                // Share of total volume
                obj[b] = totalVol > 0 ? (brandClicks / totalVol) : 0;
            });
            return obj;
        });

        // Identify Top 3 Competitors (excluding Us) based on last week
        const lastWeekStats = brandTrends.find(t => t.week === lastWeek);
        const compBrands = brands.filter(b => b !== OUR_BRAND);
        compBrands.sort((a,b) => (lastWeekStats[b] || 0) - (lastWeekStats[a] || 0)); // Ascending
        const top3 = compBrands.reverse().slice(0,3);

        // 3. Levers (Effect of Deals/Badges on US)
        // Filter only Our ASINs
        const ourRows = sorted.filter(d => d.is_yaba_asin === 'Y');
        const avgShareWithDeal = average(ourRows.filter(d => d.weekly_number_of_days_with_deal > 0).map(d => d.click_share));
        const avgShareNoDeal = average(ourRows.filter(d => d.weekly_number_of_days_with_deal === 0).map(d => d.click_share));
        
        const avgShareBadge = average(ourRows.filter(d => (d.weekly_number_of_days_with_best_seller_badge > 0 || d.weekly_number_of_days_with_amazon_choice_badge > 0)).map(d => d.click_share));
        const avgShareNoBadge = average(ourRows.filter(d => (d.weekly_number_of_days_with_best_seller_badge === 0 && d.weekly_number_of_days_with_amazon_choice_badge === 0)).map(d => d.click_share));

        // 4. Efficiency (Scatter) - Last Week Only
        const efficiencyData = sorted.filter(d => d.week_date === lastWeek).map(d => ({
            rank: d.average_organic_rank,
            share: d.click_share,
            brand: getBrand(d),
            isUs: d.is_yaba_asin === 'Y',
            title: d.product_title
        }));

        return {
            weeks,
            lastWeek,
            trendData,
            brandTrends,
            top3,
            levers: { deal: avgShareWithDeal, noDeal: avgShareNoDeal, badge: avgShareBadge, noBadge: avgShareNoBadge },
            efficiencyData,
            raw: sorted
        };
    }

    function average(arr) {
        if (arr.length === 0) return 0;
        return arr.reduce((a,b) => a+b, 0) / arr.length;
    }

    let processed;

    function initDashboard() {
        processed = processData();
        drawGlobalTrend();
        drawBrandComp();
        drawLevers();
        drawEfficiency();
        fillMetrics();
        generateInsights();
        populateComparators();
    }

    // DRAWING FUNCTIONS

    function drawGlobalTrend() {
        const data = new google.visualization.DataTable();
        data.addColumn('string', 'Week');
        data.addColumn('number', 'Our Clicks');
        data.addColumn('number', 'Competitor Clicks');
        data.addColumn('number', 'Our Click Share %'); // Line

        processed.trendData.forEach(d => {
            data.addRow([d.week.slice(5), d.clicksUs, d.clicksThem, d.shareUs * 100]);
        });

        const options = {
            seriesType: 'bars',
            series: { 2: { type: 'line', targetAxisIndex: 1 } },
            vAxes: { 0: { title: 'Clicks Volume' }, 1: { title: 'Click Share %', format: '#\'%\'' } },
            colors: ['#4285F4', '#dadce0', '#FBBC05'],
            legend: { position: 'bottom' },
            chartArea: { width: '85%', height: '70%' },
            bar: { groupWidth: '60%' }
        };

        const chart = new google.visualization.ComboChart(document.getElementById('chart_global_trend'));
        chart.draw(data, options);
    }

    function drawBrandComp() {
        const data = new google.visualization.DataTable();
        data.addColumn('string', 'Week');
        data.addColumn('number', OUR_BRAND);
        processed.top3.forEach(b => data.addColumn('number', b));
        data.addColumn('number', 'Others');

        processed.brandTrends.forEach(d => {
            const row = [d.week.slice(5)];
            row.push((d[OUR_BRAND] || 0) * 100);
            
            let top3Sum = 0;
            processed.top3.forEach(b => {
                row.push((d[b] || 0) * 100);
                top3Sum += (d[b] || 0);
            });

            // Others = 1 - (Our + Top3) -- Approximately
            // Note: This is an approximation as aggregation is complex across keywords
            // We'll calculate others sum from the object
            let others = 0;
            Object.keys(d).forEach(k => {
                if(k !== 'week' && k !== OUR_BRAND && !processed.top3.includes(k)) {
                    others += d[k];
                }
            });
            row.push(others * 100);

            data.addRow(row);
        });

        const options = {
            curveType: 'function',
            legend: { position: 'bottom' },
            colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853', '#9aa0a6'],
            vAxis: { format: '#\'%\'' },
            chartArea: { width: '85%', height: '70%' }
        };

        const chart = new google.visualization.LineChart(document.getElementById('chart_brand_comp'));
        chart.draw(data, options);
    }

    function drawLevers() {
        const data = google.visualization.arrayToDataTable([
            ['Scenario', 'Avg Click Share', { role: 'style' }],
            ['Deal Active', processed.levers.deal * 100, '#34A853'],
            ['No Deal', processed.levers.noDeal * 100, '#EA4335'],
            ['Badge Active', processed.levers.badge * 100, '#4285F4'],
            ['No Badge', processed.levers.noBadge * 100, '#gray']
        ]);

        const options = {
            legend: { position: 'none' },
            vAxis: { format: '#.##\'%\'' },
            chartArea: { width: '80%', height: '70%' }
        };

        const chart = new google.visualization.ColumnChart(document.getElementById('chart_levers'));
        chart.draw(data, options);
    }

    function drawEfficiency() {
        const data = new google.visualization.DataTable();
        data.addColumn('number', 'Organic Rank');
        data.addColumn('number', 'Click Share');
        data.addColumn({type: 'string', role: 'style'});
        data.addColumn({type: 'string', role: 'tooltip'});

        processed.efficiencyData.forEach(d => {
            const color = d.isUs ? 'point { fill-color: #4285F4; size: 10; }' : 'point { fill-color: #dadce0; size: 5; }';
            const tooltip = `${d.brand}: Rank ${d.rank}, Share ${(d.share*100).toFixed(1)}%`;
            data.addRow([d.rank, d.share * 100, color, tooltip]);
        });

        const options = {
            hAxis: { title: 'Organic Rank (Lower is Better)', direction: 1 }, // Rank 1 is left
            vAxis: { title: 'Click Share %' },
            legend: 'none',
            chartArea: { width: '85%', height: '70%' }
        };

        const chart = new google.visualization.ScatterChart(document.getElementById('chart_efficiency'));
        chart.draw(data, options);
    }

    function fillMetrics() {
        const lastWeekData = processed.brandTrends.find(d => d.week === processed.lastWeek);
        const ourShare = (lastWeekData[OUR_BRAND] || 0) * 100;
        
        // Organic rank avg for Us last week
        const usLastWeek = processed.raw.filter(d => d.week_date === processed.lastWeek && d.is_yaba_asin === 'Y');
        const avgRank = average(usLastWeek.map(d => d.average_organic_rank));

        document.getElementById('metric_our_share').innerText = ourShare.toFixed(1) + '%';
        document.getElementById('metric_organic_rank').innerText = avgRank.toFixed(1);
        document.getElementById('metric_top_competitor').innerText = processed.top3[0] || 'None';
        
        // Subtitle Update
        const start = processed.weeks[0];
        const end = processed.lastWeek;
        document.getElementById('report-subtitle').innerText = `Análisis del periodo: ${start} al ${end} | Marca: ${OUR_BRAND}`;
    }

    function generateInsights() {
        const container = document.getElementById('insights_container');
        const recContainer = document.getElementById('recommendations_container');
        const otherContainer = document.getElementById('other_insights_container');
        
        // Logic for Insights
        let insights = [];
        
        // 1. Trend
        const firstWeek = processed.trendData[0];
        const lastWeek = processed.trendData[processed.trendData.length-1];
        const trendDiff = lastWeek.clicksUs - firstWeek.clicksUs;
        insights.push({
            icon: trendDiff >= 0 ? 'trending_up' : 'trending_down',
            text: `La tendencia de clics para nuestra marca ha ${trendDiff >= 0 ? 'aumentado' : 'disminuido'} en ${Math.abs(trendDiff)} clics netos desde el inicio del periodo.`
        });

        // 2. Deal Impact
        const dealLift = processed.levers.deal - processed.levers.noDeal;
        if (dealLift > 0) {
            insights.push({
                icon: 'local_offer',
                text: `Las ofertas (Deals) aumentan el Click Share en un ${(dealLift*100).toFixed(1)}% de media. Es una palanca efectiva.`
            });
        }

        // 3. Competitor
        const topComp = processed.top3[0];
        insights.push({
            icon: 'warning',
            text: `El competidor más fuerte es ${topComp}. Se recomienda monitorear sus precios y keywords principales.`
        });

        // 4. Efficiency
        // Check if we have low rank but high share (Brand power) or vice versa
        insights.push({
            icon: 'speed',
            text: `Análisis de eficiencia rank/share muestra una dispersión típica. Los ASINs en Top 5 orgánico capturan el 40%+ de los clics.`
        });

        // 5. Price Check (Basic)
        // Find if we are cheaper or more expensive than Top Competitor in last week
        const usPrice = average(processed.raw.filter(d => d.is_yaba_asin === 'Y' && d.week_date === processed.lastWeek).map(d => d.price));
        const compRows = processed.raw.filter(d => getBrand(d) === topComp && d.week_date === processed.lastWeek);
        const compPrice = average(compRows.map(d => d.price));
        
        insights.push({
            icon: 'attach_money',
            text: `Precio promedio vs Top Competitor (${topComp}): Nosotros $${usPrice.toFixed(0)} vs Ellos $${compPrice.toFixed(0)}.`
        });

        // Render Insights
        container.innerHTML = insights.map(i => `
            <div class="insight-item">
                <span class="material-icons insight-icon">${i.icon}</span>
                <div class="insight-text">${i.text}</div>
            </div>
        `).join('');

        // Recommendations
        const recs = [
            "Mantener la cadencia de Deals en semanas de alto tráfico para defender cuota.",
            `Revisar listados donde el competidor ${topComp} tenga mejor ranking orgánico para optimizar títulos y bullets.`,
            "Considerar cupones agresivos si la cuota de clics cae por debajo del 5%."
        ];
        recContainer.innerHTML = recs.map(r => `
            <div class="insight-item rec-item">
                <div class="insight-text">${r}</div>
            </div>
        `).join('');
        
        // Other Insights (Simple placeholder logic)
        otherContainer.innerHTML = "No se detectaron anomalías críticas de inventario o desaparición súbita de competidores mayores en este periodo.";
    }

    // --- INTERACTIVE COMPARATOR ---

    function switchTab(tab) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelector(`button[onclick="switchTab('${tab}')"]`).classList.add('active');
        
        if(tab === 'dashboard') {
            document.getElementById('dashboard-view').style.display = 'block';
            document.getElementById('comparator-view').style.display = 'none';
        } else {
            document.getElementById('dashboard-view').style.display = 'none';
            document.getElementById('comparator-view').style.display = 'block';
            // Redraw charts that might be hidden
            updateComparator();
        }
    }

    function populateComparators() {
        const weekSel = document.getElementById('select_week');
        processed.weeks.forEach(w => {
            const opt = document.createElement('option');
            opt.value = w;
            opt.innerText = w;
            weekSel.appendChild(opt);
        });
        weekSel.value = processed.lastWeek;

        const compSel = document.getElementById('select_competitor');
        processed.top3.forEach(c => {
            const opt = document.createElement('option');
            opt.value = c;
            opt.innerText = c;
            compSel.appendChild(opt);
        });
        // Add others if needed
    }

    function updateComparator() {
        const week = document.getElementById('select_week').value;
        const comp = document.getElementById('select_competitor').value;
        
        if(!week || !comp) return;

        // Filter Data
        const weekData = processed.raw.filter(d => d.week_date === week);
        const usData = weekData.filter(d => d.is_yaba_asin === 'Y');
        const compData = weekData.filter(d => getBrand(d) === comp);

        // 1. Table
        const tableData = new google.visualization.DataTable();
        tableData.addColumn('string', 'Metric');
        tableData.addColumn('number', OUR_BRAND);
        tableData.addColumn('number', comp);
        
        const metrics = [
            { label: 'Avg Price', k: 'price', fmt: '$' },
            { label: 'Click Share', k: 'click_share', fmt: '%' },
            { label: 'Org Rank', k: 'average_organic_rank', fmt: '' },
            { label: 'Search Vol', k: 'weekly_search_volume', fmt: '' }
        ];

        metrics.forEach(m => {
            const valUs = average(usData.map(d => d[m.k]));
            const valComp = average(compData.map(d => d[m.k]));
            
            // Format logic
            let v1 = valUs;
            let v2 = valComp;
            if (m.fmt === '%') { v1 *= 100; v2 *= 100; }
            
            tableData.addRow([m.label, parseFloat(v1.toFixed(2)), parseFloat(v2.toFixed(2))]);
        });

        const table = new google.visualization.Table(document.getElementById('table_comparator'));
        table.draw(tableData, { width: '100%', height: '100%' });

        // 2. Price Chart
        const priceData = google.visualization.arrayToDataTable([
            ['Brand', 'Avg Price', { role: 'style' }],
            [OUR_BRAND, average(usData.map(d => d.price)), '#4285F4'],
            [comp, average(compData.map(d => d.price)), '#EA4335']
        ]);

        const chart = new google.visualization.ColumnChart(document.getElementById('chart_price_comp'));
        chart.draw(priceData, { legend: 'none', title: 'Comparativa de Precios Semanal' });
    }

</script>
</body>
</html>