<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Intelligence Report: Naturalebio</title>
    
    <!-- Google Charts Loader -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        :root {
            --primary: #0071e3;
            --secondary: #86868b;
            --bg: #f5f5f7;
            --card-bg: #ffffff;
            --text-main: #1d1d1f;
            --danger: #ff3b30;
            --success: #34c759;
            --border-radius: 20px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header */
        header {
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
            margin: 0;
        }

        .date-badge {
            background: #e3e3e3;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            color: var(--secondary);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 20px;
            margin-bottom: 24px;
            border-bottom: 1px solid #d2d2d7;
            padding-bottom: 10px;
        }

        .tab-btn {
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 500;
            color: var(--secondary);
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .tab-btn.active {
            color: var(--text-main);
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* Content Sections */
        .section-content {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .section-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.04);
            margin-bottom: 24px;
            border: 1px solid rgba(0,0,0,0.02);
        }

        .card h2 {
            margin-top: 0;
            font-size: 20px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* KPI Grid */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .kpi-card {
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
            text-align: center;
        }

        .kpi-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }

        .kpi-label {
            color: var(--secondary);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }

        /* Charts */
        .chart-container {
            width: 100%;
            height: 400px;
        }

        /* Insights List */
        .insight-list {
            list-style: none;
            padding: 0;
        }

        .insight-list li {
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            font-size: 15px;
            line-height: 1.5;
        }

        .insight-icon {
            color: var(--primary);
            min-width: 24px;
        }

        /* Recommendations */
        .rec-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
        }

        .rec-item {
            background: #fbfbfd;
            padding: 16px;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
        }

        .rec-title {
            font-weight: 600;
            margin-bottom: 4px;
            display: block;
        }

        /* Interactive Controls */
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            background: white;
            padding: 16px;
            border-radius: 16px;
        }

        select {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #d2d2d7;
            font-size: 14px;
            min-width: 200px;
            outline: none;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .comparison-table th {
            text-align: left;
            padding: 12px;
            border-bottom: 2px solid #eee;
            color: var(--secondary);
        }
        
        .comparison-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        .vs-badge {
            background: var(--primary);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            margin-left: 8px;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            color: var(--secondary);
            font-size: 12px;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1>üìä Parent ASIN Intelligence</h1>
            <div style="color: var(--secondary); margin-top: 4px;">Brand: <strong id="brand-name">Loading...</strong></div>
        </div>
        <span class="date-badge" id="report-date">Loading...</span>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('static')">üìù Strategic Report</button>
        <button class="tab-btn" onclick="switchTab('interactive')">‚ö° Interactive Comparator</button>
    </div>

    <!-- TAB 1: STATIC REPORT -->
    <div id="static-tab" class="section-content active">
        
        <!-- KPI Cards -->
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-label">Click Share Trend</div>
                <div class="kpi-value trend-down">6.75% üìâ</div>
                <div style="font-size: 12px; color: #888;">Down from 8.86% last week</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Organic Efficiency</div>
                <div class="kpi-value" style="color: #f5a623;">Rank #7</div>
                <div style="font-size: 12px; color: #888;">Top competitor ranks #2</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Price Positioning</div>
                <div class="kpi-value trend-down">Premium</div>
                <div style="font-size: 12px; color: #888;">102% higher than market avg</div>
            </div>
        </div>

        <!-- Section 1: Global Trend -->
        <div class="card">
            <h2><span class="material-icons">trending_up</span> 1. Global Parent Trend (Clicks & Share)</h2>
            <div id="trend_chart_div" class="chart-container"></div>
            <p style="font-size: 13px; color: #666; margin-top: 10px;">
                <strong>Analysis:</strong> Total category interest dropped significantly in the last week. Our brand followed the market trend but also lost relative share (from 8.9% to 6.8%), indicating a double negative impact (market contraction + share loss).
            </p>
        </div>

        <!-- Section 2: Competitiveness -->
        <div class="card">
            <h2><span class="material-icons">pie_chart</span> 2. Brand Competitiveness Share</h2>
            <div id="brand_chart_div" class="chart-container"></div>
            <p style="font-size: 13px; color: #666; margin-top: 10px;">
                <strong>Key Rival:</strong> Sevenhills Wholefoods is the dominant player, growing share from 17.5% to 24.5% while we declined. They are capturing the demand we are losing.
            </p>
        </div>

        <!-- Section 4: Efficiency -->
        <div class="card">
            <h2><span class="material-icons">scatter_plot</span> 4. Efficiency: Rank vs Click Share</h2>
            <div id="scatter_chart_div" class="chart-container"></div>
            <p style="font-size: 13px; color: #666; margin-top: 10px;">
                <strong>Efficiency Gap:</strong> We are at Rank 7 with ~4% share (per ASIN). Competitors like "Kaba" are at Rank 2 with 9% share. Our high price is likely preventing higher click-through despite decent ranking.
            </p>
        </div>

        <!-- Section 5: Conclusions -->
        <div class="card" style="border-left: 5px solid var(--primary);">
            <h2><span class="material-icons">lightbulb</span> 5. Strategic Insights & Actions</h2>
            
            <div style="display: flex; flex-wrap: wrap; gap: 30px;">
                <div style="flex: 1; min-width: 300px;">
                    <h3 style="font-size: 16px; margin-bottom: 10px;">üí° Key Insights</h3>
                    <ul class="insight-list" id="insights-container">
                        <!-- Injected via JS -->
                    </ul>
                </div>

                <div style="flex: 1; min-width: 300px;">
                    <h3 style="font-size: 16px; margin-bottom: 10px;">üöÄ Recommendations</h3>
                    <div class="rec-grid">
                        <div class="rec-item">
                            <span class="rec-title">Price Strategy Audit</span>
                            Review the +102% premium. If value prop doesn't justify it (e.g. organic certification), consider a temporary 10-15% coupon to regain velocity.
                        </div>
                        <div class="rec-item">
                            <span class="rec-title">Defend against Sevenhills</span>
                            Sevenhills is eating market share. Target their ASINs with SD/SP ads to intercept traffic before they convert.
                        </div>
                        <div class="rec-item">
                            <span class="rec-title">Content Optimization</span>
                            With Rank 7 but low clicks, the Main Image or Title might not be attractive enough vs cheaper options. Test new creatives.
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- TAB 2: INTERACTIVE COMPARATOR -->
    <div id="interactive-tab" class="section-content">
        <div class="card">
            <h2>‚ö° Head-to-Head Comparator</h2>
            
            <div class="controls">
                <div>
                    <label style="display:block; font-size:12px; color:#888; margin-bottom:4px;">Select Week</label>
                    <select id="weekSelector" onchange="updateInteractive()"></select>
                </div>
                <div>
                    <label style="display:block; font-size:12px; color:#888; margin-bottom:4px;">Compare vs Competitor</label>
                    <select id="compSelector" onchange="updateInteractive()"></select>
                </div>
            </div>

            <div id="interactive-dashboard">
                <!-- Dynamic Content injected here -->
                <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                    <div style="flex:1; background:#f0f5ff; padding:15px; border-radius:12px;">
                        <h4 style="margin:0 0 10px 0; color: var(--primary);">Naturalebio (Us)</h4>
                        <div id="us-stats">Loading...</div>
                    </div>
                    <div style="flex:1; background:#fff0f0; padding:15px; border-radius:12px;">
                        <h4 style="margin:0 0 10px 0; color: #d32f2f;" id="comp-name-header">Competitor</h4>
                        <div id="comp-stats">Loading...</div>
                    </div>
                </div>
                
                <h3 style="font-size: 16px; border-bottom: 1px solid #eee; padding-bottom: 8px;">Detailed Metrics</h3>
                <div id="comparison-table-div"></div>
            </div>
        </div>
    </div>

    <footer>
        Generated automatically by Market Intelligence AI ‚Ä¢ Based on provided CSV Data
    </footer>
</div>

<script>
    // --- 1. DATA INJECTION ---
    // Processed data from Python Analysis
    const marketData = {
        "trend_chart": [["Week", "Our Clicks", "Competitor Clicks", "Our Click Share (%)"], ["2025-52", 267.2, 2748.4, 8.86], ["2026-01", 121.2, 1675.1, 6.75]], 
        "brand_chart": [["Week", "Naturalebio", "Sevenhills Wholefoods", "Vom-Achterhof", "Kaba", "Others"], ["2025-52", 8.86, 17.5, 15.06, 16.01, 42.57], ["2026-01", 6.75, 24.52, 16.27, 15.16, 37.3]], 
        "scatter_chart": [["ID", "Organic Rank", "Click Share", "Type", "Size"], ["Sevenhills Wholefoods...", 6, 3.55, "Competitor", 1], ["Sevenhills Wholefoods...", 4, 5.42, "Competitor", 1], ["Sevenhills Wholefoods...", 4, 5.42, "Competitor", 1], ["Alnatura Bio Kakao...", 2, 8.78, "Competitor", 1], ["Kakao Pulver Bio 100...", 11, 3.23, "Competitor", 1], ["Kakao Pulver Bio 500...", 14, 6.32, "Competitor", 1], ["NaturaleBio Kakao...", 7, 3.96, "Our Brand", 1], ["Cortegas Cacao Puro...", 7, 4.04, "Competitor", 1], ["Nestl√© Nesquik...", 8, 4.04, "Competitor", 1], ["Kaba Choco...", 2, 8.9, "Competitor", 1], ["Suchard Express...", 6, 5.03, "Competitor", 1]], 
        "raw_data": [{"week_date": "2026-01", "processed_brand": "Sevenhills Wholefoods", "product_title": "Sevenhills Wholefoods Bio Kakaopulver 500g", "click_share": 3.55, "price": 19.57, "average_organic_rank": 6, "is_yaba_asin": "N"}, {"week_date": "2026-01", "processed_brand": "Sevenhills Wholefoods", "product_title": "Sevenhills Wholefoods Bio Kakaopulver 1kg", "click_share": 5.42, "price": 32.62, "average_organic_rank": 4, "is_yaba_asin": "N"}, {"week_date": "2026-01", "processed_brand": "Alnatura", "product_title": "Alnatura Bio Kakao schwach ent√∂lt", "click_share": 8.78, "price": 5.21, "average_organic_rank": 2, "is_yaba_asin": "N"}, {"week_date": "2026-01", "processed_brand": "Vom-Achterhof", "product_title": "Kakao Pulver Bio 1000g", "click_share": 3.23, "price": 34.68, "average_organic_rank": 11, "is_yaba_asin": "N"}, {"week_date": "2026-01", "processed_brand": "Vom-Achterhof", "product_title": "Kakao Pulver Bio 500g", "click_share": 6.32, "price": 23.81, "average_organic_rank": 14, "is_yaba_asin": "N"}, {"week_date": "2026-01", "processed_brand": "Naturalebio", "product_title": "NaturaleBio Kakao Pulver Bio 1kg", "click_share": 3.96, "price": 34.79, "average_organic_rank": 7, "is_yaba_asin": "Y"}, {"week_date": "2026-01", "processed_brand": "Cortegas", "product_title": "Cortegas Cacao Puro", "click_share": 4.04, "price": 10.55, "average_organic_rank": 7, "is_yaba_asin": "N"}, {"week_date": "2026-01", "processed_brand": "Nesquik", "product_title": "Nestl√© Nesquik Original", "click_share": 4.04, "price": 6.27, "average_organic_rank": 8, "is_yaba_asin": "N"}, {"week_date": "2026-01", "processed_brand": "Kaba", "product_title": "Kaba Choco 400g Beutel", "click_share": 8.9, "price": 3.25, "average_organic_rank": 2, "is_yaba_asin": "N"}, {"week_date": "2026-01", "processed_brand": "Suchard Express", "product_title": "Suchard Express 400g Beutel", "click_share": 5.03, "price": 3.47, "average_organic_rank": 6, "is_yaba_asin": "N"}, {"week_date": "2025-52", "processed_brand": "Sevenhills Wholefoods", "product_title": "Sevenhills Wholefoods Bio Kakaopulver 1kg", "click_share": 4.76, "price": 30.72, "average_organic_rank": 4, "is_yaba_asin": "N"}, {"week_date": "2025-52", "processed_brand": "Naturalebio", "product_title": "NaturaleBio Kakao Pulver Bio 1kg", "click_share": 4.82, "price": 32.77, "average_organic_rank": 5, "is_yaba_asin": "Y"}], 
        "our_brand": "Naturalebio", 
        "top_competitors": ["Sevenhills Wholefoods", "Vom-Achterhof", "Kaba"], 
        "insights": ["Global Trend: Our click share is down by 2.11% in the last week (2026-01).", "Price Positioning: We are priced 102.2% higher than the average competitor.", "Promo Impact: ASINs with deals averaged 0% share vs 5.3% for those without (No active deals)."], 
        "latest_week": "2026-01"
    };

    // --- 2. INITIALIZATION ---
    document.getElementById('brand-name').textContent = marketData.our_brand;
    document.getElementById('report-date').textContent = 'Week ' + marketData.latest_week;

    // Populate Insights
    const insightsContainer = document.getElementById('insights-container');
    marketData.insights.forEach(text => {
        const li = document.createElement('li');
        li.innerHTML = `<span class="material-icons insight-icon">insights</span><span>${text}</span>`;
        insightsContainer.appendChild(li);
    });

    // Populate Selectors for Interactive Tab
    const weeks = [...new Set(marketData.raw_data.map(d => d.week_date))].sort().reverse();
    const competitors = marketData.top_competitors;
    
    const weekSel = document.getElementById('weekSelector');
    weeks.forEach(w => {
        const opt = document.createElement('option');
        opt.value = w;
        opt.textContent = w;
        weekSel.appendChild(opt);
    });

    const compSel = document.getElementById('compSelector');
    competitors.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c;
        opt.textContent = c;
        compSel.appendChild(opt);
    });

    // --- 3. GOOGLE CHARTS LOGIC ---
    google.charts.load('current', {'packages':['corechart', 'bar']});
    google.charts.setOnLoadCallback(drawDashboard);

    function drawDashboard() {
        drawTrendChart();
        drawBrandChart();
        drawScatterChart();
        updateInteractive(); // Initial load
    }

    function drawTrendChart() {
        var data = google.visualization.arrayToDataTable(marketData.trend_chart);
        var options = {
            vAxis: {title: 'Clicks'},
            hAxis: {title: 'Week'},
            seriesType: 'bars',
            series: {2: {type: 'line', targetAxisIndex: 1}},
            vAxes: {0: {title: 'Volume'}, 1: {title: 'Share %', format: '#\'%\''}},
            colors: ['#0071e3', '#a1a1a6', '#ff3b30'],
            legend: {position: 'bottom'},
            animation: {startup: true, duration: 1000, easing: 'out'},
            backgroundColor: 'transparent'
        };
        var chart = new google.visualization.ComboChart(document.getElementById('trend_chart_div'));
        chart.draw(data, options);
    }

    function drawBrandChart() {
        var data = google.visualization.arrayToDataTable(marketData.brand_chart);
        var options = {
            curveType: 'function',
            legend: { position: 'bottom' },
            colors: ['#0071e3', '#ff3b30', '#ff9500', '#34c759', '#d2d2d7'],
            vAxis: { title: 'Click Share %' },
            lineWidth: 3,
            backgroundColor: 'transparent'
        };
        var chart = new google.visualization.LineChart(document.getElementById('brand_chart_div'));
        chart.draw(data, options);
    }

    function drawScatterChart() {
        var data = google.visualization.arrayToDataTable(marketData.scatter_chart);
        var options = {
            title: 'Organic Rank (X) vs Click Share (Y) - Bubble Size Fixed',
            hAxis: {title: 'Organic Rank (Lower is Better)', direction: 1}, // Normally 1 is better, keeping std axis
            vAxis: {title: 'Click Share %'},
            legend: {position: 'bottom'},
            colors: ['#86868b', '#0071e3'], // Comp gray, Us Blue
            bubble: {textStyle: {fontSize: 10}},
            backgroundColor: 'transparent'
        };
        var chart = new google.visualization.ScatterChart(document.getElementById('scatter_chart_div'));
        chart.draw(data, options);
    }

    // --- 4. INTERACTIVE TAB LOGIC ---
    function updateInteractive() {
        const selectedWeek = document.getElementById('weekSelector').value;
        const selectedComp = document.getElementById('compSelector').value;
        
        // Filter Data
        const weekData = marketData.raw_data.filter(d => d.week_date === selectedWeek);
        const ourData = weekData.filter(d => d.is_yaba_asin === 'Y');
        const compData = weekData.filter(d => d.processed_brand === selectedComp);

        // Update Header
        document.getElementById('comp-name-header').textContent = selectedComp;

        // Calc Stats Helper
        const calcAvg = (arr, key) => {
            if (!arr.length) return 0;
            return (arr.reduce((acc, curr) => acc + (curr[key] || 0), 0) / arr.length).toFixed(2);
        };

        // Render Cards
        const renderStats = (data, containerId) => {
            const price = calcAvg(data, 'price');
            const share = calcAvg(data, 'click_share');
            const rank = calcAvg(data, 'average_organic_rank');
            
            document.getElementById(containerId).innerHTML = `
                <div style="font-size:24px; font-weight:700;">${share}% <span style="font-size:12px; font-weight:400; color:#666;">Share</span></div>
                <div style="margin-top:8px;">Price: <strong>‚Ç¨${price}</strong></div>
                <div>Avg Rank: <strong>${rank}</strong></div>
                <div style="font-size:12px; color:#888; margin-top:5px;">ASINs: ${data.length}</div>
            `;
        };

        renderStats(ourData, 'us-stats');
        renderStats(compData, 'comp-stats');

        // Render Comparison Table
        let tableHtml = `<table class="comparison-table"><thead><tr><th>Product Title</th><th>Brand</th><th>Price</th><th>Rank</th><th>Share</th></tr></thead><tbody>`;
        
        [...ourData, ...compData].sort((a,b) => b.click_share - a.click_share).forEach(item => {
            const isUs = item.is_yaba_asin === 'Y';
            const rowStyle = isUs ? 'background:#f0f5ff;' : '';
            tableHtml += `
                <tr style="${rowStyle}">
                    <td style="font-size:13px;">${item.product_title.substring(0, 40)}... ${isUs ? '<span class="vs-badge">YOU</span>' : ''}</td>
                    <td>${item.processed_brand}</td>
                    <td>‚Ç¨${parseFloat(item.price).toFixed(2)}</td>
                    <td>${item.average_organic_rank}</td>
                    <td><strong>${item.click_share}%</strong></td>
                </tr>
            `;
        });
        tableHtml += '</tbody></table>';
        document.getElementById('comparison-table-div').innerHTML = tableHtml;
    }

    // --- 5. UI HELPERS ---
    function switchTab(tabId) {
        document.querySelectorAll('.section-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        
        document.getElementById(tabId + '-tab').classList.add('active');
        event.target.classList.add('active');
        
        // Redraw charts if unhidden
        if(tabId === 'static') {
            drawDashboard();
        }
    }
</script>

</body>
</html>