<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Inteligencia de Mercado: Cacao Powder</title>
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Google Charts -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
        :root {
            --primary: #4285F4; /* Azul Google/NaturaleBio */
            --success: #34A853;
            --warning: #FBBC05;
            --danger: #EA4335;
            --gray-50: #F8F9FA;
            --gray-100: #F1F3F4;
            --gray-200: #E8EAED;
            --gray-700: #5F6368;
            --gray-900: #202124;
            --surface: #FFFFFF;
            --shadow: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
            --radius: 12px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--gray-50);
            color: var(--gray-900);
            margin: 0;
            padding: 0;
            line-height: 1.5;
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        header {
            background: var(--surface);
            padding: 24px 0;
            box-shadow: 0 1px 0 var(--gray-200);
            margin-bottom: 24px;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; font-size: 24px; font-weight: 600; }
        h2 { font-size: 18px; font-weight: 500; margin-bottom: 16px; color: var(--gray-700); }
        h3 { font-size: 16px; font-weight: 600; margin-bottom: 12px; }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 16px;
            border-bottom: 1px solid var(--gray-200);
            margin-bottom: 24px;
        }

        .tab-btn {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            font-weight: 500;
            color: var(--gray-700);
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Cards & Grid */
        .grid {
            display: grid;
            gap: 24px;
            grid-template-columns: repeat(12, 1fr);
            margin-bottom: 24px;
        }

        .col-12 { grid-column: span 12; }
        .col-8 { grid-column: span 8; }
        .col-6 { grid-column: span 6; }
        .col-4 { grid-column: span 4; }

        @media (max-width: 768px) {
            .col-8, .col-6, .col-4 { grid-column: span 12; }
        }

        .card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            height: 100%;
            box-sizing: border-box;
        }

        /* Metrics */
        .metric-value { font-size: 32px; font-weight: 700; color: var(--primary); }
        .metric-label { font-size: 14px; color: var(--gray-700); }
        .trend-up { color: var(--success); font-size: 14px; display: flex; align-items: center; }
        .trend-down { color: var(--danger); font-size: 14px; display: flex; align-items: center; }
        .material-icons.sm { font-size: 16px; margin-right: 4px; }

        /* Insights List */
        ul.insights-list {
            padding-left: 20px;
            margin: 0;
        }
        ul.insights-list li {
            margin-bottom: 8px;
            color: var(--gray-700);
        }

        /* Form Elements */
        select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
            font-size: 14px;
            outline: none;
            background: var(--surface);
            width: 100%;
        }

        /* Comparator Table */
        .comp-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        .comp-table th { text-align: left; color: var(--gray-700); padding: 8px; border-bottom: 1px solid var(--gray-200); }
        .comp-table td { padding: 12px 8px; border-bottom: 1px solid var(--gray-100); }
        .comp-table .winner { color: var(--success); font-weight: 600; }
        .comp-table .loser { color: var(--danger); }

        /* Custom Styles for Charts */
        .chart-container {
            width: 100%;
            height: 300px;
        }
        .chart-container-lg {
            width: 100%;
            height: 400px;
        }

        /* Chips */
        .chip {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            margin-right: 8px;
        }
        .chip-blue { background: #E8F0FE; color: #1967D2; }
        .chip-green { background: #E6F4EA; color: #137333; }
        
        .section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            color: var(--primary);
            font-weight: 600;
        }
    </style>
</head>
<body>

    <header>
        <div class="header-content">
            <div>
                <h1>Parent ASIN Analysis: Cacao Powder</h1>
                <span class="metric-label" id="reporting-date">Generado: 2026-01-03</span>
            </div>
            <div style="text-align: right;">
                <div class="chip chip-blue" id="my-brand-badge">Mi Marca: Detectando...</div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Navigation -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('static')">1. Reporte Estrat√©gico</button>
            <button class="tab-btn" onclick="switchTab('interactive')">2. Comparador Interactivo</button>
        </div>

        <!-- Pesta√±a 1: Reporte Est√°tico -->
        <div id="tab-static" class="tab-content active">
            
            <!-- KPI Summary -->
            <div class="grid">
                <div class="col-4 card">
                    <h3>Click Share (√öltima Semana)</h3>
                    <div id="kpi-share" class="metric-value">--%</div>
                    <div id="kpi-share-trend" class="trend-down">Calculando...</div>
                </div>
                <div class="col-4 card">
                    <h3>Organic Rank Promedio</h3>
                    <div id="kpi-rank" class="metric-value">--</div>
                    <div id="kpi-rank-trend" class="trend-down">Posici√≥n promedio</div>
                </div>
                <div class="col-4 card">
                    <h3>Visibilidad (Deals/Badges)</h3>
                    <div style="margin-top:8px">
                        <div style="display:flex; justify-content:space-between; margin-bottom:4px">
                            <span>Deals:</span> <strong id="kpi-deals">0</strong>
                        </div>
                        <div style="display:flex; justify-content:space-between;">
                            <span>Amazon Choice:</span> <strong id="kpi-choice">0</strong>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n 1: Tendencia Global -->
            <div class="grid">
                <div class="col-12 card">
                    <div class="section-title">
                        <span class="material-icons">trending_up</span>
                        1. Tendencia Global del Parent (Volumen & Share)
                    </div>
                    <div id="chart_global_trend" class="chart-container-lg"></div>
                    <p style="font-size:13px; color:#666; margin-top:10px;">
                        <em>Interpretaci√≥n:</em> Las barras representan el volumen estimado de tr√°fico (Clicks Proxy). La l√≠nea muestra nuestro Share de Clicks frente a la competencia.
                    </p>
                </div>
            </div>

            <!-- Secci√≥n 2: Competitividad -->
            <div class="grid">
                <div class="col-8 card">
                    <div class="section-title">
                        <span class="material-icons">pie_chart</span>
                        2. Competitividad de Marca (Share Semanal)
                    </div>
                    <div id="chart_brand_comp" class="chart-container-lg"></div>
                </div>
                <div class="col-4 card">
                    <h3>Top Competidores (Share Avg)</h3>
                    <div id="top-competitors-list" style="margin-top:16px;">
                        <!-- JS Inserted -->
                    </div>
                </div>
            </div>

            <!-- Secci√≥n 3: Palancas -->
            <div class="grid">
                <div class="col-6 card">
                    <div class="section-title">
                        <span class="material-icons">tune</span>
                        3. Palancas: Impacto del Precio
                    </div>
                    <p class="metric-label">Comparativa de Precio vs Share (Promedio del periodo)</p>
                    <div id="chart_price_scatter" class="chart-container"></div>
                </div>
                <div class="col-6 card">
                    <div class="section-title">
                        <span class="material-icons">local_offer</span>
                        Impacto de Promociones
                    </div>
                    <ul class="insights-list" id="promo-insights">
                        <!-- JS Inserted -->
                    </ul>
                </div>
            </div>

            <!-- Secci√≥n 4: Eficiencia -->
            <div class="grid">
                <div class="col-12 card">
                    <div class="section-title">
                        <span class="material-icons">speed</span>
                        4. Eficiencia: Organic Rank vs Click Share
                    </div>
                    <div id="chart_efficiency" class="chart-container-lg"></div>
                    <p style="font-size:13px; color:#666; margin-top:10px;">
                        <strong>Cuadrante Superior Izquierdo (Alta Eficiencia):</strong> Buen Share con mal Rank (Marca fuerte/Precio).<br>
                        <strong>Cuadrante Inferior Derecho (Baja Eficiencia):</strong> Buen Rank pero poco Share (Listing pobre/Precio alto).
                    </p>
                </div>
            </div>

            <!-- Secci√≥n 5 & 6: Conclusiones -->
            <div class="grid">
                <div class="col-6 card" style="border-left: 4px solid var(--primary);">
                    <h3>üí° 5. Conclusiones Clave</h3>
                    <ul class="insights-list" id="key-conclusions">
                        <!-- JS Logic -->
                    </ul>
                </div>
                <div class="col-6 card" style="border-left: 4px solid var(--success);">
                    <h3>üöÄ Recomendaciones Accionables</h3>
                    <ul class="insights-list" id="key-recommendations">
                        <!-- JS Logic -->
                    </ul>
                </div>
            </div>
            
            <div class="card">
                <h3>üîç Other Insights (Anomal√≠as detectadas)</h3>
                <p id="other-insights-text" style="color: var(--gray-700); font-size: 14px;">
                    Analizando patrones de competidores emergentes...
                </p>
            </div>

        </div>

        <!-- Pesta√±a 2: Interactivo -->
        <div id="tab-interactive" class="tab-content">
            <div class="grid">
                <div class="col-4 card">
                    <h3>Configuraci√≥n</h3>
                    <div style="margin-bottom: 16px;">
                        <label class="metric-label">Semana de An√°lisis</label>
                        <select id="select-week" onchange="updateInteractive()"></select>
                    </div>
                    <div>
                        <label class="metric-label">Competidor a Comparar</label>
                        <select id="select-competitor" onchange="updateInteractive()"></select>
                    </div>
                </div>
                <div class="col-8 card">
                    <h3>Cara a Cara: Nosotros vs Competencia</h3>
                    <table class="comp-table">
                        <thead>
                            <tr>
                                <th>M√©trica</th>
                                <th>NaturaleBio (Yo)</th>
                                <th id="th-comp-name">Competidor</th>
                                <th>Diferencia</th>
                            </tr>
                        </thead>
                        <tbody id="interactive-tbody">
                            <!-- JS filled -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="grid">
                <div class="col-12 card">
                    <h3>Evoluci√≥n Comparada: Rank & Precio</h3>
                    <div id="chart_interactive_trend" class="chart-container-lg"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- DATA & LOGIC -->
    <script type="text/javascript">
        // INYECCI√ìN DE DATOS PROCESADOS (Desde Python Interpreter)
        const marketData = [
  {
    "week_date": "2026-01",
    "parent_asin": "Cacao powder",
    "asin": "B01M6BB18S",
    "product_title": "Alnatura Bio Kakao schwach ent√∂lt, 125g",
    "real_brand": "Alnatura",
    "is_yaba_asin": "N",
    "click_share": 8.78,
    "average_organic_rank": 2.0,
    "price": 5.2125,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 4,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2026-01",
    "parent_asin": "Cacao powder",
    "asin": "B0BG2ZNJLT",
    "product_title": "Cortegas Cacao Puro - 100% Kakaopulver f√ºr hochwer...",
    "real_brand": "Cortegas",
    "is_yaba_asin": "N",
    "click_share": 4.04,
    "average_organic_rank": 7.0,
    "price": 10.55,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2026-01",
    "parent_asin": "Cacao powder",
    "asin": "B0D5QZYXPW",
    "product_title": "Kaba Choco 400g Beutel Trinkpulver, das Original K...",
    "real_brand": "Kaba",
    "is_yaba_asin": "N",
    "click_share": 8.9,
    "average_organic_rank": 2.0,
    "price": 3.2525,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 2,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2026-01",
    "parent_asin": "Cacao powder",
    "asin": "B0768L7FV1",
    "product_title": "Kakao Pulver Bio 1000g | Kakao-Pulver mit feinstem...",
    "real_brand": "Vom Achterhof",
    "is_yaba_asin": "N",
    "click_share": 3.23,
    "average_organic_rank": 11.0,
    "price": 34.6875,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2026-01",
    "parent_asin": "Cacao powder",
    "asin": "B0768LH1CP",
    "product_title": "Kakao Pulver Bio 500g | Kakao-Pulver mit feinstem ...",
    "real_brand": "Vom Achterhof",
    "is_yaba_asin": "N",
    "click_share": 6.32,
    "average_organic_rank": 14.0,
    "price": 23.81,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2026-01",
    "parent_asin": "Cacao powder",
    "asin": "B07DFPSNGJ",
    "product_title": "NaturaleBio Kakao Pulver Bio 1kg. Organic Cacao Po...",
    "real_brand": "NaturaleBio",
    "is_yaba_asin": "Y",
    "click_share": 3.96,
    "average_organic_rank": 7.0,
    "price": 34.7975,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2026-01",
    "parent_asin": "Cacao powder",
    "asin": "B0CX24HT4W",
    "product_title": "Nestl√© Nesquik Original kakaohaltiges Getr√§nkepulv...",
    "real_brand": "Nesquik",
    "is_yaba_asin": "N",
    "click_share": 4.04,
    "average_organic_rank": 8.0,
    "price": 6.2775,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2026-01",
    "parent_asin": "Cacao powder",
    "asin": "B00M423I92",
    "product_title": "Sevenhills Wholefoods Bio Kakaopulver 1kg, Rein un...",
    "real_brand": "Sevenhills Wholefoods",
    "is_yaba_asin": "N",
    "click_share": 5.42,
    "average_organic_rank": 4.0,
    "price": 32.62,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2026-01",
    "parent_asin": "Cacao powder",
    "asin": "B00M423I92",
    "product_title": "Sevenhills Wholefoods Bio Kakaopulver 1kg, Rein un...",
    "real_brand": "Sevenhills Wholefoods",
    "is_yaba_asin": "N",
    "click_share": 5.42,
    "average_organic_rank": 4.0,
    "price": 32.62,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2026-01",
    "parent_asin": "Cacao powder",
    "asin": "B00944FKNK",
    "product_title": "Sevenhills Wholefoods Bio Kakaopulver 500g, Rein u...",
    "real_brand": "Sevenhills Wholefoods",
    "is_yaba_asin": "N",
    "click_share": 3.55,
    "average_organic_rank": 6.0,
    "price": 19.57,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2026-01",
    "parent_asin": "Cacao powder",
    "asin": "B0D5R1W596",
    "product_title": "Suchard Express 400g Beutel, Getr√§nkepulver f√ºr he...",
    "real_brand": "Suchard",
    "is_yaba_asin": "N",
    "click_share": 5.03,
    "average_organic_rank": 6.0,
    "price": 3.47,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-52",
    "parent_asin": "Cacao powder",
    "asin": "B01M6BB18S",
    "product_title": "Alnatura Bio Kakao schwach ent√∂lt, 125g",
    "real_brand": "Alnatura",
    "is_yaba_asin": "N",
    "click_share": 7.64,
    "average_organic_rank": 2.0,
    "price": 4.907142857,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 5,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-52",
    "parent_asin": "Cacao powder",
    "asin": "B000W45AZY",
    "product_title": "Caotina Dark dunkle Trinkschokolade - Kakao-Pulver...",
    "real_brand": "Caotina",
    "is_yaba_asin": "N",
    "click_share": 2.93,
    "average_organic_rank": 12.0,
    "price": 9.722857143,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-52",
    "parent_asin": "Cacao powder",
    "asin": "B0BG2ZNJLT",
    "product_title": "Cortegas Cacao Puro - 100% Kakaopulver f√ºr hochwer...",
    "real_brand": "Cortegas",
    "is_yaba_asin": "N",
    "click_share": 3.97,
    "average_organic_rank": 6.0,
    "price": 9.937142857,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-52",
    "parent_asin": "Cacao powder",
    "asin": "B0D5QZYXPW",
    "product_title": "Kaba Choco 400g Beutel Trinkpulver, das Original K...",
    "real_brand": "Kaba",
    "is_yaba_asin": "N",
    "click_share": 8.71,
    "average_organic_rank": 2.0,
    "price": 2.765714286,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 5,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-52",
    "parent_asin": "Cacao powder",
    "asin": "B0768L7FV1",
    "product_title": "Kakao Pulver Bio 1000g | Kakao-Pulver mit feinstem...",
    "real_brand": "Vom Achterhof",
    "is_yaba_asin": "N",
    "click_share": 3.34,
    "average_organic_rank": 14.0,
    "price": 32.67,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-52",
    "parent_asin": "Cacao powder",
    "asin": "B0768LH1CP",
    "product_title": "Kakao Pulver Bio 500g | Kakao-Pulver mit feinstem ...",
    "real_brand": "Vom Achterhof",
    "is_yaba_asin": "N",
    "click_share": 4.85,
    "average_organic_rank": 14.0,
    "price": 22.42571429,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-52",
    "parent_asin": "Cacao powder",
    "asin": "B07DFPSNGJ",
    "product_title": "NaturaleBio Kakao Pulver Bio 1kg. Organic Cacao Po...",
    "real_brand": "NaturaleBio",
    "is_yaba_asin": "Y",
    "click_share": 4.82,
    "average_organic_rank": 5.0,
    "price": 32.77285714,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-52",
    "parent_asin": "Cacao powder",
    "asin": "B0CX24HT4W",
    "product_title": "Nestl√© Nesquik Original kakaohaltiges Getr√§nkepulv...",
    "real_brand": "Nesquik",
    "is_yaba_asin": "N",
    "click_share": 3.56,
    "average_organic_rank": 9.0,
    "price": 5.911428571,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-52",
    "parent_asin": "Cacao powder",
    "asin": "B00M423I92",
    "product_title": "Sevenhills Wholefoods Bio Kakaopulver 1kg, Rein un...",
    "real_brand": "Sevenhills Wholefoods",
    "is_yaba_asin": "N",
    "click_share": 4.76,
    "average_organic_rank": 4.0,
    "price": 30.72428571,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-52",
    "parent_asin": "Cacao powder",
    "asin": "B00M423I92",
    "product_title": "Sevenhills Wholefoods Bio Kakaopulver 1kg, Rein un...",
    "real_brand": "Sevenhills Wholefoods",
    "is_yaba_asin": "N",
    "click_share": 4.76,
    "average_organic_rank": 4.0,
    "price": 30.72428571,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-52",
    "parent_asin": "Cacao powder",
    "asin": "B0D5R1W596",
    "product_title": "Suchard Express 400g Beutel, Getr√§nkepulver f√ºr he...",
    "real_brand": "Suchard",
    "is_yaba_asin": "N",
    "click_share": 5.06,
    "average_organic_rank": 5.0,
    "price": 3.268571429,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-51",
    "parent_asin": "Cacao powder",
    "asin": "B01M6BB18S",
    "product_title": "Alnatura Bio Kakao schwach ent√∂lt, 125g",
    "real_brand": "Alnatura",
    "is_yaba_asin": "N",
    "click_share": 8.2,
    "average_organic_rank": 1.0,
    "price": 4.55,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 6,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-51",
    "parent_asin": "Cacao powder",
    "asin": "B0BG2ZNJLT",
    "product_title": "Cortegas Cacao Puro - 100% Kakaopulver f√ºr hochwer...",
    "real_brand": "Cortegas",
    "is_yaba_asin": "N",
    "click_share": 4.64,
    "average_organic_rank": 6.0,
    "price": 10.18,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-51",
    "parent_asin": "Cacao powder",
    "asin": "B0D5QZYXPW",
    "product_title": "Kaba Choco 400g Beutel Trinkpulver, das Original K...",
    "real_brand": "Kaba",
    "is_yaba_asin": "N",
    "click_share": 9.39,
    "average_organic_rank": 2.0,
    "price": 2.911428571,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 3,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-51",
    "parent_asin": "Cacao powder",
    "asin": "B0768L7FV1",
    "product_title": "Kakao Pulver Bio 1000g | Kakao-Pulver mit feinstem...",
    "real_brand": "Vom Achterhof",
    "is_yaba_asin": "N",
    "click_share": 3.03,
    "average_organic_rank": 14.0,
    "price": 33.46857143,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-51",
    "parent_asin": "Cacao powder",
    "asin": "B07DFPSNGJ",
    "product_title": "NaturaleBio Kakao Pulver Bio 1kg. Organic Cacao Po...",
    "real_brand": "NaturaleBio",
    "is_yaba_asin": "Y",
    "click_share": 4.27,
    "average_organic_rank": 4.0,
    "price": 33.57428571,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-51",
    "parent_asin": "Cacao powder",
    "asin": "B09584WMRS",
    "product_title": "Nestl√© Feinste Hei√üe Schokolade, Schokoladenpulver...",
    "real_brand": "Nesquik",
    "is_yaba_asin": "N",
    "click_share": 3.2,
    "average_organic_rank": 11.0,
    "price": 5.027142857,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-51",
    "parent_asin": "Cacao powder",
    "asin": "B0CX24HT4W",
    "product_title": "Nestl√© Nesquik Original kakaohaltiges Getr√§nkepulv...",
    "real_brand": "Nesquik",
    "is_yaba_asin": "N",
    "click_share": 3.07,
    "average_organic_rank": 8.0,
    "price": 6.055714286,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-51",
    "parent_asin": "Cacao powder",
    "asin": "B0DLB8RTJL",
    "product_title": "RheinNatur Bio Kakaopulver 1 kg - 100% reiner Kaka...",
    "real_brand": "RheinNatur",
    "is_yaba_asin": "N",
    "click_share": 4.2,
    "average_organic_rank": 33.0,
    "price": 35.99857143,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-51",
    "parent_asin": "Cacao powder",
    "asin": "B00M423I92",
    "product_title": "Sevenhills Wholefoods Bio Kakaopulver 1kg, Rein un...",
    "real_brand": "Sevenhills Wholefoods",
    "is_yaba_asin": "N",
    "click_share": 5.72,
    "average_organic_rank": 4.0,
    "price": 31.47571429,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-51",
    "parent_asin": "Cacao powder",
    "asin": "B00M423I92",
    "product_title": "Sevenhills Wholefoods Bio Kakaopulver 1kg, Rein un...",
    "real_brand": "Sevenhills Wholefoods",
    "is_yaba_asin": "N",
    "click_share": 5.72,
    "average_organic_rank": 4.0,
    "price": 31.47571429,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  },
  {
    "week_date": "2025-51",
    "parent_asin": "Cacao powder",
    "asin": "B0D5R1W596",
    "product_title": "Suchard Express 400g Beutel, Getr√§nkepulver f√ºr he...",
    "real_brand": "Suchard",
    "is_yaba_asin": "N",
    "click_share": 4.22,
    "average_organic_rank": 5.0,
    "price": 3.348571429,
    "weekly_number_of_days_with_deal": 0,
    "weekly_number_of_days_with_coupon": 0,
    "weekly_number_of_days_with_amazon_choice_badge": 0,
    "keywords": "kakaopulver"
  }
];

        // CONFIGURACI√ìN CENTRAL
        const MY_BRAND = "NaturaleBio"; 
        const COLORS = {
            ME: '#4285F4',
            COMP_1: '#EA4335',
            COMP_2: '#FBBC05',
            COMP_3: '#34A853',
            REST: '#9AA0A6'
        };

        // GOOGLE CHARTS INIT
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(initDashboard);

        function initDashboard() {
            processKPIs();
            renderCharts();
            populateControls();
        }

        // --- L√ìGICA DE DATOS ---

        function getUniqueWeeks() {
            return [...new Set(marketData.map(d => d.week_date))].sort();
        }

        function getCompetitors() {
            const brands = [...new Set(marketData.map(d => d.real_brand))];
            return brands.filter(b => b !== MY_BRAND).sort();
        }

        function processKPIs() {
            // Actualizar Badge de Marca
            document.getElementById('my-brand-badge').textContent = `Mi Marca: ${MY_BRAND}`;

            // Datos √∫ltima semana
            const weeks = getUniqueWeeks();
            const lastWeek = weeks[weeks.length - 1];
            const prevWeek = weeks[weeks.length - 2];

            const myDataCurrent = marketData.filter(d => d.real_brand === MY_BRAND && d.week_date === lastWeek);
            const myDataPrev = marketData.filter(d => d.real_brand === MY_BRAND && d.week_date === prevWeek);

            // 1. Share
            const currentShare = myDataCurrent.reduce((sum, d) => sum + d.click_share, 0);
            const prevShare = myDataPrev.reduce((sum, d) => sum + d.click_share, 0);
            
            const shareEl = document.getElementById('kpi-share');
            shareEl.textContent = `${currentShare.toFixed(2)}%`;
            
            const trendEl = document.getElementById('kpi-share-trend');
            if (currentShare > prevShare) {
                trendEl.className = 'trend-up';
                trendEl.innerHTML = `<span class="material-icons sm">trending_up</span> Subiendo (vs ${prevShare.toFixed(2)}%)`;
            } else {
                trendEl.className = 'trend-down';
                trendEl.innerHTML = `<span class="material-icons sm">trending_down</span> Bajando (vs ${prevShare.toFixed(2)}%)`;
            }

            // 2. Rank
            const currentRank = myDataCurrent.length > 0 ? myDataCurrent[0].average_organic_rank : 0;
            const prevRank = myDataPrev.length > 0 ? myDataPrev[0].average_organic_rank : 0;
            
            document.getElementById('kpi-rank').textContent = currentRank > 0 ? currentRank.toFixed(1) : '-';
            const rankTrendEl = document.getElementById('kpi-rank-trend');
            
            if (currentRank < prevRank && currentRank > 0) { // Menor es mejor en Rank
                rankTrendEl.className = 'trend-up';
                rankTrendEl.innerHTML = `<span class="material-icons sm">arrow_upward</span> Mejora (era ${prevRank})`;
            } else if (currentRank > prevRank) {
                rankTrendEl.className = 'trend-down';
                rankTrendEl.innerHTML = `<span class="material-icons sm">arrow_downward</span> Empeora (era ${prevRank})`;
            } else {
                rankTrendEl.innerHTML = 'Sin cambios';
                rankTrendEl.className = 'metric-label';
            }

            // 3. Deals/Badges
            const deals = myDataCurrent.reduce((sum, d) => sum + d.weekly_number_of_days_with_deal, 0);
            const choice = myDataCurrent.reduce((sum, d) => sum + d.weekly_number_of_days_with_amazon_choice_badge, 0);
            document.getElementById('kpi-deals').textContent = deals;
            document.getElementById('kpi-choice').textContent = choice;

            // Generate Insights Text Logic
            generateInsights(currentShare, prevShare, currentRank, prevRank, deals, choice);
        }

        function generateInsights(currShare, prevShare, currRank, prevRank, deals, choice) {
            // Conclusions
            const conclusions = [];
            // Trend
            if (currShare < prevShare) conclusions.push(`üî¥ <strong>P√©rdida de tracci√≥n:</strong> Tu Click Share cay√≥ de ${prevShare.toFixed(2)}% a ${currShare.toFixed(2)}% en la √∫ltima semana.`);
            else conclusions.push(`üü¢ <strong>Ganancia de tracci√≥n:</strong> Click Share subi√≥ a ${currShare.toFixed(2)}%.`);
            
            // Rank Impact
            if (currRank > prevRank) conclusions.push(`üìâ <strong>Ca√≠da en Ranking Org√°nico:</strong> Pasaste de posici√≥n media ${prevRank} a ${currRank}, lo que explica la ca√≠da en tr√°fico.`);
            
            // Competitor Pressure
            conclusions.push(`üõ°Ô∏è <strong>Presi√≥n Competitiva:</strong> Competidores como Kaba y Alnatura mantienen el dominio del Top 3.`);
            
            // Palancas
            if (deals === 0 && choice === 0) conclusions.push(`‚ö†Ô∏è <strong>Ausencia de Promociones:</strong> No tuviste Deals ni Badges activos esta semana, mientras competidores como Alnatura usaron Amazon Choice (4 d√≠as).`);

            // Efficiency
            conclusions.push(`üìä <strong>Eficiencia de Rank:</strong> Tu relaci√≥n Rank/Share indica que, aunque est√°s posicionado, la conversi√≥n a clic es menor que la de l√≠deres como Kaba (que tiene mayor Share con Rank similar).`);

            const ulConc = document.getElementById('key-conclusions');
            ulConc.innerHTML = conclusions.map(c => `<li>${c}</li>`).join('');

            // Recommendations
            const recs = [];
            recs.push(`üè∑Ô∏è <strong>Activar Cupones:</strong> Reactiva cupones para recuperar CTR frente a Kaba/Alnatura.`);
            if (currRank > 5) recs.push(`üîç <strong>SEO en T√≠tulo/Backend:</strong> Revisa keywords "Cacao Powder" ya que tu org√°nico ha ca√≠do a la posici√≥n 7.`);
            recs.push(`üí∞ <strong>Revisi√≥n de Precio:</strong> Tu producto es Premium (~34‚Ç¨). Considera variantes m√°s peque√±as (como Kaba 400g) para reducir la barrera de entrada.`);

            const ulRecs = document.getElementById('key-recommendations');
            ulRecs.innerHTML = recs.map(r => `<li>${r}</li>`).join('');

            // Promo Insights
            const ulPromos = document.getElementById('promo-insights');
            ulPromos.innerHTML = `
                <li><strong>Amazon Choice:</strong> Gran impacto. Alnatura (4 d√≠as) y Kaba (2 d√≠as) dominan el share.</li>
                <li><strong>Precio:</strong> Alta sensibilidad. Los l√≠deres (Kaba, Alnatura) est√°n en el rango de 3-6‚Ç¨ (formato peque√±o), mientras t√∫ est√°s en >30‚Ç¨ (Bulk).</li>
            `;
        }

        // --- RENDERING CHARTS ---

        function renderCharts() {
            drawTrendChart();
            drawBrandCompChart();
            drawEfficiencyChart();
            drawPriceScatter();
        }

        function drawTrendChart() {
            const weeks = getUniqueWeeks();
            const dataTable = [['Semana', 'Volumen Mercado (Clicks Proxy)', 'Mi Click Share (%)']];

            weeks.forEach(week => {
                const weekData = marketData.filter(d => d.week_date === week);
                // Proxy Volumen: Sum(Click Share) * Avg(Search Volume) / 100 ... Simplificado para visualizaci√≥n
                // Asumimos Search Volume constante o tomamos el del primer registro si var√≠a
                const sv = 3000; // Placeholder o derivado de datos si existiera search_volume variable
                const totalShare = weekData.reduce((sum, d) => sum + d.click_share, 0);
                const myShare = weekData.filter(d => d.real_brand === MY_BRAND).reduce((sum, d) => sum + d.click_share, 0);
                
                // Barras = Total "Inter√©s" (Suma de Shares de todos * Constante)
                // L√≠nea = Mi Share
                dataTable.push([week, totalShare * 10, myShare]);
            });

            const data = google.visualization.arrayToDataTable(dataTable);
            const options = {
                seriesType: 'bars',
                series: {1: {type: 'line', color: COLORS.ME, lineWidth: 3}},
                colors: ['#E8EAED'],
                legend: {position: 'bottom'},
                vAxes: {
                    0: {title: 'Volumen Index'},
                    1: {title: 'Mi Share (%)', textStyle: {color: COLORS.ME}}
                }
            };

            const chart = new google.visualization.ComboChart(document.getElementById('chart_global_trend'));
            chart.draw(data, options);
        }

        function drawBrandCompChart() {
            const weeks = getUniqueWeeks();
            const competitors = getCompetitors();
            
            // Identify Top 3 based on total share
            const compShares = {};
            competitors.forEach(c => compShares[c] = 0);
            
            marketData.forEach(d => {
                if (d.real_brand !== MY_BRAND) compShares[d.real_brand] = (compShares[d.real_brand] || 0) + d.click_share;
            });
            
            const top3 = Object.keys(compShares).sort((a,b) => compShares[b] - compShares[a]).slice(0, 3);
            
            // Populate List in HTML
            document.getElementById('top-competitors-list').innerHTML = top3.map((c, i) => 
                `<div style="display:flex; justify-content:space-between; margin-bottom:8px; font-size:14px;">
                    <span>${i+1}. ${c}</span>
                    <strong style="color:var(--gray-700)">Top Tier</strong>
                </div>`
            ).join('');

            // Prepare Chart Data
            const header = ['Semana', MY_BRAND, ...top3, 'Resto'];
            const rows = [];

            weeks.forEach(week => {
                const weekData = marketData.filter(d => d.week_date === week);
                const row = [week];
                
                // Me
                row.push(weekData.filter(d => d.real_brand === MY_BRAND).reduce((s, x) => s + x.click_share, 0));
                
                // Top 3
                let top3Sum = 0;
                top3.forEach(comp => {
                    const val = weekData.filter(d => d.real_brand === comp).reduce((s, x) => s + x.click_share, 0);
                    row.push(val);
                    top3Sum += val;
                });

                // Rest
                const totalShare = weekData.reduce((s, x) => s + x.click_share, 0);
                const myShare = row[1];
                row.push(Math.max(0, totalShare - myShare - top3Sum)); // Resto del mercado

                rows.push(row);
            });

            const data = google.visualization.arrayToDataTable([header, ...rows]);
            const options = {
                curveType: 'function',
                lineWidth: 2,
                colors: [COLORS.ME, COLORS.COMP_1, COLORS.COMP_2, COLORS.COMP_3, COLORS.REST],
                legend: {position: 'bottom'},
                chartArea: {width: '85%', height: '70%'}
            };

            const chart = new google.visualization.LineChart(document.getElementById('chart_brand_comp'));
            chart.draw(data, options);
        }

        function drawEfficiencyChart() {
            // Scatter: X=Rank, Y=Click Share. Color=Brand Type
            const dataTable = [['Rank', 'Click Share', {'type': 'string', 'role': 'style'}, {'type': 'string', 'role': 'tooltip'}]];
            
            const lastWeek = getUniqueWeeks().pop();
            const weekData = marketData.filter(d => d.week_date === lastWeek);

            weekData.forEach(d => {
                const color = d.real_brand === MY_BRAND ? `point {fill-color: ${COLORS.ME}; size: 10}` : `point {fill-color: #999; size: 4}`;
                const label = `${d.real_brand} (Rank: ${d.average_organic_rank}, Share: ${d.click_share}%)`;
                dataTable.push([d.average_organic_rank, d.click_share, color, label]);
            });

            const data = google.visualization.arrayToDataTable(dataTable);
            const options = {
                hAxis: {title: 'Organic Rank (Menor es mejor)', direction: -1}, // Invertir eje
                vAxis: {title: 'Click Share (%)'},
                legend: 'none',
                chartArea: {width: '80%', height: '80%'}
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('chart_efficiency'));
            chart.draw(data, options);
        }

        function drawPriceScatter() {
             // Scatter simple: Precio vs Share Avg
             const brands = [...new Set(marketData.map(d => d.real_brand))];
             const dataTable = [['Precio', 'Avg Share', {'type': 'string', 'role': 'style'}, {'type': 'string', 'role': 'tooltip'}]];

             brands.forEach(brand => {
                 const bData = marketData.filter(d => d.real_brand === brand);
                 const avgPrice = bData.reduce((s, x) => s + x.price, 0) / bData.length;
                 const avgShare = bData.reduce((s, x) => s + x.click_share, 0) / bData.length;
                 
                 let color = '#ccc';
                 if(brand === MY_BRAND) color = COLORS.ME;
                 else if (avgShare > 5) color = COLORS.COMP_1; // High performers

                 dataTable.push([avgPrice, avgShare, `point {fill-color: ${color}}`, `${brand}: ‚Ç¨${avgPrice.toFixed(2)}`]);
             });

             const data = google.visualization.arrayToDataTable(dataTable);
             const options = {
                hAxis: {title: 'Precio (‚Ç¨)'},
                vAxis: {title: 'Avg Click Share (%)'},
                legend: 'none'
             };

             const chart = new google.visualization.ScatterChart(document.getElementById('chart_price_scatter'));
             chart.draw(data, options);
        }

        // --- INTERACTIVITY ---

        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            // Find button by text mostly or index, simpler:
            if(tabId === 'static') {
                document.querySelector('button[onclick*="static"]').classList.add('active');
                document.getElementById('tab-static').classList.add('active');
            } else {
                document.querySelector('button[onclick*="interactive"]').classList.add('active');
                document.getElementById('tab-interactive').classList.add('active');
                updateInteractive(); // Redraw interactive elements
            }
        }

        function populateControls() {
            const weeks = getUniqueWeeks().reverse();
            const comps = getCompetitors();
            
            const weekSel = document.getElementById('select-week');
            weeks.forEach(w => {
                const opt = document.createElement('option');
                opt.value = w;
                opt.text = w;
                weekSel.appendChild(opt);
            });

            const compSel = document.getElementById('select-competitor');
            comps.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.text = c;
                compSel.appendChild(opt);
            });
            // Select biggest competitor by default
            if(comps.length > 0) compSel.value = "Kaba";
        }

        function updateInteractive() {
            const week = document.getElementById('select-week').value;
            const comp = document.getElementById('select-competitor').value;
            if(!week || !comp) return;

            document.getElementById('th-comp-name').textContent = comp;

            // Get Data
            const myRow = marketData.find(d => d.week_date === week && d.real_brand === MY_BRAND) || {};
            const compRow = marketData.find(d => d.week_date === week && d.real_brand === comp) || {};

            // Helper to safe access
            const getVal = (row, key, fix=2) => row[key] !== undefined ? row[key].toFixed(fix) : '-';
            
            const metrics = [
                {k: 'Click Share', id: 'click_share', unit: '%', inverse: false},
                {k: 'Organic Rank', id: 'average_organic_rank', unit: '', inverse: true}, // Lower is better
                {k: 'Precio', id: 'price', unit: '‚Ç¨', inverse: true}, // Lower usually better for sales
                {k: 'Deal Days', id: 'weekly_number_of_days_with_deal', unit: '', inverse: false}
            ];

            const tbody = document.getElementById('interactive-tbody');
            tbody.innerHTML = '';

            metrics.forEach(m => {
                const valMe = myRow[m.id] || 0;
                const valComp = compRow[m.id] || 0;
                let diff = valMe - valComp;
                
                // Color logic
                let diffClass = '';
                // Logic: If inverse (Rank), Lower (negative diff) is Green.
                if (m.inverse) {
                    if (diff < 0) diffClass = 'winner';
                    else if (diff > 0) diffClass = 'loser';
                } else {
                    if (diff > 0) diffClass = 'winner';
                    else if (diff < 0) diffClass = 'loser';
                }

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${m.k}</td>
                    <td>${getVal(myRow, m.id)} ${m.unit}</td>
                    <td>${getVal(compRow, m.id)} ${m.unit}</td>
                    <td class="${diffClass}">${diff > 0 ? '+' : ''}${diff.toFixed(2)}</td>
                `;
                tbody.appendChild(tr);
            });

            drawInteractiveChart(comp);
        }

        function drawInteractiveChart(compName) {
            // Trend Line Chart Comparison
            const weeks = getUniqueWeeks();
            const dataTable = [['Semana', 'Yo (Share)', `${compName} (Share)`]];

            weeks.forEach(w => {
                const myD = marketData.filter(d => d.week_date === w && d.real_brand === MY_BRAND).reduce((s,x)=>s+x.click_share,0);
                const compD = marketData.filter(d => d.week_date === w && d.real_brand === compName).reduce((s,x)=>s+x.click_share,0);
                dataTable.push([w, myD, compD]);
            });

            const data = google.visualization.arrayToDataTable(dataTable);
            const options = {
                title: 'Tendencia Hist√≥rica de Share',
                curveType: 'function',
                colors: [COLORS.ME, COLORS.COMP_1],
                legend: {position: 'bottom'}
            };

            const chart = new google.visualization.LineChart(document.getElementById('chart_interactive_trend'));
            chart.draw(data, options);
        }

    </script>
</body>
</html>