<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Inteligencia de Mercado - Parent ASIN</title>
    
    <!-- Google Charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* CSS Reset & Variables */
        :root {
            --primary-color: #4285F4; /* Google Blue */
            --secondary-color: #34A853; /* Google Green */
            --accent-color: #EA4335; /* Google Red */
            --bg-color: #F8F9FA;
            --card-bg: #FFFFFF;
            --text-primary: #202124;
            --text-secondary: #5F6368;
            --border-radius: 16px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.5;
            padding-bottom: 40px;
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            margin-bottom: 30px;
            text-align: center;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: #fff;
            padding: 5px;
            border-radius: 50px;
            box-shadow: var(--shadow);
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }

        .tab-btn {
            padding: 10px 24px;
            border: none;
            background: none;
            border-radius: 40px;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 2px 4px rgba(66, 133, 244, 0.3);
        }

        /* Grid System */
        .grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .col-12 { grid-column: span 12; }
        .col-6 { grid-column: span 6; }
        .col-4 { grid-column: span 4; }

        @media (max-width: 768px) {
            .col-6, .col-4 { grid-column: span 12; }
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--shadow);
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-container {
            flex-grow: 1;
            min-height: 300px;
            width: 100%;
        }

        /* Metrics */
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .metric-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Insights List */
        .insights-list {
            list-style: none;
        }

        .insights-list li {
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .insights-list li:last-child {
            border-bottom: none;
        }

        .insight-icon {
            color: var(--primary-color);
            margin-top: 2px;
        }

        /* Controls (Tab 2) */
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            background: white;
            padding: 16px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        select {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-family: 'Inter', sans-serif;
            min-width: 200px;
        }

        /* Utility */
        .hidden { display: none; }
        
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .badge-pos { background: #E6F4EA; color: #137333; }
        .badge-neg { background: #FCE8E6; color: #C5221F; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Análisis de Rendimiento: Parent ASIN</h1>
        <p class="subtitle">Inteligencia de Mercado & Competitividad (Últimas 5 Semanas)</p>
    </header>

    <!-- Navigation Tabs -->
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('static')">Reporte Estratégico</button>
        <button class="tab-btn" onclick="switchTab('interactive')">Comparador Interactivo</button>
    </div>

    <!-- TAB 1: STATIC REPORT -->
    <div id="tab-static">
        
        <!-- Section 1: Global Trend -->
        <div class="grid">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span class="material-icons">trending_up</span>
                            1. Tendencia Global del Parent (Tráfico & Cuota)
                        </h2>
                    </div>
                    <div id="chart_global_trend" class="chart-container"></div>
                    <div class="metric-label" style="margin-top: 10px; text-align: center;">
                        <small>Barras: Volumen de Clics | Línea: Click Share Total (%)</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 2: Competitiveness -->
        <div class="grid">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span class="material-icons">pie_chart</span>
                            2. Competitividad de Marca (Share of Voice)
                        </h2>
                    </div>
                    <div id="chart_competitiveness" class="chart-container"></div>
                </div>
            </div>
        </div>

        <!-- Section 3 & 4: Levers & Efficiency -->
        <div class="grid">
            <div class="col-6">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span class="material-icons">rocket_launch</span>
                            3. Impacto de Palancas (Deals/Badges)
                        </h2>
                    </div>
                    <div id="chart_levers" class="chart-container"></div>
                </div>
            </div>
            <div class="col-6">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span class="material-icons">scatter_plot</span>
                            4. Eficiencia (Rank vs Click Share)
                        </h2>
                    </div>
                    <div id="chart_efficiency" class="chart-container"></div>
                </div>
            </div>
        </div>

        <!-- Section 5: Insights & Recommendations -->
        <div class="grid">
            <div class="col-6">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span class="material-icons">lightbulb</span>
                            5. Insights Clave
                        </h2>
                    </div>
                    <ul class="insights-list" id="insights_container">
                        <!-- Populated by JS -->
                    </ul>
                </div>
            </div>
            <div class="col-6">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span class="material-icons">assignment_turned_in</span>
                            Recomendaciones Accionables
                        </h2>
                    </div>
                    <ul class="insights-list" id="recommendations_container">
                        <!-- Populated by JS -->
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB 2: INTERACTIVE COMPARATOR -->
    <div id="tab-interactive" class="hidden">
        <div class="controls">
            <div>
                <label class="metric-label">Seleccionar Semana:</label>
                <select id="select_week" onchange="updateInteractiveCharts()"></select>
            </div>
            <div>
                <label class="metric-label">Comparar con Competidor:</label>
                <select id="select_competitor" onchange="updateInteractiveCharts()"></select>
            </div>
        </div>

        <div class="grid">
            <div class="col-6">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Comparativa de Precio Promedio</h2>
                    </div>
                    <div id="chart_int_price" class="chart-container"></div>
                </div>
            </div>
            <div class="col-6">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Share vs Visibilidad (Rank)</h2>
                    </div>
                    <div id="chart_int_share" class="chart-container"></div>
                </div>
            </div>
        </div>
        
        <div class="grid">
             <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Detalle de ASINs (Tabla)</h2>
                    </div>
                    <div id="table_int_details" class="chart-container"></div>
                </div>
            </div>
        </div>
    </div>

</div>

<script type="text/javascript">
    // ---------------------------------------------------------
    // 1. DATA INJECTION (Synthetic Data as per Prompt Instructions)
    // ---------------------------------------------------------
    
    // In a real scenario, this variable would be populated by the backend/Python script.
    // Generating robust sample data to ensure the template functions perfectly.
    const rawData = [
        // Week 1
        {week:'2023-10-01', brand:'YabaAudio', asin:'B001', title:'Yaba Pro Wireless', rank:5, deal:0, share:12.5, price:49.99, is_yaba:'Y', clicks:125},
        {week:'2023-10-01', brand:'YabaAudio', asin:'B002', title:'Yaba Sport Buds', rank:8, deal:0, share:8.2, price:29.99, is_yaba:'Y', clicks:82},
        {week:'2023-10-01', brand:'SonyX', asin:'C001', title:'SonyX Premium', rank:2, deal:0, share:25.0, price:89.99, is_yaba:'N', clicks:250},
        {week:'2023-10-01', brand:'BoseY', asin:'C002', title:'BoseY Quiet', rank:3, deal:0, share:20.0, price:129.99, is_yaba:'N', clicks:200},
        {week:'2023-10-01', brand:'JBLZ', asin:'C003', title:'JBLZ Bass', rank:12, deal:0, share:15.0, price:39.99, is_yaba:'N', clicks:150},
        
        // Week 2
        {week:'2023-10-08', brand:'YabaAudio', asin:'B001', title:'Yaba Pro Wireless', rank:4, deal:0, share:13.5, price:49.99, is_yaba:'Y', clicks:140},
        {week:'2023-10-08', brand:'YabaAudio', asin:'B002', title:'Yaba Sport Buds', rank:7, deal:0, share:9.0, price:29.99, is_yaba:'Y', clicks:95},
        {week:'2023-10-08', brand:'SonyX', asin:'C001', title:'SonyX Premium', rank:2, deal:0, share:24.0, price:89.99, is_yaba:'N', clicks:260},
        
        // Week 3 (Price Drop Yaba)
        {week:'2023-10-15', brand:'YabaAudio', asin:'B001', title:'Yaba Pro Wireless', rank:3, deal:1, share:18.5, price:39.99, is_yaba:'Y', clicks:210},
        {week:'2023-10-15', brand:'YabaAudio', asin:'B002', title:'Yaba Sport Buds', rank:6, deal:0, share:8.5, price:29.99, is_yaba:'Y', clicks:90},
        {week:'2023-10-15', brand:'SonyX', asin:'C001', title:'SonyX Premium', rank:2, deal:0, share:22.0, price:89.99, is_yaba:'N', clicks:230},
        
        // Week 4 (Competitor Deal)
        {week:'2023-10-22', brand:'YabaAudio', asin:'B001', title:'Yaba Pro Wireless', rank:5, deal:0, share:11.0, price:49.99, is_yaba:'Y', clicks:115},
        {week:'2023-10-22', brand:'SonyX', asin:'C001', title:'SonyX Premium', rank:1, deal:1, share:35.0, price:69.99, is_yaba:'N', clicks:400},
        {week:'2023-10-22', brand:'BoseY', asin:'C002', title:'BoseY Quiet', rank:4, deal:0, share:18.0, price:129.99, is_yaba:'N', clicks:190},
        
        // Week 5 (Latest)
        {week:'2023-10-29', brand:'YabaAudio', asin:'B001', title:'Yaba Pro Wireless', rank:4, deal:0, share:14.0, price:49.99, is_yaba:'Y', clicks:150},
        {week:'2023-10-29', brand:'YabaAudio', asin:'B002', title:'Yaba Sport Buds', rank:5, deal:1, share:12.0, price:24.99, is_yaba:'Y', clicks:130},
        {week:'2023-10-29', brand:'SonyX', asin:'C001', title:'SonyX Premium', rank:2, deal:0, share:28.0, price:89.99, is_yaba:'N', clicks:290},
        {week:'2023-10-29', brand:'BoseY', asin:'C002', title:'BoseY Quiet', rank:3, deal:0, share:19.0, price:129.99, is_yaba:'N', clicks:210},
        {week:'2023-10-29', brand:'JBLZ', asin:'C003', title:'JBLZ Bass', rank:10, deal:0, share:10.0, price:39.99, is_yaba:'N', clicks:110}
    ];

    const marketData = rawData; // Assign to main constant

    // ---------------------------------------------------------
    // 2. LOGIC & PROCESSING
    // ---------------------------------------------------------

    google.charts.load('current', {'packages':['corechart', 'table', 'bar']});
    google.charts.setOnLoadCallback(initDashboard);

    let chartTrend, chartComp, chartEfficiency, chartLevers, chartIntPrice, chartIntShare, tableInt;

    function initDashboard() {
        // Prepare Data
        const weeks = [...new Set(marketData.map(d => d.week))].sort();
        const latestWeek = weeks[weeks.length - 1];
        
        // Identify Brands
        const ourBrandRow = marketData.find(d => d.is_yaba === 'Y');
        const ourBrand = ourBrandRow ? ourBrandRow.brand : 'Unknown';
        
        // Populate Selectors
        const weekSelect = document.getElementById('select_week');
        weeks.forEach(w => {
            const opt = document.createElement('option');
            opt.value = w;
            opt.text = w;
            weekSelect.add(opt);
        });
        weekSelect.value = latestWeek;

        const competitors = [...new Set(marketData.filter(d => d.brand !== ourBrand).map(d => d.brand))];
        const compSelect = document.getElementById('select_competitor');
        competitors.forEach(c => {
            const opt = document.createElement('option');
            opt.value = c;
            opt.text = c;
            compSelect.add(opt);
        });

        // DRAW STATIC CHARTS
        drawGlobalTrend(weeks, ourBrand);
        drawCompetitiveness(weeks, ourBrand, competitors);
        drawLevers(ourBrand);
        drawEfficiency(latestWeek, ourBrand);
        generateInsights(latestWeek, ourBrand, weeks);

        // INITIALIZE INTERACTIVE
        updateInteractiveCharts();
    }

    // --- CHART 1: GLOBAL TREND ---
    function drawGlobalTrend(weeks, ourBrand) {
        const data = new google.visualization.DataTable();
        data.addColumn('string', 'Semana');
        data.addColumn('number', 'Clics Totales');
        data.addColumn('number', 'Nuestra Cuota (%)');

        const rows = weeks.map(week => {
            const weekData = marketData.filter(d => d.week === week);
            const totalClicks = weekData.reduce((sum, d) => sum + (d.clicks || 0), 0);
            
            const ourData = weekData.filter(d => d.brand === ourBrand);
            const ourClicks = ourData.reduce((sum, d) => sum + (d.clicks || 0), 0);
            const share = totalClicks > 0 ? (ourClicks / totalClicks) * 100 : 0;
            
            return [week, totalClicks, share];
        });

        data.addRows(rows);

        const options = {
            seriesType: 'bars',
            series: {1: {type: 'line', targetAxisIndex: 1}},
            colors: ['#E0E0E0', '#4285F4'],
            legend: {position: 'bottom'},
            vAxes: {
                0: {title: 'Volumen de Clics'},
                1: {title: 'Share (%)', format: '#\'%\''}
            },
            chartArea: {width: '85%', height: '70%'},
            animation: { startup: true, duration: 1000, easing: 'out' }
        };

        chartTrend = new google.visualization.ComboChart(document.getElementById('chart_global_trend'));
        chartTrend.draw(data, options);
    }

    // --- CHART 2: COMPETITIVENESS ---
    function drawCompetitiveness(weeks, ourBrand, competitors) {
        // Calculate Top 3 Competitors by Avg Share
        const compShares = competitors.map(comp => {
            const totalShare = marketData.filter(d => d.brand === comp).reduce((sum, d) => sum + d.share, 0);
            return {brand: comp, total: totalShare};
        });
        const top3 = compShares.sort((a,b) => b.total - a.total).slice(0, 3).map(c => c.brand);

        const data = new google.visualization.DataTable();
        data.addColumn('string', 'Semana');
        data.addColumn('number', ourBrand);
        top3.forEach(c => data.addColumn('number', c));
        data.addColumn('number', 'Otros');

        const rows = weeks.map(week => {
            const weekData = marketData.filter(d => d.week === week);
            
            const getShare = (brand) => {
                return weekData.filter(d => d.brand === brand).reduce((sum, d) => sum + d.share, 0);
            };

            const ourShare = getShare(ourBrand);
            const top3Shares = top3.map(c => getShare(c));
            const othersShare = weekData
                .filter(d => d.brand !== ourBrand && !top3.includes(d.brand))
                .reduce((sum, d) => sum + d.share, 0);

            return [week, ourShare, ...top3Shares, othersShare];
        });

        data.addRows(rows);

        const options = {
            curveType: 'function',
            legend: {position: 'bottom'},
            colors: ['#4285F4', '#DB4437', '#F4B400', '#0F9D58', '#9AA0A6'], // Blue (Us), Red/Yellow/Green (Top3), Grey (Others)
            vAxis: {title: 'Click Share (%)'},
            chartArea: {width: '85%', height: '70%'},
            pointSize: 5
        };

        chartComp = new google.visualization.LineChart(document.getElementById('chart_competitiveness'));
        chartComp.draw(data, options);
    }

    // --- CHART 3: LEVERS ---
    function drawLevers(ourBrand) {
        // Compare Avg Click Share: Deal vs No Deal
        const ourData = marketData.filter(d => d.brand === ourBrand);
        
        const withDeal = ourData.filter(d => d.deal > 0);
        const withoutDeal = ourData.filter(d => d.deal === 0);
        
        const avgShareDeal = withDeal.length ? withDeal.reduce((s, d) => s + d.share, 0) / withDeal.length : 0;
        const avgShareNoDeal = withoutDeal.length ? withoutDeal.reduce((s, d) => s + d.share, 0) / withoutDeal.length : 0;

        const data = google.visualization.arrayToDataTable([
            ['Estado', 'Share Promedio', { role: 'style' }],
            ['Sin Deal', avgShareNoDeal, '#9AA0A6'],
            ['Con Deal', avgShareDeal, '#34A853']
        ]);

        const options = {
            legend: {position: 'none'},
            vAxis: {title: 'Click Share (%)'},
            bar: {groupWidth: "50%"},
            chartArea: {width: '80%', height: '70%'}
        };

        chartLevers = new google.visualization.ColumnChart(document.getElementById('chart_levers'));
        chartLevers.draw(data, options);
    }

    // --- CHART 4: EFFICIENCY ---
    function drawEfficiency(week, ourBrand) {
        const weekData = marketData.filter(d => d.week === week);
        
        const data = new google.visualization.DataTable();
        data.addColumn('number', 'Rank Orgánico');
        data.addColumn('number', 'Click Share (%)');
        data.addColumn({type: 'string', role: 'tooltip'});
        data.addColumn({type: 'string', role: 'style'}); // Color

        const rows = weekData.map(d => {
            const color = d.brand === ourBrand ? '#4285F4' : '#EA4335';
            return [d.rank, d.share, `${d.brand}: ${d.title} (Rank ${d.rank}, Share ${d.share}%)`, `point { fill-color: ${color}; }`];
        });

        data.addRows(rows);

        const options = {
            hAxis: {title: 'Rank Orgánico (Menor es Mejor)', direction: -1}, // Reverse axis so rank 1 is right or left
            vAxis: {title: 'Click Share (%)'},
            legend: 'none',
            chartArea: {width: '85%', height: '70%'}
        };

        chartEfficiency = new google.visualization.ScatterChart(document.getElementById('chart_efficiency'));
        chartEfficiency.draw(data, options);
    }

    // --- INSIGHTS GENERATION ---
    function generateInsights(latestWeek, ourBrand, weeks) {
        const insightsList = document.getElementById('insights_container');
        const recsList = document.getElementById('recommendations_container');
        
        // Helper to add list item
        const addLi = (target, text, icon) => {
            target.innerHTML += `<li><span class="material-icons insight-icon">${icon}</span><span>${text}</span></li>`;
        };

        // Logic
        const lastWeekData = marketData.filter(d => d.week === latestWeek);
        const prevWeekData = marketData.filter(d => d.week === weeks[weeks.length - 2]);

        const getBrandShare = (data, b) => data.filter(d => d.brand === b).reduce((s,d) => s + d.share, 0);
        
        const currentShare = getBrandShare(lastWeekData, ourBrand);
        const prevShare = getBrandShare(prevWeekData, ourBrand);
        const diff = currentShare - prevShare;

        // Insight 1: Trend
        if (diff > 0) addLi(insightsList, `Tendencia Positiva: Nuestra marca ganó <b>${diff.toFixed(1)}%</b> de cuota la última semana.`, 'trending_up');
        else addLi(insightsList, `Alerta: Caída de share de <b>${diff.toFixed(1)}%</b> respecto a la semana anterior.`, 'trending_down');

        // Insight 2: Pricing
        const ourAvgPrice = lastWeekData.filter(d => d.brand === ourBrand).reduce((s,d)=>s+d.price,0) / (lastWeekData.filter(d=>d.brand===ourBrand).length || 1);
        const mktAvgPrice = lastWeekData.filter(d => d.brand !== ourBrand).reduce((s,d)=>s+d.price,0) / (lastWeekData.filter(d=>d.brand!==ourBrand).length || 1);
        
        if (ourAvgPrice > mktAvgPrice * 1.2) {
            addLi(insightsList, `Posicionamiento Premium: Precio un 20%+ superior al promedio del mercado.`, 'monetization_on');
            addLi(recsList, `Evaluar elasticidad: Si el share cae, considerar cupón temporal para reducir barrera de entrada.`, 'local_offer');
        } else {
            addLi(insightsList, `Precio Competitivo: Alineado con el promedio del mercado.`, 'check_circle');
        }

        // Insight 3: Efficiency
        const ourBestASIN = lastWeekData.filter(d => d.brand === ourBrand).sort((a,b)=>a.rank-b.rank)[0];
        if (ourBestASIN && ourBestASIN.rank > 5 && ourBestASIN.share > 10) {
            addLi(insightsList, `Sobre-performance: El ASIN ${ourBestASIN.asin} tiene alto share pese a rank bajo (#${ourBestASIN.rank}).`, 'star');
            addLi(recsList, `Invertir en SEO/PPC para este ASIN: Su conversión orgánica es alta, mejorar rank multiplicaría ventas.`, 'upgrade');
        }

        // Generic Recs
        addLi(recsList, `Defensa de Marca: Asegurar deals en semanas donde competidores Top 3 (como SonyX) activen ofertas agresivas.`, 'shield');
        addLi(recsList, `Optimización de Títulos: Revisar keywords en ASINs con bajo Click Share pero buen ranking.`, 'edit');
    }

    // --- TAB 2: INTERACTIVE LOGIC ---
    function updateInteractiveCharts() {
        const week = document.getElementById('select_week').value;
        const competitor = document.getElementById('select_competitor').value;
        const ourBrand = marketData.find(d => d.is_yaba === 'Y')?.brand || 'Nuestra Marca';

        const weekData = marketData.filter(d => d.week === week);
        const ourItems = weekData.filter(d => d.brand === ourBrand);
        const compItems = weekData.filter(d => d.brand === competitor);

        // Price Chart
        const priceData = google.visualization.arrayToDataTable([
            ['Marca', 'Precio Promedio', { role: 'style' }],
            [ourBrand, ourItems.reduce((s,d)=>s+d.price,0)/ourItems.length || 0, '#4285F4'],
            [competitor, compItems.reduce((s,d)=>s+d.price,0)/compItems.length || 0, '#EA4335']
        ]);
        new google.visualization.ColumnChart(document.getElementById('chart_int_price')).draw(priceData, {legend:'none', vAxis:{title:'Precio ($)'}});

        // Share Chart
        const shareData = google.visualization.arrayToDataTable([
            ['Marca', 'Click Share Total', { role: 'style' }],
            [ourBrand, ourItems.reduce((s,d)=>s+d.share,0), '#4285F4'],
            [competitor, compItems.reduce((s,d)=>s+d.share,0), '#EA4335']
        ]);
        new google.visualization.BarChart(document.getElementById('chart_int_share')).draw(shareData, {legend:'none', hAxis:{title:'Share (%)'}});

        // Table Detail
        const tableData = new google.visualization.DataTable();
        tableData.addColumn('string', 'ASIN');
        tableData.addColumn('string', 'Título');
        tableData.addColumn('number', 'Precio');
        tableData.addColumn('number', 'Rank');
        tableData.addColumn('number', 'Share %');
        tableData.addColumn('string', 'Deal?');

        const allItems = [...ourItems, ...compItems];
        const rows = allItems.map(d => [
            d.asin, 
            d.title.substring(0, 30) + '...', 
            d.price, 
            d.rank, 
            d.share, 
            d.deal ? 'SI' : 'NO'
        ]);
        tableData.addRows(rows);

        new google.visualization.Table(document.getElementById('table_int_details')).draw(tableData, {width: '100%', height: '100%'});
    }

    // Utility: Tab Switching
    window.switchTab = function(tabName) {
        document.getElementById('tab-static').classList.add('hidden');
        document.getElementById('tab-interactive').classList.add('hidden');
        
        const btns = document.querySelectorAll('.tab-btn');
        btns.forEach(b => b.classList.remove('active'));

        if (tabName === 'static') {
            document.getElementById('tab-static').classList.remove('hidden');
            btns[0].classList.add('active');
        } else {
            document.getElementById('tab-interactive').classList.remove('hidden');
            btns[1].classList.add('active');
            updateInteractiveCharts(); // Refresh to ensure correct rendering size
        }
    }
</script>

</body>
</html>