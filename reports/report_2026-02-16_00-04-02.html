<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lisis de Rendimiento Parent ASIN - NaturaleBio</title>
    
    <!-- Google Fonts & Material Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Google Charts Loader -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
        /* RESET & BASE STYLES */
        :root {
            --primary-color: #0071e3; /* Amazon Blue-ish / Apple Blue */
            --secondary-color: #1d1d1f; /* Apple Dark */
            --bg-color: #f5f5f7; /* Apple Gray */
            --card-bg: #ffffff;
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
            --success: #34c759;
            --danger: #ff3b30;
            --warning: #ff9500;
            --border-radius: 16px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
        }

        /* LAYOUT */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--card-bg);
            padding: 20px 0;
            margin-bottom: 24px;
            box-shadow: 0 1px 0 rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        h1 { font-size: 24px; font-weight: 600; margin: 0; }
        .date-range { color: var(--text-secondary); font-size: 14px; }

        /* TABS */
        .tabs {
            display: flex;
            gap: 12px;
            background: #e5e5ea;
            padding: 4px;
            border-radius: 12px;
            width: fit-content;
        }

        .tab-btn {
            padding: 8px 16px;
            border: none;
            background: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-secondary);
        }

        .tab-btn.active {
            background: var(--card-bg);
            color: var(--text-primary);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* CARDS */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            transition: transform 0.2s ease;
        }
        
        .card:hover { transform: translateY(-2px); }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* KPI GRID */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .kpi-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
        }

        .kpi-value { font-size: 32px; font-weight: 700; color: var(--primary-color); }
        .kpi-label { font-size: 14px; color: var(--text-secondary); margin-top: 4px; }
        .trend-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }
        .trend-up { background: #e8f5e9; color: var(--success); }
        .trend-down { background: #ffebee; color: var(--danger); }

        /* SECTIONS */
        .section-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
        }
        
        @media (min-width: 768px) {
            .section-grid { grid-template-columns: 1fr 1fr; }
            .full-width { grid-column: 1 / -1; }
        }

        /* INSIGHTS LIST */
        .insights-list { list-style: none; padding: 0; margin: 0; }
        .insights-list li {
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            gap: 12px;
            font-size: 15px;
            line-height: 1.5;
        }
        .insights-list li:last-child { border-bottom: none; }
        .icon-bullet { color: var(--primary-color); font-size: 20px; flex-shrink: 0; }

        /* INTERACTIVE COMPARATOR */
        .comparator-controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        select {
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid #d1d1d6;
            background: var(--card-bg);
            font-size: 14px;
            min-width: 200px;
            outline: none;
        }

        .comparison-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .comparison-table th, .comparison-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .comparison-table th { color: var(--text-secondary); font-weight: 500; font-size: 13px; }
        .comparison-table td { font-size: 15px; font-weight: 500; }
        
        .winner-cell { color: var(--success); font-weight: 700; }
        .loser-cell { color: var(--danger); }

        /* UTILS */
        .hidden { display: none !important; }
        .chart-container { height: 350px; width: 100%; }
        
        /* SPECIFIC COLORS FOR GOOGLE CHARTS */
        /* Will be handled in JS options */

    </style>
</head>
<body>

    <header>
        <div class="header-content">
            <div>
                <h1>Reporte Parent ASIN: Cacao Powder</h1>
                <div class="date-range" id="dateRangeDisplay">Cargando datos...</div>
            </div>
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('report')">Reporte Ejecutivo</button>
                <button class="tab-btn" onclick="switchTab('interactive')">Comparador Interactivo</button>
            </div>
        </div>
    </header>

    <div class="container">
        
        <!-- PESTA√ëA 1: REPORTE EST√ÅTICO -->
        <div id="report-view">
            
            <!-- KPI SUMMARY -->
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-value" id="kpi-share">0%</div>
                    <div class="kpi-label">Click Share (Nuestra Marca)</div>
                    <div class="trend-badge trend-up" id="kpi-share-trend">Loading...</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value" id="kpi-rank">0</div>
                    <div class="kpi-label">Avg Organic Rank</div>
                    <div class="trend-badge" id="kpi-rank-trend">vs Competencia</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value" id="kpi-price">‚Ç¨0.00</div>
                    <div class="kpi-label">Precio Promedio</div>
                    <div class="trend-badge" id="kpi-price-diff">vs Mercado</div>
                </div>
            </div>

            <div class="section-grid">
                
                <!-- 1. TENDENCIA GLOBAL -->
                <div class="card full-width">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="material-icons">trending_up</span>
                            Tendencia Global del Parent
                        </div>
                    </div>
                    <div id="chart_trend" class="chart-container"></div>
                    <p style="margin-top:16px; font-size:14px; color:var(--text-secondary)">
                        <strong>An√°lisis:</strong> La l√≠nea azul representa nuestro Click Share. Las barras muestran el volumen total estimado de clics del mercado. Observamos una tendencia positiva en nuestra cuota a pesar de la estabilidad en el volumen de b√∫squeda.
                    </p>
                </div>

                <!-- 2. COMPETITIVIDAD DE MARCA -->
                <div class="card full-width">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="material-icons">pie_chart</span>
                            Competitividad de Marca (Share of Voice)
                        </div>
                    </div>
                    <div id="chart_competitiveness" class="chart-container"></div>
                    <p style="margin-top:16px; font-size:14px; color:var(--text-secondary)">
                        Comparativa de <strong>NaturaleBio</strong> (Azul) frente a los 3 principales competidores. Note los picos de competidores agresivos en precio como KABA.
                    </p>
                </div>

                <!-- 3. PALANCAS (Levers) -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="material-icons">tune</span>
                            üöÄ Palancas de Crecimiento
                        </div>
                    </div>
                    <div id="levers_content">
                        <!-- Dynamic content via JS -->
                    </div>
                </div>

                <!-- 4. EFICIENCIA (Rank vs Share) -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="material-icons">scatter_plot</span>
                            Eficiencia: Rank vs Click Share
                        </div>
                    </div>
                    <div id="chart_efficiency" class="chart-container"></div>
                    <p style="font-size:12px; color:var(--text-secondary); text-align:center; margin-top:8px;">
                        Eje X: Ranking Org√°nico (Menor es mejor) | Eje Y: Click Share
                    </p>
                </div>

                <!-- 5. CONCLUSIONES Y RECOMENDACIONES -->
                <div class="card full-width">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="material-icons">lightbulb</span>
                            üí° Conclusiones Clave y Recomendaciones
                        </div>
                    </div>
                    <ul class="insights-list" id="insights-list">
                        <!-- Populated by JS -->
                    </ul>
                </div>

            </div>
        </div>

        <!-- PESTA√ëA 2: COMPARADOR INTERACTIVO -->
        <div id="interactive-view" class="hidden">
            <div class="card full-width">
                <div class="card-header">
                    <div class="card-title">Cara a Cara: Nosotros vs Competencia</div>
                </div>
                
                <div class="comparator-controls">
                    <div>
                        <label style="display:block; margin-bottom:8px; font-size:12px; font-weight:600; color:var(--text-secondary);">SEMANA</label>
                        <select id="week-selector" onchange="updateComparator()"></select>
                    </div>
                    <div>
                        <label style="display:block; margin-bottom:8px; font-size:12px; font-weight:600; color:var(--text-secondary);">COMPETIDOR</label>
                        <select id="competitor-selector" onchange="updateComparator()"></select>
                    </div>
                </div>

                <div style="overflow-x: auto;">
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th width="20%">M√©trica</th>
                                <th width="40%" style="color:var(--primary-color);">NaturaleBio (Nosotros)</th>
                                <th width="40%" id="comp-header-name" style="color:#d63031;">Competidor</th>
                            </tr>
                        </thead>
                        <tbody id="comparison-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="card full-width">
                <div class="card-header">
                    <div class="card-title">Evoluci√≥n de Precio Comparada</div>
                </div>
                <div id="chart_price_comp" class="chart-container"></div>
            </div>
        </div>

    </div>

    <script>
        // --- 1. DATA INJECTION ---
        // Generated from the CSV analysis
        const marketData = [
    {week: '2026-04', brand: 'RUF', asin: 'B09CQB6L53', is_ours: false, share: 5.55, price: 4.16, rank: 11, deal: 0, coupon: 0, clicks: 416.0},
    {week: '2026-06', brand: 'Cortegas', asin: 'B0BG2ZNJLT', is_ours: false, share: 5.27, price: 9.7, rank: 4, deal: 0, coupon: 0, clicks: 407.3},
    {week: '2026-06', brand: 'Lindt', asin: 'B0CX236QL5', is_ours: false, share: 3.13, price: 7.99, rank: 11, deal: 0, coupon: 0, clicks: 241.9},
    {week: '2026-06', brand: 'koawach', asin: 'B0FRN2MXQM', is_ours: false, share: 3.49, price: 16.99, rank: 24, deal: 0, coupon: 0, clicks: 269.7},
    {week: '2026-06', brand: 'Cortegas', asin: 'B0CWVQKHSB', is_ours: false, share: 1.89, price: 8.7, rank: 12, deal: 0, coupon: 0, clicks: 146.0},
    {week: '2026-06', brand: 'RheinNatur', asin: 'B0DLB8RTJL', is_ours: false, share: 4.31, price: 34.3, rank: 11, deal: 0, coupon: 0, clicks: 333.1},
    {week: '2026-04', brand: 'koawach', asin: 'B0FRN2MXQM', is_ours: false, share: 4.02, price: 18.22, rank: 17, deal: 0, coupon: 0, clicks: 301.3},
    {week: '2026-06', brand: 'SUCHARD', asin: 'B0D5R1W596', is_ours: false, share: 3.17, price: 3.19, rank: 6, deal: 0, coupon: 0, clicks: 245.0},
    {week: '2026-04', brand: 'vom-Achterhof', asin: 'B0768L7FV1', is_ours: false, share: 5.91, price: 37.7, rank: 13, deal: 0, coupon: 0, clicks: 443.0},
    {week: '2026-04', brand: 'DATTELMANN¬Æ', asin: 'B0FVY7JWMY', is_ours: false, share: 2.4, price: 10.71, rank: 10, deal: 0, coupon: 0, clicks: 179.9},
    {week: '2026-04', brand: 'KABA', asin: 'B0D5QZYXPW', is_ours: false, share: 4.8, price: 3.2, rank: 11, deal: 0, coupon: 0, clicks: 359.8},
    {week: '2026-04', brand: 'SUCHARD', asin: 'B0D5R1W596', is_ours: false, share: 6.65, price: 3.42, rank: 6, deal: 0, coupon: 0, clicks: 498.5},
    {week: '2026-04', brand: 'Caotina', asin: 'B00X0JRXS0', is_ours: false, share: 2.36, price: 14.61, rank: 25, deal: 0, coupon: 0, clicks: 176.9},
    {week: '2026-06', brand: 'NaturaleBio', asin: 'B07DFPSNGJ', is_ours: true, share: 9.47, price: 33.99, rank: 1, deal: 0, coupon: 0, clicks: 731.9},
    {week: '2026-06', brand: 'vom-Achterhof', asin: 'B0768LH1CP', is_ours: false, share: 3.63, price: 24.89, rank: 5, deal: 0, coupon: 0, clicks: 280.5},
    {week: '2026-04', brand: 'Cortegas', asin: 'B0BG2ZNJLT', is_ours: false, share: 4.02, price: 10.4, rank: 9, deal: 0, coupon: 0, clicks: 301.3},
    {week: '2026-06', brand: '1kg', asin: 'B0DFWXG6D1', is_ours: false, share: 7.23, price: 24.95, rank: 5, deal: 0, coupon: 0, clicks: 558.7},
    {week: '2026-04', brand: 'NaturaleBio', asin: 'B07DFPSNGJ', is_ours: true, share: 7.09, price: 34.3, rank: 4, deal: 0, coupon: 0, clicks: 531.4},
    {week: '2026-06', brand: 'KABA', asin: 'B0D5QZYXPW', is_ours: false, share: 10.43, price: 2.7, rank: 3, deal: 0, coupon: 0, clicks: 806.1},
    {week: '2026-04', brand: 'RheinNatur', asin: 'B0DLB8RTJL', is_ours: false, share: 5.2, price: 35.75, rank: 25, deal: 0, coupon: 0, clicks: 389.8}
];

        const OUR_BRAND = "NaturaleBio";

        // --- 2. GOOGLE CHARTS SETUP ---
        google.charts.load('current', {'packages':['corechart', 'bar', 'scatter']});
        google.charts.setOnLoadCallback(initDashboard);

        // --- 3. LOGIC & HELPERS ---
        function initDashboard() {
            processDateRange();
            calculateKPIs();
            drawTrendChart();
            drawCompetitivenessChart();
            drawEfficiencyChart();
            populateInsights();
            setupInteractiveControls();
        }

        function switchTab(tabId) {
            document.getElementById('report-view').classList.add('hidden');
            document.getElementById('interactive-view').classList.add('hidden');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            
            if(tabId === 'report') {
                document.getElementById('report-view').classList.remove('hidden');
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
            } else {
                document.getElementById('interactive-view').classList.remove('hidden');
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                updateComparator(); // Refresh charts in hidden tab
            }
        }

        function getUniqueWeeks() {
            return [...new Set(marketData.map(d => d.week))].sort();
        }

        function processDateRange() {
            const weeks = getUniqueWeeks();
            document.getElementById('dateRangeDisplay').innerText = `Datos: Semana ${weeks[0]} a ${weeks[weeks.length-1]}`;
        }

        function calculateKPIs() {
            const weeks = getUniqueWeeks();
            const lastWeek = weeks[weeks.length - 1];
            const prevWeek = weeks.length > 1 ? weeks[weeks.length - 2] : null;

            // Filter data
            const currentData = marketData.filter(d => d.week === lastWeek && d.is_ours);
            const prevData = prevWeek ? marketData.filter(d => d.week === prevWeek && d.is_ours) : [];

            // 1. Share
            const currentShare = currentData.reduce((sum, d) => sum + d.share, 0);
            const prevShare = prevData.reduce((sum, d) => sum + d.share, 0);
            
            document.getElementById('kpi-share').innerText = currentShare.toFixed(2) + '%';
            const shareTrendEl = document.getElementById('kpi-share-trend');
            if(currentShare >= prevShare) {
                shareTrendEl.className = 'trend-badge trend-up';
                shareTrendEl.innerHTML = `<span class="material-icons" style="font-size:14px">trending_up</span> +${(currentShare - prevShare).toFixed(2)}%`;
            } else {
                shareTrendEl.className = 'trend-badge trend-down';
                shareTrendEl.innerHTML = `<span class="material-icons" style="font-size:14px">trending_down</span> ${(currentShare - prevShare).toFixed(2)}%`;
            }

            // 2. Rank
            const avgRank = currentData.length ? (currentData.reduce((sum, d) => sum + d.rank, 0) / currentData.length) : 0;
            document.getElementById('kpi-rank').innerText = avgRank.toFixed(1);

            // 3. Price
            const avgPrice = currentData.length ? (currentData.reduce((sum, d) => sum + d.price, 0) / currentData.length) : 0;
            document.getElementById('kpi-price').innerText = '‚Ç¨' + avgPrice.toFixed(2);
        }

        // --- CHART 1: GLOBAL TREND ---
        function drawTrendChart() {
            const weeks = getUniqueWeeks();
            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Semana');
            dataTable.addColumn('number', 'Volumen Clics Mercado');
            dataTable.addColumn('number', 'NaturaleBio Share (%)');

            const rows = weeks.map(week => {
                const weekData = marketData.filter(d => d.week === week);
                const totalClicks = weekData.reduce((sum, d) => sum + d.clicks, 0);
                const ourShare = weekData.filter(d => d.is_ours).reduce((sum, d) => sum + d.share, 0);
                return [week, totalClicks, ourShare];
            });

            dataTable.addRows(rows);

            const options = {
                seriesType: 'bars',
                series: {1: {type: 'line', targetAxisIndex: 1}},
                vAxes: {
                    0: {title: 'Clics Totales', textStyle: {color: '#86868b'}},
                    1: {title: 'Click Share %', textStyle: {color: '#0071e3'}, format: '#\'%\''}
                },
                colors: ['#e5e5ea', '#0071e3'],
                legend: {position: 'bottom'},
                chartArea: {width: '80%', height: '70%'},
                bar: {groupWidth: '40%'}
            };

            const chart = new google.visualization.ComboChart(document.getElementById('chart_trend'));
            chart.draw(dataTable, options);
        }

        // --- CHART 2: COMPETITIVENESS ---
        function drawCompetitivenessChart() {
            const weeks = getUniqueWeeks();
            
            // Identify Top 3 Competitors dynamically
            const competitors = {};
            marketData.forEach(d => {
                if(!d.is_ours) {
                    if(!competitors[d.brand]) competitors[d.brand] = 0;
                    competitors[d.brand] += d.share;
                }
            });
            const top3 = Object.entries(competitors)
                .sort((a,b) => b[1] - a[1])
                .slice(0, 3)
                .map(e => e[0]);

            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Semana');
            dataTable.addColumn('number', OUR_BRAND);
            top3.forEach(comp => dataTable.addColumn('number', comp));
            dataTable.addColumn('number', 'Otros');

            const rows = weeks.map(week => {
                const weekData = marketData.filter(d => d.week === week);
                
                // Ours
                const ourShare = weekData.filter(d => d.is_ours).reduce((s, d) => s + d.share, 0);
                
                // Top 3
                const compShares = top3.map(comp => {
                    return weekData.filter(d => d.brand === comp).reduce((s, d) => s + d.share, 0);
                });

                // Others
                const otherShare = weekData.filter(d => !d.is_ours && !top3.includes(d.brand))
                                           .reduce((s, d) => s + d.share, 0);

                return [week, ourShare, ...compShares, otherShare];
            });

            dataTable.addRows(rows);

            const options = {
                curveType: 'function',
                legend: { position: 'bottom' },
                colors: ['#0071e3', '#ff3b30', '#ff9500', '#5856d6', '#999'],
                chartArea: {width: '85%', height: '70%'},
                vAxis: {format: '#\'%\''}
            };

            const chart = new google.visualization.LineChart(document.getElementById('chart_competitiveness'));
            chart.draw(dataTable, options);
        }

        // --- CHART 3: EFFICIENCY ---
        function drawEfficiencyChart() {
            const weeks = getUniqueWeeks();
            const lastWeek = weeks[weeks.length - 1];
            const currentData = marketData.filter(d => d.week === lastWeek);

            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('number', 'Rank Org√°nico');
            dataTable.addColumn('number', 'Click Share (%)');
            dataTable.addColumn({type: 'string', role: 'tooltip'});
            dataTable.addColumn({type: 'string', role: 'style'}); // For color

            const rows = currentData.map(d => {
                const color = d.is_ours ? 'point { fill-color: #0071e3; size: 10; }' : 'point { fill-color: #86868b; }';
                const label = `${d.brand} \nRank: ${d.rank} \nShare: ${d.share}% \nPrecio: ‚Ç¨${d.price}`;
                return [d.rank, d.share, label, color];
            });

            dataTable.addRows(rows);

            const options = {
                hAxis: {title: 'Ranking Org√°nico (Inverso)', direction: -1},
                vAxis: {title: 'Click Share (%)'},
                legend: 'none',
                chartArea: {width: '80%', height: '70%'}
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('chart_efficiency'));
            chart.draw(dataTable, options);
        }

        // --- POPULATE TEXT SECTIONS ---
        function populateInsights() {
            // Levers Logic
            const leversDiv = document.getElementById('levers_content');
            leversDiv.innerHTML = `
                <table style="width:100%; font-size:14px; text-align:left;">
                    <tr style="border-bottom:1px solid #eee;">
                        <th style="padding:8px;">Factor</th>
                        <th style="padding:8px;">Impacto Observado</th>
                        <th style="padding:8px;">Evidencia</th>
                    </tr>
                    <tr>
                        <td style="padding:8px;"><strong>üí∞ Precio</strong></td>
                        <td style="padding:8px; color:var(--danger);">Alta Sensibilidad</td>
                        <td style="padding:8px;">Competidor KABA sube a 10.4% share con precio ‚Ç¨2.70 (vs nuestro ‚Ç¨34).</td>
                    </tr>
                    <tr>
                        <td style="padding:8px;"><strong>üèÜ Ranking</strong></td>
                        <td style="padding:8px; color:var(--success);">Correlaci√≥n Directa</td>
                        <td style="padding:8px;">Logramos Rank #1 en √∫ltima semana y alcanzamos 9.47% share.</td>
                    </tr>
                </table>
            `;

            // Insights Logic
            const list = document.getElementById('insights-list');
            list.innerHTML = `
                <li>
                    <span class="material-icons icon-bullet">trending_up</span>
                    <div>
                        <strong>Crecimiento S√≥lido:</strong> NaturaleBio ha aumentado su cuota del 7.09% al 9.47% en las √∫ltimas semanas, coincidiendo con una mejora en el Ranking Org√°nico (Top 1).
                    </div>
                </li>
                <li>
                    <span class="material-icons icon-bullet">warning</span>
                    <div>
                        <strong>Amenaza Low-Cost:</strong> La marca "KABA" ha irrumpido con fuerza (10.43% share) gracias a un precio agresivo de ‚Ç¨2.70. No competimos en el mismo segmento de precio, pero roban visibilidad.
                    </div>
                </li>
                <li>
                    <span class="material-icons icon-bullet">verified</span>
                    <div>
                        <strong>Eficiencia de Ranking:</strong> Somos altamente eficientes. Al alcanzar el Top 1-4 org√°nico, capturamos casi el 10% del mercado, superando a competidores con m√°s variantes pero peor posici√≥n.
                    </div>
                </li>
                <li>
                    <span class="material-icons icon-bullet">check_circle</span>
                    <div>
                        <strong>Recomendaci√≥n 1 (Posicionamiento):</strong> Mantener la defensa del Rank #1. Es el driver principal de nuestro share dado que nuestro precio (‚Ç¨34) es premium.
                    </div>
                </li>
                <li>
                    <span class="material-icons icon-bullet">check_circle</span>
                    <div>
                        <strong>Recomendaci√≥n 2 (Contenido):</strong> Diferenciarse de KABA enfatizando "Calidad Bio/Bulk" en las im√°genes principales para justificar el gap de precio (x10).
                    </div>
                </li>
            `;
        }

        // --- INTERACTIVE SECTION ---
        function setupInteractiveControls() {
            const weeks = getUniqueWeeks();
            const wSel = document.getElementById('week-selector');
            wSel.innerHTML = '';
            weeks.forEach(w => {
                const opt = document.createElement('option');
                opt.value = w;
                opt.text = w;
                wSel.add(opt);
            });
            wSel.value = weeks[weeks.length-1]; // Select last

            // Competitors
            const brands = [...new Set(marketData.filter(d => !d.is_ours).map(d => d.brand))].sort();
            const cSel = document.getElementById('competitor-selector');
            cSel.innerHTML = '';
            brands.forEach(b => {
                const opt = document.createElement('option');
                opt.value = b;
                opt.text = b;
                cSel.add(opt);
            });
            // Default select top competitor
            cSel.value = "KABA"; 
        }

        function updateComparator() {
            const week = document.getElementById('week-selector').value;
            const compBrand = document.getElementById('competitor-selector').value;
            
            // Get Data
            const ourData = marketData.find(d => d.week === week && d.is_ours);
            // Handle multiple ASINs per brand - take best performer
            const compDataCandidates = marketData.filter(d => d.week === week && d.brand === compBrand);
            const compData = compDataCandidates.sort((a,b) => b.share - a.share)[0];

            document.getElementById('comp-header-name').innerText = compBrand;

            const tbody = document.getElementById('comparison-body');
            
            if(!ourData || !compData) {
                tbody.innerHTML = '<tr><td colspan="3">Datos insuficientes para esta selecci√≥n.</td></tr>';
                return;
            }

            // Metrics Helper
            const row = (label, v1, v2, format, inverse=false) => {
                const w1 = inverse ? (v1 < v2) : (v1 > v2);
                const c1 = w1 ? 'winner-cell' : 'loser-cell';
                const c2 = w1 ? 'loser-cell' : 'winner-cell';
                return `
                    <tr>
                        <td>${label}</td>
                        <td class="${c1}">${format(v1)}</td>
                        <td class="${c2}">${format(v2)}</td>
                    </tr>
                `;
            };

            const fmtPct = v => v.toFixed(2) + '%';
            const fmtEur = v => '‚Ç¨' + v.toFixed(2);
            const fmtInt = v => v;

            let html = '';
            html += row('Click Share', ourData.share, compData.share, fmtPct);
            html += row('Precio', ourData.price, compData.price, fmtEur, true); // Lower price usually wins in commodity, but higher price wins margin. Let's assume higher share is goal -> Price is descriptive. For color logic, let's say lower price is "green" for competitiveness? No, let's keep it simple.
            html += row('Rank Org√°nico', ourData.rank, compData.rank, fmtInt, true); // Lower rank is better
            html += row('Deal Active', ourData.deal, compData.deal, v => v ? 'S√≠' : 'No');

            tbody.innerHTML = html;

            // Update Price Chart specific to these two
            drawPriceComparisonChart(compBrand);
        }

        function drawPriceComparisonChart(compBrand) {
            const weeks = getUniqueWeeks();
            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Semana');
            dataTable.addColumn('number', OUR_BRAND);
            dataTable.addColumn('number', compBrand);

            const rows = weeks.map(week => {
                const ourD = marketData.find(d => d.week === week && d.is_ours);
                // Average price if multiple ASINs for competitor
                const compDs = marketData.filter(d => d.week === week && d.brand === compBrand);
                const compPrice = compDs.length ? (compDs.reduce((s,d)=>s+d.price,0)/compDs.length) : null;
                return [week, ourD ? ourD.price : null, compPrice];
            });

            dataTable.addRows(rows);

            const options = {
                title: 'Hist√≥rico de Precios',
                curveType: 'function',
                legend: { position: 'bottom' },
                colors: ['#0071e3', '#d63031'],
                vAxis: {format: '‚Ç¨#'}
            };

            const chart = new google.visualization.LineChart(document.getElementById('chart_price_comp'));
            chart.draw(dataTable, options);
        }

        // Redraw on resize
        window.addEventListener('resize', initDashboard);

    </script>
</body>
</html>