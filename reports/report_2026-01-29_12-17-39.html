<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Market Intelligence: Incite Nutrition</title>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --primary: #4285F4; --primary-light: #E8F0FE;
            --secondary: #5F6368; --bg: #F8F9FA;
            --surface: #FFFFFF; --border: #DADCE0;
            --success: #34A853; --warning: #FBBC05; --danger: #EA4335;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: #202124; margin: 0; padding: 0; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        /* Header */
        header { background: var(--surface); padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        h1 { margin: 0; font-size: 24px; color: var(--primary); }
        .badge { background: var(--primary-light); color: var(--primary); padding: 4px 12px; border-radius: 16px; font-size: 12px; font-weight: 600; }

        /* Tabs */
        .tabs { display: flex; gap: 10px; margin: 20px 0; }
        .tab-btn { padding: 10px 20px; border: none; background: transparent; cursor: pointer; font-weight: 600; color: var(--secondary); border-bottom: 2px solid transparent; transition: all 0.2s; }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        
        /* Layout */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        @media (max-width: 768px) { .grid-2, .grid-3 { grid-template-columns: 1fr; } }

        /* Cards */
        .card { background: var(--surface); border-radius: 16px; padding: 24px; box-shadow: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15); margin-bottom: 20px; }
        .card h2 { margin-top: 0; font-size: 18px; color: var(--secondary); display: flex; align-items: center; gap: 8px; }
        .chart-box { width: 100%; height: 300px; }
        
        /* Stats */
        .stat-value { font-size: 32px; font-weight: 700; color: #202124; }
        .stat-label { font-size: 14px; color: var(--secondary); }
        .trend { font-size: 14px; font-weight: 500; display: flex; align-items: center; }
        .trend.up { color: var(--success); }
        .trend.down { color: var(--danger); }

        /* Insights Section */
        .insight-item { display: flex; gap: 12px; margin-bottom: 16px; align-items: flex-start; }
        .insight-icon { background: var(--primary-light); color: var(--primary); padding: 8px; border-radius: 50%; }
        .insight-text h4 { margin: 0 0 4px 0; font-size: 14px; }
        .insight-text p { margin: 0; font-size: 13px; color: var(--secondary); }

        /* Tables */
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: var(--secondary); font-size: 12px; padding: 8px; border-bottom: 1px solid var(--border); }
        td { padding: 8px; font-size: 13px; border-bottom: 1px solid #f1f3f4; }
        
        .hidden { display: none; }
    </style>
</head>
<body>
    <header>
        <div>
            <h1>Market Intelligence Report</h1>
            <span style="font-size: 14px; color: var(--secondary);">Parent Analysis: Incite Nutrition</span>
        </div>
        <div class="badge">Last Week: <span id="lastWeekDate"></span></div>
    </header>

    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('report')">Reporte Estratégico</button>
            <button class="tab-btn" onclick="switchTab('interactive')">Comparador Interactivo</button>
        </div>

        <!-- TAB 1: STATIC REPORT -->
        <div id="report" class="tab-content">
            
            <!-- 1. TENDENCIA GLOBAL -->
            <div class="card">
                <h2><span class="material-icons">show_chart</span> Tendencia Global del Parent</h2>
                <div class="grid-2">
                    <div>
                        <div class="stat-value" id="totalClicks">0</div>
                        <div class="stat-label">Total Clicks (Last 4 Weeks)</div>
                    </div>
                    <div>
                        <div class="stat-value" id="shareTrend">0%</div>
                        <div class="stat-label">Avg Click Share (Incite Nutrition)</div>
                    </div>
                </div>
                <div id="trendChart" class="chart-box"></div>
                <p id="trendInsight" style="font-size: 13px; color: var(--secondary); margin-top: 10px;"></p>
            </div>

            <!-- 2. COMPETITIVIDAD -->
            <div class="card">
                <h2><span class="material-icons">group</span> Competitividad de Marca</h2>
                <div id="competitorChart" class="chart-box"></div>
                <div id="competitorList" style="margin-top: 15px; font-size: 13px;"></div>
            </div>

            <!-- 3. PALANCAS (Levers) -->
            <div class="grid-2">
                <div class="card">
                    <h2><span class="material-icons">tune</span> Palancas & Impacto</h2>
                    <table id="leversTable">
                        <thead><tr><th>Driver</th><th>Impacto en Share</th><th>Status</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="card">
                    <h2><span class="material-icons">scatter_plot</span> Eficiencia (Rank vs Share)</h2>
                    <div id="efficiencyChart" class="chart-box"></div>
                </div>
            </div>

            <!-- 5. INSIGHTS & RECOMENDACIONES -->
            <div class="grid-2">
                <div class="card">
                    <h2><span class="material-icons">lightbulb</span> Insights Clave</h2>
                    <div id="insightsContainer"></div>
                </div>
                <div class="card" style="border-left: 4px solid var(--primary);">
                    <h2><span class="material-icons">assignment_turned_in</span> Recomendaciones</h2>
                    <div id="recommendationsContainer"></div>
                </div>
            </div>
            
            <!-- 6. OTHER INSIGHTS -->
             <div class="card">
                <h2><span class="material-icons">analytics</span> Other Insights</h2>
                <div id="otherInsightsContainer" style="font-size:13px; color: var(--secondary);"></div>
            </div>
        </div>

        <!-- TAB 2: INTERACTIVE -->
        <div id="interactive" class="tab-content hidden">
            <div class="card">
                <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                    <select id="weekSelect" onchange="updateInteractive()" style="padding: 8px; border-radius: 8px; border: 1px solid var(--border);">
                        <!-- Options filled by JS -->
                    </select>
                    <select id="compSelect" onchange="updateInteractive()" style="padding: 8px; border-radius: 8px; border: 1px solid var(--border);">
                        <!-- Options filled by JS -->
                    </select>
                </div>
                
                <div class="grid-3">
                    <div style="text-align: center; padding: 20px; background: var(--primary-light); border-radius: 12px;">
                        <h3 style="margin:0; font-size:14px; color:var(--primary);">Nuestra Marca</h3>
                        <div style="font-size:24px; font-weight:bold;" id="myShare"></div>
                        <div style="font-size:12px;">Click Share</div>
                        <div style="font-weight:bold; margin-top:5px;" id="myPrice"></div>
                        <div style="font-size:12px;">Avg Price</div>
                    </div>
                    <div style="text-align: center; display: flex; align-items: center; justify-content: center;">
                        <span class="material-icons" style="font-size: 32px; color: var(--secondary);">compare_arrows</span>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #f1f3f4; border-radius: 12px;">
                        <h3 style="margin:0; font-size:14px; color:#5f6368;" id="compNameDisplay">Competidor</h3>
                        <div style="font-size:24px; font-weight:bold;" id="compShare"></div>
                        <div style="font-size:12px;">Click Share</div>
                        <div style="font-weight:bold; margin-top:5px;" id="compPrice"></div>
                        <div style="font-size:12px;">Avg Price</div>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h3>Detalle de Variantes (Semana Seleccionada)</h3>
                    <div id="interactiveTable"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const marketData = [{"week":"2025-12-27","brand":"G R O U N D E D COFFEE SCRUB","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...","clicks":2213.85036,"share":2.85,"rank":8,"price":5.99,"deal_days":0,"coupon_days":7,"bs_days":0,"ac_days":0,"asin":"B08BRSVYFM","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2025-12-27","brand":"Nutrition Geeks","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D3 4000 iu & Vitamin K2 MK7 100\u03bcg - 1 Year...","clicks":12467.47308,"share":16.05,"rank":2,"price":9.99,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B0CR57HRDV","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2025-12-27","brand":"Unknown Brand","is_yaba":"N","parent_asin":"Vitamin D3","title":"4 HIM & HER Vitamin D3 4000 IU Vitamin D Tablets -...","clicks":1693.401328,"share":2.18,"rank":42,"price":7.647142857,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B0C1GJRWCL","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2025-12-27","brand":"WeightWorld","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...","clicks":13205.4232,"share":17.0,"rank":2,"price":8.99,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":6,"asin":"B086V74KKR","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2025-12-27","brand":"Incite Nutrition","is_yaba":"Y","parent_asin":"Vitamin D3","title":"Vitamin D3 4000 IU - 400 High Strength Vitamin D T...","clicks":3798.501144,"share":4.89,"rank":5,"price":7.847142857,"deal_days":1,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B00RXIIW7K","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2025-12-27","brand":"Vita Premium","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D 4,000 IU Softgels, Maximum Strength Vita...","clicks":2578.941472,"share":3.32,"rank":8,"price":8.604285714,"deal_days":2,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B072L235Z5","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2025-12-27","brand":"Nutrition Geeks","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D 1000iu - 1 Year Supply, 365 Easy-Swallow...","clicks":2912.961,"share":3.75,"rank":8,"price":6.97,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B08F5GBD9X","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2025-12-27","brand":"Vitabiotics Ultra","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D Tablets 2000IU, Vitabiotics Ultra-96 Cou...","clicks":4047.073816,"share":5.21,"rank":16,"price":6.502857143,"deal_days":0,"coupon_days":5,"bs_days":0,"ac_days":0,"asin":"B075GRYNB8","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2025-12-27","brand":"Vitabiotics Ultra","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D Tablets 1000IU, Vitabiotics Ultra","clicks":11457.6466,"share":14.75,"rank":6,"price":4.248571429,"deal_days":0,"coupon_days":4,"bs_days":0,"ac_days":4,"asin":"B003VQZC3U","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2025-12-27","brand":"Vita Premium","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...","clicks":2400.279864,"share":3.09,"rank":7,"price":9.99,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B0DJDFKXJT","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-03","brand":"Nutrition Geeks","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D3 4000 iu & Vitamin K2 MK7 100\u03bcg - 1 Year...","clicks":10149.770178,"share":17.19,"rank":2,"price":9.99,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B0CR57HRDV","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-03","brand":"Nutrition Geeks","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D 1000iu - 1 Year Supply, 365 Easy-Swallow...","clicks":2733.765906,"share":4.63,"rank":10,"price":6.97,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B08F5GBD9X","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-03","brand":"Vitabiotics Ultra","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D Tablets 1000IU, Vitabiotics Ultra","clicks":7959.214776,"share":13.48,"rank":5,"price":3.765,"deal_days":0,"coupon_days":3,"bs_days":0,"ac_days":2,"asin":"B003VQZC3U","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-03","brand":"Vita Premium","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...","clicks":1877.618916,"share":3.18,"rank":8,"price":9.99,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B0DJDFKXJT","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-03","brand":"Zipvit","is_yaba":"N","parent_asin":"Vitamin D3","title":"Zipvit Vitamin D3 4000 IU, 360 Maximum Strength Vi...","clicks":974.23623,"share":1.65,"rank":15,"price":7.49,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B079H1NVYY","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-03","brand":"Vitabiotics Ultra","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D Tablets 2000IU, Vitabiotics Ultra-96 Cou...","clicks":3017.180082,"share":5.11,"rank":8,"price":5.61,"deal_days":1,"coupon_days":3,"bs_days":0,"ac_days":0,"asin":"B075GRYNB8","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-03","brand":"Vita Premium","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D 4,000 IU Softgels, Maximum Strength Vita...","clicks":2662.912362,"share":4.51,"rank":7,"price":7.64,"deal_days":4,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B072L235Z5","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-03","brand":"WeightWorld","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...","clicks":10385.948658,"share":17.59,"rank":3,"price":8.99,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":4,"asin":"B086V74KKR","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-03","brand":"G R O U N D E D COFFEE SCRUB","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...","clicks":1712.29398,"share":2.9,"rank":10,"price":5.99,"deal_days":0,"coupon_days":4,"bs_days":0,"ac_days":0,"asin":"B08BRSVYFM","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-03","brand":"Incite Nutrition","is_yaba":"Y","parent_asin":"Vitamin D3","title":"Vitamin D3 4000 IU - 400 High Strength Vitamin D T...","clicks":2586.154356,"share":4.38,"rank":7,"price":7.99,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B00RXIIW7K","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-10","brand":"G R O U N D E D COFFEE SCRUB","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...","clicks":2953.566048,"share":2.37,"rank":8,"price":5.99,"deal_days":0,"coupon_days":7,"bs_days":0,"ac_days":0,"asin":"B08BRSVYFM","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-10","brand":"Vita Premium","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...","clicks":4062.711104,"share":3.26,"rank":7,"price":9.99,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B0DJDFKXJT","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-10","brand":"Vitabiotics Ultra","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D Tablets 2000IU, Vitabiotics Ultra-96 Cou...","clicks":17434.763296,"share":13.99,"rank":7,"price":3.79,"deal_days":7,"coupon_days":0,"bs_days":0,"ac_days":1,"asin":"B075GRYNB8","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-10","brand":"Vitabiotics Ultra","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D Tablets 1000IU, Vitabiotics Ultra","clicks":6368.237344,"share":5.11,"rank":29,"price":1.177142857,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B003VQZC3U","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-10","brand":"Incite Nutrition","is_yaba":"Y","parent_asin":"Vitamin D3","title":"Vitamin D3 4000 IU - 400 High Strength Vitamin D T...","clicks":9296.878784,"share":7.46,"rank":6,"price":6.961428571,"deal_days":6,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B00RXIIW7K","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-10","brand":"Nu U Nutrition","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D3 4000 IU - 400 Vegetarian Tablets - 13 M...","clicks":1981.506336,"share":1.59,"rank":18,"price":6.691428571,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B0BFF8LYR2","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-10","brand":"WeightWorld","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...","clicks":21073.756064,"share":16.91,"rank":1,"price":8.99,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":7,"asin":"B086V74KKR","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-10","brand":"Vita Premium","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D 4,000 IU Softgels, Maximum Strength Vita...","clicks":4523.816352,"share":3.63,"rank":6,"price":8.025714286,"deal_days":5,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B072L235Z5","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-10","brand":"Nutrition Geeks","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D3 4000 iu & Vitamin K2 MK7 100\u03bcg - 1 Year...","clicks":20201.394784,"share":16.21,"rank":3,"price":9.99,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B0CR57HRDV","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-10","brand":"Nutrition Geeks","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D 1000iu - 1 Year Supply, 365 Easy-Swallow...","clicks":5234.16768,"share":4.2,"rank":8,"price":6.984285714,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B08F5GBD9X","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-17","brand":"Vitabiotics Ultra","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D Tablets 2000IU, Vitabiotics Ultra-96 Cou...","clicks":13225.223442,"share":10.49,"rank":10,"price":7.19,"deal_days":3,"coupon_days":0,"bs_days":0,"ac_days":1,"asin":"B075GRYNB8","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-17","brand":"Vitabiotics Ultra","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D Tablets 1000IU, Vitabiotics Ultra","clicks":4639.544544,"share":3.68,"rank":31,"price":2.141428571,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B003VQZC3U","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-17","brand":"Vitabiotics Ultra","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D Tablets 400IU, Vitabiotics Ultra","clicks":2824.070592,"share":2.24,"rank":32,"price":2.666,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B0CZ7C4JWR","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-17","brand":"Nutrition Geeks","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D3 4000 iu & Vitamin K2 MK7 100\u03bcg - 1 Year...","clicks":22693.4244,"share":18.0,"rank":2,"price":9.99,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B0CR57HRDV","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-17","brand":"Nutrition Geeks","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D 1000iu - 1 Year Supply, 365 Easy-Swallow...","clicks":6404.588664,"share":5.08,"rank":8,"price":6.99,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B08F5GBD9X","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-17","brand":"G R O U N D E D COFFEE SCRUB","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...","clicks":2887.107882,"share":2.29,"rank":8,"price":5.99,"deal_days":0,"coupon_days":7,"bs_days":0,"ac_days":0,"asin":"B08BRSVYFM","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-17","brand":"Vita Premium","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D 4,000 IU Softgels, Maximum Strength Vita...","clicks":3454.443492,"share":2.74,"rank":10,"price":8.99,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B072L235Z5","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-17","brand":"Incite Nutrition","is_yaba":"Y","parent_asin":"Vitamin D3","title":"Vitamin D3 4000 IU - 400 High Strength Vitamin D T...","clicks":6694.560198,"share":5.31,"rank":5,"price":6.79,"deal_days":7,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B00RXIIW7K","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-17","brand":"Vita Premium","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...","clicks":4299.143178,"share":3.41,"rank":7,"price":9.99,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":0,"asin":"B0DJDFKXJT","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"},{"week":"2026-01-17","brand":"WeightWorld","is_yaba":"N","parent_asin":"Vitamin D3","title":"Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...","clicks":23828.09562,"share":18.9,"rank":1,"price":8.99,"deal_days":0,"coupon_days":0,"bs_days":0,"ac_days":7,"asin":"B086V74KKR","link":"https:\/\/www.amazon.co.uk\/s?k=vitamin+d","grams":0,"organic_or_not":"organic"}];
        const OUR_BRAND = "Incite Nutrition";

        google.charts.load('current', {'packages':['corechart', 'table', 'bar']});
        google.charts.setOnLoadCallback(initDashboard);

        let weeks = [];
        let brands = [];

        function initDashboard() {
            // Process basic metadata
            weeks = [...new Set(marketData.map(d => d.week))].sort();
            brands = [...new Set(marketData.map(d => d.brand))];
            
            document.getElementById('lastWeekDate').innerText = weeks[weeks.length-1];

            drawTrendChart();
            drawCompetitorChart();
            drawEfficiencyChart();
            generateInsights();
            setupInteractive();
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.remove('hidden');
            event.target.classList.add('active');
        }

        // --- CHART 1: TREND ---
        function drawTrendChart() {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Week');
            data.addColumn('number', 'Our Clicks');
            data.addColumn('number', 'Competitor Clicks');
            data.addColumn('number', 'Our Click Share %');

            const trendData = weeks.map(week => {
                const weekData = marketData.filter(d => d.week === week);
                const totalClicks = weekData.reduce((sum, d) => sum + d.clicks, 0);
                const ourClicks = weekData.filter(d => d.is_yaba === 'Y').reduce((sum, d) => sum + d.clicks, 0);
                const compClicks = totalClicks - ourClicks;
                const ourShare = (ourClicks / totalClicks) * 100 || 0;
                return [week, ourClicks, compClicks, ourShare];
            });

            data.addRows(trendData);

            const options = {
                seriesType: 'bars',
                series: {2: {type: 'line', targetAxisIndex: 1}},
                vAxes: {0: {title: 'Volume (Clicks)'}, 1: {title: 'Share %', format: '#\'%\''}},
                colors: ['#4285F4', '#dadce0', '#34A853'],
                legend: {position: 'bottom'},
                chartArea: {width: '85%', height: '70%'}
            };

            const chart = new google.visualization.ComboChart(document.getElementById('trendChart'));
            chart.draw(data, options);

            // Update stats
            const lastData = trendData[trendData.length-1];
            const prevData = trendData[trendData.length-2] || lastData;
            document.getElementById('totalClicks').innerText = Math.round(trendData.reduce((a,b)=>a+b[1]+b[2],0)).toLocaleString();
            document.getElementById('shareTrend').innerText = lastData[3].toFixed(1) + '%';
            
            const trendText = lastData[3] > prevData[3] ? "ganando" : "perdiendo";
            document.getElementById('trendInsight').innerText = `En la última semana, ${OUR_BRAND} está ${trendText} visibilidad (share: ${lastData[3].toFixed(1)}% vs ${prevData[3].toFixed(1)}%).`;
        }

        // --- CHART 2: COMPETITIVENESS ---
        function drawCompetitorChart() {
            // Find top 3 competitors by total clicks
            const compTotals = brands.filter(b => b !== OUR_BRAND).map(b => {
                return {
                    brand: b,
                    clicks: marketData.filter(d => d.brand === b).reduce((sum, d) => sum + d.clicks, 0)
                };
            }).sort((a,b) => b.clicks - a.clicks).slice(0, 3).map(b => b.brand);

            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Week');
            data.addColumn('number', OUR_BRAND);
            compTotals.forEach(c => data.addColumn('number', c));
            data.addColumn('number', 'Rest of Market');

            const rows = weeks.map(week => {
                const weekData = marketData.filter(d => d.week === week);
                const totalClicks = weekData.reduce((sum, d) => sum + d.clicks, 0);
                
                const getShare = (brand) => {
                    const clicks = weekData.filter(d => d.brand === brand).reduce((sum, d) => sum + d.clicks, 0);
                    return (clicks / totalClicks) * 100 || 0;
                };

                const row = [week, getShare(OUR_BRAND)];
                compTotals.forEach(c => row.push(getShare(c)));
                
                const topBrands = [OUR_BRAND, ...compTotals];
                const restClicks = weekData.filter(d => !topBrands.includes(d.brand)).reduce((sum,d) => sum + d.clicks, 0);
                row.push((restClicks/totalClicks)*100);
                
                return row;
            });

            data.addRows(rows);
            
            const options = {
                curveType: 'function',
                legend: { position: 'bottom' },
                vAxis: { title: 'Click Share %' },
                colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853', '#9aa0a6'],
                chartArea: {width: '85%', height: '70%'}
            };

            const chart = new google.visualization.LineChart(document.getElementById('competitorChart'));
            chart.draw(data, options);
            
            document.getElementById('competitorList').innerHTML = `<b>Top Competidores:</b> ${compTotals.join(', ')}`;
        }

        // --- CHART 3: EFFICIENCY (Last Week) ---
        function drawEfficiencyChart() {
            const lastWeek = weeks[weeks.length-1];
            const weekData = marketData.filter(d => d.week === lastWeek && d.clicks > 0);

            const data = new google.visualization.DataTable();
            data.addColumn('number', 'Organic Rank');
            data.addColumn('number', 'Click Share');
            data.addColumn('string', {role: 'style'});
            data.addColumn('string', {role: 'tooltip'});

            weekData.forEach(d => {
                const color = d.is_yaba === 'Y' ? '#4285F4' : '#dadce0';
                const tooltip = `${d.title}
Rank: ${d.rank}, Share: ${d.share}%`;
                data.addRow([d.rank, d.share, `point { size: 5; fill-color: ${color}; }`, tooltip]);
            });

            const options = {
                hAxis: { title: 'Organic Rank (Lower is Better)', direction: 1 },
                vAxis: { title: 'Click Share %' },
                legend: 'none',
                chartArea: {width: '85%', height: '75%'}
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('efficiencyChart'));
            chart.draw(data, options);
        }

        // --- INSIGHTS ENGINE ---
        function generateInsights() {
            const insights = [];
            const recs = [];
            const otherInsights = [];
            const lastWeek = weeks[weeks.length-1];
            const weekData = marketData.filter(d => d.week === lastWeek);
            
            // 1. Price Analysis
            const myProds = weekData.filter(d => d.is_yaba === 'Y');
            const compProds = weekData.filter(d => d.is_yaba === 'N');
            const myAvgPrice = myProds.reduce((a,b)=>a+b.price,0) / (myProds.length||1);
            const compAvgPrice = compProds.reduce((a,b)=>a+b.price,0) / (compProds.length||1);
            
            if (myAvgPrice > compAvgPrice * 1.1) {
                insights.push({icon: 'attach_money', title: 'Sensibilidad al Precio', text: `Tu precio promedio ($${myAvgPrice.toFixed(2)}) es 10% mayor que la competencia ($${compAvgPrice.toFixed(2)}).`});
                recs.push("Evaluar estrategia de cupones para mitigar la diferencia de precio.");
            }

            // 2. Deal Impact
            const dealDays = myProds.some(d => d.deal_days > 0);
            if (!dealDays) {
                recs.push("Activar 'Deal Days' o Cupones para recuperar visibilidad.");
            }

            // 3. Efficiency
            const inefficient = myProds.filter(d => d.rank < 10 && d.share < 5);
            if (inefficient.length > 0) {
                insights.push({icon: 'warning', title: 'Ineficiencia de Conversión', text: `${inefficient.length} ASINs tienen buen rank (top 10) pero bajo click share (<5%).`});
                recs.push("Revisar Imagen Principal y Título de los ASINs top rankeados con bajo CTR.");
            }

            // 4. Growth
            const totalShare = myProds.reduce((a,b)=>a+b.share,0);
            if (totalShare < 10) {
                recs.push("Defensa de Marca: Tu cuota total es baja (<10%). Considerar publicidad defensiva.");
            }

            // 5. Competitors
            const topComp = weekData.filter(d => d.is_yaba === 'N').sort((a,b)=>b.share - a.share)[0];
            if (topComp) {
                otherInsights.push(`El competidor dominante es ${topComp.brand} con el producto "${topComp.title.substr(0,30)}..." (${topComp.share}% share).`);
            }

            // Render
            const renderList = (list, container) => {
                document.getElementById(container).innerHTML = list.map(i => `
                    <div class="insight-item">
                        <div class="insight-icon"><span class="material-icons">${i.icon || 'info'}</span></div>
                        <div class="insight-text"><h4>${i.title || 'Insight'}</h4><p>${i.text || i}</p></div>
                    </div>
                `).join('');
            };
            
            renderList(insights, 'insightsContainer');
            document.getElementById('recommendationsContainer').innerHTML = recs.map(r => `<div style="margin-bottom:10px; font-size:13px;">• ${r}</div>`).join('');
            document.getElementById('otherInsightsContainer').innerHTML = otherInsights.map(r => `<div>• ${r}</div>`).join('');
            
            // Levers Table Logic
            const leversBody = document.querySelector('#leversTable tbody');
            const levers = [
                {name: 'Best Seller', has: myProds.some(p => p.bs_days > 0)},
                {name: 'Amazon Choice', has: myProds.some(p => p.ac_days > 0)},
                {name: 'Deals', has: myProds.some(p => p.deal_days > 0)},
                {name: 'Coupons', has: myProds.some(p => p.coupon_days > 0)}
            ];
            leversBody.innerHTML = levers.map(l => `
                <tr>
                    <td>${l.name}</td>
                    <td>${l.has ? '<span style="color:var(--success)">Activo</span>' : '<span style="color:#dadce0">Inactivo</span>'}</td>
                    <td>${l.has ? 'High Impact' : '-'}</td>
                </tr>
            `).join('');
        }

        // --- INTERACTIVE TAB ---
        function setupInteractive() {
            const weekSel = document.getElementById('weekSelect');
            weekSel.innerHTML = weeks.map(w => `<option value="${w}">${w}</option>`).join('');
            weekSel.value = weeks[weeks.length-1];

            const compSel = document.getElementById('compSelect');
            const compList = brands.filter(b => b !== OUR_BRAND);
            compSel.innerHTML = compList.map(b => `<option value="${b}">${b}</option>`).join('');

            updateInteractive();
        }

        function updateInteractive() {
            const week = document.getElementById('weekSelect').value;
            const comp = document.getElementById('compSelect').value;
            const weekData = marketData.filter(d => d.week === week);

            // My Stats
            const myData = weekData.filter(d => d.brand === OUR_BRAND);
            const myShare = myData.reduce((s,d)=>s+d.share,0); // Sum shares
            const myPrice = myData.reduce((s,d)=>s+d.price,0) / (myData.length||1);

            // Comp Stats
            const compData = weekData.filter(d => d.brand === comp);
            const compShare = compData.reduce((s,d)=>s+d.share,0);
            const compPrice = compData.reduce((s,d)=>s+d.price,0) / (compData.length||1);

            document.getElementById('myShare').innerText = myShare.toFixed(1) + '%';
            document.getElementById('myPrice').innerText = '£' + myPrice.toFixed(2);
            
            document.getElementById('compNameDisplay').innerText = comp;
            document.getElementById('compShare').innerText = compShare.toFixed(1) + '%';
            document.getElementById('compPrice').innerText = '£' + compPrice.toFixed(2);

            // Detailed Table
            const allProducts = [...myData, ...compData].sort((a,b) => b.share - a.share);
            let tableHTML = `<table style="margin-top:15px; width:100%;">
                <thead><tr style="background:#f8f9fa;"><th>ASIN</th><th>Brand</th><th>Title</th><th>Rank</th><th>Share</th><th>Price</th></tr></thead>
                <tbody>`;
            allProducts.forEach(p => {
                tableHTML += `<tr>
                    <td><a href="${p.link}" target="_blank">${p.asin}</a></td>
                    <td>${p.brand}</td>
                    <td title="${p.title}">${p.title.substring(0,30)}...</td>
                    <td>${p.rank}</td>
                    <td>${p.share}%</td>
                    <td>£${p.price}</td>
                </tr>`;
            });
            tableHTML += '</tbody></table>';
            document.getElementById('interactiveTable').innerHTML = tableHTML;
        }
    </script>
</body>
</html>