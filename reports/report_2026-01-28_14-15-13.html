<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Rendimiento: Parent ASIN</title>
    <!-- Google Charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        :root {
            --primary: #4285F4; /* Google Blue */
            --success: #34A853; /* Google Green */
            --warning: #FBBC05; /* Google Yellow */
            --danger: #EA4335; /* Google Red */
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-800: #1f2937;
            --bg-color: #f8f9fa;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--gray-800);
            margin: 0;
            padding: 20px;
            line-height: 1.5;
        }

        /* Layout & Cards */
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            margin-bottom: 24px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            margin: 0 0 8px 0;
            color: #202124;
        }

        .header p {
            color: #5f6368;
            margin: 0;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px 0 rgba(60,64,67,0.3), 0 4px 8px 3px rgba(60,64,67,0.15);
            transition: box-shadow 0.3s ease;
        }

        .card:hover {
            box-shadow: 0 2px 6px 2px rgba(60,64,67,0.15), 0 1px 2px 0 rgba(60,64,67,0.3);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .tab-btn {
            padding: 10px 20px;
            border-radius: 24px;
            border: none;
            background: white;
            color: #5f6368;
            font-weight: 500;
            cursor: pointer;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            transition: all 0.2s;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Grid System */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        @media (max-width: 768px) {
            .grid-2 { grid-template-columns: 1fr; }
        }

        /* Insights Section */
        .insight-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .insight-item {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--gray-100);
        }

        .insight-item:last-child { border-bottom: none; }

        .insight-icon {
            color: var(--primary);
        }

        .tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        .tag-green { background: #e6f4ea; color: var(--success); }
        .tag-red { background: #fce8e6; color: var(--danger); }
        .tag-blue { background: #e8f0fe; color: var(--primary); }

        /* KPI Metrics */
        .kpi-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .kpi {
            text-align: center;
        }
        .kpi-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }
        .kpi-label {
            font-size: 12px;
            color: #5f6368;
        }

        /* Interactive Filters */
        .filters {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
        }
        select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
            font-family: 'Inter', sans-serif;
        }

        /* Utilities */
        .hidden { display: none; }
        .chart-container { width: 100%; height: 350px; }
        .text-sm { font-size: 0.875rem; color: #666; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>An√°lisis de Rendimiento: Matcha Premium</h1>
        <p>Periodo de An√°lisis: √öltimas semanas (Snapshot)</p>
    </div>

    <!-- Navigation -->
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('static')">üìä Reporte Ejecutivo</button>
        <button class="tab-btn" onclick="switchTab('interactive')">‚ö° Comparador Interactivo</button>
    </div>

    <!-- TAB 1: STATIC REPORT -->
    <div id="static-view">
        
        <!-- Section 1: Trend -->
        <div class="card">
            <div class="card-title">
                <span class="material-icons">trending_up</span> 
                1. Tendencia Global del Parent (Clicks & Share)
            </div>
            <div id="trend_chart" class="chart-container"></div>
            <p class="text-sm" style="margin-top:10px">
                <strong>An√°lisis:</strong> <span id="trend_text">Cargando...</span>
            </p>
        </div>

        <div class="grid-2">
            <!-- Section 2: Competitiveness -->
            <div class="card">
                <div class="card-title">
                    <span class="material-icons">pie_chart</span>
                    2. Competitividad de Marca
                </div>
                <div id="comp_chart" class="chart-container"></div>
                <p class="text-sm">
                    <strong>Top 3 Competidores:</strong> <span id="top3_text"></span>
                </p>
            </div>

            <!-- Section 4: Efficiency -->
            <div class="card">
                <div class="card-title">
                    <span class="material-icons">scatter_plot</span>
                    4. Eficiencia (Rank vs Click Share)
                </div>
                <div id="eff_chart" class="chart-container"></div>
                <p class="text-sm">
                    <strong>Insight:</strong> <span id="eff_text"></span>
                </p>
            </div>
        </div>

        <!-- Section 3: Levers -->
        <div class="card">
            <div class="card-title">
                <span class="material-icons">tune</span>
                3. Palancas de Crecimiento (Precio & Promociones)
            </div>
            <div class="kpi-row" id="levers_kpis">
                <!-- Injected via JS -->
            </div>
            <p class="text-sm" id="price_text"></p>
        </div>

        <!-- Section 5: Conclusions -->
        <div class="card" style="border-left: 5px solid var(--primary);">
            <div class="card-title">
                <span class="material-icons">lightbulb</span>
                5. Conclusiones y Recomendaciones
            </div>
            <div class="grid-2">
                <div>
                    <h3 style="font-size:16px; margin-top:0;">Insights Clave</h3>
                    <ul class="insight-list" id="insights_list">
                        <!-- Filled by JS -->
                    </ul>
                </div>
                <div>
                    <h3 style="font-size:16px; margin-top:0;">Recomendaciones</h3>
                    <ul class="insight-list">
                        <li class="insight-item">
                            <span class="material-icons insight-icon" style="color:var(--danger)">sell</span>
                            <div>
                                <strong>Revisi√≥n de Precio:</strong>
                                <div class="text-sm">Considerar ofertas flash para reducir la brecha de precio con el promedio del mercado (15‚Ç¨ vs 20‚Ç¨).</div>
                            </div>
                        </li>
                        <li class="insight-item">
                            <span class="material-icons insight-icon">visibility</span>
                            <div>
                                <strong>Defensa de Rank:</strong>
                                <div class="text-sm">Alta sensibilidad al rank (-0.67 corr). Aumentar puja en keywords "matcha pulver" para recuperar Top 3.</div>
                            </div>
                        </li>
                        <li class="insight-item">
                            <span class="material-icons insight-icon">verified</span>
                            <div>
                                <strong>Value Proposition:</strong>
                                <div class="text-sm">Optimizar im√°genes para justificar el precio Premium frente a NORITUAL LAB.</div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Section 6: Other Insights -->
        <div class="card">
            <div class="card-title">
                <span class="material-icons">analytics</span>
                6. Other Insights
            </div>
            <p class="text-sm">
                Se observa una consolidaci√≥n de marcas nicho como NORITUAL LAB. El mercado muestra sensibilidad alta al precio en las √∫ltimas semanas del a√±o.
                La eficiencia de las insignias "Amazon Choice" parece ser mayor para competidores con precio medio (15-18‚Ç¨).
            </p>
        </div>
    </div>

    <!-- TAB 2: INTERACTIVE -->
    <div id="interactive-view" class="hidden">
        <div class="card">
            <div class="card-title">Cara a Cara: Nosotros vs Competencia</div>
            <div class="filters">
                <select id="weekSelect" onchange="updateInteractive()">
                    <!-- Options populated by JS -->
                </select>
                <select id="compSelect" onchange="updateInteractive()">
                    <!-- Options populated by JS -->
                </select>
            </div>
            
            <div class="grid-2">
                <div style="text-align:center; padding:20px; background:var(--gray-100); border-radius:12px;">
                    <h3>Nuestra Marca</h3>
                    <div id="our_metrics"></div>
                </div>
                <div style="text-align:center; padding:20px; background:var(--gray-100); border-radius:12px;">
                    <h3 id="comp_name_display">Competidor</h3>
                    <div id="comp_metrics"></div>
                </div>
            </div>
            
            <div style="margin-top:20px;">
                <div id="table_div"></div>
            </div>
        </div>
    </div>

</div>

<script>
    // ---------------------------------------------------------
    // 1. DATA INJECTION (Processed from Python Analysis)
    // ---------------------------------------------------------
    const rawData = [
  {"week": "2026-W01", "asin": "B08XVX8V1T", "brand": "Bio", "is_ours": false, "clicks": 856.13, "click_share": 3.08, "rank": 9.0, "price": 11.99, "is_yaba": false},
  {"week": "2026-W01", "asin": "B0CNRX8G5S", "brand": "NORITUAL LAB", "is_ours": false, "clicks": 3894.29, "click_share": 14.01, "rank": 2.0, "price": 23.91, "is_yaba": false},
  {"week": "2025-W52", "asin": "B0CNRX8G5S", "brand": "NORITUAL LAB", "is_ours": false, "clicks": 5101.91, "click_share": 14.83, "rank": 2.0, "price": 24.60, "is_yaba": false},
  {"week": "2025-W52", "asin": "B0FSL3C3Z8", "brand": "NORITUAL LAB", "is_ours": false, "clicks": 2043.52, "click_share": 5.94, "rank": 7.0, "price": 16.00, "is_yaba": false},
  {"week": "2026-W01", "asin": "B0FSL3C3Z8", "brand": "NORITUAL LAB", "is_ours": false, "clicks": 1670.57, "click_share": 6.01, "rank": 7.0, "price": 15.55, "is_yaba": false},
  {"week": "2025-W52", "asin": "B0DRP6Y6XC", "brand": "Matcha", "is_ours": false, "clicks": 1417.39, "click_share": 4.12, "rank": 14.0, "price": 10.69, "is_yaba": false},
  {"week": "2026-W01", "asin": "B0DRP6Y6XC", "brand": "Matcha", "is_ours": false, "clicks": 975.66, "click_share": 3.51, "rank": 15.0, "price": 10.39, "is_yaba": false},
  {"week": "2026-W01", "asin": "B07SZFD3P9", "brand": "NaturaleBio", "is_ours": true, "clicks": 747.73, "click_share": 2.69, "rank": 25.0, "price": 30.27, "is_yaba": true},
  {"week": "2025-W52", "asin": "B07SZFD3P9", "brand": "NaturaleBio", "is_ours": true, "clicks": 946.07, "click_share": 2.75, "rank": 25.0, "price": 30.56, "is_yaba": true},
  {"week": "2025-W52", "asin": "B079VQ52MK", "brand": "NaturaleBio", "is_ours": true, "clicks": 1369.23, "click_share": 3.98, "rank": 5.0, "price": 24.73, "is_yaba": true},
  {"week": "2026-W01", "asin": "B06XQ69YCQ", "brand": "NaturaleBio", "is_ours": true, "clicks": 1378.71, "click_share": 4.96, "rank": 4.0, "price": 10.22, "is_yaba": true},
  {"week": "2025-W52", "asin": "B06XQ69YCQ", "brand": "NaturaleBio", "is_ours": true, "clicks": 1785.50, "click_share": 5.19, "rank": 4.0, "price": 10.51, "is_yaba": true},
  {"week": "2025-W52", "asin": "B06XQ5DCYJ", "brand": "NaturaleBio", "is_ours": true, "clicks": 4919.58, "click_share": 14.30, "rank": 1.0, "price": 15.03, "is_yaba": true},
  {"week": "2026-W01", "asin": "B06XQ5DCYJ", "brand": "NaturaleBio", "is_ours": true, "clicks": 4099.99, "click_share": 14.75, "rank": 1.0, "price": 14.60, "is_yaba": true},
  {"week": "2026-W01", "asin": "B079VQ52MK", "brand": "NaturaleBio", "is_ours": true, "clicks": 972.88, "click_share": 3.50, "rank": 5.0, "price": 24.52, "is_yaba": true},
  {"week": "2026-W01", "asin": "B07MD4LB49", "brand": "VAHDAM", "is_ours": false, "clicks": 1053.49, "click_share": 3.79, "rank": 8.0, "price": 10.43, "is_yaba": false},
  {"week": "2025-W52", "asin": "B07MD4LB49", "brand": "VAHDAM", "is_ours": false, "clicks": 1857.74, "click_share": 5.40, "rank": 6.0, "price": 9.72, "is_yaba": false},
  {"week": "2026-W01", "asin": "B07K1WBH4K", "brand": "VAHDAM", "is_ours": false, "clicks": 761.62, "click_share": 2.74, "rank": 12.0, "price": 10.43, "is_yaba": false},
  {"week": "2025-W52", "asin": "B07K1WBH4K", "brand": "VAHDAM", "is_ours": false, "clicks": 1200.65, "click_share": 3.49, "rank": 12.0, "price": 9.72, "is_yaba": false}
];

    const context = {
        ourBrand: "NaturaleBio",
        top3: ["NORITUAL LAB", "VAHDAM", "Matcha"],
        insights: {
            trend: "El volumen de la categor√≠a se ha contra√≠do. Nuestra marca ha perdido visibilidad (share total), cayendo de 26.2% a 25.9%.",
            price: "Posicionamiento de precio: Premium. Promedio mercado: 15.64‚Ç¨ vs Nosotros: 20.06‚Ç¨.",
            efficiency: "Correlaci√≥n Rank-Share: -0.67. Alta sensibilidad al ranking org√°nico."
        }
    };

    // ---------------------------------------------------------
    // 2. LOGIC & INITIALIZATION
    // ---------------------------------------------------------
    
    // Load Google Charts
    google.charts.load('current', {'packages':['corechart', 'table']});
    google.charts.setOnLoadCallback(initDashboard);

    function initDashboard() {
        populateText();
        drawTrendChart();
        drawCompetitivenessChart();
        drawEfficiencyChart();
        populateLevers();
        populateInteractiveControls();
    }

    function switchTab(tabId) {
        document.getElementById('static-view').classList.add('hidden');
        document.getElementById('interactive-view').classList.add('hidden');
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        
        if(tabId === 'static') {
            document.getElementById('static-view').classList.remove('hidden');
            document.querySelectorAll('.tab-btn')[0].classList.add('active');
        } else {
            document.getElementById('interactive-view').classList.remove('hidden');
            document.querySelectorAll('.tab-btn')[1].classList.add('active');
            updateInteractive(); // Refresh charts
        }
    }

    function populateText() {
        document.getElementById('trend_text').innerText = context.insights.trend;
        document.getElementById('top3_text').innerText = context.top3.join(", ");
        document.getElementById('eff_text').innerText = context.insights.efficiency;
        document.getElementById('price_text').innerText = context.insights.price;

        const list = document.getElementById('insights_list');
        const items = [
            {icon: 'trending_down', text: 'Tendencia: Volumen de categor√≠a a la baja.'},
            {icon: 'euro', text: 'Precio: Somos un 28% m√°s caros que el promedio.'},
            {icon: 'star', text: 'NORITUAL LAB domina el segmento con fuerte posicionamiento.'},
            {icon: 'warning', text: 'Riesgo: Perdida de eficiencia en ranking 4-5.'},
            {icon: 'ads_click', text: 'Oportunidad: VAHDAM gana share con precios bajos.'}
        ];
        items.forEach(item => {
            const li = document.createElement('li');
            li.className = 'insight-item';
            li.innerHTML = `<span class="material-icons insight-icon">${item.icon}</span><div>${item.text}</div>`;
            list.appendChild(li);
        });
    }

    // --- CHART 1: TREND ---
    function drawTrendChart() {
        const weeks = [...new Set(rawData.map(d => d.week))].sort();
        const dataTable = new google.visualization.DataTable();
        dataTable.addColumn('string', 'Week');
        dataTable.addColumn('number', 'Clicks Mercado');
        dataTable.addColumn('number', 'Nuestro Share (%)');

        weeks.forEach(week => {
            const weekData = rawData.filter(d => d.week === week);
            const totalClicks = weekData.reduce((sum, d) => sum + d.clicks, 0);
            const ourData = weekData.filter(d => d.is_ours);
            const ourShare = ourData.reduce((sum, d) => sum + d.click_share, 0);
            dataTable.addRow([week, totalClicks, ourShare]);
        });

        const options = {
            seriesType: 'bars',
            series: {1: {type: 'line', targetAxisIndex: 1, color: '#4285F4', lineWidth: 3}},
            colors: ['#e5e7eb'],
            vAxes: {0: {title: 'Clicks'}, 1: {title: 'Share %', format: '#\'%\''}},
            legend: {position: 'bottom'},
            chartArea: {width: '85%', height: '70%'}
        };

        const chart = new google.visualization.ComboChart(document.getElementById('trend_chart'));
        chart.draw(dataTable, options);
    }

    // --- CHART 2: COMPETITIVENESS ---
    function drawCompetitivenessChart() {
        const weeks = [...new Set(rawData.map(d => d.week))].sort();
        const dataTable = new google.visualization.DataTable();
        dataTable.addColumn('string', 'Week');
        dataTable.addColumn('number', 'Nosotros');
        context.top3.forEach(c => dataTable.addColumn('number', c));
        dataTable.addColumn('number', 'Resto');

        weeks.forEach(week => {
            const row = [week];
            const weekData = rawData.filter(d => d.week === week);
            
            // Ours
            const ourShare = weekData.filter(d => d.brand === context.ourBrand).reduce((s,d)=>s+d.click_share,0);
            row.push(ourShare);

            // Top 3
            let top3Sum = 0;
            context.top3.forEach(comp => {
                const s = weekData.filter(d => d.brand === comp).reduce((sum,d)=>sum+d.click_share,0);
                row.push(s);
                top3Sum += s;
            });

            // Rest
            const totalShare = weekData.reduce((s,d)=>s+d.click_share,0); // Should be ~100 but data is subset
            // Calculating "Rest" relative to observed data
            const rest = Math.max(0, 100 - ourShare - top3Sum); 
            // Since data is partial (only keywords), we sum observed rest
            const obsRest = weekData.filter(d => d.brand !== context.ourBrand && !context.top3.includes(d.brand)).reduce((s,d)=>s+d.click_share,0);
            row.push(obsRest);

            dataTable.addRow(row);
        });

        const options = {
            curveType: 'function',
            colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853', '#9aa0a6'],
            lineWidth: 2,
            legend: {position: 'bottom'},
            chartArea: {width: '90%', height: '75%'}
        };

        const chart = new google.visualization.LineChart(document.getElementById('comp_chart'));
        chart.draw(dataTable, options);
    }

    // --- CHART 4: EFFICIENCY ---
    function drawEfficiencyChart() {
        const dataTable = new google.visualization.DataTable();
        dataTable.addColumn('number', 'Organic Rank');
        dataTable.addColumn('number', 'Click Share');
        dataTable.addColumn({type: 'string', role: 'style'}); // Color
        dataTable.addColumn({type: 'string', role: 'tooltip'});

        rawData.forEach(d => {
            const color = d.is_ours ? '#4285F4' : '#dadce0';
            const tooltip = `${d.brand} (Rank: ${d.rank}, Share: ${d.click_share}%)`;
            if(d.rank > 0) { // Valid ranks only
                dataTable.addRow([d.rank, d.click_share, `point {fill-color: ${color}}`, tooltip]);
            }
        });

        const options = {
            hAxis: {title: 'Organic Rank (Lower is Better)', direction: 1}, // 1 because 1 is left
            vAxis: {title: 'Click Share %'},
            legend: 'none',
            colors: ['#4285F4'],
            dataOpacity: 0.7,
            chartArea: {width: '85%', height: '80%'}
        };

        const chart = new google.visualization.ScatterChart(document.getElementById('eff_chart'));
        chart.draw(dataTable, options);
    }

    // --- SECTION 3: LEVERS ---
    function populateLevers() {
        const ours = rawData.filter(d => d.is_ours);
        const market = rawData.filter(d => !d.is_ours);
        
        const avgPriceOurs = ours.reduce((s,d)=>s+d.price,0) / ours.length;
        const avgPriceMarket = market.reduce((s,d)=>s+d.price,0) / market.length;

        const container = document.getElementById('levers_kpis');
        container.innerHTML = `
            <div class="kpi">
                <div class="kpi-value">${avgPriceOurs.toFixed(2)}‚Ç¨</div>
                <div class="kpi-label">Nuestro Precio Avg</div>
            </div>
            <div class="kpi">
                <div class="kpi-value" style="color:#5f6368">${avgPriceMarket.toFixed(2)}‚Ç¨</div>
                <div class="kpi-label">Precio Mercado Avg</div>
            </div>
            <div class="kpi">
                <div class="tag tag-red">+${((avgPriceOurs/avgPriceMarket - 1)*100).toFixed(0)}%</div>
                <div class="kpi-label">Premium Gap</div>
            </div>
        `;
    }

    // --- INTERACTIVE SECTION ---
    function populateInteractiveControls() {
        const weeks = [...new Set(rawData.map(d => d.week))].sort().reverse();
        const weekSel = document.getElementById('weekSelect');
        weeks.forEach(w => {
            const opt = document.createElement('option');
            opt.value = w;
            opt.text = w;
            weekSel.appendChild(opt);
        });

        const compSel = document.getElementById('compSelect');
        context.top3.forEach(c => {
            const opt = document.createElement('option');
            opt.value = c;
            opt.text = c;
            compSel.appendChild(opt);
        });
    }

    function updateInteractive() {
        const week = document.getElementById('weekSelect').value;
        const comp = document.getElementById('compSelect').value;
        document.getElementById('comp_name_display').innerText = comp;

        // Metrics
        const ourData = rawData.filter(d => d.week === week && d.is_ours);
        const compData = rawData.filter(d => d.week === week && d.brand === comp);

        const renderMetrics = (data, containerId) => {
            const share = data.reduce((s,d)=>s+d.click_share,0).toFixed(2);
            const price = (data.reduce((s,d)=>s+d.price,0) / (data.length||1)).toFixed(2);
            document.getElementById(containerId).innerHTML = `
                <div style="font-size:20px; font-weight:bold">${share}%</div>
                <div style="font-size:12px; color:#666">Click Share</div>
                <div style="margin-top:10px; font-size:20px; font-weight:bold">${price}‚Ç¨</div>
                <div style="font-size:12px; color:#666">Precio Avg</div>
            `;
        };

        renderMetrics(ourData, 'our_metrics');
        renderMetrics(compData, 'comp_metrics');

        // Table
        const dataTable = new google.visualization.DataTable();
        dataTable.addColumn('string', 'ASIN');
        dataTable.addColumn('string', 'Brand');
        dataTable.addColumn('number', 'Price (‚Ç¨)');
        dataTable.addColumn('number', 'Share (%)');
        dataTable.addColumn('number', 'Rank');

        [...ourData, ...compData].forEach(d => {
            dataTable.addRow([d.asin, d.brand, d.price, d.click_share, d.rank]);
        });

        const table = new google.visualization.Table(document.getElementById('table_div'));
        table.draw(dataTable, {showRowNumber: false, width: '100%', height: '100%'});
    }

    // Resize charts on window resize
    window.addEventListener('resize', () => {
        drawTrendChart();
        drawCompetitivenessChart();
        drawEfficiencyChart();
    });

</script>

</body>
</html>