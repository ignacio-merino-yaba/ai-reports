<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon ASIN Performance Report - Matcha Premium</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #f5f5f7; color: #1d1d1f; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #d1d1d6; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #aeaeb2; }

        .card-shadow { box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); }
        .glass-panel { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.5); }
        
        .tab-active { background-color: white; color: #000; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .tab-inactive { color: #86868b; }
        .tab-inactive:hover { color: #1d1d1f; }
    </style>
</head>
<body class="antialiased min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        const { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, AreaChart, Area, ComposedChart, ScatterChart, Scatter, ZAxis } = Recharts;

        // ------------------------------------------------------------------
        // DATA INJECTION
        // ------------------------------------------------------------------
        const rawData = [
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha pulver","competitor_brand":"bioKontor","asin":"B08XVX8V1T","product_title":"Bio Matcha Pulver 100 g ‚Äì Japan Matcha Tee, 100% n...","country_code":"de","average_organic_rank":9,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":3.08,"impression_share":3.95,"price":11.9975,"click_share_rank":8,"weekly_search_volume":27683.79,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha pulver","competitor_brand":null,"asin":"B08XVX8V1T","product_title":"Bio Matcha Pulver 100 g ‚Äì Japan Matcha Tee, 100% n...","country_code":"de","average_organic_rank":9,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":3.08,"impression_share":3.95,"price":11.9975,"click_share_rank":8,"weekly_search_volume":27683.79,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha pulver","competitor_brand":"NORITUAL LAB","asin":"B0CNRX8G5S","product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","country_code":"de","average_organic_rank":3,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":0,"click_share":12.72,"impression_share":3.41,"price":24.605714286,"click_share_rank":2,"weekly_search_volume":44660.44,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha pulver","competitor_brand":"NORITUAL LAB","asin":"B0CNRX8G5S","product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","country_code":"de","average_organic_rank":2,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":4,"weekly_number_of_days_with_coupon":0,"click_share":14.01,"impression_share":3.49,"price":23.91,"click_share_rank":2,"weekly_search_volume":27683.79,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha pulver","competitor_brand":"NORITUAL LAB","asin":"B0CNRX8G5S","product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","country_code":"de","average_organic_rank":2,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":7,"weekly_number_of_days_with_coupon":0,"click_share":14.83,"impression_share":3.52,"price":24.602857143,"click_share_rank":1,"weekly_search_volume":34420.66,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha pulver","competitor_brand":null,"asin":"B0G1T7N675","product_title":"Ceremonial Matcha Pulver BIO-Qualit√§t 50g ideal zu...","country_code":"de","average_organic_rank":13,"weekly_number_of_days_with_deal":7,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":2.51,"impression_share":3.67,"price":9.112857143,"click_share_rank":10,"weekly_search_volume":44660.44,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha pulver","competitor_brand":null,"asin":"B0G1T7N675","product_title":"Ceremonial Matcha Pulver BIO-Qualit√§t 50g ideal zu...","country_code":"de","average_organic_rank":12,"weekly_number_of_days_with_deal":3,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":2.38,"impression_share":4.47,"price":12.447142857,"click_share_rank":10,"weekly_search_volume":34420.66,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha pulver","competitor_brand":null,"asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr√ºntee-Pulver au...","country_code":"de","average_organic_rank":6,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":5.96,"impression_share":4.35,"price":16.01,"click_share_rank":3,"weekly_search_volume":44660.44,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha pulver","competitor_brand":"NORITUAL LAB","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr√ºntee-Pulver au...","country_code":"de","average_organic_rank":6,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":5.96,"impression_share":4.35,"price":16.01,"click_share_rank":3,"weekly_search_volume":44660.44,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha pulver","competitor_brand":"NORITUAL LAB","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr√ºntee-Pulver au...","country_code":"de","average_organic_rank":7,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":6.01,"impression_share":4.41,"price":15.5575,"click_share_rank":3,"weekly_search_volume":27683.79,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha pulver","competitor_brand":null,"asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr√ºntee-Pulver au...","country_code":"de","average_organic_rank":7,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":6.01,"impression_share":4.41,"price":15.5575,"click_share_rank":3,"weekly_search_volume":27683.79,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha pulver","competitor_brand":"NORITUAL LAB","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr√ºntee-Pulver au...","country_code":"de","average_organic_rank":7,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":5.94,"impression_share":4.43,"price":16.008571429,"click_share_rank":3,"weekly_search_volume":34420.66,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha pulver","competitor_brand":null,"asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr√ºntee-Pulver au...","country_code":"de","average_organic_rank":7,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":5.94,"impression_share":4.43,"price":16.008571429,"click_share_rank":3,"weekly_search_volume":34420.66,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha pulver","competitor_brand":"Special Leaves","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat√ºrlich & Fein Gemahl...","country_code":"de","average_organic_rank":15,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":4,"click_share":3.51,"impression_share":4.76,"price":10.39,"click_share_rank":6,"weekly_search_volume":27683.79,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha pulver","competitor_brand":null,"asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat√ºrlich & Fein Gemahl...","country_code":"de","average_organic_rank":15,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":4,"click_share":3.51,"impression_share":4.76,"price":10.39,"click_share_rank":6,"weekly_search_volume":27683.79,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha pulver","competitor_brand":null,"asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat√ºrlich & Fein Gemahl...","country_code":"de","average_organic_rank":15,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":7,"click_share":4.07,"impression_share":5.02,"price":10.69,"click_share_rank":6,"weekly_search_volume":44660.44,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha pulver","competitor_brand":"Special Leaves","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat√ºrlich & Fein Gemahl...","country_code":"de","average_organic_rank":15,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":7,"click_share":4.07,"impression_share":5.02,"price":10.69,"click_share_rank":6,"weekly_search_volume":44660.44,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha pulver","competitor_brand":"Special Leaves","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat√ºrlich & Fein Gemahl...","country_code":"de","average_organic_rank":14,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":7,"click_share":4.12,"impression_share":5.51,"price":10.69,"click_share_rank":6,"weekly_search_volume":34420.66,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha pulver","competitor_brand":null,"asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat√ºrlich & Fein Gemahl...","country_code":"de","average_organic_rank":14,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":7,"click_share":4.12,"impression_share":5.51,"price":10.69,"click_share_rank":6,"weekly_search_volume":34420.66,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha pulver","competitor_brand":"NaturaleBio","asin":"B07SZFD3P9","product_title":"NaturaleBio Matcha Ceremonial Grade 100g. Original...","country_code":"de","average_organic_rank":100,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":2.69,"impression_share":2.28,"price":30.27,"click_share_rank":10,"weekly_search_volume":27683.79,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha pulver","competitor_brand":"NaturaleBio","asin":"B07SZFD3P9","product_title":"NaturaleBio Matcha Ceremonial Grade 100g. Original...","country_code":"de","average_organic_rank":25,"weekly_number_of_days_with_deal":1,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":2.75,"impression_share":2.58,"price":30.562857143,"click_share_rank":9,"weekly_search_volume":34420.66,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha pulver","competitor_brand":"NaturaleBio","asin":"B079VQ52MK","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":5,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":3.27,"impression_share":3.29,"price":23.63,"click_share_rank":8,"weekly_search_volume":44660.44,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha pulver","competitor_brand":"NaturaleBio","asin":"B06XQ5DCYJ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":1,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":13.42,"impression_share":3.43,"price":14.435714286,"click_share_rank":1,"weekly_search_volume":44660.44,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha pulver","competitor_brand":"NaturaleBio","asin":"B06XQ69YCQ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":4,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":5.03,"impression_share":3.44,"price":9.445714286,"click_share_rank":4,"weekly_search_volume":44660.44,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha pulver","competitor_brand":"NaturaleBio","asin":"B06XQ69YCQ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":4,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":4.96,"impression_share":3.45,"price":10.2225,"click_share_rank":4,"weekly_search_volume":27683.79,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha pulver","competitor_brand":"NaturaleBio","asin":"B079VQ52MK","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":5,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":3.5,"impression_share":3.48,"price":24.5275,"click_share_rank":7,"weekly_search_volume":27683.79,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha pulver","competitor_brand":"NaturaleBio","asin":"B06XQ5DCYJ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":1,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":14.75,"impression_share":3.5,"price":14.6075,"click_share_rank":1,"weekly_search_volume":27683.79,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha pulver","competitor_brand":"NaturaleBio","asin":"B079VQ52MK","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":5,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":3.98,"impression_share":3.51,"price":24.737142857,"click_share_rank":7,"weekly_search_volume":34420.66,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha pulver","competitor_brand":"NaturaleBio","asin":"B06XQ69YCQ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":4,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":5.19,"impression_share":3.53,"price":10.518571429,"click_share_rank":5,"weekly_search_volume":34420.66,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha pulver","competitor_brand":"NaturaleBio","asin":"B06XQ5DCYJ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":1,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":14.3,"impression_share":3.54,"price":15.031428571,"click_share_rank":2,"weekly_search_volume":34420.66,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha pulver","competitor_brand":"TEA Uniq≈ç","asin":"B0912DKFK5","product_title":"Tea Uniqo ‚Äì Premium Matcha Pulver ‚Äì Ideal zum Trin...","country_code":"de","average_organic_rank":12,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":3.83,"impression_share":4.82,"price":12.884285714,"click_share_rank":7,"weekly_search_volume":44660.44,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha pulver","competitor_brand":"VAHDAM","asin":"B07MD4LB49","product_title":"VAHDAM, Matcha Gr√ºntee Pulver (100g, 50+ Tassen) A...","country_code":"de","average_organic_rank":8,"weekly_number_of_days_with_deal":5,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":4.83,"impression_share":5.5,"price":9.157142857,"click_share_rank":5,"weekly_search_volume":44660.44,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha pulver","competitor_brand":"VAHDAM","asin":"B07MD4LB49","product_title":"VAHDAM, Matcha Gr√ºntee Pulver (100g, 50+ Tassen) A...","country_code":"de","average_organic_rank":8,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":3.79,"impression_share":5.94,"price":10.43,"click_share_rank":5,"weekly_search_volume":27683.79,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha pulver","competitor_brand":"VAHDAM","asin":"B07MD4LB49","product_title":"VAHDAM, Matcha Gr√ºntee Pulver (100g, 50+ Tassen) A...","country_code":"de","average_organic_rank":6,"weekly_number_of_days_with_deal":3,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":5.4,"impression_share":5.97,"price":9.727142857,"click_share_rank":4,"weekly_search_volume":34420.66,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha pulver","competitor_brand":"VAHDAM","asin":"B07K1WBH4K","product_title":"VAHDAM, Vanille Matcha Gr√ºner Tee Pulver (100g, 50...","country_code":"de","average_organic_rank":22,"weekly_number_of_days_with_deal":5,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":2.62,"impression_share":2.67,"price":9.242857143,"click_share_rank":9,"weekly_search_volume":44660.44,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha pulver","competitor_brand":"VAHDAM","asin":"B07K1WBH4K","product_title":"VAHDAM, Vanille Matcha Gr√ºner Tee Pulver (100g, 50...","country_code":"de","average_organic_rank":12,"weekly_number_of_days_with_deal":3,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":3.49,"impression_share":4.67,"price":9.727142857,"click_share_rank":8,"weekly_search_volume":34420.66,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"},
            {"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha pulver","competitor_brand":"VAHDAM","asin":"B07K1WBH4K","product_title":"VAHDAM, Vanille Matcha Gr√ºner Tee Pulver (100g, 50...","country_code":"de","average_organic_rank":12,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"weekly_number_of_days_with_coupon":0,"click_share":2.74,"impression_share":4.94,"price":10.43,"click_share_rank":9,"weekly_search_volume":27683.79,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha+pulver"}
        ];

        // ------------------------------------------------------------------
        // LOGIC & HOOKS
        // ------------------------------------------------------------------
        const useDataProcessor = (data) => {
            return useMemo(() => {
                // 1. Backfill Brands
                const asinBrandMap = {};
                data.forEach(row => {
                    if (row.competitor_brand && row.competitor_brand !== "null") {
                        asinBrandMap[row.asin] = row.competitor_brand;
                    }
                });

                const processed = data.map(row => {
                    let brand = row.competitor_brand;
                    if (!brand || brand === "null") {
                        brand = asinBrandMap[row.asin] || row.product_title.split(' ')[0] || "Unknown Brand";
                    }
                    
                    // Specific fix for the placeholder logic in CSV
                    if (brand === "Ceremonial" || brand === "Bio") brand = "Generic / Unknown";

                    return {
                        ...row,
                        real_brand: brand,
                        estimated_clicks: (row.click_share / 100) * row.weekly_search_volume
                    };
                });

                // 2. Identify Our Brand
                const ourBrandRow = processed.find(r => r.is_yaba_asin === 'Y');
                const ourBrand = ourBrandRow ? ourBrandRow.real_brand : "Our Brand";

                // 3. Weekly Aggregation
                const weeks = [...new Set(processed.map(d => d.week_date))].sort();
                
                const weeklyStats = weeks.map(week => {
                    const weekData = processed.filter(d => d.week_date === week);
                    const totalClicks = weekData.reduce((acc, curr) => acc + curr.estimated_clicks, 0);
                    
                    const ourData = weekData.filter(d => d.real_brand === ourBrand);
                    const ourClicks = ourData.reduce((acc, curr) => acc + curr.estimated_clicks, 0);
                    
                    return {
                        week,
                        totalClicks,
                        ourShare: totalClicks ? (ourClicks / totalClicks) * 100 : 0,
                        competitorShare: totalClicks ? ((totalClicks - ourClicks) / totalClicks) * 100 : 0
                    };
                });

                // 4. Competitor Ranking
                const brandClicks = {};
                processed.forEach(d => {
                    if (d.real_brand !== ourBrand) {
                        brandClicks[d.real_brand] = (brandClicks[d.real_brand] || 0) + d.estimated_clicks;
                    }
                });
                const topCompetitors = Object.entries(brandClicks)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3)
                    .map(e => e[0]);

                // 5. Market Share History
                const marketShareHistory = weeks.map(week => {
                    const weekData = processed.filter(d => d.week_date === week);
                    const total = weekData.reduce((sum, r) => sum + r.estimated_clicks, 0);
                    
                    const getShare = (b) => {
                        const bClicks = weekData.filter(r => r.real_brand === b).reduce((s, r) => s + r.estimated_clicks, 0);
                        return total ? (bClicks / total) * 100 : 0;
                    };

                    return {
                        week,
                        [ourBrand]: getShare(ourBrand),
                        [topCompetitors[0] || 'Comp1']: getShare(topCompetitors[0]),
                        [topCompetitors[1] || 'Comp2']: getShare(topCompetitors[1]),
                        [topCompetitors[2] || 'Comp3']: getShare(topCompetitors[2]),
                        "Others": 100 - (getShare(ourBrand) + getShare(topCompetitors[0]) + getShare(topCompetitors[1]) + getShare(topCompetitors[2]))
                    };
                });

                return { processed, ourBrand, weeklyStats, topCompetitors, marketShareHistory, weeks };
            }, [data]);
        };

        // ------------------------------------------------------------------
        // COMPONENTS
        // ------------------------------------------------------------------
        
        const StatCard = ({ title, value, sub, trend, color = "blue" }) => (
            <div className="bg-white p-6 rounded-2xl card-shadow flex flex-col justify-between h-full">
                <h3 className="text-sm font-medium text-gray-500 uppercase tracking-wide">{title}</h3>
                <div className="mt-2 flex items-baseline">
                    <span className={`text-3xl font-bold text-${color}-600`}>{value}</span>
                    {sub && <span className="ml-2 text-sm text-gray-400">{sub}</span>}
                </div>
                {trend && <div className={`mt-2 text-xs font-medium px-2 py-1 rounded-full w-fit ${trend.includes('+') ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                    {trend} vs prev
                </div>}
            </div>
        );

        const InsightBox = ({ icon: Icon, title, children, type = "neutral" }) => {
            const colors = {
                neutral: "bg-gray-50 border-gray-200",
                warning: "bg-orange-50 border-orange-200",
                success: "bg-green-50 border-green-200",
                info: "bg-blue-50 border-blue-200"
            };
            const textColors = {
                neutral: "text-gray-800",
                warning: "text-orange-900",
                success: "text-green-900",
                info: "text-blue-900"
            };

            return (
                <div className={`p-4 rounded-xl border ${colors[type]} mb-4 last:mb-0`}>
                    <div className="flex items-start gap-3">
                        <div className={`mt-1 p-1.5 rounded-lg bg-white bg-opacity-60`}>
                            <Icon size={18} className={textColors[type]} />
                        </div>
                        <div>
                            <h4 className={`font-semibold text-sm ${textColors[type]}`}>{title}</h4>
                            <p className="text-sm text-gray-600 mt-1 leading-relaxed">{children}</p>
                        </div>
                    </div>
                </div>
            );
        };

        // TAB 1: STATIC REPORT
        const ReportDashboard = ({ data, ourBrand, weeklyStats, marketShareHistory, topCompetitors }) => {
            const latestWeek = weeklyStats[weeklyStats.length - 1];
            const prevWeek = weeklyStats[weeklyStats.length - 2] || latestWeek;
            
            const shareChange = (latestWeek.ourShare - prevWeek.ourShare).toFixed(2);
            const clickChange = ((latestWeek.totalClicks - prevWeek.totalClicks) / prevWeek.totalClicks * 100).toFixed(1);

            return (
                <div className="space-y-8 animate-in fade-in duration-500">
                    {/* Header Metrics */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <StatCard title="Total Market Clicks" value={Math.round(latestWeek.totalClicks).toLocaleString()} sub="Last Week" trend={`${clickChange > 0 ? '+' : ''}${clickChange}%`} />
                        <StatCard title="Our Click Share" value={`${latestWeek.ourShare.toFixed(1)}%`} sub="Dominant" trend={`${shareChange > 0 ? '+' : ''}${shareChange}%`} color="blue" />
                        <StatCard title="Top Competitor" value={topCompetitors[0]} sub="Primary Threat" color="red" />
                        <StatCard title="Active ASINs" value={data.processed.filter(d => d.real_brand === ourBrand && d.week_date === latestWeek.week).length} sub="Our Variants" color="gray" />
                    </div>

                    {/* Charts Section */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        {/* Global Trend */}
                        <div className="bg-white p-6 rounded-2xl card-shadow">
                            <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <lucide.TrendingUp size={20} /> Tendencia Global (Market Volume vs Our Share)
                            </h3>
                            <div className="h-64">
                                <ResponsiveContainer width="100%" height="100%">
                                    <ComposedChart data={weeklyStats}>
                                        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e5e5e5" />
                                        <XAxis dataKey="week" axisLine={false} tickLine={false} tick={{fill:'#6b7280', fontSize:12}} />
                                        <YAxis yAxisId="left" orientation="left" axisLine={false} tickLine={false} />
                                        <YAxis yAxisId="right" orientation="right" axisLine={false} tickLine={false} unit="%" domain={[0, 50]} />
                                        <Tooltip contentStyle={{borderRadius:'12px', border:'none', boxShadow:'0 4px 12px rgba(0,0,0,0.1)'}} />
                                        <Bar yAxisId="left" dataKey="totalClicks" name="Market Volume" fill="#e5e7eb" radius={[4,4,0,0]} barSize={40} />
                                        <Line yAxisId="right" type="monotone" dataKey="ourShare" name="Our Share %" stroke="#2563eb" strokeWidth={3} dot={{r:4, fill:'#2563eb'}} />
                                    </ComposedChart>
                                </ResponsiveContainer>
                            </div>
                        </div>

                        {/* Brand Competitiveness */}
                        <div className="bg-white p-6 rounded-2xl card-shadow">
                            <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <lucide.Users size={20} /> Competitividad de Marca (Click Share %)
                            </h3>
                            <div className="h-64">
                                <ResponsiveContainer width="100%" height="100%">
                                    <AreaChart data={marketShareHistory}>
                                        <defs>
                                            <linearGradient id="colorOur" x1="0" y1="0" x2="0" y2="1">
                                                <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.1}/>
                                                <stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/>
                                            </linearGradient>
                                        </defs>
                                        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e5e5e5" />
                                        <XAxis dataKey="week" axisLine={false} tickLine={false} tick={{fill:'#6b7280', fontSize:12}} />
                                        <YAxis axisLine={false} tickLine={false} unit="%" />
                                        <Tooltip contentStyle={{borderRadius:'12px', border:'none', boxShadow:'0 4px 12px rgba(0,0,0,0.1)'}} />
                                        <Area type="monotone" dataKey={ourBrand} stackId="1" stroke="#2563eb" fill="url(#colorOur)" strokeWidth={2} />
                                        <Area type="monotone" dataKey={topCompetitors[0]} stackId="1" stroke="#ef4444" fill="transparent" strokeWidth={2} strokeDasharray="5 5" />
                                        <Area type="monotone" dataKey="Others" stackId="1" stroke="#9ca3af" fill="transparent" strokeWidth={1} />
                                    </AreaChart>
                                </ResponsiveContainer>
                            </div>
                        </div>
                    </div>

                    {/* Efficiency & Levers Grid */}
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        {/* Efficiency Plot */}
                        <div className="bg-white p-6 rounded-2xl card-shadow lg:col-span-2">
                            <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <lucide.Target size={20} /> Eficiencia: Organic Rank vs Click Share
                            </h3>
                            <div className="h-64">
                                <ResponsiveContainer width="100%" height="100%">
                                    <ScatterChart margin={{top: 20, right: 20, bottom: 20, left: 20}}>
                                        <CartesianGrid strokeDasharray="3 3" />
                                        <XAxis type="number" dataKey="average_organic_rank" name="Rank" label={{ value: 'Organic Rank (Lower is Better)', position: 'insideBottom', offset: -10 }} reversed={true} domain={[30, 0]} />
                                        <YAxis type="number" dataKey="click_share" name="Share" unit="%" label={{ value: 'Click Share %', angle: -90, position: 'insideLeft' }} />
                                        <Tooltip cursor={{ strokeDasharray: '3 3' }} content={({active, payload}) => {
                                            if (active && payload && payload.length) {
                                                const d = payload[0].payload;
                                                return <div className="bg-white p-3 rounded-lg shadow-lg border text-xs">
                                                    <p className="font-bold">{d.real_brand}</p>
                                                    <p>{d.product_title.substring(0,30)}...</p>
                                                    <p>Rank: {d.average_organic_rank} | Share: {d.click_share}%</p>
                                                </div>
                                            }
                                            return null;
                                        }} />
                                        <Legend />
                                        <Scatter name="Our ASINs" data={data.processed.filter(d => d.is_yaba_asin === 'Y' && d.week_date === latestWeek.week)} fill="#2563eb" shape="circle" />
                                        <Scatter name="Competitors" data={data.processed.filter(d => d.is_yaba_asin === 'N' && d.week_date === latestWeek.week)} fill="#9ca3af" shape="triangle" />
                                    </ScatterChart>
                                </ResponsiveContainer>
                            </div>
                        </div>

                        {/* Analysis Text - Generated based on the Python Analysis */}
                        <div className="space-y-4">
                            <h3 className="text-lg font-bold text-gray-800">Key Drivers (Palancas)</h3>
                            <InsightBox icon={lucide.DollarSign} title="Precio vs Share" type="warning">
                                Alta correlaci√≥n negativa (-0.49). Subidas de precio penalizan fuertemente la cuota. Los competidores se mantienen en rangos de 10-16‚Ç¨ mientras nuestras variantes premium (24‚Ç¨+) sufren m√°s para ganar volumen.
                            </InsightBox>
                            <InsightBox icon={lucide.Tag} title="Promociones" type="info">
                                Deal Days mostraron una correlaci√≥n inversa curiosa (-0.31). En la semana 52, las ofertas no generaron un pico de share sostenido, sugiriendo fatiga promocional o baja visibilidad de la oferta.
                            </InsightBox>
                        </div>
                    </div>

                    {/* Insights & Recommendations - Generated */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div className="bg-white p-6 rounded-2xl card-shadow border-l-4 border-blue-500">
                            <h3 className="text-lg font-bold text-gray-800 mb-4">üí° Conclusiones Clave</h3>
                            <ul className="space-y-3 text-sm text-gray-700">
                                <li className="flex gap-2"><lucide.CheckCircle size={16} className="text-blue-500 mt-0.5" /> <strong>Liderazgo Estable:</strong> NaturaleBio retiene ~36% del mercado, aunque el crecimiento se ha estancado en el inicio de 2026.</li>
                                <li className="flex gap-2"><lucide.CheckCircle size={16} className="text-blue-500 mt-0.5" /> <strong>Amenaza Principal:</strong> NORITUAL LAB est√° consolidando la segunda posici√≥n con estrategias agresivas de visibilidad org√°nica.</li>
                                <li className="flex gap-2"><lucide.CheckCircle size={16} className="text-blue-500 mt-0.5" /> <strong>Dependencia Org√°nica:</strong> Nuestra cuota depende cr√≠ticamente del Top 3 ranking. Cualquier ca√≠da en SEO (Rank > 5) destruye la eficiencia de clics dr√°sticamente.</li>
                                <li className="flex gap-2"><lucide.CheckCircle size={16} className="text-blue-500 mt-0.5" /> <strong>Fragmentaci√≥n Low-Cost:</strong> Marcas "Generic/Unknown" est√°n capturando la cola larga del mercado con precios <15‚Ç¨, erosionando la entrada a la categor√≠a.</li>
                                <li className="flex gap-2"><lucide.CheckCircle size={16} className="text-blue-500 mt-0.5" /> <strong>Anomal√≠a:</strong> La variante de 100g (B06XQ5DCYJ) sobre-performa masivamente gracias a su ranking #1 absoluto.</li>
                            </ul>
                        </div>
                        <div className="bg-white p-6 rounded-2xl card-shadow border-l-4 border-green-500">
                            <h3 className="text-lg font-bold text-gray-800 mb-4">üöÄ Recomendaciones Accionables</h3>
                            <div className="space-y-4">
                                <div className="flex items-start gap-3">
                                    <span className="bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded">1</span>
                                    <p className="text-sm text-gray-700"><strong>Blindaje SEO:</strong> Priorizar defensa del ranking #1 de la variante B06XQ5DCYJ. Si cae al puesto #3, la p√©rdida de volumen ser√° desproporcionada.</p>
                                </div>
                                <div className="flex items-start gap-3">
                                    <span className="bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded">2</span>
                                    <p className="text-sm text-gray-700"><strong>Ajuste T√°ctico de Precio:</strong> Probar una reducci√≥n temporal del 5% en las variantes de 24‚Ç¨ para testear elasticidad frente a NORITUAL LAB (precio medio 16‚Ç¨).</p>
                                </div>
                                <div className="flex items-start gap-3">
                                    <span className="bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded">3</span>
                                    <p className="text-sm text-gray-700"><strong>Revisi√≥n de Deals:</strong> Pausar Deals aislados. Enfocar presupuesto en Cupones (Green Badge) que tienen mejor CTR visual en la SERP para competir con las opciones baratas.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // TAB 2: INTERACTIVE COMPARATOR
        const InteractiveComparator = ({ data, weeks, topCompetitors, ourBrand }) => {
            const [selectedWeek, setSelectedWeek] = useState(weeks[weeks.length - 1]);
            const [selectedCompetitor, setSelectedCompetitor] = useState(topCompetitors[0]);

            const weekData = data.processed.filter(d => d.week_date === selectedWeek);
            
            // Aggregates
            const getMetrics = (brand) => {
                const brandRows = weekData.filter(d => d.real_brand === brand);
                const avgPrice = brandRows.reduce((a,b) => a + b.price, 0) / (brandRows.length || 1);
                const totalShare = brandRows.reduce((a,b) => a + b.click_share, 0);
                const bestRank = Math.min(...brandRows.map(r => r.average_organic_rank));
                const dealDays = Math.max(...brandRows.map(r => r.weekly_number_of_days_with_deal));
                return { avgPrice, totalShare, bestRank, dealDays, count: brandRows.length };
            };

            const us = getMetrics(ourBrand);
            const them = getMetrics(selectedCompetitor);

            return (
                <div className="space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <div className="flex gap-4 p-4 bg-white rounded-xl shadow-sm">
                        <select 
                            className="bg-gray-50 border border-gray-200 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                            value={selectedWeek} 
                            onChange={(e) => setSelectedWeek(e.target.value)}
                        >
                            {weeks.map(w => <option key={w} value={w}>Week: {w}</option>)}
                        </select>
                        <select 
                            className="bg-gray-50 border border-gray-200 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                            value={selectedCompetitor} 
                            onChange={(e) => setSelectedCompetitor(e.target.value)}
                        >
                            {topCompetitors.map(c => <option key={c} value={c}>Vs: {c}</option>)}
                        </select>
                    </div>

                    {/* Head-to-Head Cards */}
                    <div className="grid grid-cols-2 gap-8">
                        {/* US */}
                        <div className="bg-gradient-to-br from-blue-50 to-white p-6 rounded-2xl border border-blue-100 text-center">
                            <h3 className="text-xl font-bold text-blue-900 mb-6">{ourBrand} (Us)</h3>
                            <div className="space-y-6">
                                <div><p className="text-xs text-blue-400 uppercase">Click Share</p><p className="text-3xl font-bold text-blue-600">{us.totalShare.toFixed(1)}%</p></div>
                                <div><p className="text-xs text-blue-400 uppercase">Avg Price</p><p className="text-2xl font-semibold text-gray-700">‚Ç¨{us.avgPrice.toFixed(2)}</p></div>
                                <div><p className="text-xs text-blue-400 uppercase">Best Rank</p><p className="text-xl font-medium text-gray-700">#{us.bestRank}</p></div>
                                <div className="flex justify-center gap-2">
                                    {us.dealDays > 0 && <span className="px-2 py-1 bg-red-100 text-red-600 text-xs rounded-full font-bold">DEAL ACTIVE</span>}
                                    <span className="px-2 py-1 bg-blue-100 text-blue-600 text-xs rounded-full">{us.count} ASINs</span>
                                </div>
                            </div>
                        </div>

                        {/* THEM */}
                        <div className="bg-white p-6 rounded-2xl border border-gray-200 text-center">
                            <h3 className="text-xl font-bold text-gray-700 mb-6">{selectedCompetitor}</h3>
                            <div className="space-y-6">
                                <div><p className="text-xs text-gray-400 uppercase">Click Share</p><p className="text-3xl font-bold text-gray-600">{them.totalShare.toFixed(1)}%</p></div>
                                <div><p className="text-xs text-gray-400 uppercase">Avg Price</p><p className={`text-2xl font-semibold ${them.avgPrice < us.avgPrice ? 'text-red-500' : 'text-gray-700'}`}>‚Ç¨{them.avgPrice.toFixed(2)}</p></div>
                                <div><p className="text-xs text-gray-400 uppercase">Best Rank</p><p className="text-xl font-medium text-gray-700">#{them.bestRank}</p></div>
                                <div className="flex justify-center gap-2">
                                    {them.dealDays > 0 && <span className="px-2 py-1 bg-red-100 text-red-600 text-xs rounded-full font-bold">DEAL ACTIVE</span>}
                                    <span className="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full">{them.count} ASINs</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white p-6 rounded-2xl card-shadow">
                        <h4 className="font-bold text-gray-700 mb-4">Direct Insight</h4>
                        <p className="text-gray-600">
                            In <strong>{selectedWeek}</strong>, {ourBrand} is capturing <strong>{(us.totalShare - them.totalShare).toFixed(1)}%</strong> more market share than {selectedCompetitor}. 
                            {us.avgPrice > them.avgPrice ? ` However, we are priced ‚Ç¨${(us.avgPrice - them.avgPrice).toFixed(2)} higher on average.` : ` We are also priced more aggressively.`}
                        </p>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('report');
            const data = useDataProcessor(rawData);

            return (
                <div className="max-w-7xl mx-auto px-4 py-8 md:py-12">
                    <header className="mb-10 text-center md:text-left">
                        <div className="flex items-center gap-3 justify-center md:justify-start mb-2">
                            <lucide.BarChart2 className="text-blue-600" size={28} />
                            <h1 className="text-3xl font-bold text-gray-900 tracking-tight">Parent ASIN Intelligence</h1>
                        </div>
                        <p className="text-gray-500 ml-0 md:ml-10">Weekly Strategic Analysis ‚Ä¢ Matcha Premium Category</p>
                    </header>

                    {/* Navigation */}
                    <div className="flex justify-center md:justify-start space-x-1 bg-gray-200/50 p-1 rounded-xl w-fit mb-8 mx-auto md:mx-0">
                        <button 
                            onClick={() => setActiveTab('report')}
                            className={`px-6 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ${activeTab === 'report' ? 'tab-active' : 'tab-inactive'}`}
                        >
                            Static Report
                        </button>
                        <button 
                            onClick={() => setActiveTab('compare')}
                            className={`px-6 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 ${activeTab === 'compare' ? 'tab-active' : 'tab-inactive'}`}
                        >
                            Interactive Comparator
                        </button>
                    </div>

                    <main>
                        {activeTab === 'report' && <ReportDashboard {...data} />}
                        {activeTab === 'compare' && <InteractiveComparator {...data} />}
                    </main>

                    <footer className="mt-20 border-t border-gray-200 pt-8 text-center text-xs text-gray-400">
                        <p>Generated by Automated Market Intelligence ‚Ä¢ Confidential</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>