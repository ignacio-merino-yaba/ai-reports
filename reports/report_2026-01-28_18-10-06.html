<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Rendimiento - Parent ASIN</title>
    
    <!-- Google Charts Library -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        :root {
            --primary: #4285F4; /* Google Blue */
            --primary-light: #E8F0FE;
            --secondary: #34A853; /* Google Green */
            --danger: #EA4335; /* Google Red */
            --warning: #FBBC04; /* Google Yellow */
            --gray: #5f6368;
            --bg: #F8F9FA;
            --card-bg: #FFFFFF;
            --border: #DADCE0;
            --shadow: 0 1px 3px rgba(60,64,67,0.3), 0 4px 8px 3px rgba(60,64,67,0.15);
            --radius: 16px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: #202124;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header Style */
        .header {
            background: var(--card-bg);
            padding: 24px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            margin: 0;
            font-size: 24px;
            color: var(--primary);
            font-weight: 600;
        }
        
        .header .meta {
            font-size: 14px;
            color: var(--gray);
            margin-top: 4px;
        }

        /* Tabs Navigation */
        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .tab-btn {
            background: var(--card-bg);
            border: 1px solid var(--border);
            padding: 12px 24px;
            border-radius: 24px;
            cursor: pointer;
            font-weight: 500;
            color: var(--gray);
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .tab-btn:hover {
            background: #f1f3f4;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 2px 4px rgba(66, 133, 244, 0.3);
        }

        /* Content Sections */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Grid Layout */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .card {
            background: var(--card-bg);
            padding: 24px;
            border-radius: var(--radius);
            box-shadow: 0 1px 3px rgba(60,64,67,0.1);
            transition: box-shadow 0.2s;
        }

        .card:hover {
            box-shadow: 0 4px 6px rgba(60,64,67,0.15);
        }

        .card h2 {
            margin-top: 0;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #202124;
            border-bottom: 1px solid #f1f3f4;
            padding-bottom: 12px;
            margin-bottom: 16px;
        }

        .chart-container {
            width: 100%;
            height: 350px;
        }

        /* Insights & Recommendations */
        .insights-box {
            background: var(--primary-light);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 5px solid var(--primary);
        }

        .recommendation-box {
            background: #E6F4EA;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 5px solid var(--secondary);
        }

        ul, ol {
            margin: 0;
            padding-left: 24px;
        }
        
        li {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        /* Interactive Controls */
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            background: var(--card-bg);
            padding: 16px;
            border-radius: var(--radius);
            align-items: center;
        }

        select {
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid var(--border);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            background-color: #fff;
            cursor: pointer;
        }

        /* KPI Cards */
        .kpi-row {
            display: flex;
            gap: 24px;
            margin-bottom: 24px;
        }
        
        .kpi-card {
            flex: 1;
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .kpi-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .kpi-label {
            font-size: 12px;
            text-transform: uppercase;
            color: var(--gray);
            font-weight: 600;
            letter-spacing: 0.5px;
            margin-top: 8px;
        }

        /* Utility */
        .material-icons {
            font-size: 20px;
            vertical-align: middle;
        }
        
        /* Table overrides */
        .google-visualization-table-table {
            font-family: 'Inter', sans-serif !important;
        }
        .google-visualization-table-tr-head {
            background-color: var(--primary-light) !important;
            color: var(--primary) !important;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div>
                <h1>Análisis de Rendimiento: Parent ASIN</h1>
                <div class="meta">Analista Sénior | Datos hasta Semana 01-2026</div>
            </div>
            <div style="text-align: right;">
                <div style="font-weight: bold; color: var(--primary); font-size: 16px;">Nuestra Marca: NaturaleBio</div>
                <div style="font-size: 12px; color: var(--gray);">Contexto: Mercado Matcha Premium</div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('static')">
                <span class="material-icons">analytics</span> Reporte Ejecutivo
            </button>
            <button class="tab-btn" onclick="switchTab('interactive')">
                <span class="material-icons">compare_arrows</span> Comparador Dinámico
            </button>
        </div>

        <!-- TAB 1: REPORTE ESTÁTICO -->
        <div id="static" class="tab-content active">
            
            <!-- Section 5: Conclusiones Clave -->
            <div class="grid">
                 <div class="card" style="grid-column: 1 / -1;">
                    <h2><span class="material-icons" style="color:var(--warning)">lightbulb</span> Conclusiones Clave (Insights)</h2>
                    <div class="insights-box">
                        <ul>
                            <li><strong>Defensa de Cuota de Mercado:</strong> NaturaleBio mantiene una cuota sólida (~26%) frente a un mercado fragmentado, aunque ha sufrido una ligera erosión (-0.32 pts) en la última semana frente a competidores agresivos.</li>
                            <li><strong>Dominio del ASIN Estrella (B06XQ5DCYJ):</strong> Este ASIN actúa como "Category King" con el <strong>Rank Orgánico #1</strong> y capturando ~14.5% de los clics totales. Su eficiencia es máxima.</li>
                            <li><strong>Amenaza Competitiva Principal:</strong> <strong style="color:var(--danger)">NORITUAL LAB</strong> se consolida como el rival más peligroso (~10% share), atacando el segmento medio con una propuesta de valor clara.</li>
                            <li><strong>Barrera de Precio en High-Ticket:</strong> El ASIN B07SZFD3P9 (>30€) muestra ineficiencia (Rank 25, Share <3%). Su precio premium (+47% vs mercado) limita la conversión orgánica sin apoyo promocional.</li>
                            <li><strong>Agresividad Promocional Externa:</strong> Competidores como VAHDAM están activando Deals para ganar visibilidad temporal. Nuestra respuesta ha sido limitada en las variantes secundarias.</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Section 1 & 2: Charts -->
            <div class="grid">
                <div class="card">
                    <h2><span class="material-icons" style="color:var(--primary)">trending_up</span> Tendencia Global del Parent</h2>
                    <div id="trend_chart" class="chart-container"></div>
                    <p style="font-size: 12px; color: var(--gray); margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px;">
                        <strong>Análisis:</strong> Barras comparan volumen de clics estimados. La línea muestra nuestra cuota (%) total. Observamos estabilidad, pero estancamiento en crecimiento orgánico.
                    </p>
                </div>
                <div class="card">
                    <h2><span class="material-icons" style="color:var(--primary)">pie_chart</span> Competitividad de Marca (Share %)</h2>
                    <div id="brand_chart" class="chart-container"></div>
                    <p style="font-size: 12px; color: var(--gray); margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px;">
                        <strong>Análisis:</strong> Curvas de Click Share semanal. NaturaleBio (Azul) lidera, seguido de NORITUAL LAB (Rojo). El resto del mercado ("Resto") está muy fragmentado.
                    </p>
                </div>
            </div>

            <!-- Section 4 & 3: Efficiency & Levers -->
            <div class="grid">
                <div class="card">
                    <h2><span class="material-icons" style="color:var(--primary)">speed</span> Eficiencia: Rank Orgánico vs Click Share</h2>
                    <div id="efficiency_chart" class="chart-container"></div>
                    <p style="font-size: 12px; color: var(--gray); margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px;">
                        <strong>Interpretación:</strong> Eje X (Rank Invertido) -> Eje Y (Cuota). <span style="color:var(--primary)">● Nosotros</span> vs <span style="color:var(--danger)">● Competencia</span>. Los puntos arriba a la derecha son "Outperformers" (Alta cuota, buen rank).
                    </p>
                </div>
                <div class="card">
                    <h2><span class="material-icons" style="color:var(--primary)">local_offer</span> Impacto de Palancas (Deals/Cupones)</h2>
                    <div id="levers_chart" class="chart-container"></div>
                    <p style="font-size: 12px; color: var(--gray); margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px;">
                         Comparativa de Click Share promedio en días con promoción activa vs días normales.
                    </p>
                </div>
            </div>

            <!-- Section 5.2: Recommendations -->
            <div class="card">
                <h2><span class="material-icons" style="color:var(--secondary)">assignment_turned_in</span> Recomendaciones Accionables</h2>
                <div class="recommendation-box">
                    <ol>
                        <li><strong>Estrategia de Fortaleza (ASIN B06XQ5DCYJ):</strong> <span style="color:var(--secondary)">MANTENER.</span> No modificar precio ni título. Asegurar stock al 100%. Es el pilar de rentabilidad actual.</li>
                        <li><strong>Estrategia de Recuperación (ASIN B07SZFD3P9):</strong> <span style="color:var(--warning)">ACTIVAR.</span> El precio de 30€ es una fricción. Recomiendo activar un <strong>Cupón del 15% (Clip Coupon)</strong> para mejorar el CTR en SERP y recuperar posiciones desde el Rank 25.</li>
                        <li><strong>Defensa contra NORITUAL LAB:</strong> <span style="color:var(--danger)">ATACAR.</span> Este competidor está creciendo en el segmento medio. Usar <strong>Product Targeting (SP)</strong> en sus páginas de detalle para robar tráfico cualificado, destacando nuestra certificación Bio/Premium.</li>
                    </ol>
                </div>
            </div>

            <div class="card">
                <h2><span class="material-icons">info</span> Other Insights</h2>
                <p style="color: var(--gray);">Se detecta que la marca "VAHDAM" intenta penetrar con precios bajos y deals puntuales, pero su retención de ranking orgánico es baja. Esto sugiere que su producto no repite compra o su conversión orgánica sin deal es pobre. Oportunidad para destacar "Calidad Sostenible" en nuestras viñetas.</p>
            </div>

        </div>

        <!-- TAB 2: INTERACTIVE COMPARATOR -->
        <div id="interactive" class="tab-content">
            <div class="controls">
                <div style="display:flex; align-items:center; gap:8px;">
                    <span class="material-icons" style="color:var(--gray)">calendar_today</span>
                    <select id="weekSelector" onchange="updateInteractive()">
                        <option value="all">Todas las Semanas</option>
                        <!-- JS populated -->
                    </select>
                </div>
                <div style="display:flex; align-items:center; gap:8px;">
                    <span class="material-icons" style="color:var(--gray)">store</span>
                    <select id="competitorSelector" onchange="updateInteractive()">
                        <option value="all">Todos los Competidores</option>
                        <!-- JS populated -->
                    </select>
                </div>
            </div>

            <!-- Dynamic KPIs -->
            <div class="kpi-row">
                <div class="kpi-card">
                    <div id="kpi_share" class="kpi-value">-</div>
                    <div class="kpi-label">Click Share (NaturaleBio)</div>
                </div>
                <div class="kpi-card">
                    <div id="kpi_rank" class="kpi-value">-</div>
                    <div class="kpi-label">Rank Orgánico (NaturaleBio)</div>
                </div>
                <div class="kpi-card">
                    <div id="kpi_price" class="kpi-value">-</div>
                    <div class="kpi-label">Precio Promedio (NaturaleBio)</div>
                </div>
            </div>

            <div class="card">
                <h2>Comparativa Detallada (Nosotros vs Mercado)</h2>
                <div id="table_chart" class="chart-container" style="height: 500px;"></div>
            </div>
        </div>

    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script type="text/javascript">
        // 1. DATA INJECTION (Processed from CSV)
        const marketData = [{"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha pulver", "competitor_brand": "Unknown Brand", "asin": "B08XVX8V1T", "product_title": "Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...", "country_code": "de", "average_organic_rank": 9.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 3.08, "impression_share": 3.95, "price": 11.9975, "click_share_rank": 8, "weekly_search_volume": 27796.53, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha pulver", "competitor_brand": "bioKontor", "asin": "B08XVX8V1T", "product_title": "Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...", "country_code": "de", "average_organic_rank": 9.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 3.08, "impression_share": 3.95, "price": 11.9975, "click_share_rank": 8, "weekly_search_volume": 27796.53, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha pulver", "competitor_brand": "NORITUAL LAB", "asin": "B0CNRX8G5S", "product_title": "Ceremonial Matcha - Reines Matcha Pulver aus Japan...", "country_code": "de", "average_organic_rank": 2.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 4.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 14.01, "impression_share": 3.49, "price": 23.91, "click_share_rank": 2, "weekly_search_volume": 27796.53, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha pulver", "competitor_brand": "NORITUAL LAB", "asin": "B0CNRX8G5S", "product_title": "Ceremonial Matcha - Reines Matcha Pulver aus Japan...", "country_code": "de", "average_organic_rank": 2.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 7.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 14.83, "impression_share": 3.52, "price": 24.602857143, "click_share_rank": 1, "weekly_search_volume": 34402.64, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha pulver", "competitor_brand": "Ceremonial", "asin": "B0G1T7N675", "product_title": "Ceremonial Matcha Pulver BIO-Qualit\u00e4t 50g ideal zu...", "country_code": "de", "average_organic_rank": 12.0, "weekly_number_of_days_with_deal": 3.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 2.38, "impression_share": 4.47, "price": 12.447142857, "click_share_rank": 10, "weekly_search_volume": 34402.64, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha pulver", "competitor_brand": "Ceremonial", "asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...", "country_code": "de", "average_organic_rank": 7.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 5.94, "impression_share": 4.43, "price": 16.008571429, "click_share_rank": 3, "weekly_search_volume": 34402.64, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha pulver", "competitor_brand": "NORITUAL LAB", "asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...", "country_code": "de", "average_organic_rank": 7.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 5.94, "impression_share": 4.43, "price": 16.008571429, "click_share_rank": 3, "weekly_search_volume": 34402.64, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha pulver", "competitor_brand": "NORITUAL LAB", "asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...", "country_code": "de", "average_organic_rank": 7.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 6.01, "impression_share": 4.41, "price": 15.5575, "click_share_rank": 3, "weekly_search_volume": 27796.53, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha pulver", "competitor_brand": "Ceremonial", "asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...", "country_code": "de", "average_organic_rank": 7.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 6.01, "impression_share": 4.41, "price": 15.5575, "click_share_rank": 3, "weekly_search_volume": 27796.53, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha pulver", "competitor_brand": "Matcha", "asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...", "country_code": "de", "average_organic_rank": 14.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 7.0, "click_share": 4.12, "impression_share": 5.51, "price": 10.69, "click_share_rank": 6, "weekly_search_volume": 34402.64, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha pulver", "competitor_brand": "Special Leaves", "asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...", "country_code": "de", "average_organic_rank": 14.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 7.0, "click_share": 4.12, "impression_share": 5.51, "price": 10.69, "click_share_rank": 6, "weekly_search_volume": 34402.64, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha pulver", "competitor_brand": "Matcha", "asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...", "country_code": "de", "average_organic_rank": 15.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 4.0, "click_share": 3.51, "impression_share": 4.76, "price": 10.39, "click_share_rank": 6, "weekly_search_volume": 27796.53, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha pulver", "competitor_brand": "Special Leaves", "asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...", "country_code": "de", "average_organic_rank": 15.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 4.0, "click_share": 3.51, "impression_share": 4.76, "price": 10.39, "click_share_rank": 6, "weekly_search_volume": 27796.53, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha pulver", "competitor_brand": "NaturaleBio", "asin": "B07SZFD3P9", "product_title": "NaturaleBio Matcha Ceremonial Grade 100g. Original...", "country_code": "de", "average_organic_rank": 0.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 2.69, "impression_share": 2.28, "price": 30.27, "click_share_rank": 10, "weekly_search_volume": 27796.53, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha pulver", "competitor_brand": "NaturaleBio", "asin": "B07SZFD3P9", "product_title": "NaturaleBio Matcha Ceremonial Grade 100g. Original...", "country_code": "de", "average_organic_rank": 25.0, "weekly_number_of_days_with_deal": 1.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 2.75, "impression_share": 2.58, "price": 30.562857143, "click_share_rank": 9, "weekly_search_volume": 34402.64, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha pulver", "competitor_brand": "NaturaleBio", "asin": "B079VQ52MK", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "country_code": "de", "average_organic_rank": 5.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 3.98, "impression_share": 3.51, "price": 24.737142857, "click_share_rank": 7, "weekly_search_volume": 34402.64, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha pulver", "competitor_brand": "NaturaleBio", "asin": "B06XQ69YCQ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "country_code": "de", "average_organic_rank": 4.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 4.96, "impression_share": 3.45, "price": 10.2225, "click_share_rank": 4, "weekly_search_volume": 27796.53, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha pulver", "competitor_brand": "NaturaleBio", "asin": "B06XQ69YCQ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "country_code": "de", "average_organic_rank": 4.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 5.19, "impression_share": 3.53, "price": 10.518571429, "click_share_rank": 5, "weekly_search_volume": 34402.64, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha pulver", "competitor_brand": "NaturaleBio", "asin": "B06XQ5DCYJ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "country_code": "de", "average_organic_rank": 1.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 14.3, "impression_share": 3.54, "price": 15.031428571, "click_share_rank": 2, "weekly_search_volume": 34402.64, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha pulver", "competitor_brand": "NaturaleBio", "asin": "B06XQ5DCYJ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "country_code": "de", "average_organic_rank": 1.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 14.75, "impression_share": 3.5, "price": 14.6075, "click_share_rank": 1, "weekly_search_volume": 27796.53, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha pulver", "competitor_brand": "NaturaleBio", "asin": "B079VQ52MK", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "country_code": "de", "average_organic_rank": 5.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 3.5, "impression_share": 3.48, "price": 24.5275, "click_share_rank": 7, "weekly_search_volume": 27796.53, "is_yaba_asin": "Y", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha pulver", "competitor_brand": "VAHDAM", "asin": "B07MD4LB49", "product_title": "VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A...", "country_code": "de", "average_organic_rank": 8.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 3.79, "impression_share": 5.94, "price": 10.43, "click_share_rank": 5, "weekly_search_volume": 27796.53, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha pulver", "competitor_brand": "VAHDAM", "asin": "B07MD4LB49", "product_title": "VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A...", "country_code": "de", "average_organic_rank": 6.0, "weekly_number_of_days_with_deal": 3.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 5.4, "impression_share": 5.97, "price": 9.727142857, "click_share_rank": 4, "weekly_search_volume": 34402.64, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2026-01-03", "week_date": "2026-01", "keywords": "matcha pulver", "competitor_brand": "VAHDAM", "asin": "B07K1WBH4K", "product_title": "VAHDAM, Vanille Matcha Gr\u00fcner Tee Pulver (100g, 50...", "country_code": "de", "average_organic_rank": 12.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 2.74, "impression_share": 4.94, "price": 10.43, "click_share_rank": 9, "weekly_search_volume": 27796.53, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}, {"brand_aggregation": "naturalebio", "parent_asin": "Matcha Premium", "reporting_date": "2025-12-27", "week_date": "2025-52", "keywords": "matcha pulver", "competitor_brand": "VAHDAM", "asin": "B07K1WBH4K", "product_title": "VAHDAM, Vanille Matcha Gr\u00fcner Tee Pulver (100g, 50...", "country_code": "de", "average_organic_rank": 12.0, "weekly_number_of_days_with_deal": 3.0, "weekly_number_of_days_with_best_seller_badge": 0.0, "weekly_number_of_days_with_amazon_choice_badge": 0.0, "weekly_number_of_days_with_coupon": 0.0, "click_share": 3.49, "impression_share": 4.67, "price": 9.727142857, "click_share_rank": 8, "weekly_search_volume": 34402.64, "is_yaba_asin": "N", "keywords_link": "https://www.amazon.de/s?k=matcha+pulver"}];
        
        const ourBrand = "NaturaleBio";

        // 2. INITIALIZE GOOGLE CHARTS
        google.charts.load('current', {'packages':['corechart', 'table', 'bar']});
        google.charts.setOnLoadCallback(initDashboard);

        function initDashboard() {
            populateSelectors();
            drawTrendChart();
            drawBrandChart();
            drawEfficiencyChart();
            drawLeversChart();
            updateInteractive(); 
        }

        // Helper: Populate Dropdowns
        function populateSelectors() {
            const weeks = [...new Set(marketData.map(d => d.week_date))].sort();
            const competitors = [...new Set(marketData.map(d => d.competitor_brand))].sort();
            
            const weekSel = document.getElementById('weekSelector');
            weeks.forEach(w => {
                let opt = document.createElement('option');
                opt.value = w;
                opt.text = w;
                weekSel.add(opt);
            });

            const compSel = document.getElementById('competitorSelector');
            competitors.forEach(c => {
                if(c !== ourBrand) {
                    let opt = document.createElement('option');
                    opt.value = c;
                    opt.text = c;
                    compSel.add(opt);
                }
            });
        }

        // Tab Switching Logic
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            
            // Map buttons to tabs (simple index mapping)
            const btns = document.querySelectorAll('.tab-btn');
            if(tabId === 'static') btns[0].classList.add('active');
            else btns[1].classList.add('active');
        }

        // --- CHART 1: GLOBAL TREND (Combo) ---
        function drawTrendChart() {
            const weeks = [...new Set(marketData.map(d => d.week_date))].sort();
            const dataMap = {};
            
            marketData.forEach(row => {
                if (!dataMap[row.week_date]) {
                    dataMap[row.week_date] = { ourClicks: 0, compClicks: 0, totalShare: 0, ourShareSum: 0 };
                }
                const clicks = (row.click_share / 100) * row.weekly_search_volume;
                
                if (row.is_yaba_asin === 'Y') {
                    dataMap[row.week_date].ourClicks += clicks;
                    // Summing share percentages across keywords for the brand
                    dataMap[row.week_date].ourShareSum += row.click_share; 
                } else {
                    dataMap[row.week_date].compClicks += clicks;
                }
            });

            const chartData = [['Semana', 'Clicks Nuestros', 'Clicks Competencia', 'Nuestra Cuota (%)']];
            weeks.forEach(w => {
                const d = dataMap[w];
                const totalC = d.ourClicks + d.compClicks;
                // Calculate "Real" share based on estimated volume or use summed share
                // Using summed share from rows for direct representation of the "Click Share" metric
                chartData.push([w, d.ourClicks, d.compClicks, d.ourShareSum]);
            });

            const data = google.visualization.arrayToDataTable(chartData);
            const options = {
                seriesType: 'bars',
                series: {2: {type: 'line', targetAxisIndex: 1, pointSize: 5}},
                vAxes: {
                    0: {title: 'Volumen de Clicks Estimado', textStyle: {color: '#5f6368'}}, 
                    1: {title: 'Click Share Total %', format: '#\'%\'', textStyle: {color: '#4285F4'}}
                },
                colors: ['#4285F4', '#EA4335', '#1a73e8'],
                legend: { position: 'bottom' },
                chartArea: {width: '80%', height: '70%'},
                bar: { groupWidth: '60%' }
            };

            const chart = new google.visualization.ComboChart(document.getElementById('trend_chart'));
            chart.draw(data, options);
        }

        // --- CHART 2: BRAND COMPETITIVENESS (Line) ---
        function drawBrandChart() {
            // Find Top 3 Competitors
            const brandTotals = {};
            marketData.forEach(d => {
                if (d.competitor_brand !== ourBrand) {
                    brandTotals[d.competitor_brand] = (brandTotals[d.competitor_brand] || 0) + d.click_share;
                }
            });
            const top3 = Object.entries(brandTotals)
                .sort((a,b) => b[1] - a[1])
                .slice(0, 3)
                .map(e => e[0]);

            const weeks = [...new Set(marketData.map(d => d.week_date))].sort();
            
            // Prepare Data Table
            const header = ['Semana', ourBrand, ...top3, 'Resto del Mercado'];
            const rows = [];

            weeks.forEach(w => {
                let row = [w, 0, 0, 0, 0, 0]; // Init counters
                
                marketData.filter(d => d.week_date === w).forEach(d => {
                    if (d.competitor_brand === ourBrand) row[1] += d.click_share;
                    else if (d.competitor_brand === top3[0]) row[2] += d.click_share;
                    else if (d.competitor_brand === top3[1]) row[3] += d.click_share;
                    else if (d.competitor_brand === top3[2]) row[4] += d.click_share;
                    else row[5] += d.click_share;
                });
                rows.push(row);
            });

            const data = google.visualization.arrayToDataTable([header, ...rows]);
            const options = {
                curveType: 'function',
                legend: { position: 'bottom' },
                colors: ['#4285F4', '#EA4335', '#FBBC04', '#34A853', '#9AA0A6'],
                vAxis: { title: 'Click Share Total %' },
                chartArea: {width: '85%', height: '70%'},
                pointSize: 5
            };

            const chart = new google.visualization.LineChart(document.getElementById('brand_chart'));
            chart.draw(data, options);
        }

        // --- CHART 3: EFFICIENCY (Scatter) ---
        function drawEfficiencyChart() {
            const dataArr = [['Rank Orgánico', 'Click Share', { role: 'style' }, {role: 'tooltip'}]];
            
            marketData.forEach(d => {
                // Color logic: Blue for Us, Red for Competitors
                const color = d.is_yaba_asin === 'Y' ? '#4285F4' : '#EA4335';
                const opacity = d.is_yaba_asin === 'Y' ? '1.0' : '0.4'; // Dim competitors slightly
                const stroke = d.is_yaba_asin === 'Y' ? 'stroke-width: 2; stroke-color: #1a73e8' : '';
                
                const tooltip = `${d.product_title.substring(0, 40)}...\nBrand: ${d.competitor_brand}\nRank: ${d.average_organic_rank}\nShare: ${d.click_share}%`;
                
                // Exclude rank 0 or very high ranks for cleaner chart
                if(d.average_organic_rank > 0 && d.average_organic_rank < 60) {
                    dataArr.push([d.average_organic_rank, d.click_share, `point { fill-color: ${color}; fill-opacity: ${opacity}; ${stroke} }`, tooltip]);
                }
            });

            const data = google.visualization.arrayToDataTable(dataArr);
            const options = {
                hAxis: { title: 'Rank Orgánico (Menor es mejor)', direction: -1, gridlines: {count: 8} }, 
                vAxis: { title: 'Click Share %', gridlines: {count: 5} },
                legend: 'none',
                chartArea: {width: '85%', height: '75%'},
                tooltip: { textStyle: { fontSize: 12 } }
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('efficiency_chart'));
            chart.draw(data, options);
        }

        // --- CHART 4: LEVERS (Column) ---
        function drawLeversChart() {
            let promoShareSum = 0, promoCount = 0;
            let organicShareSum = 0, organicCount = 0;

            marketData.forEach(d => {
                const hasPromo = d.weekly_number_of_days_with_deal > 0 || d.weekly_number_of_days_with_coupon > 0;
                if (hasPromo) {
                    promoShareSum += d.click_share;
                    promoCount++;
                } else {
                    organicShareSum += d.click_share;
                    organicCount++;
                }
            });

            const avgPromo = promoCount ? promoShareSum / promoCount : 0;
            const avgOrganic = organicCount ? organicShareSum / organicCount : 0;

            const data = google.visualization.arrayToDataTable([
                ['Estado', 'Share Promedio', { role: 'style' }, { role: 'annotation' }],
                ['Sin Promo', avgOrganic, 'color: #9AA0A6', avgOrganic.toFixed(2)+'%'],
                ['Con Promo (Deal/Cupón)', avgPromo, 'color: #34A853', avgPromo.toFixed(2)+'%']
            ]);

            const options = {
                legend: { position: 'none' },
                vAxis: { title: 'Click Share Promedio %', minValue: 0 },
                bar: { groupWidth: "50%" },
                chartArea: {width: '80%', height: '75%'}
            };

            const chart = new google.visualization.ColumnChart(document.getElementById('levers_chart'));
            chart.draw(data, options);
        }

        // --- INTERACTIVE TABLE & KPIS ---
        function updateInteractive() {
            const weekVal = document.getElementById('weekSelector').value;
            const compVal = document.getElementById('competitorSelector').value;

            // Logic: Comparison mode. 
            // If Week Selected -> Filter by Week.
            // If Competitor Selected -> Show "Our Brand" AND "Selected Competitor" to allow comparison.
            
            let filtered = marketData.filter(d => {
                const matchWeek = weekVal === 'all' || d.week_date === weekVal;
                const matchComp = compVal === 'all' || d.competitor_brand === compVal || d.competitor_brand === ourBrand;
                return matchWeek && matchComp;
            });

            // Update KPIs (Focus on Our Brand stats within the selection)
            const usData = filtered.filter(d => d.competitor_brand === ourBrand);
            
            if(usData.length > 0) {
                // Calculate simple averages
                const avgShare = (usData.reduce((a,b) => a + b.click_share, 0) / usData.length).toFixed(2);
                document.getElementById('kpi_share').innerText = avgShare + '%';
                
                const avgRank = (usData.reduce((a,b) => a + b.average_organic_rank, 0) / usData.length).toFixed(1);
                document.getElementById('kpi_rank').innerText = avgRank;
                
                const avgPrice = (usData.reduce((a,b) => a + b.price, 0) / usData.length).toFixed(2);
                document.getElementById('kpi_price').innerText = avgPrice + '€';
            } else {
                document.getElementById('kpi_share').innerText = '-';
                document.getElementById('kpi_rank').innerText = '-';
                document.getElementById('kpi_price').innerText = '-';
            }

            // Draw Table
            const tableData = new google.visualization.DataTable();
            tableData.addColumn('string', 'Semana');
            tableData.addColumn('string', 'Marca');
            tableData.addColumn('string', 'ASIN');
            tableData.addColumn('number', 'Share %');
            tableData.addColumn('number', 'Rank Org.');
            tableData.addColumn('number', 'Precio (€)');
            tableData.addColumn('number', 'Días Deal');

            filtered.forEach(d => {
                tableData.addRow([
                    d.week_date,
                    d.competitor_brand,
                    d.asin,
                    d.click_share,
                    d.average_organic_rank,
                    d.price,
                    d.weekly_number_of_days_with_deal
                ]);
            });

            const table = new google.visualization.Table(document.getElementById('table_chart'));
            // Apply custom formatter
            const formatter = new google.visualization.ColorFormat();
            formatter.addRange(null, null, 'black', '#F8F9FA'); // odd rows
            formatter.format(tableData, 0); 

            table.draw(tableData, {showRowNumber: true, width: '100%', height: '100%', allowHtml: true});
        }

        // Window Resize Handler
        window.onresize = function() {
            drawTrendChart();
            drawBrandChart();
            drawEfficiencyChart();
            drawLeversChart();
            updateInteractive();
        };
    </script>
</body>
</html>