<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anal√≠tica de Mercado: Matcha Ceremonial</title>
    
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Google Charts -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
        :root {
            --primary: #007AFF; /* Apple Blue */
            --secondary: #5AC8FA;
            --success: #34C759;
            --danger: #FF3B30;
            --gray-100: #F2F2F7;
            --gray-200: #E5E5EA;
            --gray-800: #1C1C1E;
            --white: #FFFFFF;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            --radius: 16px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #F5F5F7;
            color: var(--gray-800);
            margin: 0;
            padding: 20px;
            -webkit-font-smoothing: antialiased;
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { font-weight: 700; font-size: 24px; margin: 0; }
        h2 { font-weight: 600; font-size: 18px; margin-bottom: 16px; color: #333; }
        .subtitle { color: #666; font-size: 14px; margin-top: 4px; }

        /* Tabs */
        .tabs {
            display: flex;
            background: var(--gray-200);
            padding: 4px;
            border-radius: 12px;
            width: fit-content;
            margin-bottom: 24px;
        }

        .tab-btn {
            border: none;
            background: none;
            padding: 8px 24px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            font-size: 14px;
            color: #666;
            transition: all 0.2s;
        }

        .tab-btn.active {
            background: var(--white);
            color: var(--primary);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Cards & Sections */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px; }
        
        .card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            transition: transform 0.2s;
        }
        
        .card:hover { transform: translateY(-2px); }

        /* KPI Metrics */
        .kpi-row {
            display: flex;
            gap: 40px;
            margin-bottom: 20px;
        }
        .kpi { display: flex; flex-direction: column; }
        .kpi-label { font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; }
        .kpi-value { font-size: 28px; font-weight: 700; margin: 4px 0; }
        .kpi-change { font-size: 13px; font-weight: 500; display: flex; align-items: center; gap: 4px; }
        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }

        /* Charts */
        .chart-container {
            width: 100%;
            height: 300px;
        }

        /* Insights List */
        .insight-list { list-style: none; padding: 0; margin: 0; }
        .insight-item {
            display: flex;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-100);
        }
        .insight-item:last-child { border-bottom: none; }
        .insight-icon {
            color: var(--primary);
            background: rgba(0, 122, 255, 0.1);
            padding: 8px;
            border-radius: 8px;
            height: fit-content;
        }
        .insight-content h4 { margin: 0 0 4px 0; font-size: 15px; font-weight: 600; }
        .insight-content p { margin: 0; font-size: 14px; color: #555; line-height: 1.4; }

        /* Recommendations */
        .rec-tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .rec-price { background: #E3F2FD; color: #1565C0; }
        .rec-ads { background: #E8F5E9; color: #2E7D32; }

        /* Controls */
        select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-family: inherit;
            margin-right: 12px;
        }

        /* Utility */
        .hidden { display: none; }
        .text-sm { font-size: 13px; color: #666; }

        @media (max-width: 768px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
            .kpi-row { gap: 20px; }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <div>
                <h1>Reporte Parent: Matcha Ceremonial</h1>
                <div class="subtitle">An√°lisis de rendimiento semana 2026-01 vs hist√≥rico</div>
            </div>
            <div style="text-align: right;">
                <div class="kpi-label">Marca Analizada</div>
                <div style="font-weight: 600; font-size: 16px; color: var(--primary);">NaturaleBio</div>
            </div>
        </header>

        <!-- Navigation -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('static')">Reporte Estrat√©gico</button>
            <button class="tab-btn" onclick="switchTab('interactive')">Comparador Interactivo</button>
        </div>

        <!-- ========================= TAB 1: STATIC REPORT ========================= -->
        <div id="tab-static">
            
            <!-- KPI Summary -->
            <div class="card">
                <div class="kpi-row">
                    <div class="kpi">
                        <span class="kpi-label">Click Share Total</span>
                        <span class="kpi-value">10.8%</span>
                        <span class="kpi-change trend-down">
                            <span class="material-icons" style="font-size: 16px;">trending_down</span>
                            -1.7% vs semana ant.
                        </span>
                    </div>
                    <div class="kpi">
                        <span class="kpi-label">Posici√≥n Media (Rank)</span>
                        <span class="kpi-value">#3.5</span>
                        <span class="kpi-change trend-up">
                            <span class="material-icons" style="font-size: 16px;">trending_up</span>
                            Estable en Top 5
                        </span>
                    </div>
                    <div class="kpi">
                        <span class="kpi-label">Precio Promedio</span>
                        <span class="kpi-value">‚Ç¨21.50</span>
                        <span class="kpi-change trend-down" style="color: #666;">
                            vs ‚Ç¨19.50 (L√≠der)
                        </span>
                    </div>
                </div>
            </div>

            <div class="grid-2">
                <!-- Section 1: Global Trend -->
                <div class="card">
                    <h2>1. Tendencia Global del Parent</h2>
                    <div id="chart_trend" class="chart-container"></div>
                    <p class="text-sm" style="margin-top:10px;">
                        El volumen de b√∫squeda se mantiene, pero <strong>NaturaleBio pierde cuota</strong> frente a la agresividad de competidores emergentes.
                    </p>
                </div>

                <!-- Section 2: Brand Competitiveness -->
                <div class="card">
                    <h2>2. Competitividad de Marca (Share)</h2>
                    <div id="chart_share" class="chart-container"></div>
                    <p class="text-sm" style="margin-top:10px;">
                        <strong>NORITUAL LAB</strong> domina con el 46% del mercado. La brecha con NaturaleBio se ha ampliado en la √∫ltima semana.
                    </p>
                </div>
            </div>

            <div class="grid-2">
                <!-- Section 3: Levers -->
                <div class="card">
                    <h2>3. Palancas de Crecimiento</h2>
                    <ul class="insight-list">
                        <li class="insight-item">
                            <span class="material-icons insight-icon">euro</span>
                            <div class="insight-content">
                                <h4>Sensibilidad al Precio</h4>
                                <p>El l√≠der (Noritual) opera en el rango de <strong>‚Ç¨15-23</strong>. Nuestros ASINs principales est√°n en <strong>‚Ç¨14-29</strong>. El SKU de ‚Ç¨29 sufre en conversi√≥n frente al de ‚Ç¨23 del l√≠der.</p>
                            </div>
                        </li>
                        <li class="insight-item">
                            <span class="material-icons insight-icon">verified</span>
                            <div class="insight-content">
                                <h4>Badges & Deals</h4>
                                <p>Semanas con "Amazon Choice" activan +15% de CTR. Actualmente activo en 4 d√≠as/semana.</p>
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- Section 4: Efficiency -->
                <div class="card">
                    <h2>4. Eficiencia (Rank vs Share)</h2>
                    <div id="chart_scatter" class="chart-container"></div>
                    <p class="text-sm" style="margin-top:10px;">
                        <span style="color:red;">‚óè</span> Competencia <span style="color:blue;">‚óè</span> Nosotros.
                        Detectamos "underperformance": Buen ranking org√°nico (#3) pero bajo share comparado con el l√≠der en ranking #1.
                    </p>
                </div>
            </div>

            <!-- Section 5: Insights & Recommendations -->
            <div class="card" style="background: linear-gradient(to right, #fff, #f8faff);">
                <h2>5. Conclusiones y Recomendaciones Accionables</h2>
                <div class="grid-2">
                    <div>
                        <h3 style="font-size:16px; margin-bottom:12px;">üîç Insights Clave</h3>
                        <ul class="insight-list">
                            <li class="insight-item">
                                <span class="material-icons" style="color:var(--danger);">warning</span>
                                <div class="insight-content">
                                    <h4>P√©rdida de Dominio</h4>
                                    <p>NaturaleBio ha cedido 1.7 puntos de share en solo 7 d√≠as, cayendo al 10.8%.</p>
                                </div>
                            </li>
                            <li class="insight-item">
                                <span class="material-icons" style="color:var(--primary);">leaderboard</span>
                                <div class="insight-content">
                                    <h4>Monopolio de NORITUAL</h4>
                                    <p>Un solo competidor concentra el 46% de los clics, validando una estrategia de precio medio-bajo y m√∫ltiples SKUs.</p>
                                </div>
                            </li>
                            <li class="insight-item">
                                <span class="material-icons" style="color:#666;">visibility</span>
                                <div class="insight-content">
                                    <h4>Visibilidad vs Conversi√≥n</h4>
                                    <p>Estamos visibles (Top 5 org√°nico), pero no nos eligen. El problema es oferta/precio, no SEO.</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div>
                        <h3 style="font-size:16px; margin-bottom:12px;">üöÄ Plan de Acci√≥n</h3>
                        <div style="background:var(--gray-100); padding:16px; border-radius:12px; margin-bottom:12px;">
                            <span class="rec-tag rec-price">PRECIO</span>
                            <p style="margin:4px 0 0 0; font-size:14px; font-weight:500;">Ajuste T√°ctico ASIN B07SZFD3P9</p>
                            <p style="margin:4px 0 0 0; font-size:13px; color:#555;">Reducir precio de ‚Ç¨29 a ‚Ç¨24.99 temporalmente para romper la barrera psicol√≥gica frente a los ‚Ç¨23 de Noritual.</p>
                        </div>
                        <div style="background:var(--gray-100); padding:16px; border-radius:12px; margin-bottom:12px;">
                            <span class="rec-tag rec-ads">CRO</span>
                            <p style="margin:4px 0 0 0; font-size:14px; font-weight:500;">Defensa de Marca</p>
                            <p style="margin:4px 0 0 0; font-size:13px; color:#555;">Revisar imagen principal. El competidor usa packaging minimalista que atrae m√°s clics.</p>
                        </div>
                         <div style="background:var(--gray-100); padding:16px; border-radius:12px;">
                            <span class="rec-tag" style="background:#FFF3E0; color:#E65100;">VARIANTS</span>
                            <p style="margin:4px 0 0 0; font-size:14px; font-weight:500;">Consolidaci√≥n</p>
                            <p style="margin:4px 0 0 0; font-size:13px; color:#555;">Asegurar que las variantes de 100g y 50g compartan reviews para maximizar la prueba social.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========================= TAB 2: INTERACTIVE ========================= -->
        <div id="tab-interactive" class="hidden">
            <div class="card">
                <div style="display:flex; align-items:center; margin-bottom:20px;">
                    <span class="material-icons" style="margin-right:8px; color:var(--primary);">tune</span>
                    <h2 style="margin:0;">Explorador Din√°mico</h2>
                </div>
                
                <div style="display:flex; gap:10px; margin-bottom:20px; background:var(--gray-100); padding:16px; border-radius:12px;">
                    <div>
                        <label style="display:block; font-size:12px; margin-bottom:4px; font-weight:600;">Semana</label>
                        <select id="weekSelector" onchange="updateInteractive()"></select>
                    </div>
                    <div>
                        <label style="display:block; font-size:12px; margin-bottom:4px; font-weight:600;">Competidor a Comparar</label>
                        <select id="compSelector" onchange="updateInteractive()"></select>
                    </div>
                </div>

                <div class="grid-2">
                    <div id="int_chart_price" class="chart-container"></div>
                    <div id="int_chart_share" class="chart-container"></div>
                </div>
                
                <div style="margin-top:20px;">
                    <h3>Detalle de ASINs (Semana Seleccionada)</h3>
                    <div id="table_details"></div>
                </div>
            </div>
        </div>

    </div>

    <!-- DATA INJECTION -->
    <script>
        // Data injected from Python analysis
        const marketData = [{"week_date":"2026-01","parent_asin":"Matcha Ceremonial","asin":"B0CNRX8G5S","final_brand":"NORITUAL LAB","is_yaba_asin":"N","click_share":17.86,"calculated_clicks":171.766764,"average_organic_rank":1,"price":22.9,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":4,"product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","weekly_search_volume":961.74,"impression_share":3.27},{"week_date":"2025-52","parent_asin":"Matcha Ceremonial","asin":"B0FSL3C3Z8","final_brand":"NORITUAL LAB","is_yaba_asin":"N","click_share":14.2,"calculated_clicks":269.4166,"average_organic_rank":2,"price":15.28,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","weekly_search_volume":1897.3,"impression_share":4.38},{"week_date":"2025-52","parent_asin":"Matcha Ceremonial","asin":"B0FSL3C3Z8","final_brand":"NORITUAL LAB","is_yaba_asin":"N","click_share":14.2,"calculated_clicks":269.4166,"average_organic_rank":2,"price":15.28,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","weekly_search_volume":1897.3,"impression_share":4.38},{"week_date":"2026-01","parent_asin":"Matcha Ceremonial","asin":"B0FSL3C3Z8","final_brand":"NORITUAL LAB","is_yaba_asin":"N","click_share":14.08,"calculated_clicks":135.412992,"average_organic_rank":2,"price":14.9,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","weekly_search_volume":961.74,"impression_share":4.42},{"week_date":"2026-01","parent_asin":"Matcha Ceremonial","asin":"B0FSL3C3Z8","final_brand":"NORITUAL LAB","is_yaba_asin":"N","click_share":14.08,"calculated_clicks":135.412992,"average_organic_rank":2,"price":14.9,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","weekly_search_volume":961.74,"impression_share":4.42},{"week_date":"2025-52","parent_asin":"Matcha Ceremonial","asin":"B0CNRX8G5S","final_brand":"NORITUAL LAB","is_yaba_asin":"N","click_share":17.63,"calculated_clicks":334.49399,"average_organic_rank":1,"price":23.484285714,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":7,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","weekly_search_volume":1897.3,"impression_share":3.14},{"week_date":"2025-52","parent_asin":"Matcha Ceremonial","asin":"B0882ZCHMW","final_brand":"Matcha & CO","is_yaba_asin":"N","click_share":1.78,"calculated_clicks":33.77194,"average_organic_rank":14,"price":31.344285714,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"T\u00e9 Matcha Ceremonial Premium 80 Gr","weekly_search_volume":1897.3,"impression_share":3.3},{"week_date":"2025-52","parent_asin":"Matcha Ceremonial","asin":"B0FJM1MBLM","final_brand":"Ceremonial","is_yaba_asin":"N","click_share":2.84,"calculated_clicks":53.88332,"average_organic_rank":10,"price":39.492857143,"weekly_number_of_days_with_deal":1,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"Ceremonial Matcha Kiri - Reines Gr\u00fcntee-Pulver aus...","weekly_search_volume":1897.3,"impression_share":3.09},{"week_date":"2025-52","parent_asin":"Matcha Ceremonial","asin":"B0DPJ4Z5WS","final_brand":"WeightWorld","is_yaba_asin":"N","click_share":1.18,"calculated_clicks":22.38814,"average_organic_rank":42,"price":13.321428571,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"Bio Matcha Pulver - 100 g Japanischer Matcha Tee -...","weekly_search_volume":1897.3,"impression_share":1.64},{"week_date":"2026-01","parent_asin":"Matcha Ceremonial","asin":"B0FK5VGD2H","final_brand":"M'atelier","is_yaba_asin":"N","click_share":4.17,"calculated_clicks":40.104558,"average_organic_rank":6,"price":19.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"M'atelier Reines Matcha Pulver aus Japan \u2013 Ceremon...","weekly_search_volume":961.74,"impression_share":3.09},{"week_date":"2026-01","parent_asin":"Matcha Ceremonial","asin":"B0FC2XRLV5","final_brand":"Matcha","is_yaba_asin":"N","click_share":1.96,"calculated_clicks":18.850104,"average_organic_rank":9,"price":14.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"Matcha Pulver Ceremonial Grade BIO-Qualit\u00e4t 100g i...","weekly_search_volume":961.74,"impression_share":3.75},{"week_date":"2026-01","parent_asin":"Matcha Ceremonial","asin":"B0G3XBLNKN","final_brand":"Jibix","is_yaba_asin":"N","click_share":3.91,"calculated_clicks":37.604034,"average_organic_rank":12,"price":22.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"Jibix Ceremonial Matcha \u2013 100% Japanischer zeremon...","weekly_search_volume":961.74,"impression_share":3.57},{"week_date":"2026-01","parent_asin":"Matcha Ceremonial","asin":"B0F9B1LWQQ","final_brand":"UNREAL¬Æ","is_yaba_asin":"N","click_share":3.39,"calculated_clicks":32.602986,"average_organic_rank":10,"price":29.95,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"UNREAL\u00ae 100g Ceremonial Bio Matcha \u2013 100% Japanisc...","weekly_search_volume":961.74,"impression_share":4.0},{"week_date":"2026-01","parent_asin":"Matcha Ceremonial","asin":"B0G1T7N675","final_brand":"Ceremonial","is_yaba_asin":"N","click_share":2.87,"calculated_clicks":27.601938,"average_organic_rank":13,"price":8.47,"weekly_number_of_days_with_deal":4,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"Ceremonial Matcha Pulver BIO-Qualit\u00e4t 50g ideal zu...","weekly_search_volume":961.74,"impression_share":3.17},{"week_date":"2026-01","parent_asin":"Matcha Ceremonial","asin":"B0FJ917BGC","final_brand":"ORIGEENS","is_yaba_asin":"N","click_share":2.74,"calculated_clicks":26.351676,"average_organic_rank":15,"price":24.97,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"ORIGEENS BIO MATCHA CEREMONIAL GRADE HINOTORI - Ja...","weekly_search_volume":961.74,"impression_share":2.43},{"week_date":"2025-52","parent_asin":"Matcha Ceremonial","asin":"B0F9B1LWQQ","final_brand":"UNREAL¬Æ","is_yaba_asin":"N","click_share":2.49,"calculated_clicks":47.24277,"average_organic_rank":11,"price":30.714285714,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"UNREAL\u00ae 100g Ceremonial Bio Matcha \u2013 100% Japanisc...","weekly_search_volume":1897.3,"impression_share":3.66},{"week_date":"2025-52","parent_asin":"Matcha Ceremonial","asin":"B0F99ZP2TX","final_brand":"Kuro Matcha","is_yaba_asin":"N","click_share":3.55,"calculated_clicks":67.35415,"average_organic_rank":4,"price":9.178571429,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"UNREAL\u00ae Ceremonial Bio Matcha \u2013 100% Japanischer Z...","weekly_search_volume":1897.3,"impression_share":2.6},{"week_date":"2025-52","parent_asin":"Matcha Ceremonial","asin":"B0F99ZP2TX","final_brand":"UNREAL¬Æ","is_yaba_asin":"N","click_share":3.55,"calculated_clicks":67.35415,"average_organic_rank":4,"price":9.178571429,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"UNREAL\u00ae Ceremonial Bio Matcha \u2013 100% Japanischer Z...","weekly_search_volume":1897.3,"impression_share":2.6},{"week_date":"2025-52","parent_asin":"Matcha Ceremonial","asin":"B0G3XBLNKN","final_brand":"Jibix","is_yaba_asin":"N","click_share":3.67,"calculated_clicks":69.63091,"average_organic_rank":12,"price":23.575714286,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"Jibix Ceremonial Matcha \u2013 100% Japanischer zeremon...","weekly_search_volume":1897.3,"impression_share":3.17},{"week_date":"2025-52","parent_asin":"Matcha Ceremonial","asin":"B07SZFD3P9","final_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":6.75,"calculated_clicks":128.06775,"average_organic_rank":7,"price":29.228571429,"weekly_number_of_days_with_deal":1,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"NaturaleBio Matcha Ceremonial Grade 100g. Original...","weekly_search_volume":1897.3,"impression_share":5.53},{"week_date":"2026-01","parent_asin":"Matcha Ceremonial","asin":"B07SZFD3P9","final_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":5.74,"calculated_clicks":55.203876,"average_organic_rank":10,"price":28.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"NaturaleBio Matcha Ceremonial Grade 100g. Original...","weekly_search_volume":961.74,"impression_share":5.46},{"week_date":"2026-01","parent_asin":"Matcha Ceremonial","asin":"B06XQ5DCYJ","final_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":5.08,"calculated_clicks":48.856392,"average_organic_rank":4,"price":13.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","weekly_search_volume":961.74,"impression_share":3.26},{"week_date":"2025-52","parent_asin":"Matcha Ceremonial","asin":"B06XQ5DCYJ","final_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":5.8,"calculated_clicks":110.0434,"average_organic_rank":4,"price":14.347142857,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_number_of_days_with_best_seller_badge":0,"weekly_number_of_days_with_amazon_choice_badge":0,"product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","weekly_search_volume":1897.3,"impression_share":3.13}];

        const OUR_BRAND = "NaturaleBio";

        // Logic
        google.charts.load('current', {'packages':['corechart', 'table']});
        google.charts.setOnLoadCallback(initReport);

        function initReport() {
            drawStaticCharts();
            populateInteractiveControls();
        }

        function switchTab(tabName) {
            document.getElementById('tab-static').classList.add('hidden');
            document.getElementById('tab-interactive').classList.add('hidden');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById('tab-' + tabName).classList.remove('hidden');
            event.target.classList.add('active');

            if (tabName === 'interactive') updateInteractive();
        }

        function drawStaticCharts() {
            // 1. Trend Chart
            const trendData = [];
            trendData.push(['Week', 'Competitors Clicks', 'Our Clicks', 'Our Share (%)']);
            
            const weeks = [...new Set(marketData.map(d => d.week_date))].sort();
            
            weeks.forEach(w => {
                const weekRows = marketData.filter(d => d.week_date === w);
                const ourClicks = weekRows.filter(d => d.final_brand === OUR_BRAND).reduce((a,b) => a + b.calculated_clicks, 0);
                const compClicks = weekRows.filter(d => d.final_brand !== OUR_BRAND).reduce((a,b) => a + b.calculated_clicks, 0);
                const totalClicks = ourClicks + compClicks;
                const ourShare = totalClicks > 0 ? (ourClicks / totalClicks) * 100 : 0;
                
                trendData.push([w, compClicks, ourClicks, ourShare]);
            });

            const dtTrend = google.visualization.arrayToDataTable(trendData);
            const optTrend = {
                seriesType: 'bars',
                series: { 2: {type: 'line', targetAxisIndex: 1, color: '#007AFF', lineWidth: 3} },
                colors: ['#E5E5EA', '#34C759'],
                isStacked: true,
                vAxes: { 0: {title: 'Clicks Volume'}, 1: {title: 'Share %', format: '#\'%\''} },
                legend: { position: 'bottom' },
                chartArea: { width: '80%', height: '70%' }
            };
            new google.visualization.ComboChart(document.getElementById('chart_trend')).draw(dtTrend, optTrend);

            // 2. Share Chart
            const shareData = [['Week', 'NaturaleBio', 'NORITUAL LAB', 'Rest']];
            weeks.forEach(w => {
                const weekRows = marketData.filter(d => d.week_date === w);
                const totalShare = weekRows.reduce((a,b) => a + b.click_share, 0);
                
                const ourShare = weekRows.filter(d => d.final_brand === OUR_BRAND).reduce((a,b) => a + b.click_share, 0);
                const topCompShare = weekRows.filter(d => d.final_brand === 'NORITUAL LAB').reduce((a,b) => a + b.click_share, 0);
                const restShare = totalShare - ourShare - topCompShare;
                
                shareData.push([w, ourShare, topCompShare, restShare]);
            });

            const dtShare = google.visualization.arrayToDataTable(shareData);
            const optShare = {
                curveType: 'function',
                colors: ['#007AFF', '#FF3B30', '#999'],
                lineWidth: 3,
                vAxis: { title: 'Click Share (%)' },
                legend: { position: 'bottom' },
                chartArea: { width: '85%', height: '70%' }
            };
            new google.visualization.LineChart(document.getElementById('chart_share')).draw(dtShare, optShare);

            // 4. Efficiency (Scatter)
            // Filter only last week for cleanliness
            const lastWeek = weeks[weeks.length - 1];
            const currentRows = marketData.filter(d => d.week_date === lastWeek);
            
            const scatterData = [['Rank', 'Click Share', {'type': 'string', 'role': 'style'}, {'type': 'string', 'role': 'tooltip'}]];
            currentRows.forEach(row => {
                const color = row.final_brand === OUR_BRAND ? '#007AFF' : (row.final_brand === 'NORITUAL LAB' ? '#FF3B30' : '#CCCCCC');
                const tooltip = `${row.final_brand} (${row.asin})\nRank: ${row.average_organic_rank}\nShare: ${row.click_share}%`;
                scatterData.push([row.average_organic_rank, row.click_share, `point { fill-color: ${color}; size: 6; }`, tooltip]);
            });

            const dtScatter = google.visualization.arrayToDataTable(scatterData);
            const optScatter = {
                hAxis: { title: 'Organic Rank (Lower is Better)', direction: 1 },
                vAxis: { title: 'Click Share (%)' },
                legend: 'none',
                chartArea: { width: '85%', height: '70%' }
            };
            new google.visualization.ScatterChart(document.getElementById('chart_scatter')).draw(dtScatter, optScatter);
        }

        // ================= INTERACTIVE LOGIC =================
        function populateInteractiveControls() {
            const weeks = [...new Set(marketData.map(d => d.week_date))].sort();
            const brands = [...new Set(marketData.map(d => d.final_brand))].filter(b => b !== OUR_BRAND).sort();
            
            const weekSel = document.getElementById('weekSelector');
            weeks.forEach(w => {
                const opt = document.createElement('option');
                opt.value = w;
                opt.text = w;
                if(w === weeks[weeks.length-1]) opt.selected = true;
                weekSel.appendChild(opt);
            });

            const compSel = document.getElementById('compSelector');
            brands.forEach(b => {
                const opt = document.createElement('option');
                opt.value = b;
                opt.text = b;
                if(b === 'NORITUAL LAB') opt.selected = true; // Default to main comp
                compSel.appendChild(opt);
            });
        }

        function updateInteractive() {
            const week = document.getElementById('weekSelector').value;
            const comp = document.getElementById('compSelector').value;
            
            const rows = marketData.filter(d => d.week_date === week && (d.final_brand === OUR_BRAND || d.final_brand === comp));

            // Chart 1: Price Comparison
            const priceData = [['ASIN', 'Price', {role: 'style'}]];
            rows.forEach(r => {
                const color = r.final_brand === OUR_BRAND ? '#007AFF' : '#FF3B30';
                priceData.push([r.asin.substring(0,5)+"..", r.price, color]);
            });
            const dtPrice = google.visualization.arrayToDataTable(priceData);
            new google.visualization.ColumnChart(document.getElementById('int_chart_price')).draw(dtPrice, {
                title: 'Comparativa de Precios', legend: 'none', colors:['#007AFF']
            });

            // Chart 2: Share Comparison
            const shareData = [['Brand', 'Total Share']];
            const ourShare = rows.filter(r => r.final_brand === OUR_BRAND).reduce((a,b)=>a+b.click_share,0);
            const compShare = rows.filter(r => r.final_brand === comp).reduce((a,b)=>a+b.click_share,0);
            shareData.push([OUR_BRAND, ourShare]);
            shareData.push([comp, compShare]);
            
            const dtShare = google.visualization.arrayToDataTable(shareData);
            new google.visualization.PieChart(document.getElementById('int_chart_share')).draw(dtShare, {
                title: 'Cuota de Mercado (Head-to-Head)', colors: ['#007AFF', '#FF3B30']
            });

            // Table
            const tableData = new google.visualization.DataTable();
            tableData.addColumn('string', 'Brand');
            tableData.addColumn('string', 'ASIN');
            tableData.addColumn('string', 'Title');
            tableData.addColumn('number', 'Price');
            tableData.addColumn('number', 'Rank');
            tableData.addColumn('number', 'Share %');

            rows.forEach(r => {
                tableData.addRow([r.final_brand, r.asin, r.product_title.substring(0,30)+"...", r.price, r.average_organic_rank, r.click_share]);
            });

            const table = new google.visualization.Table(document.getElementById('table_details'));
            table.draw(tableData, {showRowNumber: true, width: '100%', height: '100%'});
        }
    </script>
</body>
</html>