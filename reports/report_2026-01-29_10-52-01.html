<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analisis Parent ASIN: Matcha Premium</title>
    <!-- Google Charts -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        :root {
            --primary: #007AFF; /* Apple Blue */
            --bg: #F5F5F7;
            --card-bg: #FFFFFF;
            --text-main: #1D1D1F;
            --text-sec: #86868B;
            --success: #34C759;
            --danger: #FF3B30;
            --border: #D2D2D7;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header */
        header {
            margin-bottom: 30px;
            text-align: center;
        }
        h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        .subtitle {
            color: var(--text-sec);
            font-size: 14px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: #E8E8ED;
            padding: 4px;
            border-radius: 12px;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }
        .tab-btn {
            padding: 8px 24px;
            border: none;
            background: transparent;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 8px;
            color: var(--text-sec);
            transition: all 0.2s;
        }
        .tab-btn.active {
            background: var(--card-bg);
            color: var(--text-main);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Grid Layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: 18px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.05);
        }
        .card-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .metric-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-main);
        }
        .metric-label {
            font-size: 13px;
            color: var(--text-sec);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Text Sections */
        .text-section h3 {
            color: var(--primary);
            font-size: 18px;
            margin-top: 0;
        }
        .insight-list li {
            margin-bottom: 8px;
            color: #424245;
        }
        .rec-tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            margin-right: 8px;
        }
        .rec-tag.urgent { background: #FFDADA; color: #D70015; }
        .rec-tag.growth { background: #E4F4E0; color: #248A3D; }

        /* Interactive Controls */
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            background: var(--card-bg);
            padding: 16px;
            border-radius: 16px;
            align-items: center;
        }
        select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            font-size: 14px;
            background: var(--bg);
        }
        .vs-badge {
            font-weight: 800;
            color: var(--text-sec);
            font-size: 12px;
            background: #E8E8ED;
            padding: 4px 8px;
            border-radius: 4px;
        }

        /* Chart Containers */
        .chart-box {
            width: 100%;
            height: 300px;
        }

        /* Utilities */
        .hidden { display: none; }
        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }
        
        @media (max-width: 768px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>An√°lisis Estrat√©gico: Matcha Premium</h1>
        <div class="subtitle">Reporte de Inteligencia de Mercado | √öltima actualizaci√≥n: Semana 01 2026</div>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('static')">Reporte Ejecutivo</button>
        <button class="tab-btn" onclick="switchTab('interactive')">Comparador Din√°mico</button>
    </div>

    <!-- PESTA√ëA 1: REPORTE EST√ÅTICO -->
    <div id="tab-static">
        
        <!-- 1. KPIs Globales -->
        <div class="grid-3">
            <div class="card">
                <div class="metric-label">Tendencia de Tr√°fico (Est.)</div>
                <div class="metric-value trend-down">
                    <span class="material-icons" style="vertical-align: middle;">trending_down</span> -41%
                </div>
                <div class="subtitle">Vs. Semana anterior (Post-Xmas Drop)</div>
            </div>
            <div class="card">
                <div class="metric-label">Dominancia de Mercado</div>
                <div class="metric-value">NORITUAL</div>
                <div class="subtitle">L√≠der con ~19% Click Share</div>
            </div>
            <div class="card">
                <div class="metric-label">Posici√≥n de Precio</div>
                <div class="metric-value" style="color: var(--primary);">Premium</div>
                <div class="subtitle">+30% sobre el promedio de la categor√≠a</div>
            </div>
        </div>

        <!-- 2. Charts Row 1 -->
        <div class="grid-2">
            <div class="card">
                <div class="card-title">
                    <span class="material-icons">bar_chart</span> Tendencia Global del Parent
                </div>
                <div id="chart_trend" class="chart-box"></div>
                <div class="subtitle" style="margin-top:10px; font-size:12px;">
                    * Barras: Volumen Estimado | L√≠neas: Click Share (Nosotros vs Competencia)
                </div>
            </div>
            <div class="card">
                <div class="card-title">
                    <span class="material-icons">show_chart</span> Competitividad de Marca (Share %)
                </div>
                <div id="chart_comp" class="chart-box"></div>
                <div class="subtitle" style="margin-top:10px; font-size:12px;">
                    * Top 3 Competidores vs Nuestra Marca
                </div>
            </div>
        </div>

        <!-- 3. Efficiency & Levers -->
        <div class="grid-2">
            <div class="card">
                <div class="card-title">
                    <span class="material-icons">scatter_plot</span> Eficiencia: Rank vs Click Share
                </div>
                <div id="chart_efficiency" class="chart-box"></div>
                <div class="subtitle" style="margin-top:10px; font-size:12px;">
                    * Arriba a la derecha = Alta Eficiencia (Buen Share con buen Rank)
                </div>
            </div>
            
            <div class="card text-section">
                <div class="card-title">
                    <span class="material-icons">tune</span> Palancas y An√°lisis
                </div>
                <div class="insight-list">
                    <div style="margin-bottom:15px;">
                        <strong>üí≤ Sensibilidad al Precio:</strong>
                        <p style="font-size:13px; margin:4px 0;">El mercado prefiere opciones < 16‚Ç¨. Nuestra marca (>20‚Ç¨) sufre presi√≥n en share frente a competidores m√°s baratos como <i>Special Leaves</i> (10‚Ç¨).</p>
                    </div>
                    <div>
                        <strong>üè∑Ô∏è Badges y Promociones:</strong>
                        <p style="font-size:13px; margin:4px 0;">Competidores usan agresivamente "Amazon Choice". En las semanas analizadas, nuestros ASINs carecen de Deal Days significativos comparado con VAHDAM.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. Insights & Recomendaciones -->
        <div class="card text-section">
            <h3>üí° Conclusiones y Recomendaciones Accionables</h3>
            <div class="grid-2">
                <div>
                    <h4 style="margin:0 0 10px 0; font-size:14px;">Insights Clave</h4>
                    <ul class="insight-list" style="padding-left: 20px; font-size:13px;">
                        <li><strong>Contracci√≥n de Demanda:</strong> Ca√≠da severa del volumen de b√∫squeda en la Semana 01 (-41%), normalizando tras fiestas.</li>
                        <li><strong>Liderazgo de Nicho:</strong> NORITUAL LAB domina con consistencia. Su estrategia parece enfocada en "Ceremonial Grade" a precio medio.</li>
                        <li><strong>Gap de Visibilidad:</strong> Nuestros ASINs tienen buen ranking org√°nico (Avg Rank ~4) pero menor conversi√≥n a clicks que el l√≠der.</li>
                        <li><strong>Riesgo de Precio:</strong> Al ser la opci√≥n m√°s cara del Top 5, somos vulnerables a competidores "Value" como Special Leaves.</li>
                        <li><strong>Anomal√≠a:</strong> ASIN B0CNRX8G5S (Competidor) mantiene share alto a pesar de precio alto, posiblemente por fidelizaci√≥n o keywords espec√≠ficas.</li>
                    </ul>
                </div>
                <div>
                    <h4 style="margin:0 0 10px 0; font-size:14px;">Plan de Acci√≥n</h4>
                    <ul class="insight-list" style="list-style: none; padding: 0;">
                        <li><span class="rec-tag urgent">DEFENSA</span> <strong>Revisi√≥n de Precio:</strong> Evaluar reducci√≥n temporal a 18.99‚Ç¨ para recuperar tracci√≥n en la cuesta de enero.</li>
                        <li><span class="rec-tag growth">VISIBILIDAD</span> <strong>Activar Cupones:</strong> Implementar cup√≥n del 5-10% en ASINs principales para mejorar CTR visual.</li>
                        <li><span class="rec-tag growth">KEYWORD</span> <strong>Defensa de Marca:</strong> Blindar keywords de marca propia, competidores est√°n apareciendo en b√∫squedas relacionadas.</li>
                    </ul>
                </div>
            </div>
        </div>

    </div>

    <!-- PESTA√ëA 2: COMPARADOR INTERACTIVO -->
    <div id="tab-interactive" class="hidden">
        <div class="controls">
            <div>
                <label style="font-size:12px; display:block; color:var(--text-sec);">Semana</label>
                <select id="sel_week" onchange="updateComparator()"></select>
            </div>
            <div class="vs-badge">VS</div>
            <div>
                <label style="font-size:12px; display:block; color:var(--text-sec);">Competidor a Analizar</label>
                <select id="sel_comp" onchange="updateComparator()"></select>
            </div>
        </div>

        <div class="grid-2">
            <!-- Nuestra Ficha -->
            <div class="card" style="border-top: 4px solid var(--primary);">
                <div class="card-title" style="color:var(--primary);">NaturaleBio (Nosotros)</div>
                <div id="stats_us"></div>
            </div>
            
            <!-- Ficha Competencia -->
            <div class="card" style="border-top: 4px solid var(--danger);">
                <div class="card-title" style="color:var(--danger);" id="comp_title_disp">Competidor</div>
                <div id="stats_comp"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-title">Cara a Cara: M√©tricas Clave</div>
            <div id="chart_comparator" class="chart-box"></div>
        </div>
    </div>

</div>

<!-- DATA & LOGIC -->
<script>
    // 1. INJECTED DATA (From Python)
    const marketData = [{"week": "2025-52", "brand": "NaturaleBio", "brand_cat": "Nuestra Marca", "is_ours": true, "asin": "B06XQ5DCYJ", "title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit......", "clicks": 5563.97, "share": 11.66, "rank": 2.0, "price": 15.058571429, "deal_days": 0.0, "coupon_days": 0.0, "best_seller": 0.0, "amazon_choice": 0.0}, {"week": "2025-52", "brand": "NORITUAL LAB", "brand_cat": "NORITUAL LAB", "is_ours": false, "asin": "B0CNRX8G5S", "title": "Ceremonial Matcha - Reines Matcha Pulver aus Japan......", "clicks": 8956.75, "share": 18.77, "rank": 2.0, "price": 24.648571429, "deal_days": 0.0, "coupon_days": 0.0, "best_seller": 0.0, "amazon_choice": 7.0}, {"week": "2025-52", "brand": "NaturaleBio", "brand_cat": "Nuestra Marca", "is_ours": true, "asin": "B06XQ69YCQ", "title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit......", "clicks": 1789.44, "share": 3.75, "rank": 4.0, "price": 10.538571429, "deal_days": 0.0, "coupon_days": 0.0, "best_seller": 0.0, "amazon_choice": 0.0}, {"week": "2025-52", "brand": "NaturaleBio", "brand_cat": "Nuestra Marca", "is_ours": true, "asin": "B079VQ52MK", "title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit......", "clicks": 1665.37, "share": 3.49, "rank": 5.0, "price": 24.855714286, "deal_days": 0.0, "coupon_days": 0.0, "best_seller": 0.0, "amazon_choice": 0.0}, {"week": "2025-52", "brand": "Ceremonial", "brand_cat": "Ceremonial", "is_ours": false, "asin": "B0FSL3C3Z8", "title": "Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au......", "clicks": 4017.89, "share": 8.42, "rank": 6.0, "price": 16.037142857, "deal_days": 0.0, "coupon_days": 0.0, "best_seller": 0.0, "amazon_choice": 0.0}, {"week": "2025-52", "brand": "VAHDAM", "brand_cat": "Resto", "is_ours": false, "asin": "B07MD4LB49", "title": "VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A......", "clicks": 1999.4, "share": 4.19, "rank": 7.0, "price": 9.895714286, "deal_days": 3.0, "coupon_days": 0.0, "best_seller": 0.0, "amazon_choice": 0.0}, {"week": "2025-52", "brand": "bioKontor", "brand_cat": "Resto", "is_ours": false, "asin": "B08XVX8V1T", "title": "Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n......", "clicks": 1164.33, "share": 2.44, "rank": 10.0, "price": 12.367142857, "deal_days": 0.0, "coupon_days": 0.0, "best_seller": 0.0, "amazon_choice": 0.0}, {"week": "2025-52", "brand": "Special Leaves", "brand_cat": "Special Leaves", "is_ours": false, "asin": "B0DRP6Y6XC", "title": "Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl......", "clicks": 1622.43, "share": 3.4, "rank": 13.0, "price": 10.71, "deal_days": 0.0, "coupon_days": 7.0, "best_seller": 0.0, "amazon_choice": 0.0}, {"week": "2025-52", "brand": "VAHDAM", "brand_cat": "Resto", "is_ours": false, "asin": "B07K1WBH4K", "title": "VAHDAM, Vanille Matcha Gr\u00fcner Tee Pulver (100g, 50......", "clicks": 701.46, "share": 1.47, "rank": 20.0, "price": 9.895714286, "deal_days": 3.0, "coupon_days": 0.0, "best_seller": 0.0, "amazon_choice": 0.0}, {"week": "2025-52", "brand": "NaturaleBio", "brand_cat": "Nuestra Marca", "is_ours": true, "asin": "B07SZFD3P9", "title": "NaturaleBio Matcha Ceremonial Grade 100g. Original......", "clicks": 1398.15, "share": 2.93, "rank": 23.0, "price": 30.704285714, "deal_days": 1.0, "coupon_days": 0.0, "best_seller": 0.0, "amazon_choice": 0.0}, {"week": "2026-01", "brand": "NaturaleBio", "brand_cat": "Nuestra Marca", "is_ours": true, "asin": "B07SZFD3P9", "title": "NaturaleBio Matcha Ceremonial Grade 100g. Original......", "clicks": 726.09, "share": 2.68, "rank": 0.0, "price": 30.27, "deal_days": 0.0, "coupon_days": 0.0, "best_seller": 0.0, "amazon_choice": 0.0}, {"week": "2026-01", "brand": "NaturaleBio", "brand_cat": "Nuestra Marca", "is_ours": true, "asin": "B06XQ5DCYJ", "title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit......", "clicks": 3494.99, "share": 12.9, "rank": 2.0, "price": 14.6075, "deal_days": 0.0, "coupon_days": 0.0, "best_seller": 0.0, "amazon_choice": 0.0}, {"week": "2026-01", "brand": "NORITUAL LAB", "brand_cat": "NORITUAL LAB", "is_ours": false, "asin": "B0CNRX8G5S", "title": "Ceremonial Matcha - Reines Matcha Pulver aus Japan......", "clicks": 5239.77, "share": 19.34, "rank": 2.0, "price": 23.91, "deal_days": 0.0, "coupon_days": 0.0, "best_seller": 0.0, "amazon_choice": 4.0}, {"week": "2026-01", "brand": "NaturaleBio", "brand_cat": "Nuestra Marca", "is_ours": true, "asin": "B06XQ69YCQ", "title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit......", "clicks": 907.61, "share": 3.35, "rank": 5.0, "price": 10.2225, "deal_days": 0.0, "coupon_days": 0.0, "best_seller": 0.0, "amazon_choice": 0.0}, {"week": "2026-01", "brand": "NaturaleBio", "brand_cat": "Nuestra Marca", "is_ours": true, "asin": "B079VQ52MK", "title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit......", "clicks": 991.6, "share": 3.66, "rank": 5.0, "price": 24.5275, "deal_days": 0.0, "coupon_days": 0.0, "best_seller": 0.0, "amazon_choice": 0.0}, {"week": "2026-01", "brand": "NORITUAL LAB", "brand_cat": "NORITUAL LAB", "is_ours": false, "asin": "B0FSL3C3Z8", "title": "Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au......", "clicks": 1999.46, "share": 7.38, "rank": 6.0, "price": 15.5575, "deal_days": 0.0, "coupon_days": 0.0, "best_seller": 0.0, "amazon_choice": 0.0}, {"week": "2026-01", "brand": "VAHDAM", "brand_cat": "Resto", "is_ours": false, "asin": "B07MD4LB49", "title": "VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A......", "clicks": 853.43, "share": 3.15, "rank": 9.0, "price": 10.43, "deal_days": 0.0, "coupon_days": 0.0, "best_seller": 0.0, "amazon_choice": 0.0}, {"week": "2026-01", "brand": "bioKontor", "brand_cat": "Resto", "is_ours": false, "asin": "B08XVX8V1T", "title": "Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n......", "clicks": 647.52, "share": 2.39, "rank": 10.0, "price": 11.9975, "deal_days": 0.0, "coupon_days": 0.0, "best_seller": 0.0, "amazon_choice": 0.0}, {"week": "2026-01", "brand": "Matcha", "brand_cat": "Resto", "is_ours": false, "asin": "B0DRP6Y6XC", "title": "Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl......", "clicks": 812.79, "share": 3.0, "rank": 16.0, "price": 10.39, "deal_days": 0.0, "coupon_days": 4.0, "best_seller": 0.0, "amazon_choice": 0.0}, {"week": "2026-01", "brand": "UNREAL\u00ae", "brand_cat": "Resto", "is_ours": false, "asin": "B0F9B1LWQQ", "title": "UNREAL\u00ae 100g Ceremonial Bio Matcha \u2013 100% Japanisc......", "clicks": 425.36, "share": 1.57, "rank": 19.0, "price": 31.2725, "deal_days": 0.0, "coupon_days": 0.0, "best_seller": 0.0, "amazon_choice": 0.0}];

    // 2. INIT GOOGLE CHARTS
    google.charts.load('current', {'packages':['corechart', 'bar', 'line']});
    google.charts.setOnLoadCallback(initDashboard);

    function initDashboard() {
        drawTrendChart();
        drawCompChart();
        drawEfficiencyChart();
        populateInteractiveControls();
        updateComparator();
    }

    // 3. CHART LOGIC
    function drawTrendChart() {
        const data = new google.visualization.DataTable();
        data.addColumn('string', 'Semana');
        data.addColumn('number', 'Clicks Nosotros');
        data.addColumn('number', 'Clicks Competencia');
        data.addColumn('number', 'Share % Nosotros');
        data.addColumn('number', 'Share % Competencia');

        // Aggregation
        const weeks = [...new Set(marketData.map(d => d.week))].sort();
        const rows = weeks.map(week => {
            const ours = marketData.filter(d => d.week === week && d.is_ours);
            const comps = marketData.filter(d => d.week === week && !d.is_ours);
            
            const clicksOurs = ours.reduce((a,b) => a + b.clicks, 0);
            const clicksComps = comps.reduce((a,b) => a + b.clicks, 0);
            const shareOurs = ours.reduce((a,b) => a + b.share, 0); // Approx sum of share
            const shareComps = comps.reduce((a,b) => a + b.share, 0);

            return [week, clicksOurs, clicksComps, shareOurs, shareComps];
        });

        data.addRows(rows);

        const options = {
            seriesType: 'bars',
            series: {
                2: {type: 'line', targetAxisIndex: 1, color: '#007AFF', lineWidth: 3},
                3: {type: 'line', targetAxisIndex: 1, color: '#86868B', lineWidth: 3, lineDashStyle: [4, 4]}
            },
            colors: ['#4285F4', '#E0E0E0'],
            vAxes: {
                0: {title: 'Volumen Estimado'},
                1: {title: 'Click Share %', format: '#\'%\''}
            },
            legend: {position: 'bottom'},
            animation: {startup: true, duration: 1000, easing: 'out'},
            chartArea: {width: '85%', height: '75%'}
        };

        const chart = new google.visualization.ComboChart(document.getElementById('chart_trend'));
        chart.draw(data, options);
    }

    function drawCompChart() {
        const data = new google.visualization.DataTable();
        data.addColumn('string', 'Semana');
        data.addColumn('number', 'Nuestra Marca');
        data.addColumn('number', 'NORITUAL LAB');
        data.addColumn('number', 'Ceremonial');
        
        const weeks = [...new Set(marketData.map(d => d.week))].sort();
        
        const rows = weeks.map(week => {
            // Helper to sum share by brand
            const getShare = (brand) => {
                return marketData
                    .filter(d => d.week === week && (d.brand === brand || (brand === 'Nuestra Marca' && d.is_ours)))
                    .reduce((a,b) => a + b.share, 0);
            };
            return [week, getShare('Nuestra Marca'), getShare('NORITUAL LAB'), getShare('Ceremonial')];
        });

        data.addRows(rows);

        const options = {
            curveType: 'function',
            legend: { position: 'bottom' },
            colors: ['#007AFF', '#FF3B30', '#34C759'], // Blue, Red, Green
            vAxis: {title: 'Total Click Share %'},
            lineWidth: 3,
            chartArea: {width: '85%', height: '75%'}
        };

        const chart = new google.visualization.LineChart(document.getElementById('chart_comp'));
        chart.draw(data, options);
    }

    function drawEfficiencyChart() {
        const data = new google.visualization.DataTable();
        data.addColumn('number', 'Rank Org√°nico');
        data.addColumn('number', 'Click Share %');
        data.addColumn({type: 'string', role: 'style'}); // Color
        data.addColumn({type: 'string', role: 'tooltip'});

        const currentWeek = "2026-01"; // Focus on latest
        const weekData = marketData.filter(d => d.week === currentWeek);

        const rows = weekData.map(d => {
            const color = d.is_ours ? '#007AFF' : '#C7C7CC';
            const tooltip = `${d.brand}\nRank: ${d.rank}\nShare: ${d.share}%\nPrecio: ${d.price.toFixed(2)}‚Ç¨`;
            return [d.rank, d.share, `point { fill-color: ${color}; size: 10; }`, tooltip];
        });

        data.addRows(rows);

        const options = {
            hAxis: {title: 'Posici√≥n Org√°nica (Rank)', direction: 1}, // 1 is normal
            vAxis: {title: 'Click Share %'},
            legend: 'none',
            chartArea: {width: '85%', height: '75%'}
        };

        const chart = new google.visualization.ScatterChart(document.getElementById('chart_efficiency'));
        chart.draw(data, options);
    }

    // 4. INTERACTIVE LOGIC
    function populateInteractiveControls() {
        // Weeks
        const weeks = [...new Set(marketData.map(d => d.week))].sort().reverse();
        const selWeek = document.getElementById('sel_week');
        weeks.forEach(w => {
            const opt = document.createElement('option');
            opt.value = w;
            opt.text = w;
            selWeek.add(opt);
        });

        // Competitors
        const comps = [...new Set(marketData.filter(d => !d.is_ours).map(d => d.brand))].sort();
        const selComp = document.getElementById('sel_comp');
        comps.forEach(c => {
            const opt = document.createElement('option');
            opt.value = c;
            opt.text = c;
            selComp.add(opt);
        });
    }

    function updateComparator() {
        const week = document.getElementById('sel_week').value;
        const compBrand = document.getElementById('sel_comp').value;
        
        document.getElementById('comp_title_disp').innerText = compBrand;

        // Data Prep
        const usData = marketData.filter(d => d.week === week && d.is_ours);
        const compData = marketData.filter(d => d.week === week && d.brand === compBrand);

        // Calculate Stats
        const avgPriceUs = usData.reduce((a,b) => a + b.price, 0) / (usData.length || 1);
        const avgPriceComp = compData.reduce((a,b) => a + b.price, 0) / (compData.length || 1);
        const shareUs = usData.reduce((a,b) => a + b.share, 0);
        const shareComp = compData.reduce((a,b) => a + b.share, 0);

        // Update DOM
        document.getElementById('stats_us').innerHTML = `
            <div style="margin-bottom:8px"><strong>Share:</strong> ${shareUs.toFixed(1)}%</div>
            <div style="margin-bottom:8px"><strong>Precio Avg:</strong> ${avgPriceUs.toFixed(2)}‚Ç¨</div>
            <div><strong>ASINs Activos:</strong> ${usData.length}</div>
        `;
        document.getElementById('stats_comp').innerHTML = `
            <div style="margin-bottom:8px"><strong>Share:</strong> ${shareComp.toFixed(1)}%</div>
            <div style="margin-bottom:8px"><strong>Precio Avg:</strong> ${avgPriceComp.toFixed(2)}‚Ç¨</div>
            <div><strong>ASINs Activos:</strong> ${compData.length}</div>
        `;

        // Draw Comparator Chart
        const data = google.visualization.arrayToDataTable([
            ['M√©trica', 'Nosotros', compBrand],
            ['Share %', shareUs, shareComp],
            ['Precio (‚Ç¨)', avgPriceUs, avgPriceComp],
            ['Rank Avg', usData.length > 0 ? usData[0].rank : 0, compData.length > 0 ? compData[0].rank : 0]
        ]);

        const options = {
            bars: 'horizontal',
            colors: ['#007AFF', '#FF3B30'],
            chartArea: {width: '60%', height: '80%'}
        };

        const chart = new google.visualization.BarChart(document.getElementById('chart_comparator'));
        chart.draw(data, options);
    }

    // Utils
    function switchTab(tabId) {
        document.getElementById('tab-static').classList.add('hidden');
        document.getElementById('tab-interactive').classList.add('hidden');
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        
        document.getElementById('tab-' + tabId).classList.remove('hidden');
        event.target.classList.add('active');
        
        // Redraw interactive if needed to fix dimensions
        if(tabId === 'interactive') updateComparator();
    }
    
    // Resize handler
    window.addEventListener('resize', initDashboard);

</script>

</body>
</html>