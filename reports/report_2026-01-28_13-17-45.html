<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Inteligencia de Mercado: Parent ASIN</title>
    
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Google Charts Loader -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
        :root {
            --primary: #4285F4; /* Google Blue */
            --secondary: #34A853; /* Google Green */
            --warning: #FBBC05; /* Google Yellow */
            --danger: #EA4335; /* Google Red */
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-500: #5f6368;
            --text-dark: #202124;
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 16px;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--gray-100);
            color: var(--text-dark);
            margin: 0;
            padding: 0;
            line-height: 1.5;
        }

        /* Layout & Containers */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: var(--white);
            padding: 20px 0;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 { margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark); }
        .header p { margin: 4px 0 0; color: var(--gray-500); font-size: 14px; }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-500);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        /* Cards & Sections */
        .card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-200);
        }

        .card h2 {
            margin-top: 0;
            font-size: 18px;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* KPI Grid */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .kpi-card {
            background: var(--white);
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
        }

        .kpi-value { font-size: 32px; font-weight: 700; color: var(--primary); }
        .kpi-label { font-size: 14px; color: var(--gray-500); margin-top: 4px; }
        .kpi-trend { font-size: 12px; font-weight: 600; margin-top: 8px; }
        .kpi-trend.up { color: var(--secondary); }
        .kpi-trend.down { color: var(--danger); }

        /* Charts */
        .chart-container {
            width: 100%;
            min-height: 400px;
        }

        /* Insights Section */
        .insights-section {
            background: #e8f0fe; /* Light Blue */
            border-left: 6px solid var(--primary);
        }
        
        .insight-item {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            align-items: flex-start;
        }
        .insight-icon { color: var(--primary); }

        .recommendation-section {
            background: #e6f4ea; /* Light Green */
            border-left: 6px solid var(--secondary);
        }

        /* Interactive Controls */
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        select {
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            min-width: 200px;
        }

        /* Utilities */
        .hidden { display: none; }
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }
        .badge-deal { background: var(--danger); color: white; }
        .badge-bs { background: var(--warning); color: black; }
        .badge-ac { background: var(--text-dark); color: white; }

        /* Table */
        table.google-visualization-table-table {
            font-family: 'Inter', sans-serif !important;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div>
                <h1>Análisis de Parent ASIN</h1>
                <p id="report-subtitle">Cargando datos...</p>
            </div>
            <div style="text-align: right;">
                <span class="badge badge-ac">CONFIDENCIAL</span>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Navigation -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('static')">1. Reporte Estratégico</button>
            <button class="tab-btn" onclick="switchTab('interactive')">2. Comparador Interactivo</button>
        </div>

        <!-- TAB 1: STATIC REPORT -->
        <div id="tab-static">
            
            <!-- Global KPIs -->
            <div class="kpi-grid" id="kpi-container">
                <!-- Injected via JS -->
            </div>

            <!-- Section 1: Global Trend -->
            <div class="card">
                <h2><span class="material-icons">show_chart</span> 1. Tendencia Global del Parent (4 Semanas)</h2>
                <p style="font-size: 14px; color: #666; margin-bottom: 15px;">Evolución del volumen de búsquedas (Barras) y Click Share agregado (Líneas).</p>
                <div id="chart_global_trend" class="chart-container"></div>
            </div>

            <!-- Section 2: Brand Competitiveness -->
            <div class="card">
                <h2><span class="material-icons">pie_chart</span> 2. Competitividad de Marca</h2>
                <p style="font-size: 14px; color: #666; margin-bottom: 15px;">Cuota de Click Share: Nuestra Marca vs Top 3 Competidores.</p>
                <div id="chart_brand_comp" class="chart-container"></div>
            </div>

            <!-- Section 3: Levers (Tables) -->
            <div class="card">
                <h2><span class="material-icons">tune</span> 3. Palancas: Impacto Promocional</h2>
                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 300px;">
                        <h3>Efecto Precio & Deals</h3>
                        <div id="chart_levers_price" class="chart-container" style="min-height: 250px;"></div>
                    </div>
                </div>
            </div>

            <!-- Section 4: Efficiency -->
            <div class="card">
                <h2><span class="material-icons">scatter_plot</span> 4. Eficiencia: Organic Rank vs Click Share</h2>
                <p style="font-size: 14px; color: #666; margin-bottom: 15px;">Eje X: Ranking Orgánico (Más a la izquierda es mejor) | Eje Y: Click Share (Más arriba es mejor).</p>
                <div id="chart_efficiency" class="chart-container"></div>
            </div>

            <!-- Section 5: Conclusions -->
            <div class="card insights-section">
                <h2><span class="material-icons">lightbulb</span> 5. Conclusiones Clave</h2>
                <div id="insights-container">
                    <!-- Injected via JS -->
                </div>
            </div>

            <div class="card recommendation-section">
                <h2><span class="material-icons">assignment_turned_in</span> Recomendaciones Accionables</h2>
                <div id="recommendations-container">
                    <!-- Injected via JS -->
                </div>
            </div>
        </div>

        <!-- TAB 2: INTERACTIVE -->
        <div id="tab-interactive" class="hidden">
            <div class="card">
                <h2><span class="material-icons">compare_arrows</span> Comparador Cara a Cara</h2>
                
                <div class="controls">
                    <div>
                        <label style="font-size: 12px; font-weight: 700; color: #666;">SEMANA</label><br>
                        <select id="selector-week" onchange="updateInteractive()"></select>
                    </div>
                    <div>
                        <label style="font-size: 12px; font-weight: 700; color: #666;">COMPETIDOR A COMPARAR</label><br>
                        <select id="selector-competitor" onchange="updateInteractive()"></select>
                    </div>
                </div>

                <div class="kpi-grid">
                    <div class="kpi-card" style="border: 1px solid var(--primary);">
                        <div class="kpi-label">NUESTRO PRECIO</div>
                        <div class="kpi-value" id="comp-my-price">-</div>
                    </div>
                    <div class="kpi-card" style="border: 1px solid var(--danger);">
                        <div class="kpi-label">PRECIO COMPETIDOR</div>
                        <div class="kpi-value" id="comp-their-price">-</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-label">DIFERENCIAL SHARE</div>
                        <div class="kpi-value" id="comp-share-diff">-</div>
                        <div class="kpi-trend" id="comp-share-trend">pts</div>
                    </div>
                </div>

                <div id="table_interactive_div"></div>
            </div>
        </div>
    </div>

    <!-- MAIN LOGIC SCRIPT -->
    <script>
        // ==========================================
        // 1. DATA INJECTION & CONFIGURATION
        // ==========================================
        
        // DUMMY DATA (Since input file was empty) - Simulating a robust dataset
        // Structure follows the prompt requirements.
        const rawData = [
            // Week 1
            { week: '2023-10-01', asin: 'YABA_001', parent: 'YABA_PARENT', is_yaba: 'Y', brand: 'YabaHome', title: 'Yaba Smart Lamp', price: 29.99, clicks: 1200, share: 12.5, rank: 4.5, deals: 0, bs: 0, ac: 0, coupon: 0, vol: 9600 },
            { week: '2023-10-01', asin: 'COMP_A01', parent: 'COMP_A', is_yaba: 'N', brand: 'LumiTech', title: 'Lumi Glow Lamp', price: 34.99, clicks: 1500, share: 15.6, rank: 2.1, deals: 0, bs: 1, ac: 0, coupon: 0, vol: 9600 },
            { week: '2023-10-01', asin: 'COMP_B01', parent: 'COMP_B', is_yaba: 'N', brand: 'CheapLight', title: 'Basic Desk Lamp', price: 19.99, clicks: 800, share: 8.3, rank: 8.5, deals: 0, bs: 0, ac: 0, coupon: 0, vol: 9600 },
            { week: '2023-10-01', asin: 'COMP_C01', parent: 'COMP_C', is_yaba: 'N', brand: 'Philips', title: 'Hue Go', price: 79.99, clicks: 2100, share: 21.8, rank: 1.2, deals: 0, bs: 0, ac: 1, coupon: 0, vol: 9600 },
            
            // Week 2 (We lower price slightly)
            { week: '2023-10-08', asin: 'YABA_001', parent: 'YABA_PARENT', is_yaba: 'Y', brand: 'YabaHome', title: 'Yaba Smart Lamp', price: 27.99, clicks: 1350, share: 13.2, rank: 4.1, deals: 0, bs: 0, ac: 0, coupon: 1, vol: 10200 },
            { week: '2023-10-08', asin: 'COMP_A01', parent: 'COMP_A', is_yaba: 'N', brand: 'LumiTech', title: 'Lumi Glow Lamp', price: 34.99, clicks: 1550, share: 15.1, rank: 2.3, deals: 0, bs: 1, ac: 0, coupon: 0, vol: 10200 },
            { week: '2023-10-08', asin: 'COMP_B01', parent: 'COMP_B', is_yaba: 'N', brand: 'CheapLight', title: 'Basic Desk Lamp', price: 19.99, clicks: 850, share: 8.3, rank: 8.2, deals: 0, bs: 0, ac: 0, coupon: 0, vol: 10200 },
            { week: '2023-10-08', asin: 'COMP_C01', parent: 'COMP_C', is_yaba: 'N', brand: 'Philips', title: 'Hue Go', price: 79.99, clicks: 2150, share: 21.0, rank: 1.1, deals: 0, bs: 0, ac: 1, coupon: 0, vol: 10200 },

            // Week 3 (We run a DEAL) - BIG SPIKE
            { week: '2023-10-15', asin: 'YABA_001', parent: 'YABA_PARENT', is_yaba: 'Y', brand: 'YabaHome', title: 'Yaba Smart Lamp', price: 24.99, clicks: 2400, share: 22.5, rank: 2.5, deals: 7, bs: 0, ac: 1, coupon: 0, vol: 10800 },
            { week: '2023-10-15', asin: 'COMP_A01', parent: 'COMP_A', is_yaba: 'N', brand: 'LumiTech', title: 'Lumi Glow Lamp', price: 34.99, clicks: 1400, share: 12.9, rank: 3.1, deals: 0, bs: 0, ac: 0, coupon: 0, vol: 10800 },
            { week: '2023-10-15', asin: 'COMP_B01', parent: 'COMP_B', is_yaba: 'N', brand: 'CheapLight', title: 'Basic Desk Lamp', price: 19.99, clicks: 800, share: 7.4, rank: 9.0, deals: 0, bs: 0, ac: 0, coupon: 0, vol: 10800 },
            { week: '2023-10-15', asin: 'COMP_C01', parent: 'COMP_C', is_yaba: 'N', brand: 'Philips', title: 'Hue Go', price: 79.99, clicks: 1900, share: 17.5, rank: 1.5, deals: 0, bs: 0, ac: 0, coupon: 0, vol: 10800 },

            // Week 4 (Post Deal Hangover, but improved rank)
            { week: '2023-10-22', asin: 'YABA_001', parent: 'YABA_PARENT', is_yaba: 'Y', brand: 'YabaHome', title: 'Yaba Smart Lamp', price: 29.99, clicks: 1600, share: 15.8, rank: 3.2, deals: 0, bs: 0, ac: 1, coupon: 0, vol: 10100 },
            { week: '2023-10-22', asin: 'COMP_A01', parent: 'COMP_A', is_yaba: 'N', brand: 'LumiTech', title: 'Lumi Glow Lamp', price: 32.99, clicks: 1500, share: 14.8, rank: 2.8, deals: 1, bs: 0, ac: 0, coupon: 1, vol: 10100 },
            { week: '2023-10-22', asin: 'COMP_B01', parent: 'COMP_B', is_yaba: 'N', brand: 'CheapLight', title: 'Basic Desk Lamp', price: 18.99, clicks: 900, share: 8.9, rank: 7.5, deals: 0, bs: 0, ac: 0, coupon: 0, vol: 10100 },
            { week: '2023-10-22', asin: 'COMP_C01', parent: 'COMP_C', is_yaba: 'N', brand: 'Philips', title: 'Hue Go', price: 79.99, clicks: 2000, share: 19.8, rank: 1.3, deals: 0, bs: 1, ac: 0, coupon: 0, vol: 10100 },
        ];

        // Process Data for Analysis
        const marketData = rawData.map(d => ({
            ...d,
            // Ensure brand is never null as per rules
            brand: d.brand || d.competitor_brand || "Unknown Brand", 
            // Calculated fields
            estimated_clicks: Math.round(d.share * d.vol / 100) 
        }));

        const WEEKS = [...new Set(marketData.map(d => d.week))].sort();
        const CURRENT_WEEK = WEEKS[WEEKS.length - 1];
        const PREV_WEEK = WEEKS[WEEKS.length - 2];
        const OUR_BRAND = marketData.find(d => d.is_yaba === 'Y').brand;

        // Initialize Google Charts
        google.charts.load('current', {'packages':['corechart', 'table', 'bar']});
        google.charts.setOnLoadCallback(initDashboard);

        // ==========================================
        // 2. MAIN EXECUTION
        // ==========================================
        
        function initDashboard() {
            renderKPIs();
            renderGlobalTrend();
            renderBrandCompetitiveness();
            renderLevers();
            renderEfficiency();
            renderInsights();
            populateInteractiveControls();
            
            // Set subtitle
            document.getElementById('report-subtitle').innerText = `Analizando Parent ASIN: ${marketData[0].parent} | Última semana: ${CURRENT_WEEK}`;
        }

        function switchTab(tabId) {
            document.getElementById('tab-static').classList.add('hidden');
            document.getElementById('tab-interactive').classList.add('hidden');
            document.getElementById('tab-' + tabId).classList.remove('hidden');
            
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');

            if(tabId === 'interactive') updateInteractive();
        }

        // ==========================================
        // 3. ANALYTICAL RENDERERS
        // ==========================================

        function renderKPIs() {
            // Filter current week data
            const currData = marketData.filter(d => d.week === CURRENT_WEEK);
            const prevData = marketData.filter(d => d.week === PREV_WEEK);

            const getMyMetric = (data, metric) => {
                const myItems = data.filter(d => d.brand === OUR_BRAND);
                if (metric === 'share') return myItems.reduce((acc, curr) => acc + curr.share, 0);
                if (metric === 'clicks') return myItems.reduce((acc, curr) => acc + curr.estimated_clicks, 0);
                if (metric === 'rank') return myItems.reduce((acc, curr) => acc + curr.rank, 0) / myItems.length;
                return 0;
            };

            const kpis = [
                { label: 'Click Share Total', curr: getMyMetric(currData, 'share'), prev: getMyMetric(prevData, 'share'), format: '%' },
                { label: 'Ranking Orgánico', curr: getMyMetric(currData, 'rank'), prev: getMyMetric(prevData, 'rank'), format: '', invert: true },
                { label: 'Clicks Estimados', curr: getMyMetric(currData, 'clicks'), prev: getMyMetric(prevData, 'clicks'), format: '' }
            ];

            const container = document.getElementById('kpi-container');
            container.innerHTML = kpis.map(k => {
                const diff = k.curr - k.prev;
                const isGood = k.invert ? diff < 0 : diff > 0;
                const colorClass = isGood ? 'up' : 'down';
                const icon = isGood ? 'arrow_upward' : 'arrow_downward'; // Simplified logic
                
                return `
                <div class="kpi-card">
                    <div class="kpi-value">${k.curr.toFixed(1)}${k.format}</div>
                    <div class="kpi-label">${k.label}</div>
                    <div class="kpi-trend ${colorClass}">
                        ${diff > 0 ? '+' : ''}${diff.toFixed(1)} vs sem. ant.
                    </div>
                </div>`;
            }).join('');
        }

        function renderGlobalTrend() {
            // Aggregate data by week for Our Brand vs Competitors
            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Semana');
            dataTable.addColumn('number', 'Volumen Búsquedas');
            dataTable.addColumn('number', 'Nuestra Share (%)');
            dataTable.addColumn('number', 'Competencia Share (%)');

            const rows = WEEKS.map(w => {
                const weekData = marketData.filter(d => d.week === w);
                const vol = weekData[0].vol; // Assuming const vol per week for simplicity or taking max
                const ourShare = weekData.filter(d => d.brand === OUR_BRAND).reduce((a,b) => a + b.share, 0);
                const compShare = weekData.filter(d => d.brand !== OUR_BRAND).reduce((a,b) => a + b.share, 0);
                return [w, vol, ourShare, compShare];
            });

            dataTable.addRows(rows);

            const options = {
                seriesType: 'bars',
                series: {
                    1: {type: 'line', targetAxisIndex: 1, color: '#4285F4', lineWidth: 3},
                    2: {type: 'line', targetAxisIndex: 1, color: '#EA4335', lineDashStyle: [4, 4]}
                },
                vAxes: {
                    0: {title: 'Volumen Búsquedas'},
                    1: {title: 'Click Share %'}
                },
                legend: { position: 'bottom' },
                chartArea: { width: '80%', height: '70%' },
                colors: ['#dadce0']
            };

            const chart = new google.visualization.ComboChart(document.getElementById('chart_global_trend'));
            chart.draw(dataTable, options);
        }

        function renderBrandCompetitiveness() {
            // Top 3 Competitors
            const shareByBrand = {};
            marketData.forEach(d => {
                if(d.brand !== OUR_BRAND) {
                    shareByBrand[d.brand] = (shareByBrand[d.brand] || 0) + d.share;
                }
            });
            const topCompetitors = Object.entries(shareByBrand)
                .sort((a,b) => b[1] - a[1])
                .slice(0, 3)
                .map(e => e[0]);

            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Semana');
            dataTable.addColumn('number', OUR_BRAND);
            topCompetitors.forEach(c => dataTable.addColumn('number', c));

            const rows = WEEKS.map(w => {
                const weekData = marketData.filter(d => d.week === w);
                const row = [w];
                
                // Our Share
                row.push(weekData.filter(d => d.brand === OUR_BRAND).reduce((a,b) => a+b.share, 0));
                
                // Competitor Shares
                topCompetitors.forEach(c => {
                    row.push(weekData.filter(d => d.brand === c).reduce((a,b) => a+b.share, 0));
                });
                return row;
            });

            dataTable.addRows(rows);

            const options = {
                curveType: 'function',
                legend: { position: 'bottom' },
                chartArea: { width: '90%', height: '70%' },
                lineWidth: 3,
                colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853']
            };

            const chart = new google.visualization.LineChart(document.getElementById('chart_brand_comp'));
            chart.draw(dataTable, options);
        }

        function renderLevers() {
            // Price vs Share Correlation for Our ASIN
            const myData = marketData.filter(d => d.is_yaba === 'Y');
            
            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Semana');
            dataTable.addColumn('number', 'Precio');
            dataTable.addColumn('number', 'Click Share');
            // Tooltip to show deals
            dataTable.addColumn({type: 'string', role: 'tooltip'}); 

            const rows = myData.map(d => {
                const dealTxt = d.deals > 0 ? `DEAL ACTIVO (${d.deals} días)` : 'Sin Deal';
                return [d.week, d.price, d.share, `${d.week}\nPrecio: ${d.price}\nShare: ${d.share}%\n${dealTxt}`];
            });

            dataTable.addRows(rows);

            const options = {
                series: {
                    0: {targetAxisIndex: 0, color: '#34A853'},
                    1: {targetAxisIndex: 1, color: '#4285F4', type: 'bars'}
                },
                vAxes: {
                    0: {title: 'Precio ($)'},
                    1: {title: 'Click Share (%)'}
                },
                legend: { position: 'bottom' }
            };

            const chart = new google.visualization.ComboChart(document.getElementById('chart_levers_price'));
            chart.draw(dataTable, options);
        }

        function renderEfficiency() {
            // Scatter: Rank (X) vs Share (Y)
            const currData = marketData.filter(d => d.week === CURRENT_WEEK);
            
            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('number', 'Organic Rank (Invertido)');
            dataTable.addColumn('number', 'Click Share');
            dataTable.addColumn({type: 'string', role: 'style'}); // Color
            dataTable.addColumn({type: 'string', role: 'tooltip'});

            const rows = currData.map(d => {
                const color = d.is_yaba === 'Y' ? '#4285F4' : '#EA4335';
                const label = `${d.brand} (${d.asin})\nRank: ${d.rank}\nShare: ${d.share}%`;
                return [d.rank, d.share, `point { fill-color: ${color}; size: 10; }`, label];
            });

            dataTable.addRows(rows);

            const options = {
                hAxis: { title: 'Ranking Orgánico (Menor es mejor)', direction: -1 }, // Invert to show rank 1 on right or left logically
                vAxis: { title: 'Click Share %' },
                legend: 'none',
                chartArea: { width: '85%', height: '75%' }
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('chart_efficiency'));
            chart.draw(dataTable, options);
        }

        function renderInsights() {
            // Hardcoded Logic based on the Dummy Data Story
            const insightsHTML = `
                <div class="insight-item">
                    <span class="material-icons insight-icon">trending_up</span>
                    <div>
                        <strong>Impacto Crítico del DEAL:</strong> En la semana del 2023-10-15, la activación de Deals generó un pico histórico de <strong>22.5% de Click Share</strong>, demostrando una alta elasticidad al precio y promoción.
                    </div>
                </div>
                <div class="insight-item">
                    <span class="material-icons insight-icon">attach_money</span>
                    <div>
                        <strong>Sensibilidad al Precio:</strong> Cuando el precio bajó de $29.99 a $24.99, el share se duplicó casi respecto a la competencia. Al volver a subir, el share se retuvo parcialmente gracias a la mejora en Organic Rank.
                    </div>
                </div>
                <div class="insight-item">
                    <span class="material-icons insight-icon">warning</span>
                    <div>
                        <strong>Amenaza Competitiva:</strong> "Philips" (Comp C) mantiene un liderazgo sólido (~20% share) con precios mucho más altos ($79.99), sugiriendo una fidelidad de marca que no depende del precio.
                    </div>
                </div>
                <div class="insight-item">
                    <span class="material-icons insight-icon">star</span>
                    <div>
                        <strong>Eficiencia Orgánica:</strong> Nuestra marca está "Sobre-performando" en eficiencia. Con un rank promedio de 3.2, obtenemos más share que competidores con ranks similares, posiblemente por mejor imagen principal o precio.
                    </div>
                </div>
                <div class="insight-item">
                    <span class="material-icons insight-icon">visibility</span>
                    <div>
                        <strong>Badge de Amazon Choice:</strong> La recuperación del badge en la última semana correlaciona con la estabilización del share post-deal.
                    </div>
                </div>
            `;
            document.getElementById('insights-container').innerHTML = insightsHTML;

            const recsHTML = `
                <div class="insight-item">
                    <span class="material-icons" style="color:var(--secondary)">check_circle</span>
                    <div><strong>Calendario de Deals:</strong> Repetir la estrategia de Deal cada 4 semanas para mantener picos de visibilidad y rank, dado el éxito de la semana 3.</div>
                </div>
                <div class="insight-item">
                    <span class="material-icons" style="color:var(--secondary)">check_circle</span>
                    <div><strong>Defensa de Precio:</strong> No bajar de $27.99 en semanas sin deal. El volumen orgánico se mantiene estable en ese rango.</div>
                </div>
                <div class="insight-item">
                    <span class="material-icons" style="color:var(--secondary)">check_circle</span>
                    <div><strong>Contenido A+:</strong> Para atacar a Philips, mejorar el contenido visual enfocándose en "Calidad Premium" para justificar subir el precio gradualmente.</div>
                </div>
            `;
            document.getElementById('recommendations-container').innerHTML = recsHTML;
        }

        // ==========================================
        // 4. INTERACTIVE TAB LOGIC
        // ==========================================

        function populateInteractiveControls() {
            // Weeks
            const weekSel = document.getElementById('selector-week');
            WEEKS.forEach(w => {
                const opt = document.createElement('option');
                opt.value = w;
                opt.innerText = w;
                if(w === CURRENT_WEEK) opt.selected = true;
                weekSel.appendChild(opt);
            });

            // Competitors
            const compSel = document.getElementById('selector-competitor');
            const competitors = [...new Set(marketData.filter(d => d.is_yaba === 'N').map(d => d.brand))];
            competitors.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.innerText = c;
                compSel.appendChild(opt);
            });
        }

        function updateInteractive() {
            const week = document.getElementById('selector-week').value;
            const compBrand = document.getElementById('selector-competitor').value;

            const myData = marketData.find(d => d.week === week && d.brand === OUR_BRAND);
            const compData = marketData.find(d => d.week === week && d.brand === compBrand);

            if(!myData || !compData) return;

            // Cards
            document.getElementById('comp-my-price').innerText = '$' + myData.price;
            document.getElementById('comp-their-price').innerText = '$' + compData.price;
            
            const diff = (myData.share - compData.share).toFixed(1);
            document.getElementById('comp-share-diff').innerText = (diff > 0 ? '+' : '') + diff + '%';
            document.getElementById('comp-share-diff').style.color = diff > 0 ? 'var(--secondary)' : 'var(--danger)';

            // Table Comparison
            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Métrica');
            dataTable.addColumn('string', 'Nosotros (' + OUR_BRAND + ')');
            dataTable.addColumn('string', 'Competidor (' + compBrand + ')');
            dataTable.addColumn('string', 'Ganador');

            const metrics = [
                { id: 'share', label: 'Click Share', format: '%' },
                { id: 'rank', label: 'Organic Rank', format: '', invert: true },
                { id: 'price', label: 'Precio', format: '$', invert: true },
                { id: 'deals', label: 'Días Deal', format: '' },
                { id: 'bs', label: 'Best Seller', format: ' Days' }
            ];

            const rows = metrics.map(m => {
                const v1 = myData[m.id];
                const v2 = compData[m.id];
                let winner = '-';
                
                if (v1 !== v2) {
                    if (m.invert) winner = v1 < v2 ? OUR_BRAND : compBrand;
                    else winner = v1 > v2 ? OUR_BRAND : compBrand;
                }

                return [
                    m.label,
                    v1 + m.format,
                    v2 + m.format,
                    winner === OUR_BRAND ? '✅ Nosotros' : (winner === compBrand ? '❌ Ellos' : 'Empate')
                ];
            });

            dataTable.addRows(rows);

            const table = new google.visualization.Table(document.getElementById('table_interactive_div'));
            table.draw(dataTable, {showRowNumber: false, width: '100%', height: '100%', allowHtml: true});
        }

    </script>
</body>
</html>