<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matcha Premium - Strategic Market Analysis</title>
    
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Google Charts Loader -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
        :root {
            --google-blue: #4285F4;
            --google-red: #EA4335;
            --google-yellow: #FBBC05;
            --google-green: #34A853;
            --google-gray: #5f6368;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            color: #202124;
            -webkit-font-smoothing: antialiased;
        }

        /* Layout & Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: var(--card-bg);
            padding: 20px 0;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        h1 {
            font-size: 22px;
            font-weight: 400;
            color: var(--google-gray);
            margin: 0;
        }
        
        h1 span {
            color: #202124;
            font-weight: 500;
        }

        .badge {
            background-color: #e8f0fe;
            color: var(--google-blue);
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
        }

        /* Navigation / Tabs */
        .nav-tabs {
            display: flex;
            gap: 20px;
            border-bottom: 1px solid #dadce0;
            margin-bottom: 30px;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 12px 4px;
            font-family: 'Roboto', sans-serif;
            font-size: 14px;
            font-weight: 500;
            color: var(--google-gray);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .tab-btn.active {
            color: var(--google-blue);
            border-bottom-color: var(--google-blue);
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: 8px;
            border: 1px solid #dadce0;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 2px rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
        }

        .card h2 {
            font-size: 18px;
            font-weight: 400;
            margin-top: 0;
            margin-bottom: 20px;
            color: #202124;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card h2 .material-icons {
            font-size: 20px;
            color: var(--google-gray);
        }

        /* Grid System */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
        }

        /* Insights Section */
        .insight-box {
            border-left: 4px solid var(--google-blue);
            padding-left: 16px;
            margin-bottom: 16px;
        }
        
        .insight-title {
            font-weight: 700;
            font-size: 14px;
            color: #202124;
            margin-bottom: 4px;
        }

        .insight-text {
            font-size: 14px;
            color: var(--google-gray);
            line-height: 1.5;
        }

        .recommendation-list {
            list-style: none;
            padding: 0;
        }

        .recommendation-list li {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            font-size: 14px;
            line-height: 1.5;
        }

        .recommendation-list li .material-icons {
            color: var(--google-green);
            font-size: 20px;
        }

        /* Interactive Section */
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            background: #fff;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #dadce0;
        }

        select {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #dadce0;
            font-family: 'Roboto', sans-serif;
            font-size: 14px;
            color: #3c4043;
            outline: none;
        }

        .stat-big {
            font-size: 32px;
            font-weight: 400;
            color: #202124;
        }

        .stat-label {
            font-size: 12px;
            color: var(--google-gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .comparison-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .comparison-row:last-child {
            border-bottom: none;
        }

        .val-us { color: var(--google-blue); font-weight: 700; }
        .val-them { color: var(--google-red); font-weight: 700; }

        /* Chart Containers */
        .chart-box {
            width: 100%;
            min-height: 300px;
        }

        /* Utility */
        .hidden { display: none; }
        .text-center { text-align: center; }
        .mt-4 { margin-top: 16px; }

    </style>
</head>
<body>

    <header>
        <div class="header-content">
            <h1>Market Intelligence <span>Matcha Premium</span></h1>
            <span class="badge">CONFIDENTIAL</span>
        </div>
    </header>

    <div class="container">
        
        <!-- Tabs -->
        <div class="nav-tabs">
            <button class="tab-btn active" onclick="switchTab('static')">Strategic Analysis</button>
            <button class="tab-btn" onclick="switchTab('interactive')">Competitor Comparator</button>
        </div>

        <!-- TAB 1: STATIC REPORT -->
        <div id="tab-static">
            
            <!-- Section 1: Global Trend -->
            <div class="card">
                <h2><span class="material-icons">show_chart</span> 1. Global Parent Trend (Clicks & Share)</h2>
                <div id="chart_global_trend" class="chart-box"></div>
                <div class="grid-2 mt-4">
                    <div class="insight-box">
                        <div class="insight-title">Volume Dynamics</div>
                        <div class="insight-text">The market shows a contraction in search volume moving from Week 52 to Week 01 (Post-Holiday seasonality). Total clicks dropped by ~19%, impacting all players.</div>
                    </div>
                    <div class="insight-box">
                        <div class="insight-title">Share Stability</div>
                        <div class="insight-text">Despite the volume drop, <strong>NaturaleBio</strong> (Our Brand) maintained a stable Click Share (~26%), indicating high customer loyalty or effective ranking retention during low-traffic periods.</div>
                    </div>
                </div>
            </div>

            <!-- Section 2: Brand Competitiveness -->
            <div class="grid-2">
                <div class="card">
                    <h2><span class="material-icons">pie_chart</span> 2. Brand Competitiveness</h2>
                    <div id="chart_brand_share" class="chart-box"></div>
                </div>
                <div class="card">
                    <h2><span class="material-icons">flag</span> Top Competitors (Week 01)</h2>
                    <div id="table_competitors" class="chart-box"></div>
                </div>
            </div>

            <!-- Section 4: Efficiency -->
            <div class="card">
                <h2><span class="material-icons">gps_fixed</span> 4. Organic Efficiency (Rank vs. Share)</h2>
                <p style="font-size: 13px; color: #5f6368; margin-bottom: 10px;">Y-Axis: Click Share % (Higher is better) | X-Axis: Avg Organic Rank (Lower/Left is better)</p>
                <div id="chart_efficiency" class="chart-box" style="height: 400px;"></div>
            </div>

            <!-- Section 3 & 5: Insights & Recommendations -->
            <div class="grid-2">
                <div class="card">
                    <h2><span class="material-icons">lightbulb</span> 5. Key Insights</h2>
                    
                    <div class="insight-box">
                        <div class="insight-title">1. Market Contraction</div>
                        <div class="insight-text">Total category clicks fell from ~25k to ~20k. This is a seasonal correction. Future projections should account for lower traffic in January.</div>
                    </div>

                    <div class="insight-box">
                        <div class="insight-title">2. Primary Threat: NORITUAL LAB</div>
                        <div class="insight-text">NORITUAL LAB is the dominant competitor, capturing ~20% share. Their top ASIN (B0CNRX8G5S) is an efficiency outlier, gaining massive share despite ranking lower than some of our variants.</div>
                    </div>

                    <div class="insight-box">
                        <div class="insight-title">3. Portfolio Cannibalization?</div>
                        <div class="insight-text">Our brand (NaturaleBio) has multiple ASINs (4+) on the first page. While this dominates shelf space, the share is fragmented across variants compared to competitors focusing on 1-2 hero ASINs.</div>
                    </div>

                    <div class="insight-box">
                        <div class="insight-title">4. Price Resilience</div>
                        <div class="insight-text">Our prices remained stable (~24-30€ range) while maintaining share. No evidence of aggressive price wars from top competitors in the last week.</div>
                    </div>

                    <div class="insight-box" style="border-left-color: var(--google-red);">
                        <div class="insight-title">5. The "Ceremonial" Keyword Ambiguity</div>
                        <div class="insight-text">Several listings use "Ceremonial" heavily in titles. Competitors are optimizing specifically for this attribute, which drives high click-through rates.</div>
                    </div>
                </div>

                <div class="card">
                    <h2><span class="material-icons">assignment_turned_in</span> Actions & Recommendations</h2>
                    <ul class="recommendation-list">
                        <li>
                            <span class="material-icons">check_circle</span>
                            <div>
                                <strong>Consolidate Visual Identity</strong><br>
                                Considering the fragmentation, ensure the main hero ASIN (B06XQ5DCYJ) has distinctive main image elements to stand out against NORITUAL LAB's clean packaging.
                            </div>
                        </li>
                        <li>
                            <span class="material-icons">check_circle</span>
                            <div>
                                <strong>Defensive Couponing</strong><br>
                                Since volume is low, activate a 5% coupon on the 2nd best-performing ASIN to steal share from "Unknown/Generic" brands that are accumulating ~15% share combined.
                            </div>
                        </li>
                        <li>
                            <span class="material-icons">check_circle</span>
                            <div>
                                <strong>Keyword Defense: "Ceremonial"</strong><br>
                                Update backend search terms and A+ content to reinforce "Ceremonial Grade" messaging, directly countering NORITUAL LAB's positioning.
                            </div>
                        </li>
                    </ul>

                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                        <h3 style="font-size: 16px; margin-bottom: 10px;">Other Strategic Notes</h3>
                        <p style="font-size: 14px; color: #5f6368;">
                            Emerging threat from "Special Leaves" brand appearing in latest week with ~3.5% share. Monitor if they increase ad spend or drop price aggressively.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: INTERACTIVE COMPARATOR -->
        <div id="tab-interactive" class="hidden">
            <div class="controls">
                <div>
                    <label class="stat-label" style="display:block; margin-bottom:4px;">Select Week</label>
                    <select id="weekSelector" onchange="updateComparator()"></select>
                </div>
                <div>
                    <label class="stat-label" style="display:block; margin-bottom:4px;">Compare Against</label>
                    <select id="competitorSelector" onchange="updateComparator()"></select>
                </div>
            </div>

            <div class="grid-3">
                <div class="card text-center">
                    <div class="stat-label">Market Share Gap</div>
                    <div class="stat-big" id="comp_share_gap">--</div>
                    <div style="font-size: 12px; margin-top: 8px;">
                        Us: <span id="comp_share_us" class="val-us">--</span> vs Them: <span id="comp_share_them" class="val-them">--</span>
                    </div>
                </div>
                <div class="card text-center">
                    <div class="stat-label">Price Positioning</div>
                    <div class="stat-big" id="comp_price_gap">--</div>
                    <div style="font-size: 12px; margin-top: 8px;">
                        Us: <span id="comp_price_us" class="val-us">--</span> vs Them: <span id="comp_price_them" class="val-them">--</span>
                    </div>
                </div>
                <div class="card text-center">
                    <div class="stat-label">Avg Organic Rank</div>
                    <div class="stat-big" id="comp_rank_gap">--</div>
                    <div style="font-size: 12px; margin-top: 8px;">
                        Us: <span id="comp_rank_us" class="val-us">--</span> vs Them: <span id="comp_rank_them" class="val-them">--</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2><span class="material-icons">table_chart</span> Detailed Head-to-Head (ASIN Level)</h2>
                <div id="table_interactive"></div>
            </div>
        </div>

    </div>

    <!-- DATA INJECTION -->
    <script>
        // Data injected from Python processing
        const marketData = [
            {"week_date": "2025-52", "real_brand": "NORITUAL LAB", "is_yaba_asin": "N", "asin": "B0CNRX8G5S", "product_title": "Ceremonial Matcha - Reines Matcha Pulver aus Japan...", "price": 24.60, "click_share": 14.83, "average_organic_rank": 2.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "estimated_clicks": 5101.91, "weekly_search_volume": 34402.64},
            {"week_date": "2025-52", "real_brand": "Unknown Brand", "is_yaba_asin": "N", "asin": "B0G1T7N675", "product_title": "Ceremonial Matcha Pulver BIO-Qualität 50g ideal zu...", "price": 12.45, "click_share": 0.0, "average_organic_rank": 12.0, "weekly_number_of_days_with_deal": 3, "weekly_number_of_days_with_coupon": 0, "estimated_clicks": 0.0, "weekly_search_volume": 34402.64},
            {"week_date": "2025-52", "real_brand": "NORITUAL LAB", "is_yaba_asin": "N", "asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Grüntee-Pulver au...", "price": 16.01, "click_share": 5.94, "average_organic_rank": 7.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "estimated_clicks": 2043.52, "weekly_search_volume": 34402.64},
            {"week_date": "2025-52", "real_brand": "Special Leaves", "is_yaba_asin": "N", "asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Natürlich & Fein Gemahl...", "price": 10.69, "click_share": 4.12, "average_organic_rank": 14.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 7, "estimated_clicks": 1417.39, "weekly_search_volume": 34402.64},
            {"week_date": "2025-52", "real_brand": "NaturaleBio", "is_yaba_asin": "Y", "asin": "B07SZFD3P9", "product_title": "NaturaleBio Matcha Ceremonial Grade 100g. Original...", "price": 30.56, "click_share": 2.75, "average_organic_rank": 25.0, "weekly_number_of_days_with_deal": 1, "weekly_number_of_days_with_coupon": 0, "estimated_clicks": 946.07, "weekly_search_volume": 34402.64},
            {"week_date": "2025-52", "real_brand": "NaturaleBio", "is_yaba_asin": "Y", "asin": "B06XQ69YCQ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "price": 10.52, "click_share": 5.19, "average_organic_rank": 4.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "estimated_clicks": 1785.50, "weekly_search_volume": 34402.64},
            {"week_date": "2025-52", "real_brand": "NaturaleBio", "is_yaba_asin": "Y", "asin": "B079VQ52MK", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "price": 24.74, "click_share": 3.98, "average_organic_rank": 5.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "estimated_clicks": 1369.23, "weekly_search_volume": 34402.64},
            {"week_date": "2025-52", "real_brand": "NaturaleBio", "is_yaba_asin": "Y", "asin": "B06XQ5DCYJ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "price": 15.03, "click_share": 14.30, "average_organic_rank": 1.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "estimated_clicks": 4919.58, "weekly_search_volume": 34402.64},
            {"week_date": "2025-52", "real_brand": "VAHDAM", "is_yaba_asin": "N", "asin": "B07MD4LB49", "product_title": "VAHDAM, Matcha Grüntee Pulver (100g, 50+ Tassen) A...", "price": 9.73, "click_share": 5.40, "average_organic_rank": 6.0, "weekly_number_of_days_with_deal": 3, "weekly_number_of_days_with_coupon": 0, "estimated_clicks": 1857.74, "weekly_search_volume": 34402.64},
            {"week_date": "2025-52", "real_brand": "VAHDAM", "is_yaba_asin": "N", "asin": "B07K1WBH4K", "product_title": "VAHDAM, Vanille Matcha Grüner Tee Pulver (100g, 50...", "price": 9.73, "click_share": 3.49, "average_organic_rank": 12.0, "weekly_number_of_days_with_deal": 3, "weekly_number_of_days_with_coupon": 0, "estimated_clicks": 1200.65, "weekly_search_volume": 34402.64},
            {"week_date": "2026-01", "real_brand": "bioKontor", "is_yaba_asin": "N", "asin": "B08XVX8V1T", "product_title": "Bio Matcha Pulver 100 g – Japan Matcha Tee, 100% n...", "price": 12.00, "click_share": 3.08, "average_organic_rank": 9.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "estimated_clicks": 856.13, "weekly_search_volume": 27796.53},
            {"week_date": "2026-01", "real_brand": "NORITUAL LAB", "is_yaba_asin": "N", "asin": "B0CNRX8G5S", "product_title": "Ceremonial Matcha - Reines Matcha Pulver aus Japan...", "price": 23.91, "click_share": 14.01, "average_organic_rank": 2.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "estimated_clicks": 3894.29, "weekly_search_volume": 27796.53},
            {"week_date": "2026-01", "real_brand": "NORITUAL LAB", "is_yaba_asin": "N", "asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Grüntee-Pulver au...", "price": 15.56, "click_share": 6.01, "average_organic_rank": 7.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "estimated_clicks": 1670.57, "weekly_search_volume": 27796.53},
            {"week_date": "2026-01", "real_brand": "Special Leaves", "is_yaba_asin": "N", "asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Natürlich & Fein Gemahl...", "price": 10.39, "click_share": 3.51, "average_organic_rank": 15.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 4, "estimated_clicks": 975.66, "weekly_search_volume": 27796.53},
            {"week_date": "2026-01", "real_brand": "NaturaleBio", "is_yaba_asin": "Y", "asin": "B07SZFD3P9", "product_title": "NaturaleBio Matcha Ceremonial Grade 100g. Original...", "price": 30.27, "click_share": 2.69, "average_organic_rank": 25.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "estimated_clicks": 747.73, "weekly_search_volume": 27796.53},
            {"week_date": "2026-01", "real_brand": "NaturaleBio", "is_yaba_asin": "Y", "asin": "B06XQ5DCYJ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "price": 14.61, "click_share": 14.75, "average_organic_rank": 1.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "estimated_clicks": 4099.99, "weekly_search_volume": 27796.53},
            {"week_date": "2026-01", "real_brand": "NaturaleBio", "is_yaba_asin": "Y", "asin": "B079VQ52MK", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "price": 24.53, "click_share": 3.50, "average_organic_rank": 5.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "estimated_clicks": 972.88, "weekly_search_volume": 27796.53},
            {"week_date": "2026-01", "real_brand": "NaturaleBio", "is_yaba_asin": "Y", "asin": "B06XQ69YCQ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "price": 10.22, "click_share": 4.96, "average_organic_rank": 4.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "estimated_clicks": 1378.71, "weekly_search_volume": 27796.53},
            {"week_date": "2026-01", "real_brand": "VAHDAM", "is_yaba_asin": "N", "asin": "B07MD4LB49", "product_title": "VAHDAM, Matcha Grüntee Pulver (100g, 50+ Tassen) A...", "price": 10.43, "click_share": 3.79, "average_organic_rank": 8.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "estimated_clicks": 1053.49, "weekly_search_volume": 27796.53},
            {"week_date": "2026-01", "real_brand": "VAHDAM", "is_yaba_asin": "N", "asin": "B07K1WBH4K", "product_title": "VAHDAM, Vanille Matcha Grüner Tee Pulver (100g, 50...", "price": 10.43, "click_share": 2.74, "average_organic_rank": 12.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "estimated_clicks": 761.62, "weekly_search_volume": 27796.53}
        ];

        const OUR_BRAND_NAME = "NaturaleBio";

        // Initialize Google Charts
        google.charts.load('current', {'packages':['corechart', 'table']});
        google.charts.setOnLoadCallback(initDashboard);

        function initDashboard() {
            drawGlobalTrend();
            drawBrandShare();
            drawEfficiency();
            drawCompetitorTable();
            populateSelectors();
        }

        // --- CHART 1: GLOBAL TREND (COMBO) ---
        function drawGlobalTrend() {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Week');
            data.addColumn('number', 'Our Clicks');
            data.addColumn('number', 'Competitor Clicks');
            data.addColumn('number', 'Our Share %');

            // Aggregate data by week
            const weeks = [...new Set(marketData.map(d => d.week_date))].sort();
            const rows = weeks.map(week => {
                const weekData = marketData.filter(d => d.week_date === week);
                const ourClicks = weekData.filter(d => d.is_yaba_asin === 'Y')
                                          .reduce((acc, curr) => acc + curr.estimated_clicks, 0);
                const compClicks = weekData.filter(d => d.is_yaba_asin === 'N')
                                           .reduce((acc, curr) => acc + curr.estimated_clicks, 0);
                
                // Calculate total click share for 'Y' ASINs
                const totalShare = weekData.reduce((acc, curr) => acc + curr.click_share, 0);
                const ourShare = weekData.filter(d => d.is_yaba_asin === 'Y')
                                         .reduce((acc, curr) => acc + curr.click_share, 0);
                
                // Note: Simple Sum of Share is an approximation.
                return [week, Math.round(ourClicks), Math.round(compClicks), ourShare];
            });

            data.addRows(rows);

            const options = {
                title: 'Market Volume vs Our Share',
                seriesType: 'bars',
                series: {2: {type: 'line', targetAxisIndex: 1}},
                colors: ['#4285F4', '#dadce0', '#FBBC05'],
                vAxes: {
                    0: {title: 'Estimated Clicks'},
                    1: {title: 'Click Share %', format: '#\'%\''}
                },
                height: 350,
                legend: {position: 'bottom'},
                chartArea: {width: '80%', height: '70%'}
            };

            const chart = new google.visualization.ComboChart(document.getElementById('chart_global_trend'));
            chart.draw(data, options);
        }

        // --- CHART 2: BRAND SHARE (LINE) ---
        function drawBrandShare() {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Week');
            
            // Identify Top Brands (Us + Top 3)
            const brandTotals = {};
            marketData.forEach(d => {
                if(!brandTotals[d.real_brand]) brandTotals[d.real_brand] = 0;
                brandTotals[d.real_brand] += d.click_share;
            });
            
            // Sort brands by total share
            const sortedBrands = Object.keys(brandTotals).sort((a,b) => brandTotals[b] - brandTotals[a]);
            const topBrands = sortedBrands.slice(0, 4); // Top 4 brands
            
            topBrands.forEach(brand => data.addColumn('number', brand));

            const weeks = [...new Set(marketData.map(d => d.week_date))].sort();
            
            weeks.forEach(week => {
                const row = [week];
                topBrands.forEach(brand => {
                    const share = marketData.filter(d => d.week_date === week && d.real_brand === brand)
                                            .reduce((acc, c) => acc + c.click_share, 0);
                    row.push(share);
                });
                data.addRow(row);
            });

            const options = {
                title: 'Click Share Evolution (Top Brands)',
                curveType: 'function',
                height: 300,
                legend: {position: 'bottom'},
                chartArea: {width: '85%', height: '70%'},
                pointSize: 5
            };

            const chart = new google.visualization.LineChart(document.getElementById('chart_brand_share'));
            chart.draw(data, options);
        }

        // --- CHART 3: EFFICIENCY (SCATTER) ---
        function drawEfficiency() {
            const data = new google.visualization.DataTable();
            data.addColumn('number', 'Avg Organic Rank');
            data.addColumn('number', 'Click Share %');
            data.addColumn({type: 'string', role: 'tooltip', p: {html: true}});
            data.addColumn({type: 'string', role: 'style'});

            // Use latest week only
            const weeks = [...new Set(marketData.map(d => d.week_date))].sort();
            const latestWeek = weeks[weeks.length - 1];
            const currentData = marketData.filter(d => d.week_date === latestWeek);

            currentData.forEach(d => {
                const color = d.is_yaba_asin === 'Y' ? '#4285F4' : '#EA4335';
                const shape = d.is_yaba_asin === 'Y' ? 'circle' : 'triangle';
                const tooltip = `<div style="padding:10px;"><strong>${d.real_brand}</strong><br>ASIN: ${d.asin}<br>Rank: ${d.average_organic_rank}<br>Share: ${d.click_share}%</div>`;
                data.addRow([d.average_organic_rank, d.click_share, tooltip, `point {fill-color: ${color}; shape-type: ${shape}; size: 10;}`]);
            });

            const options = {
                title: 'Organic Rank vs Click Share Efficiency (Latest Week)',
                hAxis: {title: 'Average Organic Rank (Inverted)', direction: -1}, // Invert so rank 1 is right (or keep left as standard) -> Let's keep 1 on left (standard scatter)
                vAxis: {title: 'Click Share %'},
                legend: 'none',
                height: 400,
                tooltip: {isHtml: true}
            };

            // Customizing hAxis to make Rank 1 appear on the LEFT (standard) or RIGHT? 
            // Better: Rank 1 is "good", usually top-right in quadrant analysis, but standard charts go 0->100.
            // Let's stick to standard: Rank 1 is left. High share is up. Top-Left is "Best".
            options.hAxis.direction = 1; 

            const chart = new google.visualization.ScatterChart(document.getElementById('chart_efficiency'));
            chart.draw(data, options);
        }

        // --- CHART 4: SIMPLE TABLE FOR TOP COMPETITORS ---
        function drawCompetitorTable() {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Brand');
            data.addColumn('number', 'Total Click Share %');
            data.addColumn('number', 'Avg Price (€)');

            const weeks = [...new Set(marketData.map(d => d.week_date))].sort();
            const latestWeek = weeks[weeks.length - 1];
            
            // Aggregate by brand for latest week
            const brandStats = {};
            marketData.filter(d => d.week_date === latestWeek && d.real_brand !== OUR_BRAND_NAME).forEach(d => {
                if(!brandStats[d.real_brand]) brandStats[d.real_brand] = {share: 0, priceSum: 0, count: 0};
                brandStats[d.real_brand].share += d.click_share;
                brandStats[d.real_brand].priceSum += d.price;
                brandStats[d.real_brand].count += 1;
            });

            const rows = Object.keys(brandStats).map(b => [
                b, 
                parseFloat(brandStats[b].share.toFixed(2)),
                parseFloat((brandStats[b].priceSum / brandStats[b].count).toFixed(2))
            ]).sort((a,b) => b[1] - a[1]).slice(0, 5); // Top 5

            data.addRows(rows);

            const table = new google.visualization.Table(document.getElementById('table_competitors'));
            table.draw(data, {showRowNumber: true, width: '100%', height: '100%'});
        }

        // --- TAB LOGIC ---
        function switchTab(tabId) {
            document.getElementById('tab-static').classList.add('hidden');
            document.getElementById('tab-interactive').classList.add('hidden');
            document.getElementById('tab-' + tabId).classList.remove('hidden');

            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // --- INTERACTIVE COMPARATOR LOGIC ---
        function populateSelectors() {
            const weeks = [...new Set(marketData.map(d => d.week_date))].sort().reverse();
            const weekSel = document.getElementById('weekSelector');
            weeks.forEach(w => {
                const opt = document.createElement('option');
                opt.value = w;
                opt.text = w;
                weekSel.appendChild(opt);
            });

            // Get competitors
            const competitors = [...new Set(marketData.filter(d => d.is_yaba_asin === 'N').map(d => d.real_brand))].sort();
            const compSel = document.getElementById('competitorSelector');
            competitors.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.text = c;
                compSel.appendChild(opt);
            });
            
            // Set default if exists
            if (competitors.includes("NORITUAL LAB")) compSel.value = "NORITUAL LAB";

            updateComparator();
        }

        function updateComparator() {
            const week = document.getElementById('weekSelector').value;
            const competitor = document.getElementById('competitorSelector').value;

            // Filter Data
            const ourData = marketData.filter(d => d.week_date === week && d.is_yaba_asin === 'Y');
            const compData = marketData.filter(d => d.week_date === week && d.real_brand === competitor);

            // Metrics
            const ourShare = ourData.reduce((a,b) => a + b.click_share, 0);
            const compShare = compData.reduce((a,b) => a + b.click_share, 0);
            
            const ourPrice = ourData.length ? ourData.reduce((a,b) => a + b.price, 0) / ourData.length : 0;
            const compPrice = compData.length ? compData.reduce((a,b) => a + b.price, 0) / compData.length : 0;

            const ourRank = ourData.length ? ourData.reduce((a,b) => a + b.average_organic_rank, 0) / ourData.length : 0;
            const compRank = compData.length ? compData.reduce((a,b) => a + b.average_organic_rank, 0) / compData.length : 0;

            // DOM Updates
            document.getElementById('comp_share_us').innerText = ourShare.toFixed(1) + '%';
            document.getElementById('comp_share_them').innerText = compShare.toFixed(1) + '%';
            document.getElementById('comp_share_gap').innerText = (ourShare - compShare).toFixed(1) + '%';
            document.getElementById('comp_share_gap').style.color = (ourShare > compShare) ? '#34A853' : '#EA4335';

            document.getElementById('comp_price_us').innerText = ourPrice.toFixed(2) + '€';
            document.getElementById('comp_price_them').innerText = compPrice.toFixed(2) + '€';
            const priceDiff = ourPrice - compPrice;
            document.getElementById('comp_price_gap').innerText = (priceDiff > 0 ? '+' : '') + priceDiff.toFixed(2) + '€';

            document.getElementById('comp_rank_us').innerText = '#' + ourRank.toFixed(1);
            document.getElementById('comp_rank_them').innerText = '#' + compRank.toFixed(1);

            // Detailed Table
            drawDetailedTable(ourData, compData);
        }

        function drawDetailedTable(ourList, compList) {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Brand');
            data.addColumn('string', 'ASIN');
            data.addColumn('string', 'Title');
            data.addColumn('number', 'Price');
            data.addColumn('number', 'Share %');
            data.addColumn('number', 'Rank');

            const all = [...ourList, ...compList];
            all.forEach(d => {
                data.addRow([
                    d.real_brand, 
                    d.asin, 
                    d.product_title.substring(0, 30) + '...', 
                    d.price, 
                    d.click_share, 
                    d.average_organic_rank
                ]);
            });

            const table = new google.visualization.Table(document.getElementById('table_interactive'));
            table.draw(data, {allowHtml: true, showRowNumber: false, width: '100%'});
        }

    </script>
</body>
</html>