<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Inteligencia de Mercado: Matcha Premium</title>
    
    <!-- Google Charts Loader -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #4285F4; /* Google Blue */
            --success: #34A853; /* Google Green */
            --warning: #FBBC05; /* Google Yellow */
            --danger: #EA4335;  /* Google Red */
            --gray-100: #f8f9fa;
            --gray-200: #e8eaed;
            --gray-600: #5f6368;
            --gray-800: #202124;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 16px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            color: var(--gray-800);
            margin: 0;
            padding: 20px;
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header */
        header {
            background: white;
            padding: 24px;
            border-radius: var(--radius);
            box-shadow: var(--card-shadow);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; font-size: 24px; font-weight: 700; color: var(--gray-800); }
        .subtitle { color: var(--gray-600); font-size: 14px; margin-top: 4px; }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: white;
            border: none;
            border-radius: 24px;
            font-weight: 600;
            color: var(--gray-600);
            cursor: pointer;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--card-shadow);
        }

        .kpi-label { font-size: 12px; color: var(--gray-600); text-transform: uppercase; letter-spacing: 0.5px; }
        .kpi-value { font-size: 28px; font-weight: 700; margin: 8px 0; color: var(--gray-800); }
        .kpi-trend { font-size: 13px; font-weight: 500; display: flex; align-items: center; gap: 4px; }
        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }

        /* Charts Section */
        .chart-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }
        
        @media(min-width: 768px) {
            .chart-row.split { grid-template-columns: 1fr 1fr; }
        }

        .chart-container {
            height: 400px;
            width: 100%;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Insights Section */
        .insights-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .insight-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .insight-item {
            margin-bottom: 16px;
            padding-left: 16px;
            border-left: 4px solid var(--primary);
        }

        .insight-title { font-weight: 700; color: var(--gray-800); display: block; margin-bottom: 4px; }
        .insight-text { color: var(--gray-600); font-size: 14px; }

        /* Interactive Controls */
        .controls {
            background: white;
            padding: 16px;
            border-radius: var(--radius);
            margin-bottom: 16px;
            display: flex;
            gap: 16px;
            align-items: center;
        }

        select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
        }

        /* Utility */
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        .bg-blue { background-color: #e8f0fe; color: var(--primary); }
        .bg-green { background-color: #e6f4ea; color: var(--success); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1>An√°lisis de Mercado: Matcha Premium</h1>
            <div class="subtitle">Reporte Semanal ‚Ä¢ √öltima Actualizaci√≥n: Semana 01, 2026</div>
        </div>
        <div class="badge bg-blue">ASIN Parent: B0MATCHAPREM</div>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('static')">
            <span class="material-icons">dashboard</span> Dashboard Ejecutivo
        </button>
        <button class="tab-btn" onclick="switchTab('interactive')">
            <span class="material-icons">compare_arrows</span> Comparador Interactivo
        </button>
    </div>

    <!-- TAB 1: STATIC REPORT -->
    <div id="static" class="tab-content active">
        
        <!-- KPI Row -->
        <div class="kpi-grid">
            <div class="card">
                <div class="kpi-label">Cuota de Mercado Total (NaturaleBio)</div>
                <div class="kpi-value" id="kpi-share">22.6%</div>
                <div class="kpi-trend trend-up"><span class="material-icons" style="font-size:16px;">trending_up</span> +0.8% vs semana ant.</div>
            </div>
            <div class="card">
                <div class="kpi-label">Clicks Totales (Mercado)</div>
                <div class="kpi-value" id="kpi-clicks">19,498</div>
                <div class="kpi-trend trend-down"><span class="material-icons" style="font-size:16px;">trending_down</span> -57% (Post-Holiday)</div>
            </div>
            <div class="card">
                <div class="kpi-label">Top Competidor Share (NORITUAL LAB)</div>
                <div class="kpi-value">19.3%</div>
                <div class="kpi-trend trend-up">L√≠der en Rankings</div>
            </div>
            <div class="card">
                <div class="kpi-label">Eficiencia (Rank Promedio)</div>
                <div class="kpi-value">3.2</div>
                <div class="kpi-trend">Stable Top 5</div>
            </div>
        </div>

        <!-- Section 1: Global Trend -->
        <div class="card" style="margin-bottom: 24px;">
            <div class="section-title">
                <span class="material-icons text-blue-500">show_chart</span>
                Tendencia Global: Volumen vs Participaci√≥n (√öltimas 4 Semanas)
            </div>
            <div id="trend_chart" class="chart-container"></div>
        </div>

        <!-- Section 2: Brand Competitiveness -->
        <div class="card" style="margin-bottom: 24px;">
            <div class="section-title">
                <span class="material-icons text-green-500">pie_chart</span>
                Guerra de Marcas: Evoluci√≥n de Click Share (Top 3 vs Nosotros)
            </div>
            <div id="brand_chart" class="chart-container"></div>
        </div>

        <!-- Section 4: Efficiency Matrix -->
        <div class="chart-row split">
            <div class="card">
                <div class="section-title">
                    <span class="material-icons text-orange-500">scatter_plot</span>
                    Matriz de Eficiencia: Rank Org√°nico vs Click Share
                </div>
                <div id="efficiency_chart" class="chart-container"></div>
            </div>
            
            <div class="card">
                <div class="section-title">
                    <span class="material-icons text-purple-500">lightbulb</span>
                    Conclusiones y Recomendaciones
                </div>
                <div class="insight-list">
                    <div class="insight-item">
                        <span class="insight-title">Dominio de NORITUAL LAB por Cupones</span>
                        <span class="insight-text">A pesar de un precio 60% mayor (23.91‚Ç¨ vs 14.60‚Ç¨), el competidor lidera con 19.3% de share gracias al uso agresivo de cupones (4 d√≠as/semana) y Rank #2 constante.</span>
                    </div>
                    <div class="insight-item">
                        <span class="insight-title">Resiliencia ante Ca√≠da de Mercado</span>
                        <span class="insight-text">El volumen de b√∫squeda cay√≥ >50% en Enero (efecto post-navidad), pero NaturaleBio aument√≥ ligeramente su share (21.8% -> 22.6%), mostrando una base de clientes fiel.</span>
                    </div>
                    <div class="insight-item">
                        <span class="insight-title">Oportunidad de Precio/Promoci√≥n</span>
                        <span class="insight-text">Nuestro ASIN principal es mucho m√°s barato que el l√≠der. Existe margen para subir precio o, mejor, activar un cup√≥n visual para igualar el CTR sin sacrificar margen neto actual.</span>
                    </div>
                </div>
                <hr style="border: 0; border-top: 1px solid #eee; margin: 16px 0;">
                <div style="font-weight: 600; margin-bottom: 8px; color: var(--primary);">Recomendaciones Accionables:</div>
                <ul style="padding-left: 20px; font-size: 14px; color: var(--gray-800);">
                    <li>üöÄ <strong>Activar Cup√≥n en B06XQ5DCYJ:</strong> Replicar la estrategia de NORITUAL LAB para convertir las impresiones de Rank 2 en clicks.</li>
                    <li>üõ°Ô∏è <strong>Defensa de Share:</strong> Mantener presupuesto PPC en variantes principales ante la contracci√≥n de demanda org√°nica.</li>
                    <li>üñºÔ∏è <strong>Revisi√≥n de Listing:</strong> El Rank es id√©ntico al competidor pero el Share es menor (12.9% vs 19.3%). Auditar imagen principal para mejorar CTR.</li>
                </ul>
            </div>
        </div>

    </div>

    <!-- TAB 2: INTERACTIVE -->
    <div id="interactive" class="tab-content">
        <div class="controls">
            <div>
                <label style="font-size: 12px; color: var(--gray-600); display:block;">Semana</label>
                <select id="weekSelector" onchange="drawInteractiveCharts()"></select>
            </div>
            <div>
                <label style="font-size: 12px; color: var(--gray-600); display:block;">Competidor a Comparar</label>
                <select id="compSelector" onchange="drawInteractiveCharts()"></select>
            </div>
        </div>

        <div class="chart-row split">
            <div class="card">
                <div class="section-title">Comparativa de Precios</div>
                <div id="price_comp_chart" class="chart-container"></div>
            </div>
            <div class="card">
                <div class="section-title">Comparativa de Share</div>
                <div id="share_comp_chart" class="chart-container"></div>
            </div>
        </div>
    </div>

</div>

<script>
    // 1. DATA INJECTION
    const marketData = [{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha","competitor_brand":"NORITUAL LAB","asin":"B0CNRX8G5S","product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","country_code":"de","average_organic_rank":2.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":7.0,"weekly_number_of_days_with_coupon":0.0,"click_share":18.77,"impression_share":3.35,"price":24.648571429,"click_share_rank":1,"weekly_search_volume":47708.06,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"NORITUAL LAB","estimated_clicks":8954.802862,"has_deal":false,"has_coupon":false,"has_choice":true},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B06XQ5DCYJ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":2.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":11.66,"impression_share":3.37,"price":15.058571429,"click_share_rank":2,"weekly_search_volume":47708.06,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"NaturaleBio","estimated_clicks":5562.759796,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B06XQ69YCQ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":4.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":3.75,"impression_share":3.25,"price":10.538571429,"click_share_rank":5,"weekly_search_volume":47708.06,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"NaturaleBio","estimated_clicks":1789.05225,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B079VQ52MK","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":5.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":3.49,"impression_share":3.36,"price":24.855714286,"click_share_rank":6,"weekly_search_volume":47708.06,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"NaturaleBio","estimated_clicks":1665.011294,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha","competitor_brand":null,"asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr√ºntee-Pulver au...","country_code":"de","average_organic_rank":6.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":8.42,"impression_share":4.24,"price":16.037142857,"click_share_rank":3,"weekly_search_volume":47708.06,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"Ceremonial","estimated_clicks":4017.018652,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha","competitor_brand":"NORITUAL LAB","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr√ºntee-Pulver au...","country_code":"de","average_organic_rank":6.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":8.42,"impression_share":4.24,"price":16.037142857,"click_share_rank":3,"weekly_search_volume":47708.06,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"NORITUAL LAB","estimated_clicks":4017.018652,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha","competitor_brand":"VAHDAM","asin":"B07MD4LB49","product_title":"VAHDAM, Matcha Gr√ºntee Pulver (100g, 50+ Tassen) A...","country_code":"de","average_organic_rank":7.0,"weekly_number_of_days_with_deal":3.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":4.19,"impression_share":5.29,"price":9.895714286,"click_share_rank":4,"weekly_search_volume":47708.06,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"VAHDAM","estimated_clicks":1998.967714,"has_deal":true,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha","competitor_brand":null,"asin":"B08XVX8V1T","product_title":"Bio Matcha Pulver 100 g ‚Äì Japan Matcha Tee, 100% n...","country_code":"de","average_organic_rank":10.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":2.44,"impression_share":3.4,"price":12.367142857,"click_share_rank":9,"weekly_search_volume":47708.06,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"Bio","estimated_clicks":1164.076664,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha","competitor_brand":"bioKontor","asin":"B08XVX8V1T","product_title":"Bio Matcha Pulver 100 g ‚Äì Japan Matcha Tee, 100% n...","country_code":"de","average_organic_rank":10.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":2.44,"impression_share":3.4,"price":12.367142857,"click_share_rank":9,"weekly_search_volume":47708.06,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"bioKontor","estimated_clicks":1164.076664,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha","competitor_brand":"Special Leaves","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat√ºrlich & Fein Gemahl...","country_code":"de","average_organic_rank":13.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":7.0,"click_share":3.4,"impression_share":4.7,"price":10.71,"click_share_rank":7,"weekly_search_volume":47708.06,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"Special Leaves","estimated_clicks":1622.07404,"has_deal":false,"has_coupon":true,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha","competitor_brand":null,"asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat√ºrlich & Fein Gemahl...","country_code":"de","average_organic_rank":13.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":7.0,"click_share":3.4,"impression_share":4.7,"price":10.71,"click_share_rank":7,"weekly_search_volume":47708.06,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"Matcha","estimated_clicks":1622.07404,"has_deal":false,"has_coupon":true,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha","competitor_brand":"VAHDAM","asin":"B07K1WBH4K","product_title":"VAHDAM, Vanille Matcha Gr√ºner Tee Pulver (100g, 50...","country_code":"de","average_organic_rank":20.0,"weekly_number_of_days_with_deal":3.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":1.47,"impression_share":2.29,"price":9.895714286,"click_share_rank":10,"weekly_search_volume":47708.06,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"VAHDAM","estimated_clicks":701.308482,"has_deal":true,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-27","week_date":"2025-52","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B07SZFD3P9","product_title":"NaturaleBio Matcha Ceremonial Grade 100g. Original...","country_code":"de","average_organic_rank":23.0,"weekly_number_of_days_with_deal":1.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":2.93,"impression_share":2.43,"price":30.704285714,"click_share_rank":8,"weekly_search_volume":47708.06,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"NaturaleBio","estimated_clicks":1397.846158,"has_deal":true,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B07SZFD3P9","product_title":"NaturaleBio Matcha Ceremonial Grade 100g. Original...","country_code":"de","average_organic_rank":null,"weekly_number_of_days_with_deal":null,"weekly_number_of_days_with_best_seller_badge":null,"weekly_number_of_days_with_amazon_choice_badge":null,"weekly_number_of_days_with_coupon":null,"click_share":2.68,"impression_share":2.06,"price":30.27,"click_share_rank":8,"weekly_search_volume":27011.1,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"NaturaleBio","estimated_clicks":723.89748,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha","competitor_brand":"NORITUAL LAB","asin":"B0CNRX8G5S","product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","country_code":"de","average_organic_rank":2.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":4.0,"weekly_number_of_days_with_coupon":0.0,"click_share":19.34,"impression_share":3.36,"price":23.91,"click_share_rank":1,"weekly_search_volume":27011.1,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"NORITUAL LAB","estimated_clicks":5223.94674,"has_deal":false,"has_coupon":false,"has_choice":true},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B06XQ5DCYJ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":2.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":12.9,"impression_share":3.37,"price":14.6075,"click_share_rank":2,"weekly_search_volume":27011.1,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"NaturaleBio","estimated_clicks":3484.4319,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B06XQ69YCQ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":5.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":3.35,"impression_share":3.02,"price":10.2225,"click_share_rank":5,"weekly_search_volume":27011.1,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"NaturaleBio","estimated_clicks":904.87185,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B079VQ52MK","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":5.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":3.66,"impression_share":3.36,"price":24.5275,"click_share_rank":4,"weekly_search_volume":27011.1,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"NaturaleBio","estimated_clicks":988.60626,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha","competitor_brand":"NORITUAL LAB","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr√ºntee-Pulver au...","country_code":"de","average_organic_rank":6.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":7.38,"impression_share":4.54,"price":15.5575,"click_share_rank":3,"weekly_search_volume":27011.1,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"NORITUAL LAB","estimated_clicks":1993.41918,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha","competitor_brand":null,"asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr√ºntee-Pulver au...","country_code":"de","average_organic_rank":6.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":7.38,"impression_share":4.54,"price":15.5575,"click_share_rank":3,"weekly_search_volume":27011.1,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"Ceremonial","estimated_clicks":1993.41918,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha","competitor_brand":"VAHDAM","asin":"B07MD4LB49","product_title":"VAHDAM, Matcha Gr√ºntee Pulver (100g, 50+ Tassen) A...","country_code":"de","average_organic_rank":9.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":3.15,"impression_share":5.19,"price":10.43,"click_share_rank":6,"weekly_search_volume":27011.1,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"VAHDAM","estimated_clicks":850.84965,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha","competitor_brand":null,"asin":"B08XVX8V1T","product_title":"Bio Matcha Pulver 100 g ‚Äì Japan Matcha Tee, 100% n...","country_code":"de","average_organic_rank":10.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":2.39,"impression_share":3.91,"price":11.9975,"click_share_rank":9,"weekly_search_volume":27011.1,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"Bio","estimated_clicks":645.56529,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha","competitor_brand":"bioKontor","asin":"B08XVX8V1T","product_title":"Bio Matcha Pulver 100 g ‚Äì Japan Matcha Tee, 100% n...","country_code":"de","average_organic_rank":10.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":2.39,"impression_share":3.91,"price":11.9975,"click_share_rank":9,"weekly_search_volume":27011.1,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"bioKontor","estimated_clicks":645.56529,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha","competitor_brand":null,"asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat√ºrlich & Fein Gemahl...","country_code":"de","average_organic_rank":16.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":4.0,"click_share":3.0,"impression_share":4.47,"price":10.39,"click_share_rank":7,"weekly_search_volume":27011.1,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"Matcha","estimated_clicks":810.333,"has_deal":false,"has_coupon":true,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha","competitor_brand":"Special Leaves","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat√ºrlich & Fein Gemahl...","country_code":"de","average_organic_rank":16.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":4.0,"click_share":3.0,"impression_share":4.47,"price":10.39,"click_share_rank":7,"weekly_search_volume":27011.1,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"Special Leaves","estimated_clicks":810.333,"has_deal":false,"has_coupon":true,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2026-01-03","week_date":"2026-01","keywords":"matcha","competitor_brand":null,"asin":"B0F9B1LWQQ","product_title":"UNREAL¬Æ 100g Ceremonial Bio Matcha ‚Äì 100% Japanisc...","country_code":"de","average_organic_rank":19.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":1.57,"impression_share":1.96,"price":31.2725,"click_share_rank":10,"weekly_search_volume":27011.1,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"UNREAL¬Æ","estimated_clicks":424.07427,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha","competitor_brand":"NORITUAL LAB","asin":"B0CNRX8G5S","product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","country_code":"de","average_organic_rank":2.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":7.0,"weekly_number_of_days_with_coupon":0.0,"click_share":16.66,"impression_share":3.14,"price":24.03,"click_share_rank":1,"weekly_search_volume":60855.1,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"NORITUAL LAB","estimated_clicks":10138.45966,"has_deal":false,"has_coupon":false,"has_choice":true},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B06XQ5DCYJ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":2.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":11.18,"impression_share":3.15,"price":14.084285714,"click_share_rank":2,"weekly_search_volume":60855.1,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"NaturaleBio","estimated_clicks":6803.60018,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B06XQ69YCQ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":5.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":3.85,"impression_share":3.15,"price":9.2,"click_share_rank":4,"weekly_search_volume":60855.1,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"NaturaleBio","estimated_clicks":2342.92135,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B079VQ52MK","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","country_code":"de","average_organic_rank":5.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":3.69,"impression_share":3.13,"price":23.075714286,"click_share_rank":5,"weekly_search_volume":60855.1,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"NaturaleBio","estimated_clicks":2245.55319,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha","competitor_brand":null,"asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr√ºntee-Pulver au...","country_code":"de","average_organic_rank":5.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":8.85,"impression_share":4.22,"price":15.635714286,"click_share_rank":3,"weekly_search_volume":60855.1,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"Ceremonial","estimated_clicks":5385.67635,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha","competitor_brand":"NORITUAL LAB","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr√ºntee-Pulver au...","country_code":"de","average_organic_rank":5.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":8.85,"impression_share":4.22,"price":15.635714286,"click_share_rank":3,"weekly_search_volume":60855.1,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"NORITUAL LAB","estimated_clicks":5385.67635,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha","competitor_brand":"VAHDAM","asin":"B07MD4LB49","product_title":"VAHDAM, Matcha Gr√ºntee Pulver (100g, 50+ Tassen) A...","country_code":"de","average_organic_rank":8.0,"weekly_number_of_days_with_deal":5.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":3.49,"impression_share":4.25,"price":9.005714286,"click_share_rank":6,"weekly_search_volume":60855.1,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"VAHDAM","estimated_clicks":2123.84299,"has_deal":true,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha","competitor_brand":null,"asin":"B0G1T7N675","product_title":"Ceremonial Matcha Pulver BIO-Qualit√§t 50g ideal zu...","country_code":"de","average_organic_rank":12.0,"weekly_number_of_days_with_deal":7.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":2.56,"impression_share":3.71,"price":8.898571429,"click_share_rank":9,"weekly_search_volume":60855.1,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"Ceremonial","estimated_clicks":1557.89056,"has_deal":true,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha","competitor_brand":null,"asin":"B0F5BVFRC1","product_title":"Jean & Len Handcreme I Love You So Matcha, f√ºr nor...","country_code":"de","average_organic_rank":12.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":1.92,"impression_share":2.66,"price":3.095714286,"click_share_rank":10,"weekly_search_volume":60855.1,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"Jean","estimated_clicks":1168.41792,"has_deal":false,"has_coupon":false,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha","competitor_brand":null,"asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat√ºrlich & Fein Gemahl...","country_code":"de","average_organic_rank":14.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":7.0,"click_share":3.48,"impression_share":4.53,"price":10.44,"click_share_rank":7,"weekly_search_volume":60855.1,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"Matcha","estimated_clicks":2117.75748,"has_deal":false,"has_coupon":true,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha","competitor_brand":"Special Leaves","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat√ºrlich & Fein Gemahl...","country_code":"de","average_organic_rank":14.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":7.0,"click_share":3.48,"impression_share":4.53,"price":10.44,"click_share_rank":7,"weekly_search_volume":60855.1,"is_yaba_asin":"N","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"Special Leaves","estimated_clicks":2117.75748,"has_deal":false,"has_coupon":true,"has_choice":false},{"brand_aggregation":"naturalebio","parent_asin":"Matcha Premium","reporting_date":"2025-12-20","week_date":"2025-51","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B07SZFD3P9","product_title":"NaturaleBio Matcha Ceremonial Grade 100g. Original...","country_code":"de","average_organic_rank":22.0,"weekly_number_of_days_with_deal":7.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":2.95,"impression_share":2.57,"price":26.748571429,"click_share_rank":8,"weekly_search_volume":60855.1,"is_yaba_asin":"Y","keywords_link":"https://www.amazon.de/s?k=matcha","real_brand":"NaturaleBio","estimated_clicks":1795.22545,"has_deal":true,"has_coupon":false,"has_choice":false}];

    // 2. HELPER FUNCTIONS
    
    // Normalization of Brands (Handling duplicates like 'NORITUAL LAB' vs 'Ceremonial' if same ASIN)
    // We already did some cleaning in Python, but let's ensure consistency.
    function getNormalizedData() {
        return marketData.map(row => {
            // Force strict brand mapping based on observation
            if (row.asin === 'B0FSL3C3Z8') row.real_brand = 'NORITUAL LAB'; 
            if (row.asin === 'B0DRP6Y6XC') row.real_brand = 'Special Leaves';
            if (row.asin === 'B08XVX8V1T') row.real_brand = 'bioKontor';
            return row;
        }).filter(row => row.real_brand !== 'Matcha' && row.real_brand !== 'Ceremonial' && row.real_brand !== 'Bio'); 
        // Filter out rows that were duplicate "Unknowns" in the CSV if we already have the branded row
    }

    const cleanData = getNormalizedData();
    const weeks = [...new Set(cleanData.map(d => d.week_date))].sort();
    const competitors = [...new Set(cleanData.filter(d => d.is_yaba_asin === 'N').map(d => d.real_brand))];

    // Populate Selectors
    window.onload = function() {
        const weekSel = document.getElementById('weekSelector');
        weeks.forEach(w => {
            let opt = document.createElement('option');
            opt.value = w;
            opt.text = w;
            weekSel.add(opt);
        });
        weekSel.value = weeks[weeks.length-1]; // Select last week

        const compSel = document.getElementById('compSelector');
        competitors.forEach(c => {
            let opt = document.createElement('option');
            opt.value = c;
            opt.text = c;
            compSel.add(opt);
        });
        
        // Load Charts
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawAllCharts);
    };

    function switchTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        // Find the button that calls this function? Easier to just querySelectorAll
        event.currentTarget.classList.add('active');
        if (tabId === 'interactive') drawInteractiveCharts();
    }

    function drawAllCharts() {
        drawTrendChart();
        drawBrandChart();
        drawEfficiencyChart();
    }

    // --- CHART 1: GLOBAL TREND (Combo) ---
    function drawTrendChart() {
        // Aggregate by Week and Type (My Brand vs Competitors)
        const agg = {}; 
        weeks.forEach(w => {
            agg[w] = { myClicks: 0, compClicks: 0, myShare: 0, compShare: 0, totalShare: 0 };
        });

        cleanData.forEach(r => {
            if (r.is_yaba_asin === 'Y') {
                agg[r.week_date].myClicks += r.estimated_clicks;
                agg[r.week_date].myShare += r.click_share;
            } else {
                agg[r.week_date].compClicks += r.estimated_clicks;
                agg[r.week_date].compShare += r.click_share;
            }
        });

        const dataArray = [['Week', 'Nuestros Clicks', 'Clicks Competencia', 'Nuestra Share (%)']];
        weeks.forEach(w => {
            // Note: Share is additive here for "Total Share of Brand", which is correct.
            dataArray.push([w, agg[w].myClicks, agg[w].compClicks, agg[w].myShare]);
        });

        const data = google.visualization.arrayToDataTable(dataArray);

        const options = {
            seriesType: 'bars',
            series: {2: {type: 'line', targetAxisIndex: 1}},
            vAxes: {0: {title: 'Volumen de Clicks'}, 1: {title: 'Share (%)', format: '#\'%\''}},
            colors: ['#4285F4', '#e0e0e0', '#34A853'],
            legend: {position: 'bottom'},
            chartArea: {width: '85%', height: '70%'},
            animation: {startup: true, duration: 1000, easing: 'out'}
        };

        const chart = new google.visualization.ComboChart(document.getElementById('trend_chart'));
        chart.draw(data, options);
    }

    // --- CHART 2: BRAND COMPETITIVENESS (Line) ---
    function drawBrandChart() {
        // Top 3 Competitors
        const compShares = {};
        competitors.forEach(c => compShares[c] = 0);
        cleanData.forEach(r => {
            if(r.is_yaba_asin === 'N') compShares[r.real_brand] += r.click_share;
        });
        const top3 = Object.entries(compShares).sort((a,b) => b[1]-a[1]).slice(0,3).map(x=>x[0]);

        const dataRows = [['Week', 'NaturaleBio', ...top3]];
        
        weeks.forEach(w => {
            const row = [w];
            // My Brand
            const myShare = cleanData.filter(d => d.week_date === w && d.is_yaba_asin === 'Y')
                                     .reduce((sum, d) => sum + d.click_share, 0);
            row.push(myShare);

            // Competitors
            top3.forEach(c => {
                const cShare = cleanData.filter(d => d.week_date === w && d.real_brand === c)
                                        .reduce((sum, d) => sum + d.click_share, 0);
                row.push(cShare);
            });
            dataRows.push(row);
        });

        const data = google.visualization.arrayToDataTable(dataRows);
        const options = {
            curveType: 'function',
            legend: {position: 'bottom'},
            colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853'], // Blue for us, others for them
            vAxis: {title: 'Click Share (%)'},
            chartArea: {width: '85%', height: '70%'}
        };

        const chart = new google.visualization.LineChart(document.getElementById('brand_chart'));
        chart.draw(data, options);
    }

    // --- CHART 3: EFFICIENCY (Scatter) ---
    function drawEfficiencyChart() {
        // Last week only for clarity
        const lastWeek = weeks[weeks.length - 1];
        const currentData = cleanData.filter(d => d.week_date === lastWeek);

        const dataArray = [['Rank', 'Click Share', {'type': 'string', 'role': 'style'}, {'type': 'string', 'role': 'tooltip'}]];
        
        currentData.forEach(r => {
            if (r.average_organic_rank > 0) { // Filter bad data
                const color = r.is_yaba_asin === 'Y' ? '#4285F4' : '#EA4335';
                const tooltip = `${r.real_brand} (ASIN: ${r.asin})\nRank: ${r.average_organic_rank}\nShare: ${r.click_share}%`;
                dataArray.push([r.average_organic_rank, r.click_share, `point {fill-color: ${color}; size: 10}`, tooltip]);
            }
        });

        const data = google.visualization.arrayToDataTable(dataArray);
        const options = {
            hAxis: {title: 'Rank Org√°nico (Menor es Mejor)', direction: 1}, // 1 is normal, but rank 1 is left
            vAxis: {title: 'Click Share (%)'},
            legend: 'none',
            chartArea: {width: '85%', height: '70%'}
        };

        const chart = new google.visualization.ScatterChart(document.getElementById('efficiency_chart'));
        chart.draw(data, options);
    }

    // --- INTERACTIVE CHARTS ---
    function drawInteractiveCharts() {
        const week = document.getElementById('weekSelector').value;
        const comp = document.getElementById('compSelector').value;
        const weekData = cleanData.filter(d => d.week_date === week);

        // Filter My Brand ASINs and Selected Competitor ASINs
        const myAsins = weekData.filter(d => d.is_yaba_asin === 'Y');
        const compAsins = weekData.filter(d => d.real_brand === comp);

        if (myAsins.length === 0 || compAsins.length === 0) return;

        // Price Chart
        const priceDataArray = [['ASIN', 'Precio', { role: 'style' }]];
        myAsins.forEach(d => priceDataArray.push(['Nuest: ' + d.asin.substr(-4), d.price, '#4285F4']));
        compAsins.forEach(d => priceDataArray.push(['Comp: ' + d.asin.substr(-4), d.price, '#EA4335']));
        
        const priceData = google.visualization.arrayToDataTable(priceDataArray);
        const priceChart = new google.visualization.ColumnChart(document.getElementById('price_comp_chart'));
        priceChart.draw(priceData, {legend: 'none', title: 'Comparativa de Precios (Nuestros vs Competidor)'});

        // Share Chart
        const shareDataArray = [['ASIN', 'Click Share', { role: 'style' }]];
        myAsins.forEach(d => shareDataArray.push(['Nuest: ' + d.asin.substr(-4), d.click_share, '#4285F4']));
        compAsins.forEach(d => shareDataArray.push(['Comp: ' + d.asin.substr(-4), d.click_share, '#EA4335']));

        const shareData = google.visualization.arrayToDataTable(shareDataArray);
        const shareChart = new google.visualization.ColumnChart(document.getElementById('share_comp_chart'));
        shareChart.draw(shareData, {legend: 'none', title: 'Comparativa de Cuota (Share %)'});
    }

    // Window Resize Handler
    window.onresize = drawAllCharts;

</script>
</body>
</html>