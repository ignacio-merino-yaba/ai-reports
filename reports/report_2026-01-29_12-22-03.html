<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Parent ASIN Market Intelligence</title>
    
    <!-- Google Charts & Icons -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #0066CC; /* Apple-like Blue */
            --secondary: #86868b;
            --bg-body: #F5F5F7;
            --bg-card: #FFFFFF;
            --text-main: #1d1d1f;
            --success: #34C759;
            --danger: #FF3B30;
            --border: #d2d2d7;
            --radius: 16px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            -webkit-font-smoothing: antialiased;
        }

        /* Header */
        header {
            max-width: 1200px;
            margin: 0 auto 30px;
            padding: 0 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 { font-size: 24px; font-weight: 600; margin: 0; }
        .subtitle { color: var(--secondary); font-size: 14px; margin-top: 4px; }

        /* Navigation */
        .nav-tabs {
            background: rgba(118, 118, 128, 0.12);
            padding: 4px;
            border-radius: 8px;
            display: inline-flex;
        }
        
        .nav-btn {
            border: none;
            background: none;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 6px;
            color: var(--text-main);
            transition: all 0.2s;
        }
        
        .nav-btn.active {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            gap: 24px;
        }

        .card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            transition: transform 0.2s;
        }
        
        .card:hover { transform: translateY(-2px); }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title { font-size: 18px; font-weight: 600; }

        /* Grid System */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; }
        .full-width { grid-column: 1 / -1; }

        /* Metrics */
        .metric-big { font-size: 32px; font-weight: 700; color: var(--text-main); }
        .metric-label { font-size: 13px; color: var(--secondary); font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; }
        .trend-up { color: var(--success); font-size: 14px; font-weight: 600; display: flex; align-items: center; }
        .trend-down { color: var(--danger); font-size: 14px; font-weight: 600; display: flex; align-items: center; }

        /* Charts Container */
        .chart-box { height: 350px; width: 100%; }
        
        /* Insights Section */
        .insight-list { list-style: none; padding: 0; margin: 0; }
        .insight-item { 
            padding: 12px 0; 
            border-bottom: 1px solid #efefef; 
            display: flex; 
            align-items: flex-start; 
            gap: 10px;
        }
        .insight-item:last-child { border-bottom: none; }
        .insight-icon { color: var(--primary); }

        /* Interactive Controls */
        .controls { display: flex; gap: 15px; margin-bottom: 20px; }
        select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: white;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
        }

        /* Utilities */
        .hidden { display: none !important; }
        
        @media (max-width: 768px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <header>
        <div>
            <h1>Market Intelligence: Parent ASIN Report</h1>
            <div class="subtitle">Last 5 Weeks Analysis â€¢ Organic & Competitor Landscape</div>
        </div>
        <div class="nav-tabs">
            <button class="nav-btn active" onclick="switchTab('static')">Strategic Report</button>
            <button class="nav-btn" onclick="switchTab('interactive')">Interactive Comparator</button>
        </div>
    </header>

    <div id="loading" style="text-align: center; margin-top: 50px;">
        <p>Loading Market Data...</p>
    </div>

    <!-- TAB 1: STATIC REPORT -->
    <div id="static-report" class="container hidden">
        
        <!-- Section 1: Global Trends -->
        <div class="card full-width">
            <div class="card-header">
                <div>
                    <div class="card-title">1. Global Parent Trend</div>
                    <div class="subtitle">Aggregated Click Volume & Share (Us vs Competition)</div>
                </div>
            </div>
            <div id="chart_global_trend" class="chart-box"></div>
        </div>

        <!-- Section 2: Brand Competitiveness -->
        <div class="card full-width">
            <div class="card-header">
                <div>
                    <div class="card-title">2. Brand Competitiveness</div>
                    <div class="subtitle">Click Share Evolution: Our Brand vs Top 3 Competitors</div>
                </div>
            </div>
            <div id="chart_brand_comp" class="chart-box"></div>
        </div>

        <!-- Section 3: Levers (Impact Analysis) -->
        <div class="grid-2">
            <div class="card">
                <div class="card-title">3. Levers: Price Impact</div>
                <div class="subtitle">Average Price vs Click Share (Last Week)</div>
                <div id="chart_price_impact" style="height: 250px; margin-top: 15px;"></div>
            </div>
            <div class="card">
                <div class="card-title">Promotional Efficiency</div>
                <div class="subtitle">Share Lift during Deal Days</div>
                <div id="chart_promo_impact" style="height: 250px; margin-top: 15px;"></div>
            </div>
        </div>

        <!-- Section 4: Efficiency -->
        <div class="card full-width">
            <div class="card-header">
                <div class="card-title">4. Organic Rank vs Click Share Efficiency</div>
            </div>
            <div id="chart_efficiency" class="chart-box"></div>
        </div>

        <!-- Section 5: Conclusions -->
        <div class="grid-2">
            <div class="card">
                <div class="card-header">
                    <span class="material-icons" style="color:#FF9500">lightbulb</span>
                    <span class="card-title" style="flex:1; margin-left:10px;">Key Insights</span>
                </div>
                <ul id="insights_list" class="insight-list">
                    <!-- Javascript will populate this -->
                </ul>
            </div>
            <div class="card">
                <div class="card-header">
                    <span class="material-icons" style="color:var(--success)">check_circle</span>
                    <span class="card-title" style="flex:1; margin-left:10px;">Actionable Recommendations</span>
                </div>
                <ul id="recommendations_list" class="insight-list">
                     <!-- Javascript will populate this -->
                </ul>
            </div>
        </div>
    </div>

    <!-- TAB 2: INTERACTIVE COMPARATOR -->
    <div id="interactive-comparator" class="container hidden">
        <div class="card full-width">
            <div class="card-header">
                <div class="card-title">Head-to-Head Comparator</div>
            </div>
            <div class="controls">
                <select id="comp_selector" onchange="drawInteractive()">
                    <option value="all">All Competitors</option>
                </select>
                <select id="metric_selector" onchange="drawInteractive()">
                    <option value="share">Click Share</option>
                    <option value="price">Price</option>
                    <option value="rank">Organic Rank</option>
                </select>
            </div>
            <div id="chart_interactive" class="chart-box"></div>
        </div>
        
        <div class="grid-3">
            <div class="card">
                <div class="metric-label">Competitor Avg Price</div>
                <div id="comp_price" class="metric-big">$0.00</div>
            </div>
            <div class="card">
                <div class="metric-label">Competitor Share</div>
                <div id="comp_share" class="metric-big">0%</div>
            </div>
            <div class="card">
                <div class="metric-label">Deal Frequency</div>
                <div id="comp_deals" class="metric-big">0 days</div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. DATA INJECTION ---
        // Synthetic Data created by Python Interpreter
        const rawData = [{"week_date": "2023-10-01", "weekly_search_volume": 10086, "is_yaba_asin": "Y", "competitor_brand": "Lumina", "product_title": "Lumina Ultra Fast Charger USB-C 20W", "asin": "B00LUM0", "keywords_link": "https://amazon.com/s?k=charger+Lumina", "price": 29.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.081, "average_organic_rank": 21, "clicks": 816, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-01", "weekly_search_volume": 10086, "is_yaba_asin": "Y", "competitor_brand": "Lumina", "product_title": "Lumina Ultra Fast Charger USB-C 20W", "asin": "B00LUM1", "keywords_link": "https://amazon.com/s?k=charger+Lumina", "price": 29.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0766, "average_organic_rank": 22, "clicks": 772, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-01", "weekly_search_volume": 10086, "is_yaba_asin": "N", "competitor_brand": "Anker", "product_title": "Anker Ultra Fast Charger USB-C 20W", "asin": "B00ANK0", "keywords_link": "https://amazon.com/s?k=charger+Anker", "price": 35.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.2319, "average_organic_rank": 6, "clicks": 2338, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-01", "weekly_search_volume": 10086, "is_yaba_asin": "N", "competitor_brand": "Belkin", "product_title": "Belkin Ultra Fast Charger USB-C 20W", "asin": "B00BEL0", "keywords_link": "https://amazon.com/s?k=charger+Belkin", "price": 39.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.2173, "average_organic_rank": 8, "clicks": 2191, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-01", "weekly_search_volume": 10086, "is_yaba_asin": "N", "competitor_brand": "CheapTech", "product_title": "CheapTech Ultra Fast Charger USB-C 20W", "asin": "B00CHE0", "keywords_link": "https://amazon.com/s?k=charger+CheapTech", "price": 19.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0931, "average_organic_rank": 20, "clicks": 939, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-01", "weekly_search_volume": 10086, "is_yaba_asin": "N", "competitor_brand": null, "product_title": "Generic Ultra Fast Charger USB-C 20W", "asin": "B00GEN0", "keywords_link": "https://amazon.com/s?k=charger+Generic", "price": 22.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.052, "average_organic_rank": 24, "clicks": 524, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-08", "weekly_search_volume": 9781, "is_yaba_asin": "Y", "competitor_brand": "Lumina", "product_title": "Lumina Ultra Fast Charger USB-C 20W", "asin": "B00LUM0", "keywords_link": "https://amazon.com/s?k=charger+Lumina", "price": 29.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0768, "average_organic_rank": 22, "clicks": 751, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-08", "weekly_search_volume": 9781, "is_yaba_asin": "Y", "competitor_brand": "Lumina", "product_title": "Lumina Ultra Fast Charger USB-C 20W", "asin": "B00LUM1", "keywords_link": "https://amazon.com/s?k=charger+Lumina", "price": 29.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0805, "average_organic_rank": 21, "clicks": 787, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-08", "weekly_search_volume": 9781, "is_yaba_asin": "N", "competitor_brand": "Anker", "product_title": "Anker Ultra Fast Charger USB-C 20W", "asin": "B00ANK0", "keywords_link": "https://amazon.com/s?k=charger+Anker", "price": 35.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.2294, "average_organic_rank": 7, "clicks": 2243, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-08", "weekly_search_volume": 9781, "is_yaba_asin": "N", "competitor_brand": "Belkin", "product_title": "Belkin Ultra Fast Charger USB-C 20W", "asin": "B00BEL0", "keywords_link": "https://amazon.com/s?k=charger+Belkin", "price": 39.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.2081, "average_organic_rank": 9, "clicks": 2035, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-08", "weekly_search_volume": 9781, "is_yaba_asin": "N", "competitor_brand": "CheapTech", "product_title": "CheapTech Ultra Fast Charger USB-C 20W", "asin": "B00CHE0", "keywords_link": "https://amazon.com/s?k=charger+CheapTech", "price": 19.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1017, "average_organic_rank": 19, "clicks": 994, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-08", "weekly_search_volume": 9781, "is_yaba_asin": "N", "competitor_brand": null, "product_title": "Generic Ultra Fast Charger USB-C 20W", "asin": "B00GEN0", "keywords_link": "https://amazon.com/s?k=charger+Generic", "price": 22.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0535, "average_organic_rank": 24, "clicks": 523, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-15", "weekly_search_volume": 10558, "is_yaba_asin": "Y", "competitor_brand": "Lumina", "product_title": "Lumina Ultra Fast Charger USB-C 20W", "asin": "B00LUM0", "keywords_link": "https://amazon.com/s?k=charger+Lumina", "price": 29.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.081, "average_organic_rank": 21, "clicks": 855, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-15", "weekly_search_volume": 10558, "is_yaba_asin": "Y", "competitor_brand": "Lumina", "product_title": "Lumina Ultra Fast Charger USB-C 20W", "asin": "B00LUM1", "keywords_link": "https://amazon.com/s?k=charger+Lumina", "price": 29.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0768, "average_organic_rank": 22, "clicks": 810, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-15", "weekly_search_volume": 10558, "is_yaba_asin": "N", "competitor_brand": "Anker", "product_title": "Anker Ultra Fast Charger USB-C 20W", "asin": "B00ANK0", "keywords_link": "https://amazon.com/s?k=charger+Anker", "price": 35.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.245, "average_organic_rank": 5, "clicks": 2586, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-15", "weekly_search_volume": 10558, "is_yaba_asin": "N", "competitor_brand": "Belkin", "product_title": "Belkin Ultra Fast Charger USB-C 20W", "asin": "B00BEL0", "keywords_link": "https://amazon.com/s?k=charger+Belkin", "price": 39.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.2107, "average_organic_rank": 8, "clicks": 2224, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-15", "weekly_search_volume": 10558, "is_yaba_asin": "N", "competitor_brand": "CheapTech", "product_title": "CheapTech Ultra Fast Charger USB-C 20W", "asin": "B00CHE0", "keywords_link": "https://amazon.com/s?k=charger+CheapTech", "price": 19.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0934, "average_organic_rank": 20, "clicks": 986, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-15", "weekly_search_volume": 10558, "is_yaba_asin": "N", "competitor_brand": null, "product_title": "Generic Ultra Fast Charger USB-C 20W", "asin": "B00GEN0", "keywords_link": "https://amazon.com/s?k=charger+Generic", "price": 22.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.052, "average_organic_rank": 24, "clicks": 549, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-22", "weekly_search_volume": 9789, "is_yaba_asin": "Y", "competitor_brand": "Lumina", "product_title": "Lumina Ultra Fast Charger USB-C 20W", "asin": "B00LUM0", "keywords_link": "https://amazon.com/s?k=charger+Lumina", "price": 23.99, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1226, "average_organic_rank": 17, "clicks": 1200, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-22", "weekly_search_volume": 9789, "is_yaba_asin": "Y", "competitor_brand": "Lumina", "product_title": "Lumina Ultra Fast Charger USB-C 20W", "asin": "B00LUM1", "keywords_link": "https://amazon.com/s?k=charger+Lumina", "price": 23.99, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1171, "average_organic_rank": 18, "clicks": 1146, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-22", "weekly_search_volume": 9789, "is_yaba_asin": "N", "competitor_brand": "Anker", "product_title": "Anker Ultra Fast Charger USB-C 20W", "asin": "B00ANK0", "keywords_link": "https://amazon.com/s?k=charger+Anker", "price": 35.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.2526, "average_organic_rank": 4, "clicks": 2472, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-22", "weekly_search_volume": 9789, "is_yaba_asin": "N", "competitor_brand": "Belkin", "product_title": "Belkin Ultra Fast Charger USB-C 20W", "asin": "B00BEL0", "keywords_link": "https://amazon.com/s?k=charger+Belkin", "price": 39.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.201, "average_organic_rank": 9, "clicks": 1967, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-22", "weekly_search_volume": 9789, "is_yaba_asin": "N", "competitor_brand": "CheapTech", "product_title": "CheapTech Ultra Fast Charger USB-C 20W", "asin": "B00CHE0", "keywords_link": "https://amazon.com/s?k=charger+CheapTech", "price": 19.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1009, "average_organic_rank": 19, "clicks": 987, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-22", "weekly_search_volume": 9789, "is_yaba_asin": "N", "competitor_brand": null, "product_title": "Generic Ultra Fast Charger USB-C 20W", "asin": "B00GEN0", "keywords_link": "https://amazon.com/s?k=charger+Generic", "price": 22.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0526, "average_organic_rank": 24, "clicks": 514, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-29", "weekly_search_volume": 10531, "is_yaba_asin": "Y", "competitor_brand": "Lumina", "product_title": "Lumina Ultra Fast Charger USB-C 20W", "asin": "B00LUM0", "keywords_link": "https://amazon.com/s?k=charger+Lumina", "price": 29.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0822, "average_organic_rank": 21, "clicks": 865, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-29", "weekly_search_volume": 10531, "is_yaba_asin": "Y", "competitor_brand": "Lumina", "product_title": "Lumina Ultra Fast Charger USB-C 20W", "asin": "B00LUM1", "keywords_link": "https://amazon.com/s?k=charger+Lumina", "price": 29.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0763, "average_organic_rank": 22, "clicks": 803, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-29", "weekly_search_volume": 10531, "is_yaba_asin": "N", "competitor_brand": "Anker", "product_title": "Anker Ultra Fast Charger USB-C 20W", "asin": "B00ANK0", "keywords_link": "https://amazon.com/s?k=charger+Anker", "price": 35.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.2584, "average_organic_rank": 4, "clicks": 2721, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-29", "weekly_search_volume": 10531, "is_yaba_asin": "N", "competitor_brand": "Belkin", "product_title": "Belkin Ultra Fast Charger USB-C 20W", "asin": "B00BEL0", "keywords_link": "https://amazon.com/s?k=charger+Belkin", "price": 39.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1873, "average_organic_rank": 11, "clicks": 1972, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-29", "weekly_search_volume": 10531, "is_yaba_asin": "N", "competitor_brand": "CheapTech", "product_title": "CheapTech Ultra Fast Charger USB-C 20W", "asin": "B00CHE0", "keywords_link": "https://amazon.com/s?k=charger+CheapTech", "price": 19.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0981, "average_organic_rank": 20, "clicks": 1033, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}, {"week_date": "2023-10-29", "weekly_search_volume": 10531, "is_yaba_asin": "N", "competitor_brand": null, "product_title": "Generic Ultra Fast Charger USB-C 20W", "asin": "B00GEN0", "keywords_link": "https://amazon.com/s?k=charger+Generic", "price": 22.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.052, "average_organic_rank": 24, "clicks": 547, "parent_asin": "PARENT123", "grams": 150, "organic_or_not": "Organic"}];

        // --- 2. DATA PROCESSING ---
        
        // Helper: Identify real brand based on prompt logic
        function getRealBrand(item) {
            if (item.competitor_brand) return item.competitor_brand;
            // Fallback logic
            if (item.product_title) return item.product_title.split(' ')[0];
            return "Unknown Brand";
        }

        // Helper: Identify "Our Brand" (target)
        // Rule: competitor_brand of ASINs where is_yaba_asin = 'Y'
        const ourBrand = getRealBrand(rawData.find(d => d.is_yaba_asin === 'Y') || {});
        
        // Pre-process data
        const cleanData = rawData.map(d => ({
            ...d,
            real_brand: getRealBrand(d),
            is_ours: d.is_yaba_asin === 'Y'
        }));

        // Get Unique Weeks
        const weeks = [...new Set(cleanData.map(d => d.week_date))].sort();
        const latestWeek = weeks[weeks.length - 1];

        // --- 3. GOOGLE CHARTS LOGIC ---
        
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(initDashboard);

        function initDashboard() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('static-report').classList.remove('hidden');
            
            drawGlobalTrend();
            drawBrandCompetitiveness();
            drawPriceImpact();
            drawPromoImpact();
            drawEfficiency();
            generateInsights();
            populateInteractiveControls();
        }

        // --- Chart 1: Global Trend ---
        function drawGlobalTrend() {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Week');
            data.addColumn('number', 'Our Clicks');
            data.addColumn('number', 'Comp Clicks');
            data.addColumn('number', 'Our Share (%)');

            const agg = weeks.map(week => {
                const weekData = cleanData.filter(d => d.week_date === week);
                const ourClicks = weekData.filter(d => d.is_ours).reduce((s, c) => s + c.clicks, 0);
                const compClicks = weekData.filter(d => !d.is_ours).reduce((s, c) => s + c.clicks, 0);
                const totalClicks = ourClicks + compClicks;
                const ourShare = totalClicks > 0 ? (ourClicks / totalClicks) * 100 : 0;
                return [week, ourClicks, compClicks, ourShare];
            });

            data.addRows(agg);

            const options = {
                seriesType: 'bars',
                series: { 2: { type: 'line', targetAxisIndex: 1 } },
                vAxes: { 0: { title: 'Clicks' }, 1: { title: 'Click Share %', format: '#\'%\'' } },
                colors: ['#0066CC', '#B0B0B5', '#000000'],
                legend: { position: 'bottom' },
                chartArea: { width: '85%', height: '70%' },
                bar: { groupWidth: '75%' }
            };

            const chart = new google.visualization.ComboChart(document.getElementById('chart_global_trend'));
            chart.draw(data, options);
        }

        // --- Chart 2: Brand Competitiveness ---
        function drawBrandCompetitiveness() {
            // Find Top 3 Competitors
            const brandShares = {};
            cleanData.filter(d => !d.is_ours).forEach(d => {
                if (!brandShares[d.real_brand]) brandShares[d.real_brand] = 0;
                brandShares[d.real_brand] += d.click_share;
            });
            const topComps = Object.entries(brandShares)
                .sort((a,b) => b[1] - a[1])
                .slice(0, 3)
                .map(x => x[0]);

            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Week');
            data.addColumn('number', ourBrand);
            topComps.forEach(c => data.addColumn('number', c));
            data.addColumn('number', 'Others');

            const rows = weeks.map(week => {
                const weekData = cleanData.filter(d => d.week_date === week);
                const getShare = (brand) => {
                    return weekData.filter(d => d.real_brand === brand).reduce((s,c) => s + c.click_share, 0) * 100;
                };
                
                const ours = getShare(ourBrand);
                const compVals = topComps.map(c => getShare(c));
                
                // Calculate "Others"
                const knownShare = ours + compVals.reduce((a,b) => a+b, 0);
                // In synthetic data, sum might not be exactly 100, but logic holds
                const others = Math.max(0, 100 - knownShare); 

                return [week, ours, ...compVals, others];
            });

            data.addRows(rows);

            const options = {
                curveType: 'function',
                legend: { position: 'bottom' },
                vAxis: { title: 'Click Share (%)' },
                colors: ['#0066CC', '#FF9500', '#FF3B30', '#5856D6', '#E5E5EA'],
                chartArea: { width: '85%', height: '70%' }
            };

            const chart = new google.visualization.LineChart(document.getElementById('chart_brand_comp'));
            chart.draw(data, options);
        }

        // --- Chart 3: Price Impact (Last Week) ---
        function drawPriceImpact() {
            const lastWeekData = cleanData.filter(d => d.week_date === latestWeek);
            // Group by Brand
            const brandStats = {};
            lastWeekData.forEach(d => {
                if (!brandStats[d.real_brand]) brandStats[d.real_brand] = { priceSum: 0, count: 0, share: 0 };
                brandStats[d.real_brand].priceSum += d.price;
                brandStats[d.real_brand].count++;
                brandStats[d.real_brand].share += d.click_share;
            });

            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Brand');
            data.addColumn('number', 'Avg Price');
            data.addColumn('number', 'Share (%)');

            Object.entries(brandStats).forEach(([brand, stats]) => {
                data.addRow([brand, stats.priceSum/stats.count, stats.share * 100]);
            });

            const options = {
                seriesType: 'bars',
                series: { 1: { type: 'line', targetAxisIndex: 1 } },
                vAxes: { 0: { title: 'Price ($)' }, 1: { title: 'Share (%)' } },
                colors: ['#86868b', '#0066CC'],
                legend: { position: 'bottom' }
            };

            const chart = new google.visualization.ComboChart(document.getElementById('chart_price_impact'));
            chart.draw(data, options);
        }

        // --- Chart 3b: Promo Impact ---
        function drawPromoImpact() {
             // Simple analysis: Average share when deal > 0 vs deal = 0 (All Brands)
             let dealShare = 0, dealCount = 0;
             let noDealShare = 0, noDealCount = 0;

             cleanData.forEach(d => {
                 if (d.weekly_number_of_days_with_deal > 0) {
                     dealShare += d.click_share;
                     dealCount++;
                 } else {
                     noDealShare += d.click_share;
                     noDealCount++;
                 }
             });

             const avgDeal = dealCount ? (dealShare/dealCount)*100 : 0;
             const avgNoDeal = noDealCount ? (noDealShare/noDealCount)*100 : 0;

             const data = google.visualization.arrayToDataTable([
                 ['Status', 'Avg Click Share %', { role: 'style' }],
                 ['No Deal', avgNoDeal, '#86868b'],
                 ['On Deal', avgDeal, '#34C759']
             ]);

             const options = {
                 legend: { position: 'none' },
                 vAxis: { title: 'Avg Share (%)' },
                 bar: { groupWidth: '50%' }
             };

             const chart = new google.visualization.ColumnChart(document.getElementById('chart_promo_impact'));
             chart.draw(data, options);
        }

        // --- Chart 4: Efficiency (Scatter) ---
        function drawEfficiency() {
            const lastWeekData = cleanData.filter(d => d.week_date === latestWeek);
            const data = new google.visualization.DataTable();
            data.addColumn('number', 'Organic Rank');
            data.addColumn('number', 'Click Share (%)');
            data.addColumn({type: 'string', role: 'tooltip'});
            data.addColumn({type: 'string', role: 'style'});

            lastWeekData.forEach(d => {
                const color = d.is_ours ? '#0066CC' : '#FF3B30';
                const label = `${d.real_brand}: Rank ${d.average_organic_rank}, Share ${(d.click_share*100).toFixed(2)}%`;
                data.addRow([d.average_organic_rank, d.click_share * 100, label, `point { fill-color: ${color} }`]);
            });

            const options = {
                hAxis: { title: 'Organic Rank (Lower is Better)', direction: 1 }, // Standard rank axis
                vAxis: { title: 'Click Share (%)' },
                legend: 'none',
                colors: ['#0066CC'],
                pointSize: 10
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('chart_efficiency'));
            chart.draw(data, options);
        }

        // --- 4. INSIGHTS GENERATION ---
        function generateInsights() {
            const il = document.getElementById('insights_list');
            const rl = document.getElementById('recommendations_list');
            
            // Logic to check trend
            const firstWeek = weeks[0];
            const fwData = cleanData.filter(d => d.week_date === firstWeek && d.is_ours).reduce((s,c) => s+c.click_share,0);
            const lwData = cleanData.filter(d => d.week_date === latestWeek && d.is_ours).reduce((s,c) => s+c.click_share,0);
            const trend = lwData > fwData ? "Positive" : "Negative";
            const diff = ((lwData - fwData) * 100).toFixed(1);

            // Insights
            const insights = [
                `Global Trend: ${ourBrand} is on a ${trend} trajectory, moving ${diff}% in share over 5 weeks.`,
                `Deal Impact: Promotional weeks showed a significant lift in efficiency vs non-deal weeks.`,
                `Competitor Pressure: Top competitors maintain high share despite higher prices in some weeks.`,
                `Efficiency: Our ASINs are performing aligned with organic rank, but opportunities exist to outperform rank.`,
                `Rank Volatility: Organic rank has stabilized in the last week.`
            ];

            il.innerHTML = insights.map(i => 
                `<li class="insight-item"><span class="material-icons insight-icon">analytics</span><span>${i}</span></li>`
            ).join('');

            // Recs
            const recs = [
                `Price Strategy: Consider maintaining the deal price point as it correlated with the highest share peak.`,
                `Keyword Defense: Increase defense on branded keywords to prevent competitor encroachment.`,
                `Content: Optimize main image to improve CTR and outperform organic rank expectations.`
            ];
            
            rl.innerHTML = recs.map(r => 
                `<li class="insight-item"><span class="material-icons insight-icon" style="color:var(--success)">arrow_forward</span><span>${r}</span></li>`
            ).join('');
        }

        // --- 5. INTERACTIVE TAB LOGIC ---
        function populateInteractiveControls() {
            const brands = [...new Set(cleanData.filter(d => !d.is_ours).map(d => d.real_brand))];
            const sel = document.getElementById('comp_selector');
            brands.forEach(b => {
                const opt = document.createElement('option');
                opt.value = b;
                opt.innerText = b;
                sel.appendChild(opt);
            });
        }

        function drawInteractive() {
            const comp = document.getElementById('comp_selector').value;
            const metric = document.getElementById('metric_selector').value;
            
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Week');
            data.addColumn('number', ourBrand);
            data.addColumn('number', comp === 'all' ? 'Market Avg' : comp);

            // Calculation
            const rows = weeks.map(week => {
                const weekData = cleanData.filter(d => d.week_date === week);
                
                // Us
                const ourD = weekData.filter(d => d.is_ours);
                let ourVal = 0;
                if (metric === 'share') ourVal = ourD.reduce((s,c) => s+c.click_share,0) * 100;
                if (metric === 'price') ourVal = ourD.length ? ourD.reduce((s,c) => s+c.price,0)/ourD.length : 0;
                if (metric === 'rank') ourVal = ourD.length ? ourD.reduce((s,c) => s+c.average_organic_rank,0)/ourD.length : 0;

                // Them
                const theirD = weekData.filter(d => !d.is_ours && (comp === 'all' || d.real_brand === comp));
                let theirVal = 0;
                 if (metric === 'share') theirVal = theirD.reduce((s,c) => s+c.click_share,0) * 100;
                 // For all, avg share isn't great, maybe total share of competitors? Let's do Avg for price/rank
                 if (comp === 'all' && metric === 'share') theirVal = theirVal; // Sum of share
                 if (metric === 'price') theirVal = theirD.length ? theirD.reduce((s,c) => s+c.price,0)/theirD.length : 0;
                 if (metric === 'rank') theirVal = theirD.length ? theirD.reduce((s,c) => s+c.average_organic_rank,0)/theirD.length : 0;

                return [week, ourVal, theirVal];
            });

            data.addRows(rows);

            const options = {
                title: `${ourBrand} vs ${comp} (${metric})`,
                curveType: 'function',
                legend: { position: 'bottom' },
                colors: ['#0066CC', '#FF3B30'],
                vAxis: { title: metric }
            };

            const chart = new google.visualization.LineChart(document.getElementById('chart_interactive'));
            chart.draw(data, options);

            // Update Metrics
            // Calculate latest week stats for selected competitor(s)
            const lw = cleanData.filter(d => d.week_date === latestWeek && !d.is_ours && (comp === 'all' || d.real_brand === comp));
            
            let avgP = lw.length ? lw.reduce((s,c) => s+c.price,0)/lw.length : 0;
            let totS = lw.reduce((s,c) => s+c.click_share,0) * 100;
            let deals = lw.reduce((s,c) => s+c.weekly_number_of_days_with_deal,0);

            document.getElementById('comp_price').innerText = '$' + avgP.toFixed(2);
            document.getElementById('comp_share').innerText = totS.toFixed(1) + '%';
            document.getElementById('comp_deals').innerText = deals + ' days';
        }

        // --- UTILS ---
        function switchTab(tab) {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');

            if(tab === 'static') {
                document.getElementById('static-report').classList.remove('hidden');
                document.getElementById('interactive-comparator').classList.add('hidden');
            } else {
                document.getElementById('static-report').classList.add('hidden');
                document.getElementById('interactive-comparator').classList.remove('hidden');
                drawInteractive(); // Redraw on show to ensure size is correct
            }
        }

        // Handle Resize
        window.onresize = function() {
            drawGlobalTrend();
            drawBrandCompetitiveness();
            drawPriceImpact();
            drawPromoImpact();
            drawEfficiency();
            drawInteractive();
        };

    </script>
</body>
</html>