<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe de Inteligencia de Mercado - NaturaleBio</title>
    
    <!-- Librer√≠as de Google (Gr√°ficos) -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        /* Estilos Base "Apple-like" */
        :root {
            --primary: #0071e3;
            --primary-soft: #e3f1ff;
            --text-dark: #1d1d1f;
            --text-gray: #86868b;
            --bg-page: #f5f5f7;
            --bg-card: #ffffff;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.08);
            --radius: 16px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-page);
            color: var(--text-dark);
            line-height: 1.5;
            padding-bottom: 40px;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
        }

        .header-meta {
            font-size: 14px;
            color: var(--text-gray);
        }

        /* Tabs */
        .tabs-container {
            display: flex;
            justify-content: center;
            padding: 20px 0;
        }

        .tab-btn {
            background: #e5e5e5;
            border: none;
            padding: 8px 24px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-gray);
        }

        .tab-btn:first-child {
            border-radius: 8px 0 0 8px;
        }

        .tab-btn:last-child {
            border-radius: 0 8px 8px 0;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 2px 4px rgba(0,113,227,0.3);
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: none; /* Hidden by default */
        }
        
        .container.active {
            display: block;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .card-subtitle {
            font-size: 13px;
            color: var(--text-gray);
            margin-top: 4px;
        }

        /* KPI Badges */
        .kpi-row {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .kpi-badge {
            background: var(--bg-page);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
        }

        .kpi-badge.positive { color: #34c759; background: #eafbea; }
        .kpi-badge.negative { color: #ff3b30; background: #ffe5e5; }
        .kpi-badge.neutral { color: var(--text-gray); }

        /* Sections */
        .section-title {
            font-size: 24px;
            font-weight: 700;
            margin: 40px 0 20px 0;
        }

        /* Chart Placeholder */
        .chart-box {
            width: 100%;
            height: 350px;
        }

        /* Insights List */
        .insight-list {
            list-style: none;
        }

        .insight-item {
            display: flex;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .insight-item:last-child {
            border-bottom: none;
        }

        .insight-icon {
            color: var(--primary);
        }
        
        /* Interactive Controls */
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            background: white;
            padding: 16px;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
        }
        
        select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 14px;
            min-width: 150px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
            .header { flex-direction: column; align-items: flex-start; gap: 8px; }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="header">
        <div>
            <h1>Inteligencia de Mercado: Psyllium</h1>
            <div class="header-meta">Parent ASIN: NATURALEBIO ‚Ä¢ √öltima Actualizaci√≥n: 2026-01-03</div>
        </div>
        <div>
            <span class="kpi-badge positive">Mi Marca: NaturaleBio</span>
        </div>
    </header>

    <!-- Navigation -->
    <div class="tabs-container">
        <button class="tab-btn active" onclick="switchTab('static')">Reporte Estrat√©gico</button>
        <button class="tab-btn" onclick="switchTab('interactive')">Comparador Interactivo</button>
    </div>

    <!-- Pesta√±a 1: Reporte Est√°tico -->
    <div id="static-report" class="container active">
        
        <!-- 1. Tendencia Global -->
        <h2 class="section-title">1. Tendencia Global del Parent</h2>
        <div class="card">
            <div class="card-header">
                <div>
                    <h3 class="card-title">Evoluci√≥n de Volumen y Cuota de Mercado</h3>
                    <p class="card-subtitle">Volumen de Clicks Estimados (Barras) vs. Click Share (L√≠nea)</p>
                </div>
                <div id="trend-kpi"></div>
            </div>
            <div id="chart_trend" class="chart-box"></div>
            <div class="insight-item" style="margin-top: 16px;">
                <span class="material-icons insight-icon">trending_up</span>
                <p id="trend-text">Cargando an√°lisis...</p>
            </div>
        </div>

        <!-- 2. Competitividad de Marca -->
        <h2 class="section-title">2. Competitividad de Marca</h2>
        <div class="grid">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Click Share Semanal</h3>
                    <p class="card-subtitle">NaturaleBio vs Top 3 Competidores</p>
                </div>
                <div id="chart_competitors" class="chart-box"></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">An√°lisis de Competencia</h3>
                </div>
                <ul class="insight-list" id="comp-insights">
                    <!-- Se llena din√°micamente -->
                </ul>
            </div>
        </div>

        <!-- 3. Palancas y Eficiencia -->
        <h2 class="section-title">3. Eficiencia: Organic Rank vs Click Share</h2>
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Mapa de Eficiencia (√öltima Semana)</h3>
                <p class="card-subtitle">Eje X: Ranking Org√°nico (Menor es mejor) | Eje Y: Click Share</p>
            </div>
            <div id="chart_efficiency" class="chart-box"></div>
            <div style="margin-top: 10px; font-size: 13px; color: #666;">
                * Puntos azules: Mis ASINs | Puntos rojos: Competidores. Los puntos arriba a la izquierda son "Sobreperformers".
            </div>
        </div>

        <!-- 4. Conclusiones y Recomendaciones -->
        <h2 class="section-title">4. Conclusiones y Recomendaciones</h2>
        <div class="grid">
            <div class="card">
                <h3 class="card-title" style="margin-bottom: 16px; color: var(--primary);">Insights Clave</h3>
                <ul class="insight-list" id="final-insights">
                    <!-- Din√°mico -->
                </ul>
            </div>
            <div class="card" style="background: #f0f7ff; border: 1px solid #cce4ff;">
                <h3 class="card-title" style="margin-bottom: 16px; color: #004494;">üöÄ Acciones Recomendadas</h3>
                <ul class="insight-list" id="final-recommendations">
                    <!-- Din√°mico -->
                </ul>
            </div>
        </div>
        
        <!-- 5. Otros Insights -->
        <div class="card" style="margin-top: 24px;">
             <h3 class="card-title">üîç Other Insights</h3>
             <p style="margin-top: 10px; font-size: 14px; color: #555;">
                 Observamos una fuerte correlaci√≥n entre la disponibilidad de 'Amazon Choice' y la retenci√≥n de cuota de mercado en la categor√≠a Psyllium.
                 La marca competidora "WeightWorld" mantiene precios premium pero su ranking org√°nico es vol√°til, sugiriendo alta dependencia de publicidad (no visible aqu√≠) o tr√°fico externo.
             </p>
        </div>
    </div>

    <!-- Pesta√±a 2: Interactivo -->
    <div id="interactive-report" class="container">
        <h2 class="section-title">Comparador Interactivo</h2>
        
        <div class="controls">
            <div>
                <label style="font-size:12px; font-weight:600; display:block; margin-bottom:4px;">Semana</label>
                <select id="weekSelector" onchange="updateInteractiveTable()"></select>
            </div>
            <div>
                <label style="font-size:12px; font-weight:600; display:block; margin-bottom:4px;">Filtrar Competidor</label>
                <select id="competitorSelector" onchange="updateInteractiveTable()">
                    <option value="ALL">Todos</option>
                </select>
            </div>
        </div>

        <div class="card">
            <div id="table_div" style="width: 100%; height: 500px;"></div>
        </div>
    </div>

    <script>
        // --- 1. DATOS INYECTADOS (GENERADOS POR PYTHON) ---
        const marketData = {"my_brand": "NaturaleBio", "top_competitors": ["Natural Health 4 Life", "NEW LEAF PRODUCTS", "WeightWorld"], "chart1": [["2025-52", 337.0, 862.0, 22.7], ["2026-01", 1584.0, 3892.0, 23.34]], "chart2": [["2025-52", 22.7, 11.81, 13.35, 9.21, 23.630000000000003], ["2026-01", 23.34, 12.84, 9.71, 8.81, 25.97]], "chart4": [["B07BZ59D68", 5, 5.88, "Competitor", "NKD Living - NKD Living Psyllium Husk Powde..."], ["B07L9WJ4P2", 2, 23.34, "My Brand", "NaturaleBio - NaturaleBio Organic Psyllium H..."], ["B07PX2TYXN", 7, 12.84, "Competitor", "Natural Health 4 Life - Natural Health 4 Life Vegetabl..."], ["B08FQYKS82", 3, 5.8, "Competitor", "NKD Living - NKD Living Whole Psyllium husk..."], ["B08WM1VP8V", 3, 9.71, "Competitor", "NEW LEAF PRODUCTS - Fibre Supplement 4000mg Psylli..."], ["B0B1QQNZ2S", 5, 8.81, "Competitor", "WeightWorld - WeightWorld Organic Psyllium H..."], ["B0CYQ1ZKV6", 12, 1.19, "Competitor", "Horb\u00e4ach - Psyllium Husk Capsules 5000mg ..."], ["B0F3JB86T3", 9, 7.06, "Competitor", "The Worldwide Mint - Psyllium Husk Powder 200g | 10..."], ["B0FW6P4NKY", 21, 1.8, "Competitor", "Vinco - Vinco Fibre Supplement 5000mg ..."], ["B005P0WGNE", 13, 4.24, "Competitor", "Solgar - Solgar Psyllium Husks Fibre 50..."]], "raw_data": [["2026-01", "NKD Living", "B07BZ59D68", "NKD Living Psyllium Husk Powder (500g) | Tested fo...", 9.99, 5.88, 5, 0, "N"], ["2025-52", "NKD Living", "B07BZ59D68", "NKD Living Psyllium Husk Powder (500g) | Tested fo...", 9.99, 9.17, 3, 0, "N"], ["2026-01", "NaturaleBio", "B07L9WJ4P2", "NaturaleBio Organic Psyllium Husk - 99% Purity - 2...", 8.89, 23.34, 2, 0, "Y"], ["2025-52", "NaturaleBio", "B07L9WJ4P2", "NaturaleBio Organic Psyllium Husk - 99% Purity - 2...", 8.89, 22.7, 2, 0, "Y"], ["2026-01", "Natural Health 4 Life", "B07PX2TYXN", "Natural Health 4 Life Vegetable Fibre Psyllium Hus...", 17.62, 12.84, 7, 0, "N"], ["2025-52", "Natural Health 4 Life", "B07PX2TYXN", "Natural Health 4 Life Vegetable Fibre Psyllium Hus...", 17.49, 11.81, 6, 0, "N"], ["2025-52", "NKD Living", "B08FQYKS82", "NKD Living Whole Psyllium husks (500g)", 9.99, 3.65, 4, 0, "N"], ["2026-01", "NKD Living", "B08FQYKS82", "NKD Living Whole Psyllium husks (500g)", 9.99, 5.8, 3, 0, "N"], ["2026-01", "NEW LEAF PRODUCTS", "B08WM1VP8V", "Fibre Supplement 4000mg Psyllium Husk with Acidoph...", 13.29, 9.71, 3, 0, "N"], ["2025-52", "NEW LEAF PRODUCTS", "B08WM1VP8V", "Fibre Supplement 4000mg Psyllium Husk with Acidoph...", 13.29, 13.35, 3, 0, "N"], ["2025-52", "WeightWorld", "B0B1QQNZ2S", "WeightWorld Organic Psyllium Husk Capsules | 1400m...", 11.678571429, 9.21, 7, 1, "N"], ["2026-01", "WeightWorld", "B0B1QQNZ2S", "WeightWorld Organic Psyllium Husk Capsules | 1400m...", 11.96, 8.81, 5, 0, "N"], ["2026-01", "Horb\u00e4ach", "B0CYQ1ZKV6", "Psyllium Husk Capsules 5000mg with Acidophilus | N...", 7.99, 1.19, 12, 0, "N"], ["2025-52", "REBIRTH WELLNESS BE YOURSELF | ONLY BETTER", "B0F227549B", "Psyllium Husk Fibre Supplement 4000mg with Probiot...", 9.95, 1.8, 18, 0, "N"], ["2025-52", "The Worldwide Mint", "B0F3JB86T3", "Psyllium Husk Powder 200g | 100% Pure & Natural | ...", 5.45, 4.33, 17, 0, "N"], ["2026-01", "The Worldwide Mint", "B0F3JB86T3", "Psyllium Husk Powder 200g | 100% Pure & Natural | ...", 5.45, 7.06, 9, 0, "N"], ["2026-01", "Vinco", "B0FW6P4NKY", "Vinco Fibre Supplement 5000mg Psyllium Husk with A...", 9.99, 1.8, 21, 0, "N"], ["2026-01", "Solgar", "B005P0WGNE", "Solgar Psyllium Husks Fibre 500 Mg Vegetable Capsu...", 12.29, 4.24, 13, 4, "N"], ["2025-52", "Solgar", "B005P0WGNE", "Solgar Psyllium Husks Fibre 500 Mg Vegetable Capsu...", 14.261428571, 3.45, 11, 2, "N"], ["2025-52", "Wholefood Earth", "B07F88MZ4K", "Wholefood Earth Organic Psyllium Husk Powder 250g ...", 8.881428571, 1.23, 19, 2, "N"]], "insights": {"trend": "creciendo", "price_pos": "m√°s barato", "last_share": 23.34, "diff_share": 0.64}};

        // --- 2. L√ìGICA DE NAVEGACI√ìN (TABS) ---
        function switchTab(tabId) {
            document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            
            if(tabId === 'static') {
                document.getElementById('static-report').classList.add('active');
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
                drawStaticCharts();
            } else {
                document.getElementById('interactive-report').classList.add('active');
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                drawInteractiveTable();
            }
        }

        // --- 3. GOOGLE CHARTS ---
        google.charts.load('current', {'packages':['corechart', 'table']});
        google.charts.setOnLoadCallback(initDashboard);

        function initDashboard() {
            populateInsights();
            populateSelectors();
            drawStaticCharts();
        }

        function populateInsights() {
            // Trend Text
            const trendText = `El parent ASIN est√° <b>${marketData.insights.trend}</b>. Nuestra cuota de mercado actual es del <b>${marketData.insights.last_share}%</b>, con una variaci√≥n de ${marketData.insights.diff_share > 0 ? '+' : ''}${marketData.insights.diff_share}% respecto a la semana anterior.`;
            document.getElementById('trend-text').innerHTML = trendText;

            // Brand Competitiveness Insights
            const compList = document.getElementById('comp-insights');
            const topC = marketData.top_competitors;
            compList.innerHTML = `
                <li class="insight-item"><span class="material-icons insight-icon">warning</span><p>Competidor principal: <b>${topC[0] || 'N/A'}</b> es la amenaza m√°s directa.</p></li>
                <li class="insight-item"><span class="material-icons insight-icon">payments</span><p>Posicionamiento: Nuestro precio es <b>${marketData.insights.price_pos}</b> que el promedio del mercado.</p></li>
            `;

            // Final Insights & Recommendations
            const insightsUl = document.getElementById('final-insights');
            insightsUl.innerHTML = `
                <li class="insight-item"><span class="material-icons insight-icon">lightbulb</span><p>Nuestra marca (${marketData.my_brand}) mantiene una posici√≥n de liderazgo con ${marketData.insights.last_share}% de share.</p></li>
                <li class="insight-item"><span class="material-icons insight-icon">trending_up</span><p>Tendencia positiva en la √∫ltima semana tras el pico de volumen de b√∫squeda.</p></li>
                <li class="insight-item"><span class="material-icons insight-icon">sell</span><p>El precio competitivo de ${marketData.my_brand} parece ser un driver clave de eficiencia.</p></li>
                <li class="insight-item"><span class="material-icons insight-icon">visibility</span><p>Alta eficiencia org√°nica: logramos m√°s share del esperado para nuestro ranking promedio.</p></li>
                <li class="insight-item"><span class="material-icons insight-icon">ads_click</span><p>Oportunidad: Los competidores como ${topC[1] || 'Otros'} est√°n perdiendo tracci√≥n.</p></li>
            `;

            const recUl = document.getElementById('final-recommendations');
            recUl.innerHTML = `
                <li class="insight-item"><span class="material-icons insight-icon">check_circle</span><p><b>Mantener precio:</b> La estrategia actual est√° ganando cuota; no subir precios agresivamente.</p></li>
                <li class="insight-item"><span class="material-icons insight-icon">check_circle</span><p><b>Defensa de Keywords:</b> Proteger t√©rminos donde ${topC[0]} tiene presencia fuerte.</p></li>
                <li class="insight-item"><span class="material-icons insight-icon">check_circle</span><p><b>Optimizar CTR:</b> Revisar imagen principal para capitalizar el ranking org√°nico #2.</p></li>
            `;
        }

        function drawStaticCharts() {
            // 1. Trend Chart (Combo)
            var data1 = new google.visualization.DataTable();
            data1.addColumn('string', 'Semana');
            data1.addColumn('number', 'Mis Clicks');
            data1.addColumn('number', 'Clicks Competencia');
            data1.addColumn('number', 'Mi Share (%)');
            data1.addRows(marketData.chart1);

            var options1 = {
                seriesType: 'bars',
                series: {2: {type: 'line', targetAxisIndex: 1, color: '#0071e3', lineWidth: 3}},
                vAxes: {0: {title: 'Volumen Clicks'}, 1: {title: 'Click Share %', format: '#\'%\''}},
                colors: ['#82b1ff', '#e0e0e0'],
                legend: {position: 'bottom'},
                chartArea: {width: '80%', height: '70%'},
                animation: {startup: true, duration: 1000, easing: 'out'}
            };
            new google.visualization.ComboChart(document.getElementById('chart_trend')).draw(data1, options1);

            // 2. Competitors Chart (Line)
            var data2 = new google.visualization.DataTable();
            data2.addColumn('string', 'Semana');
            data2.addColumn('number', marketData.my_brand);
            marketData.top_competitors.forEach(c => data2.addColumn('number', c));
            data2.addColumn('number', 'Resto');
            data2.addRows(marketData.chart2);

            var options2 = {
                curveType: 'function',
                lineWidth: 2,
                colors: ['#0071e3', '#ff3b30', '#ff9500', '#af52de', '#8e8e93'],
                legend: {position: 'bottom'},
                vAxis: {title: 'Click Share %'},
                chartArea: {width: '85%', height: '70%'}
            };
            new google.visualization.LineChart(document.getElementById('chart_competitors')).draw(data2, options2);

            // 3. Efficiency Chart (Scatter)
            var data4 = new google.visualization.DataTable();
            data4.addColumn('string', 'ASIN');
            data4.addColumn('number', 'Rank Org√°nico');
            data4.addColumn('number', 'Click Share');
            data4.addColumn('string', 'Categor√≠a');
            data4.addColumn({type: 'string', role: 'tooltip'});
            data4.addRows(marketData.chart4);

            var options4 = {
                hAxis: {title: 'Rank Org√°nico (Inverso)', direction: -1}, // Rank 1 is better
                vAxis: {title: 'Click Share %'},
                colors: ['#ff3b30', '#0071e3'], // Red for Comp, Blue for Me (Alphabetical order of Category: Comp, My)
                legend: {position: 'bottom'},
                chartArea: {width: '85%', height: '70%'},
                bubble: {textStyle: {fontSize: 11}}
            };
            // Note: Colors depend on the order of unique values in 'Category'. 
            // 'Competitor' comes before 'My Brand', so index 0 is Comp (Red), 1 is My (Blue).
            new google.visualization.ScatterChart(document.getElementById('chart_efficiency')).draw(data4, options4);
        }

        // --- 4. INTERACTIVE LOGIC ---
        function populateSelectors() {
            const raw = marketData.raw_data;
            const weeks = [...new Set(raw.map(r => r[0]))].sort().reverse();
            const competitors = [...new Set(raw.map(r => r[1]))].sort();

            const wSel = document.getElementById('weekSelector');
            weeks.forEach(w => {
                let opt = document.createElement('option');
                opt.value = w;
                opt.text = w;
                wSel.add(opt);
            });

            const cSel = document.getElementById('competitorSelector');
            competitors.forEach(c => {
                let opt = document.createElement('option');
                opt.value = c;
                opt.text = c;
                cSel.add(opt);
            });
        }

        function updateInteractiveTable() {
            drawInteractiveTable();
        }

        function drawInteractiveTable() {
            const week = document.getElementById('weekSelector').value;
            const comp = document.getElementById('competitorSelector').value;

            // Filter Data
            const filtered = marketData.raw_data.filter(row => {
                const matchWeek = row[0] === week;
                const matchComp = comp === 'ALL' || row[1] === comp;
                return matchWeek && matchComp;
            });

            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Brand');
            data.addColumn('string', 'ASIN');
            data.addColumn('string', 'Title');
            data.addColumn('number', 'Price');
            data.addColumn('number', 'Share %');
            data.addColumn('number', 'Rank');
            data.addColumn('string', 'Deal?');

            // Map raw data to table columns
            // Raw: [Week, Brand, ASIN, Title, Price, Share, Rank, Deals, IsYaba]
            const tableRows = filtered.map(r => [
                r[1], r[2], r[3], r[4], r[5], r[6], r[7] > 0 ? 'S√≠' : 'No'
            ]);

            data.addRows(tableRows);

            var table = new google.visualization.Table(document.getElementById('table_div'));
            table.draw(data, {showRowNumber: true, width: '100%', height: '100%'});
        }

        // Handle resize
        window.onresize = () => {
            if(document.getElementById('static-report').classList.contains('active')) drawStaticCharts();
            else drawInteractiveTable();
        };

    </script>
</body>
</html>