<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Inteligencia de Mercado - Parent ASIN</title>
    
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Google Charts -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
        :root {
            --primary-color: #4285F4; /* Google Blue */
            --secondary-color: #34A853; /* Google Green */
            --danger-color: #EA4335; /* Google Red */
            --warning-color: #FBBC05; /* Google Yellow */
            --text-main: #202124;
            --text-muted: #5f6368;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --border-radius: 12px;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: var(--card-bg);
            padding: 20px 0;
            margin-bottom: 24px;
            box-shadow: 0 1px 2px rgba(60,64,67,0.3), 0 2px 6px 2px rgba(60,64,67,0.15);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 22px;
            margin: 0;
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .badge {
            background: var(--primary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 20px;
        }

        .tab-btn {
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 500;
            color: var(--text-muted);
            cursor: pointer;
            padding: 10px 0;
            position: relative;
            transition: color 0.3s;
        }

        .tab-btn.active {
            color: var(--primary-color);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary-color);
            border-radius: 3px 3px 0 0;
        }

        /* Content Sections */
        .section {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            transition: all 0.3s cubic-bezier(.25,.8,.25,1);
        }

        .card:hover {
            box-shadow: 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 500;
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Grid */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
        }

        @media (max-width: 768px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
        }

        /* KPIs */
        .kpi-box {
            text-align: center;
            padding: 16px;
            background: #f1f3f4;
            border-radius: 8px;
        }
        .kpi-val { font-size: 24px; font-weight: bold; color: var(--primary-color); }
        .kpi-label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; margin-top: 4px; }

        /* Controls for Interactive Tab */
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        select {
            padding: 10px 16px;
            border-radius: 4px;
            border: 1px solid #dadce0;
            font-size: 14px;
            background: white;
            flex: 1;
        }

        /* Insight Lists */
        ul.insights-list {
            padding-left: 20px;
            margin: 0;
        }
        ul.insights-list li {
            margin-bottom: 10px;
            line-height: 1.5;
            color: #3c4043;
        }
        .insight-positive { color: var(--secondary-color); font-weight: 500; }
        .insight-negative { color: var(--danger-color); font-weight: 500; }

        /* Chart Containers */
        .chart-container {
            width: 100%;
            min-height: 350px;
        }
        
        .recommendation-card {
            border-left: 4px solid var(--secondary-color);
            background: #e6f4ea;
        }
    </style>
</head>
<body>

<header>
    <div class="header-content">
        <div>
            <h1>
                <span class="material-icons" style="color: var(--primary-color);">analytics</span>
                Reporte de Mercado
                <span class="badge" id="brand-badge">Cargando...</span>
            </h1>
        </div>
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('static')">Reporte Estrat칠gico</button>
            <button class="tab-btn" onclick="switchTab('interactive')">Comparador Interactivo</button>
        </div>
    </div>
</header>

<div class="container">

    <!-- TAB 1: REPORTE EST츼TICO -->
    <div id="static" class="section active">
        
        <!-- Summary KPIs -->
        <div class="card">
            <div class="grid-3" id="kpi-container">
                <!-- Injected via JS -->
            </div>
        </div>

        <!-- 1. Tendencia Global -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <span class="material-icons">show_chart</span>
                    1. Tendencia Global del Parent
                </div>
            </div>
            <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 15px;">
                An치lisis de volumen total de tr치fico (estimado) y cuota de mercado comparada.
            </p>
            <div id="trend_chart" class="chart-container"></div>
            <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                <strong>游늸 An치lisis de Tendencia:</strong>
                <span id="trend-analysis-text">Calculando...</span>
            </div>
        </div>

        <!-- 2. Competitividad de Marca -->
        <div class="card">
            <div class="card-header">
                <div class="card-title">
                    <span class="material-icons">pie_chart</span>
                    2. Competitividad de Marca (Share of Click)
                </div>
            </div>
            <div id="brand_chart" class="chart-container"></div>
        </div>

        <div class="grid-2">
            <!-- 3. Palancas -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="material-icons">tune</span>
                        3. Palancas & Promociones
                    </div>
                </div>
                <div id="drivers_chart" class="chart-container"></div>
            </div>

            <!-- 4. Eficiencia -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="material-icons">scatter_plot</span>
                        4. Eficiencia: Rank vs Click Share
                    </div>
                </div>
                <div id="efficiency_chart" class="chart-container"></div>
            </div>
        </div>

        <!-- 5. Insights y Recomendaciones -->
        <div class="grid-2">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="material-icons">lightbulb</span>
                        5. Insights Clave
                    </div>
                </div>
                <ul class="insights-list" id="insights-list">
                    <!-- Populated by JS -->
                </ul>
            </div>

            <div class="card recommendation-card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="material-icons">verified</span>
                        Recomendaciones Accionables
                    </div>
                </div>
                <ul class="insights-list" id="recommendations-list">
                    <!-- Populated by JS -->
                </ul>
            </div>
        </div>
    </div>

    <!-- TAB 2: COMPARADOR INTERACTIVO -->
    <div id="interactive" class="section">
        <div class="controls">
            <div>
                <label style="display:block; font-size: 12px; margin-bottom: 4px; color: var(--text-muted);">Semana</label>
                <select id="week-select" onchange="updateInteractive()">
                    <option value="all">Promedio Global</option>
                </select>
            </div>
            <div>
                <label style="display:block; font-size: 12px; margin-bottom: 4px; color: var(--text-muted);">Comparar Nosotros vs.</label>
                <select id="comp-select" onchange="updateInteractive()"></select>
            </div>
        </div>

        <div class="grid-2">
            <div class="card">
                <div class="card-title" style="margin-bottom: 10px;">Comparativa de Precios</div>
                <div id="int_price_chart" style="height: 300px;"></div>
            </div>
            <div class="card">
                <div class="card-title" style="margin-bottom: 10px;">Cuota de Mercado (Share)</div>
                <div id="int_share_chart" style="height: 300px;"></div>
            </div>
        </div>
        
        <div class="card">
             <div class="card-title" style="margin-bottom: 10px;">Tabla Detallada de Variantes</div>
             <div id="table_div"></div>
        </div>
    </div>

</div>

<!-- DATA INJECTION -->
<script>
    // DATA PROCESSED FROM CSV
    const marketData = [{"week_date":"2025-52","parent_asin":"Matcha Premium","asin":"B06XQ5DCYJ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":11.66,"average_organic_rank":2.0,"price":15.058571429,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":5562.759796,"keywords":"matcha"},{"week_date":"2025-52","parent_asin":"Matcha Premium","asin":"B06XQ69YCQ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":3.75,"average_organic_rank":4.0,"price":10.538571429,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":1789.05225,"keywords":"matcha"},{"week_date":"2025-52","parent_asin":"Matcha Premium","asin":"B079VQ52MK","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":3.49,"average_organic_rank":5.0,"price":24.855714286,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":1665.011294,"keywords":"matcha"},{"week_date":"2025-52","parent_asin":"Matcha Premium","asin":"B07K1WBH4K","product_title":"VAHDAM, Vanille Matcha Gr\u00fcner Tee Pulver (100g, 50...","competitor_brand":"VAHDAM","is_yaba_asin":"N","click_share":1.47,"average_organic_rank":20.0,"price":9.895714286,"weekly_number_of_days_with_deal":3.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":701.308482,"keywords":"matcha"},{"week_date":"2025-52","parent_asin":"Matcha Premium","asin":"B07MD4LB49","product_title":"VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A...","competitor_brand":"VAHDAM","is_yaba_asin":"N","click_share":4.19,"average_organic_rank":7.0,"price":9.895714286,"weekly_number_of_days_with_deal":3.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":1998.967714,"keywords":"matcha"},{"week_date":"2025-52","parent_asin":"Matcha Premium","asin":"B07SZFD3P9","product_title":"NaturaleBio Matcha Ceremonial Grade 100g. Original...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":2.93,"average_organic_rank":23.0,"price":30.704285714,"weekly_number_of_days_with_deal":1.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":1397.846158,"keywords":"matcha"},{"week_date":"2025-52","parent_asin":"Matcha Premium","asin":"B08XVX8V1T","product_title":"Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...","competitor_brand":"Unknown Brand","is_yaba_asin":"N","click_share":2.44,"average_organic_rank":10.0,"price":12.367142857,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":1164.076664,"keywords":"matcha"},{"week_date":"2025-52","parent_asin":"Matcha Premium","asin":"B08XVX8V1T","product_title":"Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...","competitor_brand":"bioKontor","is_yaba_asin":"N","click_share":2.44,"average_organic_rank":10.0,"price":12.367142857,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":1164.076664,"keywords":"matcha"},{"week_date":"2025-52","parent_asin":"Matcha Premium","asin":"B0CNRX8G5S","product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","competitor_brand":"NORITUAL LAB","is_yaba_asin":"N","click_share":18.77,"average_organic_rank":2.0,"price":24.648571429,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":7.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":8954.802862,"keywords":"matcha"},{"week_date":"2025-52","parent_asin":"Matcha Premium","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...","competitor_brand":"Unknown Brand","is_yaba_asin":"N","click_share":3.4,"average_organic_rank":13.0,"price":10.71,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":7.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":1622.07404,"keywords":"matcha"},{"week_date":"2025-52","parent_asin":"Matcha Premium","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...","competitor_brand":"Special Leaves","is_yaba_asin":"N","click_share":3.4,"average_organic_rank":13.0,"price":10.71,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":7.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":1622.07404,"keywords":"matcha"},{"week_date":"2025-52","parent_asin":"Matcha Premium","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","competitor_brand":"Unknown Brand","is_yaba_asin":"N","click_share":8.42,"average_organic_rank":6.0,"price":16.037142857,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":4017.018652,"keywords":"matcha"},{"week_date":"2025-52","parent_asin":"Matcha Premium","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","competitor_brand":"NORITUAL LAB","is_yaba_asin":"N","click_share":8.42,"average_organic_rank":6.0,"price":16.037142857,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":4017.018652,"keywords":"matcha"},{"week_date":"2026-01","parent_asin":"Matcha Premium","asin":"B06XQ5DCYJ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":12.9,"average_organic_rank":2.0,"price":14.6075,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":3484.4319,"keywords":"matcha"},{"week_date":"2026-01","parent_asin":"Matcha Premium","asin":"B06XQ69YCQ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":3.35,"average_organic_rank":5.0,"price":10.2225,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":904.87185,"keywords":"matcha"},{"week_date":"2026-01","parent_asin":"Matcha Premium","asin":"B079VQ52MK","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":3.66,"average_organic_rank":5.0,"price":24.5275,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":988.60626,"keywords":"matcha"},{"week_date":"2026-01","parent_asin":"Matcha Premium","asin":"B07MD4LB49","product_title":"VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A...","competitor_brand":"VAHDAM","is_yaba_asin":"N","click_share":3.15,"average_organic_rank":9.0,"price":10.43,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":850.84965,"keywords":"matcha"},{"week_date":"2026-01","parent_asin":"Matcha Premium","asin":"B07SZFD3P9","product_title":"NaturaleBio Matcha Ceremonial Grade 100g. Original...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":2.68,"average_organic_rank":0.0,"price":30.27,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":723.89748,"keywords":"matcha"},{"week_date":"2026-01","parent_asin":"Matcha Premium","asin":"B08XVX8V1T","product_title":"Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...","competitor_brand":"bioKontor","is_yaba_asin":"N","click_share":2.39,"average_organic_rank":10.0,"price":11.9975,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":645.56529,"keywords":"matcha"},{"week_date":"2026-01","parent_asin":"Matcha Premium","asin":"B08XVX8V1T","product_title":"Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...","competitor_brand":"Unknown Brand","is_yaba_asin":"N","click_share":2.39,"average_organic_rank":10.0,"price":11.9975,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":645.56529,"keywords":"matcha"},{"week_date":"2026-01","parent_asin":"Matcha Premium","asin":"B0CNRX8G5S","product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","competitor_brand":"NORITUAL LAB","is_yaba_asin":"N","click_share":19.34,"average_organic_rank":2.0,"price":23.91,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":4.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":5223.94674,"keywords":"matcha"},{"week_date":"2026-01","parent_asin":"Matcha Premium","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...","competitor_brand":"Special Leaves","is_yaba_asin":"N","click_share":3.0,"average_organic_rank":16.0,"price":10.39,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":4.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":810.333,"keywords":"matcha"},{"week_date":"2026-01","parent_asin":"Matcha Premium","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...","competitor_brand":"Unknown Brand","is_yaba_asin":"N","click_share":3.0,"average_organic_rank":16.0,"price":10.39,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":4.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":810.333,"keywords":"matcha"},{"week_date":"2026-01","parent_asin":"Matcha Premium","asin":"B0F9B1LWQQ","product_title":"UNREAL\u00ae 100g Ceremonial Bio Matcha \u2013 100% Japanisc...","competitor_brand":"Unknown Brand","is_yaba_asin":"N","click_share":1.57,"average_organic_rank":19.0,"price":31.2725,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":424.07427,"keywords":"matcha"},{"week_date":"2026-01","parent_asin":"Matcha Premium","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","competitor_brand":"NORITUAL LAB","is_yaba_asin":"N","click_share":7.38,"average_organic_rank":6.0,"price":15.5575,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":1993.41918,"keywords":"matcha"},{"week_date":"2026-01","parent_asin":"Matcha Premium","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","competitor_brand":"Unknown Brand","is_yaba_asin":"N","click_share":7.38,"average_organic_rank":6.0,"price":15.5575,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":1993.41918,"keywords":"matcha"},{"week_date":"2025-51","parent_asin":"Matcha Premium","asin":"B06XQ5DCYJ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":11.18,"average_organic_rank":2.0,"price":14.084285714,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":6803.60018,"keywords":"matcha"},{"week_date":"2025-51","parent_asin":"Matcha Premium","asin":"B06XQ69YCQ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":3.85,"average_organic_rank":5.0,"price":9.2,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":2342.92135,"keywords":"matcha"},{"week_date":"2025-51","parent_asin":"Matcha Premium","asin":"B079VQ52MK","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":3.69,"average_organic_rank":5.0,"price":23.075714286,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":2245.55319,"keywords":"matcha"},{"week_date":"2025-51","parent_asin":"Matcha Premium","asin":"B07MD4LB49","product_title":"VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A...","competitor_brand":"VAHDAM","is_yaba_asin":"N","click_share":3.49,"average_organic_rank":8.0,"price":9.005714286,"weekly_number_of_days_with_deal":5.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":2123.84299,"keywords":"matcha"},{"week_date":"2025-51","parent_asin":"Matcha Premium","asin":"B07SZFD3P9","product_title":"NaturaleBio Matcha Ceremonial Grade 100g. Original...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":2.95,"average_organic_rank":22.0,"price":26.748571429,"weekly_number_of_days_with_deal":7.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":1795.22545,"keywords":"matcha"},{"week_date":"2025-51","parent_asin":"Matcha Premium","asin":"B0CNRX8G5S","product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","competitor_brand":"NORITUAL LAB","is_yaba_asin":"N","click_share":16.66,"average_organic_rank":2.0,"price":24.03,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":7.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":10138.45966,"keywords":"matcha"},{"week_date":"2025-51","parent_asin":"Matcha Premium","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...","competitor_brand":"Special Leaves","is_yaba_asin":"N","click_share":3.48,"average_organic_rank":14.0,"price":10.44,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":7.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":2117.75748,"keywords":"matcha"},{"week_date":"2025-51","parent_asin":"Matcha Premium","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...","competitor_brand":"Unknown Brand","is_yaba_asin":"N","click_share":3.48,"average_organic_rank":14.0,"price":10.44,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":7.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":2117.75748,"keywords":"matcha"},{"week_date":"2025-51","parent_asin":"Matcha Premium","asin":"B0F5BVFRC1","product_title":"Jean & Len Handcreme I Love You So Matcha, f\u00fcr nor...","competitor_brand":"Unknown Brand","is_yaba_asin":"N","click_share":1.92,"average_organic_rank":12.0,"price":3.095714286,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":1168.41792,"keywords":"matcha"},{"week_date":"2025-51","parent_asin":"Matcha Premium","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","competitor_brand":"Unknown Brand","is_yaba_asin":"N","click_share":8.85,"average_organic_rank":5.0,"price":15.635714286,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":5385.67635,"keywords":"matcha"},{"week_date":"2025-51","parent_asin":"Matcha Premium","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","competitor_brand":"NORITUAL LAB","is_yaba_asin":"N","click_share":8.85,"average_organic_rank":5.0,"price":15.635714286,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":5385.67635,"keywords":"matcha"},{"week_date":"2025-51","parent_asin":"Matcha Premium","asin":"B0G1T7N675","product_title":"Ceremonial Matcha Pulver BIO-Qualit\u00e4t 50g ideal zu...","competitor_brand":"Unknown Brand","is_yaba_asin":"N","click_share":2.56,"average_organic_rank":12.0,"price":8.898571429,"weekly_number_of_days_with_deal":7.0,"weekly_number_of_days_with_coupon":0.0,"weekly_number_of_days_with_best_seller_badge":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"estimated_clicks":1557.89056,"keywords":"matcha"}];

    // GLOBAL STATE
    let OUR_BRAND = "";
    let TOP_COMPETITORS = [];
    const WEEKS = [...new Set(marketData.map(d => d.week_date))].sort();

    google.charts.load('current', {'packages':['corechart', 'table']});
    google.charts.setOnLoadCallback(init);

    function init() {
        identifyBrands();
        populateControls();
        drawStaticDashboard();
        switchTab('static');
    }

    function switchTab(tabId) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        document.querySelector(`button[onclick="switchTab('${tabId}')"]`).classList.add('active');
        
        // Redraw if invisible issues occur
        if(tabId === 'interactive') updateInteractive();
    }

    function identifyBrands() {
        const ourAsins = marketData.filter(d => d.is_yaba_asin === 'Y');
        if (ourAsins.length > 0) {
            OUR_BRAND = ourAsins[0].competitor_brand;
        } else {
            OUR_BRAND = "Nuestra Marca";
        }
        document.getElementById('brand-badge').textContent = OUR_BRAND;

        // Identify Top 3 Competitors by Avg Share
        const brandShares = {};
        marketData.forEach(d => {
            const b = d.competitor_brand;
            if (b !== OUR_BRAND && b !== "Unknown Brand") {
                if (!brandShares[b]) brandShares[b] = 0;
                brandShares[b] += d.click_share;
            }
        });
        
        // Sort
        TOP_COMPETITORS = Object.entries(brandShares)
            .sort((a,b) => b[1] - a[1])
            .slice(0, 3)
            .map(e => e[0]);
    }

    function populateControls() {
        const wSelect = document.getElementById('week-select');
        WEEKS.forEach(w => {
            const opt = document.createElement('option');
            opt.value = w;
            opt.innerText = w;
            wSelect.appendChild(opt);
        });
        // Select last week by default
        if(WEEKS.length > 0) wSelect.value = WEEKS[WEEKS.length-1];

        const cSelect = document.getElementById('comp-select');
        const allComps = [...new Set(marketData.filter(d => d.is_yaba_asin === 'N').map(d => d.competitor_brand))].sort();
        allComps.forEach(c => {
            if(c !== "Unknown Brand") {
                const opt = document.createElement('option');
                opt.value = c;
                opt.innerText = c;
                cSelect.appendChild(opt);
            }
        });
        // Select top competitor by default
        if(TOP_COMPETITORS.length > 0) cSelect.value = TOP_COMPETITORS[0];
    }

    // --- CHART FUNCTIONS ---

    function drawStaticDashboard() {
        drawKPIs();
        drawTrendChart();
        drawBrandChart();
        drawDriversChart();
        drawEfficiencyChart();
        generateInsights();
    }

    function drawKPIs() {
        const lastWeek = WEEKS[WEEKS.length - 1];
        const prevWeek = WEEKS.length > 1 ? WEEKS[WEEKS.length - 2] : null;

        const currentData = marketData.filter(d => d.week_date === lastWeek && d.is_yaba_asin === 'Y');
        const prevData = prevWeek ? marketData.filter(d => d.week_date === prevWeek && d.is_yaba_asin === 'Y') : [];

        const curShare = currentData.reduce((sum, d) => sum + d.click_share, 0);
        const prevShare = prevData.reduce((sum, d) => sum + d.click_share, 0);
        
        const curClicks = currentData.reduce((sum, d) => sum + d.estimated_clicks, 0);
        const prevClicks = prevData.reduce((sum, d) => sum + d.estimated_clicks, 0);

        const diffShare = (curShare - prevShare).toFixed(2);
        const diffClicks = prevClicks > 0 ? ((curClicks - prevClicks)/prevClicks * 100).toFixed(1) : 0;

        const html = `
            <div class="kpi-box">
                <div class="kpi-val">${curShare.toFixed(2)}%</div>
                <div class="kpi-label">Click Share (${lastWeek})</div>
                <div style="font-size:12px; color: ${diffShare >= 0 ? 'green' : 'red'}">${diffShare > 0 ? '+' : ''}${diffShare} pts vs prev</div>
            </div>
            <div class="kpi-box">
                <div class="kpi-val">${Math.round(curClicks).toLocaleString()}</div>
                <div class="kpi-label">Est. Clicks (${lastWeek})</div>
                <div style="font-size:12px; color: ${diffClicks >= 0 ? 'green' : 'red'}">${diffClicks > 0 ? '+' : ''}${diffClicks}% vs prev</div>
            </div>
            <div class="kpi-box">
                <div class="kpi-val">${currentData.length}</div>
                <div class="kpi-label">Active ASINs</div>
            </div>
        `;
        document.getElementById('kpi-container').innerHTML = html;
    }

    function drawTrendChart() {
        // Prepare Data: Week | Us Clicks | Comp Clicks | Us Share (Line)
        const agg = {};
        WEEKS.forEach(w => agg[w] = { us: 0, comp: 0, total: 0 });

        marketData.forEach(d => {
            if (d.is_yaba_asin === 'Y') agg[d.week_date].us += d.estimated_clicks;
            else agg[d.week_date].comp += d.estimated_clicks;
            agg[d.week_date].total += d.estimated_clicks;
        });

        const dataArr = [['Week', 'Nuestros Clicks', 'Clicks Competencia', 'Nuestra Share (%)']];
        WEEKS.forEach(w => {
            const share = agg[w].total > 0 ? (agg[w].us / agg[w].total) * 100 : 0;
            dataArr.push([w, agg[w].us, agg[w].comp, share]);
        });

        const data = google.visualization.arrayToDataTable(dataArr);
        const options = {
            seriesType: 'bars',
            series: { 2: { type: 'line', targetAxisIndex: 1, color: '#4285F4', lineWidth: 3 } },
            vAxes: { 0: { title: 'Volumen Clicks' }, 1: { title: 'Click Share %', format: '#\'%\'' } },
            colors: ['#8AB4F8', '#E8EAED'],
            legend: { position: 'bottom' },
            chartArea: { width: '80%', height: '70%' },
            animation: { startup: true, duration: 1000, easing: 'out' }
        };

        const chart = new google.visualization.ComboChart(document.getElementById('trend_chart'));
        chart.draw(data, options);

        // Simple Text Analysis
        const lastW = WEEKS[WEEKS.length-1];
        const firstW = WEEKS[0];
        const trend = agg[lastW].us > agg[firstW].us ? "alcista" : "bajista";
        document.getElementById('trend-analysis-text').innerText = 
            `La tendencia de clicks propios es ${trend} desde la semana ${firstW}. En la 칰ltima semana (${lastW}), nuestra cuota es del ${(agg[lastW].us/agg[lastW].total*100).toFixed(1)}%.`;
    }

    function drawBrandChart() {
        // Week | Our Brand | Comp 1 | Comp 2 | Comp 3 | Others
        const header = ['Week', OUR_BRAND, ...TOP_COMPETITORS, 'Resto'];
        const dataMap = {};

        WEEKS.forEach(w => {
            dataMap[w] = {};
            header.slice(1).forEach(h => dataMap[w][h] = 0);
        });

        marketData.forEach(d => {
            const w = d.week_date;
            let brand = d.competitor_brand;
            
            if (brand === OUR_BRAND) {
                dataMap[w][OUR_BRAND] += d.click_share;
            } else if (TOP_COMPETITORS.includes(brand)) {
                dataMap[w][brand] += d.click_share;
            } else {
                dataMap[w]['Resto'] += d.click_share;
            }
        });

        const dataArr = [header];
        WEEKS.forEach(w => {
            const row = [w];
            header.slice(1).forEach(h => row.push(dataMap[w][h]));
            dataArr.push(row);
        });

        const data = google.visualization.arrayToDataTable(dataArr);
        const options = {
            curveType: 'function',
            legend: { position: 'bottom' },
            colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853', '#9AA0A6'],
            lineWidth: 2,
            vAxis: { title: 'Click Share (%)' },
            chartArea: { width: '85%', height: '70%' }
        };

        const chart = new google.visualization.LineChart(document.getElementById('brand_chart'));
        chart.draw(data, options);
    }

    function drawDriversChart() {
        // Compare Avg Click Share for Our Brand when: Deals Active vs No Deals
        const ourData = marketData.filter(d => d.is_yaba_asin === 'Y');
        
        let dealShareSum = 0, dealCount = 0;
        let noDealShareSum = 0, noDealCount = 0;
        let couponShareSum = 0, couponCount = 0;

        ourData.forEach(d => {
            if (d.weekly_number_of_days_with_deal > 0) {
                dealShareSum += d.click_share;
                dealCount++;
            } else {
                noDealShareSum += d.click_share;
                noDealCount++;
            }
            if (d.weekly_number_of_days_with_coupon > 0) {
                couponShareSum += d.click_share;
                couponCount++;
            }
        });

        const avgDeal = dealCount > 0 ? dealShareSum / dealCount : 0;
        const avgNoDeal = noDealCount > 0 ? noDealShareSum / noDealCount : 0;
        const avgCoupon = couponCount > 0 ? couponShareSum / couponCount : 0;

        // If no data for deals, avoid empty chart or show 0
        const data = google.visualization.arrayToDataTable([
            ['Estado', 'Avg Click Share', { role: 'style' }],
            ['Base (Sin Deal)', avgNoDeal, '#E8EAED'],
            ['Con Deal', avgDeal, '#34A853'],
            ['Con Cup칩n', avgCoupon, '#FBBC05']
        ]);

        const options = {
            legend: { position: 'none' },
            vAxis: { title: 'Avg Share (%)' },
            chartArea: { width: '70%', height: '70%' }
        };

        const chart = new google.visualization.ColumnChart(document.getElementById('drivers_chart'));
        chart.draw(data, options);
    }

    function drawEfficiencyChart() {
        // Scatter: X = Rank, Y = Share. Series: Us vs Them
        const dataArr = [['Rank', 'Share', { role: 'style' }, {role: 'tooltip'}]];
        
        // Filter last week to avoid noise
        const lastWeek = WEEKS[WEEKS.length-1];
        const subset = marketData.filter(d => d.week_date === lastWeek);

        subset.forEach(d => {
            const color = d.is_yaba_asin === 'Y' ? '#4285F4' : '#EA4335';
            // Invert X axis logic visually later, or just explain Rank 1 is left
            dataArr.push([d.average_organic_rank, d.click_share, `point { fill-color: ${color}; }`, `${d.competitor_brand} (${d.asin}): Rank ${d.average_organic_rank}, Share ${d.click_share}%`]);
        });

        const data = google.visualization.arrayToDataTable(dataArr);
        const options = {
            hAxis: { title: 'Organic Rank (Lower is Better)', direction: -1 }, // Reverse axis
            vAxis: { title: 'Click Share (%)' },
            legend: 'none',
            chartArea: { width: '80%', height: '70%' }
        };

        const chart = new google.visualization.ScatterChart(document.getElementById('efficiency_chart'));
        chart.draw(data, options);
    }

    function generateInsights() {
        const insightsUl = document.getElementById('insights-list');
        const recsUl = document.getElementById('recommendations-list');
        insightsUl.innerHTML = '';
        recsUl.innerHTML = '';

        const lastWeek = WEEKS[WEEKS.length-1];
        const ourLastWeek = marketData.filter(d => d.week_date === lastWeek && d.is_yaba_asin === 'Y');
        const compLastWeek = marketData.filter(d => d.week_date === lastWeek && d.is_yaba_asin === 'N');

        // 1. Price Insight
        const ourAvgPrice = ourLastWeek.reduce((s,d) => s + d.price, 0) / (ourLastWeek.length || 1);
        const compAvgPrice = compLastWeek.reduce((s,d) => s + d.price, 0) / (compLastWeek.length || 1);
        
        const priceDiff = ((ourAvgPrice - compAvgPrice) / compAvgPrice * 100).toFixed(0);
        insightsUl.innerHTML += `<li>Nuestro precio promedio es un <b>${Math.abs(priceDiff)}% ${priceDiff > 0 ? 'mayor' : 'menor'}</b> que la competencia en la 칰ltima semana.</li>`;

        // 2. Share Dominance
        const ourTotalShare = ourLastWeek.reduce((s,d) => s + d.click_share, 0);
        const topCompShare = TOP_COMPETITORS.length > 0 ? 
            marketData.filter(d => d.week_date === lastWeek && d.competitor_brand === TOP_COMPETITORS[0]).reduce((s,d)=>s+d.click_share,0) : 0;
        
        if (ourTotalShare > topCompShare) {
            insightsUl.innerHTML += `<li class="insight-positive">Lideramos la categor칤a con un ${ourTotalShare.toFixed(1)}% de share vs ${topCompShare.toFixed(1)}% del competidor directo.</li>`;
        } else {
            insightsUl.innerHTML += `<li class="insight-negative">Estamos por debajo del l칤der (${TOP_COMPETITORS[0]}) por ${(topCompShare - ourTotalShare).toFixed(1)} puntos de share.</li>`;
            recsUl.innerHTML += `<li>Analizar ASINs top de ${TOP_COMPETITORS[0]} para igualar ofertas o mejorar contenido A+.</li>`;
        }

        // 3. Efficiency
        const badRankGoodShare = ourLastWeek.filter(d => d.average_organic_rank > 10 && d.click_share > 2);
        if (badRankGoodShare.length > 0) {
            insightsUl.innerHTML += `<li>Tenemos ${badRankGoodShare.length} ASINs con alto rendimiento de clicks a pesar de mal ranking (>10). Oportunidad de escalar.</li>`;
            recsUl.innerHTML += `<li>Invertir en PPC agresivo para los ASINs eficientes (ej. ${badRankGoodShare[0].asin}) para mejorar Organic Rank.</li>`;
        }

        // 4. Promo
        const promoActive = ourLastWeek.some(d => d.weekly_number_of_days_with_deal > 0 || d.weekly_number_of_days_with_coupon > 0);
        if (!promoActive) {
            insightsUl.innerHTML += `<li>No se detectaron Deal Days ni Cupones activos en la 칰ltima semana para nuestra marca.</li>`;
            recsUl.innerHTML += `<li>Activar cupones de baja denominaci칩n para recuperar visibilidad en listings estancados.</li>`;
        }

        // 5. Generic Rec
        recsUl.innerHTML += `<li>Revisar precios de las variantes con Rank > 20 para mejorar conversi칩n.</li>`;
    }

    // --- INTERACTIVE SECTION ---

    function updateInteractive() {
        const week = document.getElementById('week-select').value;
        const comp = document.getElementById('comp-select').value;
        
        // Filter Data
        let filtered = marketData;
        if (week !== 'all') filtered = filtered.filter(d => d.week_date === week);
        
        const ourData = filtered.filter(d => d.is_yaba_asin === 'Y');
        const compData = filtered.filter(d => d.competitor_brand === comp);

        if (ourData.length === 0 || compData.length === 0) {
            document.getElementById('int_price_chart').innerHTML = 'Insuficientes datos para esta selecci칩n.';
            return;
        }

        // 1. Price Comparison Chart
        const priceData = [['ASIN', 'Precio', {role:'style'}, {role:'tooltip'}]];
        ourData.forEach(d => priceData.push([d.asin, d.price, '#4285F4', `Nosotros: ${d.price}`]));
        compData.forEach(d => priceData.push([d.asin, d.price, '#EA4335', `${comp}: ${d.price}`]));

        const pChart = new google.visualization.ColumnChart(document.getElementById('int_price_chart'));
        pChart.draw(google.visualization.arrayToDataTable(priceData), { legend: 'none', title: 'Precio por ASIN' });

        // 2. Share Comparison
        const shareData = [['ASIN', 'Share', {role:'style'}]];
        ourData.forEach(d => shareData.push([d.asin, d.click_share, '#4285F4']));
        compData.forEach(d => shareData.push([d.asin, d.click_share, '#EA4335']));

        const sChart = new google.visualization.ColumnChart(document.getElementById('int_share_chart'));
        sChart.draw(google.visualization.arrayToDataTable(shareData), { legend: 'none', title: 'Click Share por ASIN' });

        // 3. Table
        const tableData = new google.visualization.DataTable();
        tableData.addColumn('string', 'ASIN');
        tableData.addColumn('string', 'T칤tulo');
        tableData.addColumn('string', 'Marca');
        tableData.addColumn('number', 'Precio');
        tableData.addColumn('number', 'Rank');
        tableData.addColumn('number', 'Share %');

        [...ourData, ...compData].forEach(d => {
            tableData.addRow([d.asin, d.product_title.substring(0,30)+'...', d.competitor_brand, d.price, d.average_organic_rank, d.click_share]);
        });

        const table = new google.visualization.Table(document.getElementById('table_div'));
        table.draw(tableData, { showRowNumber: true, width: '100%', height: '100%' });
    }

</script>

</body>
</html>