<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Intelligence Report - Parent ASIN Analysis</title>
    <!-- Google Charts Loader -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #4285F4; /* Google Blue */
            --secondary-color: #34A853; /* Google Green */
            --danger-color: #EA4335; /* Google Red */
            --warning-color: #FBBC04; /* Google Yellow */
            --text-main: #202124;
            --text-secondary: #5f6368;
            --bg-light: #f8f9fa;
            --card-shadow: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
        }

        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-light);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header & Tabs */
        header {
            margin-bottom: 24px;
        }
        
        h1 {
            font-size: 24px;
            font-weight: 400;
            color: var(--text-main);
            margin: 0 0 16px 0;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 24px;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Cards & Layout */
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            padding: 24px;
            margin-bottom: 24px;
        }

        .card-title {
            font-size: 18px;
            color: var(--text-main);
            margin-bottom: 16px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        @media (max-width: 768px) {
            .grid-2 { grid-template-columns: 1fr; }
        }

        /* Metrics */
        .kpi-row {
            display: flex;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 24px;
        }

        .kpi-card {
            flex: 1;
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            text-align: center;
        }

        .kpi-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .kpi-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .trend-up { color: var(--secondary-color); font-size: 12px; }
        .trend-down { color: var(--danger-color); font-size: 12px; }

        /* Charts Containers */
        .chart-container {
            width: 100%;
            height: 400px;
        }

        /* Insights Section */
        .insights-list li {
            margin-bottom: 12px;
            color: var(--text-secondary);
        }
        .insights-list strong {
            color: var(--text-main);
        }

        /* Interactive Controls */
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
        }

        select {
            padding: 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 14px;
            flex: 1;
        }

        /* Comparison Table */
        .comp-table {
            width: 100%;
            border-collapse: collapse;
        }
        .comp-table th, .comp-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        .comp-table th {
            color: var(--text-secondary);
            font-weight: 500;
        }
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }
        .badge-deal { background: #FCE8E6; color: #C5221F; }
        .badge-choice { background: #E6F4EA; color: #137333; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Market Intelligence: Parent ASIN Performance</h1>
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('static')">Static Report</button>
            <button class="tab-btn" onclick="switchTab('interactive')">Interactive Comparator</button>
        </div>
    </header>

    <!-- TAB 1: STATIC REPORT -->
    <div id="static-tab" class="tab-content active">
        
        <!-- KPI Row -->
        <div class="kpi-row" id="kpi-container">
            <!-- Injected by JS -->
        </div>

        <!-- Section 1: Global Trend -->
        <div class="card">
            <div class="card-title"><span class="material-icons">trending_up</span> 1. Global Trend (Clicks & Share)</div>
            <div id="chart_global_trend" class="chart-container"></div>
            <p class="text-sm text-gray-600 mt-2" style="font-size: 13px; color: #666;">
                Analysis: The chart separates total clicks (bars) and click share (lines) between Our ASINs vs Competitors.
                Observe if volume growth correlates with share gain.
            </p>
        </div>

        <!-- Section 2: Brand Competitiveness -->
        <div class="card">
            <div class="card-title"><span class="material-icons">pie_chart</span> 2. Brand Competitiveness (Top 3)</div>
            <div id="chart_brand_comp" class="chart-container"></div>
        </div>

        <!-- Section 3 & 4: Levers & Efficiency -->
        <div class="grid-2">
            <div class="card">
                <div class="card-title"><span class="material-icons">speed</span> 3. Organic Rank vs Click Share Efficiency</div>
                <div id="chart_efficiency" class="chart-container"></div>
                <p style="font-size: 12px; color: #666;">
                    <strong>Above line:</strong> High Efficiency (Good Titles/Pricing).<br>
                    <strong>Below line:</strong> Underperforming (Check CTR).
                </p>
            </div>
            <div class="card">
                <div class="card-title"><span class="material-icons">monetization_on</span> 4. Price & Levers Impact</div>
                <div id="chart_levers" class="chart-container"></div>
            </div>
        </div>

        <!-- Section 5: Conclusions -->
        <div class="card" style="border-left: 4px solid var(--primary-color);">
            <div class="card-title"><span class="material-icons">lightbulb</span> 5. Conclusions & Recommendations</div>
            <ul class="insights-list" id="insights-list">
                <!-- Injected via JS -->
            </ul>
        </div>
    </div>

    <!-- TAB 2: INTERACTIVE COMPARATOR -->
    <div id="interactive-tab" class="tab-content">
        <div class="controls">
            <select id="weekSelect" onchange="updateComparator()">
                <!-- Populated by JS -->
            </select>
            <select id="compSelect" onchange="updateComparator()">
                <!-- Populated by JS -->
            </select>
        </div>

        <div class="card">
            <div class="card-title">Head-to-Head Comparison</div>
            <div id="comparator-view">
                <!-- Dynamic Content -->
                <table class="comp-table">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Our Brand (<span id="our-brand-name"></span>)</th>
                            <th>Competitor (<span id="comp-brand-name"></span>)</th>
                            <th>Delta</th>
                        </tr>
                    </thead>
                    <tbody id="comparison-body">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>

<script type="text/javascript">
    // 1. DATA INJECTION (Generated from Python Step)
    const marketData = [{"brand_aggregation": "LuminaHome", "parent_asin": "B00PARENT123", "week_date": "2025-12-29", "keywords": "led desk lamp", "competitor_brand": "LuminaHome", "asin": "B00LUM0", "product_title": "LuminaHome Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 22, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0714, "impression_share": 0.07854000000000001, "price": 29.99, "click_share_rank": 0, "weekly_search_volume": 10122, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "LuminaHome", "parent_asin": "B00PARENT123", "week_date": "2025-12-29", "keywords": "led desk lamp", "competitor_brand": "LuminaHome", "asin": "B00LUM1", "product_title": "LuminaHome Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 22, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0774, "impression_share": 0.08514000000000001, "price": 29.99, "click_share_rank": 0, "weekly_search_volume": 10122, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "BrightLife", "parent_asin": "B00PARENT123", "week_date": "2025-12-29", "keywords": "reading light", "competitor_brand": "BrightLife", "asin": "B00BRI0", "product_title": "BrightLife Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 18, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1134, "impression_share": 0.12474000000000002, "price": 24.99, "click_share_rank": 0, "weekly_search_volume": 10122, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "BrightLife", "parent_asin": "B00PARENT123", "week_date": "2025-12-29", "keywords": "led desk lamp", "competitor_brand": "BrightLife", "asin": "B00BRI1", "product_title": "BrightLife Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 17, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1239, "impression_share": 0.13629, "price": 24.99, "click_share_rank": 0, "weekly_search_volume": 10122, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "GlowMaster", "parent_asin": "B00PARENT123", "week_date": "2025-12-29", "keywords": "reading light", "competitor_brand": "GlowMaster", "asin": "B00GLO0", "product_title": "GlowMaster Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 24, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0516, "impression_share": 0.056760000000000005, "price": 35.0, "click_share_rank": 0, "weekly_search_volume": 10122, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "GlowMaster", "parent_asin": "B00PARENT123", "week_date": "2025-12-29", "keywords": "led desk lamp", "competitor_brand": "GlowMaster", "asin": "B00GLO1", "product_title": "GlowMaster Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 24, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0519, "impression_share": 0.05709000000000001, "price": 35.0, "click_share_rank": 0, "weekly_search_volume": 10122, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "ShineTech", "parent_asin": "B00PARENT123", "week_date": "2025-12-29", "keywords": "reading light", "competitor_brand": "ShineTech", "asin": "B00SHI0", "product_title": "ShineTech Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 24, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0591, "impression_share": 0.06501, "price": 19.99, "click_share_rank": 0, "weekly_search_volume": 10122, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "ShineTech", "parent_asin": "B00PARENT123", "week_date": "2025-12-29", "keywords": "reading light", "competitor_brand": "ShineTech", "asin": "B00SHI1", "product_title": "ShineTech Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 23, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0644, "impression_share": 0.07084, "price": 19.99, "click_share_rank": 0, "weekly_search_volume": 10122, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "Unknown", "parent_asin": "B00PARENT123", "week_date": "2025-12-29", "keywords": "reading light", "competitor_brand": null, "asin": "B00UNK0", "product_title": "Unknown Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 24, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0548, "impression_share": 0.06028000000000001, "price": 22.0, "click_share_rank": 0, "weekly_search_volume": 10122, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "LuminaHome", "parent_asin": "B00PARENT123", "week_date": "2026-01-05", "keywords": "reading light", "competitor_brand": "LuminaHome", "asin": "B00LUM0", "product_title": "LuminaHome Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 21, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0825, "impression_share": 0.09075000000000001, "price": 29.99, "click_share_rank": 0, "weekly_search_volume": 10354, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "LuminaHome", "parent_asin": "B00PARENT123", "week_date": "2026-01-05", "keywords": "office lamp", "competitor_brand": "LuminaHome", "asin": "B00LUM1", "product_title": "LuminaHome Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 22, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0703, "impression_share": 0.07733000000000001, "price": 29.99, "click_share_rank": 0, "weekly_search_volume": 10354, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "BrightLife", "parent_asin": "B00PARENT123", "week_date": "2026-01-05", "keywords": "led desk lamp", "competitor_brand": "BrightLife", "asin": "B00BRI0", "product_title": "BrightLife Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 18, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1152, "impression_share": 0.12672, "price": 24.99, "click_share_rank": 0, "weekly_search_volume": 10354, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "BrightLife", "parent_asin": "B00PARENT123", "week_date": "2026-01-05", "keywords": "reading light", "competitor_brand": "BrightLife", "asin": "B00BRI1", "product_title": "BrightLife Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 18, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1132, "impression_share": 0.12452, "price": 24.99, "click_share_rank": 0, "weekly_search_volume": 10354, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "GlowMaster", "parent_asin": "B00PARENT123", "week_date": "2026-01-05", "keywords": "reading light", "competitor_brand": "GlowMaster", "asin": "B00GLO0", "product_title": "GlowMaster Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 24, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0544, "impression_share": 0.059840000000000004, "price": 35.0, "click_share_rank": 0, "weekly_search_volume": 10354, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "GlowMaster", "parent_asin": "B00PARENT123", "week_date": "2026-01-05", "keywords": "office lamp", "competitor_brand": "GlowMaster", "asin": "B00GLO1", "product_title": "GlowMaster Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 25, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0463, "impression_share": 0.05093, "price": 35.0, "click_share_rank": 0, "weekly_search_volume": 10354, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "ShineTech", "parent_asin": "B00PARENT123", "week_date": "2026-01-05", "keywords": "reading light", "competitor_brand": "ShineTech", "asin": "B00SHI0", "product_title": "ShineTech Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 23, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0625, "impression_share": 0.06875, "price": 19.99, "click_share_rank": 0, "weekly_search_volume": 10354, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "ShineTech", "parent_asin": "B00PARENT123", "week_date": "2026-01-05", "keywords": "led desk lamp", "competitor_brand": "ShineTech", "asin": "B00SHI1", "product_title": "ShineTech Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 23, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0613, "impression_share": 0.06743, "price": 19.99, "click_share_rank": 0, "weekly_search_volume": 10354, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "Unknown", "parent_asin": "B00PARENT123", "week_date": "2026-01-05", "keywords": "reading light", "competitor_brand": null, "asin": "B00UNK0", "product_title": "Unknown Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 24, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.053, "impression_share": 0.058300000000000005, "price": 22.0, "click_share_rank": 0, "weekly_search_volume": 10354, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "LuminaHome", "parent_asin": "B00PARENT123", "week_date": "2026-01-12", "keywords": "reading light", "competitor_brand": "LuminaHome", "asin": "B00LUM0", "product_title": "LuminaHome Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 22, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.078, "impression_share": 0.0858, "price": 29.99, "click_share_rank": 0, "weekly_search_volume": 9383, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "LuminaHome", "parent_asin": "B00PARENT123", "week_date": "2026-01-12", "keywords": "office lamp", "competitor_brand": "LuminaHome", "asin": "B00LUM1", "product_title": "LuminaHome Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 22, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0781, "impression_share": 0.08591000000000001, "price": 29.99, "click_share_rank": 0, "weekly_search_volume": 9383, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "BrightLife", "parent_asin": "B00PARENT123", "week_date": "2026-01-12", "keywords": "led desk lamp", "competitor_brand": "BrightLife", "asin": "B00BRI0", "product_title": "BrightLife Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 17, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1201, "impression_share": 0.13211, "price": 24.99, "click_share_rank": 0, "weekly_search_volume": 9383, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "BrightLife", "parent_asin": "B00PARENT123", "week_date": "2026-01-12", "keywords": "office lamp", "competitor_brand": "BrightLife", "asin": "B00BRI1", "product_title": "BrightLife Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 18, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1193, "impression_share": 0.13123, "price": 24.99, "click_share_rank": 0, "weekly_search_volume": 9383, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "GlowMaster", "parent_asin": "B00PARENT123", "week_date": "2026-01-12", "keywords": "led desk lamp", "competitor_brand": "GlowMaster", "asin": "B00GLO0", "product_title": "GlowMaster Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 24, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0543, "impression_share": 0.059730000000000005, "price": 35.0, "click_share_rank": 0, "weekly_search_volume": 9383, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "GlowMaster", "parent_asin": "B00PARENT123", "week_date": "2026-01-12", "keywords": "led desk lamp", "competitor_brand": "GlowMaster", "asin": "B00GLO1", "product_title": "GlowMaster Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 24, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0507, "impression_share": 0.05577000000000001, "price": 35.0, "click_share_rank": 0, "weekly_search_volume": 9383, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "ShineTech", "parent_asin": "B00PARENT123", "week_date": "2026-01-12", "keywords": "reading light", "competitor_brand": "ShineTech", "asin": "B00SHI0", "product_title": "ShineTech Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 24, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0597, "impression_share": 0.06567, "price": 19.99, "click_share_rank": 0, "weekly_search_volume": 9383, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "ShineTech", "parent_asin": "B00PARENT123", "week_date": "2026-01-12", "keywords": "led desk lamp", "competitor_brand": "ShineTech", "asin": "B00SHI1", "product_title": "ShineTech Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 23, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0607, "impression_share": 0.06677, "price": 19.99, "click_share_rank": 0, "weekly_search_volume": 9383, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "Unknown", "parent_asin": "B00PARENT123", "week_date": "2026-01-12", "keywords": "office lamp", "competitor_brand": null, "asin": "B00UNK0", "product_title": "Unknown Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 25, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0482, "impression_share": 0.053020000000000005, "price": 22.0, "click_share_rank": 0, "weekly_search_volume": 9383, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "LuminaHome", "parent_asin": "B00PARENT123", "week_date": "2026-01-19", "keywords": "led desk lamp", "competitor_brand": "LuminaHome", "asin": "B00LUM0", "product_title": "LuminaHome Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 22, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0748, "impression_share": 0.08228, "price": 29.99, "click_share_rank": 0, "weekly_search_volume": 9159, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "LuminaHome", "parent_asin": "B00PARENT123", "week_date": "2026-01-19", "keywords": "office lamp", "competitor_brand": "LuminaHome", "asin": "B00LUM1", "product_title": "LuminaHome Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 22, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0795, "impression_share": 0.08745000000000001, "price": 29.99, "click_share_rank": 0, "weekly_search_volume": 9159, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "BrightLife", "parent_asin": "B00PARENT123", "week_date": "2026-01-19", "keywords": "office lamp", "competitor_brand": "BrightLife", "asin": "B00BRI0", "product_title": "BrightLife Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 14, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "click_share": 0.1549, "impression_share": 0.17039, "price": 22.49, "click_share_rank": 0, "weekly_search_volume": 9159, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "BrightLife", "parent_asin": "B00PARENT123", "week_date": "2026-01-19", "keywords": "reading light", "competitor_brand": "BrightLife", "asin": "B00BRI1", "product_title": "BrightLife Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 15, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "click_share": 0.1409, "impression_share": 0.15499000000000002, "price": 22.49, "click_share_rank": 0, "weekly_search_volume": 9159, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "GlowMaster", "parent_asin": "B00PARENT123", "week_date": "2026-01-19", "keywords": "led desk lamp", "competitor_brand": "GlowMaster", "asin": "B00GLO0", "product_title": "GlowMaster Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 24, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0542, "impression_share": 0.05962, "price": 35.0, "click_share_rank": 0, "weekly_search_volume": 9159, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "GlowMaster", "parent_asin": "B00PARENT123", "week_date": "2026-01-19", "keywords": "reading light", "competitor_brand": "GlowMaster", "asin": "B00GLO1", "product_title": "GlowMaster Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 24, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0536, "impression_share": 0.058960000000000005, "price": 35.0, "click_share_rank": 0, "weekly_search_volume": 9159, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "ShineTech", "parent_asin": "B00PARENT123", "week_date": "2026-01-19", "keywords": "office lamp", "competitor_brand": "ShineTech", "asin": "B00SHI0", "product_title": "ShineTech Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 23, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0609, "impression_share": 0.06699000000000001, "price": 19.99, "click_share_rank": 0, "weekly_search_volume": 9159, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "ShineTech", "parent_asin": "B00PARENT123", "week_date": "2026-01-19", "keywords": "office lamp", "competitor_brand": "ShineTech", "asin": "B00SHI1", "product_title": "ShineTech Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 24, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0546, "impression_share": 0.06006000000000001, "price": 19.99, "click_share_rank": 0, "weekly_search_volume": 9159, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "Unknown", "parent_asin": "B00PARENT123", "week_date": "2026-01-19", "keywords": "office lamp", "competitor_brand": null, "asin": "B00UNK0", "product_title": "Unknown Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 25, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0451, "impression_share": 0.04961000000000001, "price": 22.0, "click_share_rank": 0, "weekly_search_volume": 9159, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "LuminaHome", "parent_asin": "B00PARENT123", "week_date": "2026-01-26", "keywords": "led desk lamp", "competitor_brand": "LuminaHome", "asin": "B00LUM0", "product_title": "LuminaHome Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 18, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.119, "impression_share": 0.13090000000000002, "price": 25.49, "click_share_rank": 0, "weekly_search_volume": 9784, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "LuminaHome", "parent_asin": "B00PARENT123", "week_date": "2026-01-26", "keywords": "reading light", "competitor_brand": "LuminaHome", "asin": "B00LUM1", "product_title": "LuminaHome Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 18, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1184, "impression_share": 0.13024000000000002, "price": 25.49, "click_share_rank": 0, "weekly_search_volume": 9784, "is_yaba_asin": "Y", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "BrightLife", "parent_asin": "B00PARENT123", "week_date": "2026-01-26", "keywords": "led desk lamp", "competitor_brand": "BrightLife", "asin": "B00BRI0", "product_title": "BrightLife Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 18, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1127, "impression_share": 0.12397000000000001, "price": 24.99, "click_share_rank": 0, "weekly_search_volume": 9784, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "BrightLife", "parent_asin": "B00PARENT123", "week_date": "2026-01-26", "keywords": "office lamp", "competitor_brand": "BrightLife", "asin": "B00BRI1", "product_title": "BrightLife Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 17, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.1211, "impression_share": 0.13321000000000002, "price": 24.99, "click_share_rank": 0, "weekly_search_volume": 9784, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "GlowMaster", "parent_asin": "B00PARENT123", "week_date": "2026-01-26", "keywords": "office lamp", "competitor_brand": "GlowMaster", "asin": "B00GLO0", "product_title": "GlowMaster Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 24, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0544, "impression_share": 0.059840000000000004, "price": 35.0, "click_share_rank": 0, "weekly_search_volume": 9784, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "GlowMaster", "parent_asin": "B00PARENT123", "week_date": "2026-01-26", "keywords": "reading light", "competitor_brand": "GlowMaster", "asin": "B00GLO1", "product_title": "GlowMaster Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 24, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0547, "impression_share": 0.06017, "price": 35.0, "click_share_rank": 0, "weekly_search_volume": 9784, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "ShineTech", "parent_asin": "B00PARENT123", "week_date": "2026-01-26", "keywords": "reading light", "competitor_brand": "ShineTech", "asin": "B00SHI0", "product_title": "ShineTech Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 23, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0618, "impression_share": 0.06798000000000001, "price": 19.99, "click_share_rank": 0, "weekly_search_volume": 9784, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "ShineTech", "parent_asin": "B00PARENT123", "week_date": "2026-01-26", "keywords": "led desk lamp", "competitor_brand": "ShineTech", "asin": "B00SHI1", "product_title": "ShineTech Desk Lamp Adjustable 1", "country_code": "US", "average_organic_rank": 23, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.062, "impression_share": 0.06820000000000001, "price": 19.99, "click_share_rank": 0, "weekly_search_volume": 9784, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}, {"brand_aggregation": "Unknown", "parent_asin": "B00PARENT123", "week_date": "2026-01-26", "keywords": "reading light", "competitor_brand": null, "asin": "B00UNK0", "product_title": "Unknown Desk Lamp Adjustable 0", "country_code": "US", "average_organic_rank": 25, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "click_share": 0.0497, "impression_share": 0.05467, "price": 22.0, "click_share_rank": 0, "weekly_search_volume": 9784, "is_yaba_asin": "N", "keywords_link": "http://amazon.com/..."}];

    // 2. DATA PROCESSING LOGIC
    
    // Normalize Data
    const cleanData = marketData.map(d => ({
        ...d,
        brand: d.competitor_brand || d.product_title.split(" ")[0] || "Unknown Brand",
        isOurs: d.is_yaba_asin === 'Y'
    }));

    // Identify Our Brand Name
    const ourBrandRow = cleanData.find(d => d.isOurs);
    const ourBrandName = ourBrandRow ? ourBrandRow.brand : "Our Brand";

    // Aggregations
    const weeks = [...new Set(cleanData.map(d => d.week_date))].sort();
    
    // Brand Totals for Ranking
    const brandShares = {};
    cleanData.forEach(d => {
        if (!brandShares[d.brand]) brandShares[d.brand] = 0;
        brandShares[d.brand] += d.click_share;
    });
    
    const topCompetitors = Object.keys(brandShares)
        .filter(b => b !== ourBrandName)
        .sort((a,b) => brandShares[b] - brandShares[a])
        .slice(0, 3);

    // 3. CHART DRAWING
    google.charts.load('current', {'packages':['corechart', 'table']});
    google.charts.setOnLoadCallback(drawDashboard);

    function drawDashboard() {
        drawKPIs();
        drawGlobalTrend();
        drawCompetitiveness();
        drawEfficiency();
        drawLevers();
        populateInsights();
        populateInteractive();
    }

    function drawKPIs() {
        const lastWeek = weeks[weeks.length - 1];
        const prevWeek = weeks[weeks.length - 2];
        
        const getData = (w, isOurs) => cleanData.filter(d => d.week_date === w && d.isOurs === isOurs);
        
        const oursCurr = getData(lastWeek, true);
        const oursPrev = getData(prevWeek, true);

        const sumClicks = (arr) => arr.reduce((acc, d) => acc + (d.weekly_search_volume * d.click_share), 0);
        const avgShare = (arr) => arr.length ? arr.reduce((acc, d) => acc + d.click_share, 0) / arr.length : 0;

        const clicksCurr = Math.round(sumClicks(oursCurr));
        const clicksPrev = Math.round(sumClicks(oursPrev));
        const shareCurr = (avgShare(oursCurr) * 100).toFixed(2);
        const sharePrev = (avgShare(oursPrev) * 100).toFixed(2);

        const clicksDelta = clicksCurr - clicksPrev;
        const shareDelta = (shareCurr - sharePrev).toFixed(2);

        document.getElementById('kpi-container').innerHTML = `
            <div class="kpi-card">
                <div class="kpi-label">Weekly Clicks</div>
                <div class="kpi-value">${clicksCurr}</div>
                <div class="${clicksDelta >= 0 ? 'trend-up' : 'trend-down'}">
                    ${clicksDelta > 0 ? '+' : ''}${clicksDelta} vs LW
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Avg Click Share</div>
                <div class="kpi-value">${shareCurr}%</div>
                <div class="${shareDelta >= 0 ? 'trend-up' : 'trend-down'}">
                    ${shareDelta > 0 ? '+' : ''}${shareDelta}% vs LW
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Active Keywords</div>
                <div class="kpi-value">${oursCurr.length}</div>
                <div class="text-xs text-gray-500">Tracked in Parent</div>
            </div>
        `;
    }

    function drawGlobalTrend() {
        const data = new google.visualization.DataTable();
        data.addColumn('string', 'Week');
        data.addColumn('number', 'Our Clicks');
        data.addColumn('number', 'Comp Clicks');
        data.addColumn('number', 'Our Share (%)');
        data.addColumn('number', 'Comp Share (%)');

        const rows = weeks.map(w => {
            const weekData = cleanData.filter(d => d.week_date === w);
            const ours = weekData.filter(d => d.isOurs);
            const comps = weekData.filter(d => !d.isOurs);

            const calcClicks = (arr) => arr.reduce((acc, d) => acc + (d.weekly_search_volume * d.click_share), 0);
            const calcShare = (arr) => arr.reduce((acc, d) => acc + d.click_share, 0); // Aggregate share for parent

            return [
                w.substring(5), // mm-dd
                calcClicks(ours),
                calcClicks(comps),
                calcShare(ours) * 100,
                calcShare(comps) * 100
            ];
        });

        data.addRows(rows);

        const options = {
            seriesType: 'bars',
            series: { 
                2: {type: 'line', targetAxisIndex: 1, color: '#4285F4'}, 
                3: {type: 'line', targetAxisIndex: 1, color: '#EA4335'} 
            },
            colors: ['#8AB4F8', '#FAD2CF'],
            vAxes: {
                0: {title: 'Est. Clicks'},
                1: {title: 'Click Share %', format: '#\'%\''}
            },
            legend: { position: 'bottom' },
            chartArea: { width: '85%', height: '70%' }
        };

        new google.visualization.ComboChart(document.getElementById('chart_global_trend')).draw(data, options);
    }

    function drawCompetitiveness() {
        const data = new google.visualization.DataTable();
        data.addColumn('string', 'Week');
        data.addColumn('number', ourBrandName);
        topCompetitors.forEach(c => data.addColumn('number', c));

        const rows = weeks.map(w => {
            const weekData = cleanData.filter(d => d.week_date === w);
            const getShare = (b) => {
                const brandRows = weekData.filter(d => d.brand === b);
                return brandRows.reduce((acc, d) => acc + d.click_share, 0) * 100;
            };
            return [w.substring(5), getShare(ourBrandName), ...topCompetitors.map(c => getShare(c))];
        });

        data.addRows(rows);

        const options = {
            curveType: 'function',
            legend: { position: 'bottom' },
            colors: ['#4285F4', '#EA4335', '#FBBC04', '#34A853'],
            vAxis: { title: 'Total Share %' },
            chartArea: { width: '85%', height: '70%' }
        };

        new google.visualization.LineChart(document.getElementById('chart_brand_comp')).draw(data, options);
    }

    function drawEfficiency() {
        // Scatter: Rank (X) vs Share (Y)
        const data = new google.visualization.DataTable();
        data.addColumn('number', 'Organic Rank');
        data.addColumn('number', 'Click Share %');
        data.addColumn({type: 'string', role: 'style'});
        data.addColumn({type: 'string', role: 'tooltip'});

        const lastWeek = weeks[weeks.length - 1];
        const currentData = cleanData.filter(d => d.week_date === lastWeek);

        const rows = currentData.map(d => {
            const color = d.isOurs ? '#4285F4' : '#999';
            return [
                d.average_organic_rank,
                d.click_share * 100,
                `point { fill-color: ${color}; }`,
                `${d.brand}: Rank ${d.average_organic_rank}, Share ${(d.click_share*100).toFixed(2)}%`
            ];
        });

        data.addRows(rows);

        const options = {
            hAxis: { title: 'Organic Rank (Lower is Better)', direction: -1 },
            vAxis: { title: 'Click Share %' },
            legend: 'none',
            chartArea: { width: '85%', height: '70%' }
        };

        new google.visualization.ScatterChart(document.getElementById('chart_efficiency')).draw(data, options);
    }

    function drawLevers() {
        // Simple Column Chart of Avg Price over weeks
        const data = new google.visualization.DataTable();
        data.addColumn('string', 'Week');
        data.addColumn('number', 'Our Price');
        data.addColumn('number', 'Mkt Leader Price');

        const leader = topCompetitors[0]; // Assume 1st is leader

        const rows = weeks.map(w => {
            const weekData = cleanData.filter(d => d.week_date === w);
            const getPrice = (b) => {
                const brandRows = weekData.filter(d => d.brand === b);
                return brandRows.length ? brandRows.reduce((a,x) => a + x.price, 0)/brandRows.length : 0;
            };
            return [w.substring(5), getPrice(ourBrandName), getPrice(leader)];
        });

        data.addRows(rows);

        const options = {
            legend: { position: 'bottom' },
            colors: ['#4285F4', '#EA4335'],
            vAxis: { format: '$#' },
            chartArea: { width: '85%', height: '70%' }
        };

        new google.visualization.ColumnChart(document.getElementById('chart_levers')).draw(data, options);
    }

    // 4. INSIGHTS LOGIC
    function populateInsights() {
        const insightsList = document.getElementById('insights-list');
        // Based on synthetic logic: 
        // Week 4: Competitor Coupon, Week 5: Our Deal
        const html = `
            <li><strong>Deal Impact:</strong> We activated a deal in the last week, correlating with a sharp increase in Click Share (visible in Global Trend).</li>
            <li><strong>Competitor Pressure:</strong> ${topCompetitors[0]} saw share erosion in the final week due to our aggressive pricing.</li>
            <li><strong>Price Sensitivity:</strong> Data suggests high elasticity; when price dropped below $28, share increased >15%.</li>
            <li><strong>Efficiency:</strong> Our ASINs are outperforming organic rank expectations, suggesting strong main image CTR vs competitors.</li>
            <li><strong>Recommendation:</strong> Maintain the lower price point for 1 more week to solidify ranking gains, then taper off.</li>
        `;
        insightsList.innerHTML = html;
    }

    // 5. INTERACTIVE LOGIC
    function populateInteractive() {
        const weekSel = document.getElementById('weekSelect');
        const compSel = document.getElementById('compSelect');

        // Weeks
        weeks.forEach(w => {
            const opt = document.createElement('option');
            opt.value = w;
            opt.text = w;
            weekSel.appendChild(opt);
        });
        weekSel.value = weeks[weeks.length-1]; // Default latest

        // Competitors
        topCompetitors.forEach(c => {
            const opt = document.createElement('option');
            opt.value = c;
            opt.text = c;
            compSel.appendChild(opt);
        });
        
        // Initial Draw
        updateComparator();
    }

    function updateComparator() {
        const week = document.getElementById('weekSelect').value;
        const comp = document.getElementById('compSelect').value;
        const tbody = document.getElementById('comparison-body');

        // Update Headers
        document.getElementById('our-brand-name').textContent = ourBrandName;
        document.getElementById('comp-brand-name').textContent = comp;

        // Get Data
        const weekData = cleanData.filter(d => d.week_date === week);
        const ours = weekData.filter(d => d.isOurs);
        const them = weekData.filter(d => d.brand === comp);

        if(!ours.length || !them.length) {
            tbody.innerHTML = "<tr><td colspan='4'>No data for this selection.</td></tr>";
            return;
        }

        // Aggregate
        const agg = (arr, key) => arr.reduce((a,b) => a + b[key], 0) / arr.length;
        const sum = (arr, key) => arr.reduce((a,b) => a + b[key], 0);

        const metrics = [
            { label: 'Avg Price', key: 'price', fmt: (v) => '$' + v.toFixed(2) },
            { label: 'Total Share', val: (arr) => (sum(arr, 'click_share')*100).toFixed(2) + '%' },
            { label: 'Avg Rank', key: 'average_organic_rank', fmt: (v) => v.toFixed(1) },
            { label: 'Active Deals', val: (arr) => sum(arr, 'weekly_number_of_days_with_deal') > 0 ? '<span class="badge badge-deal">Active</span>' : 'None' }
        ];

        let html = '';
        metrics.forEach(m => {
            let v1, v2;
            if(m.val) {
                v1 = m.val(ours);
                v2 = m.val(them);
            } else {
                v1 = m.fmt(agg(ours, m.key));
                v2 = m.fmt(agg(them, m.key));
            }
            
            // Delta Logic (Simple string compare or numeric)
            let delta = '-';
            if(!isNaN(parseFloat(v1)) && !isNaN(parseFloat(v2))) {
                const n1 = parseFloat(v1.replace('$','').replace('%',''));
                const n2 = parseFloat(v2.replace('$','').replace('%',''));
                const d = n1 - n2;
                delta = (d > 0 ? '+' : '') + d.toFixed(2);
            }

            html += `<tr>
                <td>${m.label}</td>
                <td style="font-weight:bold; color: var(--primary-color)">${v1}</td>
                <td>${v2}</td>
                <td style="color: #666">${delta}</td>
            </tr>`;
        });

        tbody.innerHTML = html;
    }

    // UI Tab Switcher
    window.switchTab = function(tabName) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        
        if(tabName === 'static') {
            document.getElementById('static-tab').classList.add('active');
            document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
        } else {
            document.getElementById('interactive-tab').classList.add('active');
            document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
        }
    };

</script>

</body>
</html>