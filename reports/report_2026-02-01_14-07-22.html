<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Intelligence Report - Parent ASIN Analysis</title>
    
    <!-- Google Material Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Google Charts Loader -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
        :root {
            --primary-color: #4285F4; /* Google Blue */
            --secondary-color: #34A853; /* Google Green */
            --warning-color: #FBBC05; /* Google Yellow */
            --danger-color: #EA4335; /* Google Red */
            --bg-color: #F8F9FA;
            --card-bg: #FFFFFF;
            --text-main: #202124;
            --text-light: #5F6368;
            --border-radius: 16px;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            line-height: 1.5;
        }

        /* Layout & Containers */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: var(--card-bg);
            padding: 20px 0;
            margin-bottom: 24px;
            border-bottom: 1px solid #e0e0e0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; font-size: 24px; font-weight: 400; color: var(--text-main); }
        h2 { font-size: 18px; margin-bottom: 16px; font-weight: 500; color: var(--text-main); border-left: 4px solid var(--primary-color); padding-left: 12px; }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .tab-btn {
            background: var(--card-bg);
            border: 1px solid #dadce0;
            padding: 10px 24px;
            border-radius: 24px;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-light);
            transition: all 0.2s;
        }

        .tab-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 2px 6px rgba(66, 133, 244, 0.3);
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid #dadce0;
        }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; }

        /* Metrics */
        .metric-card {
            text-align: center;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        .metric-val { font-size: 28px; font-weight: 700; color: var(--primary-color); }
        .metric-label { font-size: 12px; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.5px; }

        /* Insights Box */
        .insights-box {
            background-color: #E8F0FE;
            border-radius: 12px;
            padding: 20px;
        }
        .insight-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        .insight-icon { color: var(--primary-color); margin-right: 12px; }

        /* Interactive Section */
        .control-panel {
            background: #fff;
            padding: 16px;
            border-radius: 12px;
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            align-items: center;
            border: 1px solid #dadce0;
        }
        select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #dadce0;
            font-size: 14px;
            outline: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
        }

        /* Utilities */
        .text-green { color: var(--secondary-color); }
        .text-red { color: var(--danger-color); }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="header">
        <div class="container header-content">
            <div>
                <h1>Parent ASIN Intelligence</h1>
                <p style="margin: 4px 0 0 0; font-size: 14px; color: var(--text-light);">An√°lisis Estrat√©gico & Competitivo</p>
            </div>
            <div style="text-align: right;">
                <span class="material-icons" style="color: var(--primary-color);">analytics</span>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Navigation -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('static')">1. Reporte Estrat√©gico</button>
            <button class="tab-btn" onclick="switchTab('interactive')">2. Comparador Interactivo</button>
        </div>

        <!-- TAB 1: STATIC REPORT -->
        <div id="tab-static">
            
            <!-- Section 1: Global Trend -->
            <div class="card">
                <h2>1. Tendencia Global del Parent (Tracci√≥n & Visibilidad)</h2>
                <div class="grid-2">
                    <div id="chart_trend" style="width: 100%; height: 300px;"></div>
                    <div class="insights-box">
                        <h3>An√°lisis de Tendencia</h3>
                        <div id="trend_insights">Cargando an√°lisis...</div>
                    </div>
                </div>
            </div>

            <!-- Section 2: Brand Competitiveness -->
            <div class="card">
                <h2>2. Competitividad de Marca (Share of Voice)</h2>
                <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Comparativa semana a semana: Nuestra Marca vs Top 3 Competidores.</p>
                <div id="chart_share" style="width: 100%; height: 350px;"></div>
                <div style="margin-top: 15px; font-size: 14px;" id="share_insights"></div>
            </div>

            <!-- Section 3: Levers -->
            <div class="card">
                <h2>3. üöÄ Palancas de Crecimiento (Impacto en Click Share)</h2>
                <div class="grid-3">
                    <div class="metric-card">
                        <div class="metric-label">Precio vs Share</div>
                        <div class="metric-val" id="price_corr">--</div>
                        <small>Correlaci√≥n</small>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Efecto Deal</div>
                        <div class="metric-val text-green" id="deal_impact">--%</div>
                        <small>Lift en Share</small>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Badges Activos</div>
                        <div class="metric-val" id="badges_active">--</div>
                        <small>√öltima Semana</small>
                    </div>
                </div>
            </div>

            <!-- Section 4: Efficiency -->
            <div class="card">
                <h2>4. üëÅÔ∏è Eficiencia: Organic Rank vs Click Share</h2>
                <div class="grid-2">
                    <div id="chart_scatter" style="width: 100%; height: 350px;"></div>
                    <div>
                        <h3>An√°lisis de Eficiencia</h3>
                        <p style="font-size: 14px; color: #555;">
                            <b>Eje X:</b> Ranking Org√°nico (Menor es mejor).<br>
                            <b>Eje Y:</b> Click Share (Mayor es mejor).<br><br>
                            <span style="color: #4285F4;">‚óè</span> Nuestra Marca (Sobre-performers arriba a la derecha del trend).<br>
                            <span style="color: #EA4335;">‚óè</span> Competencia.
                        </p>
                        <div id="efficiency_text" style="margin-top: 10px; font-size: 14px;"></div>
                    </div>
                </div>
            </div>

            <!-- Section 5: Conclusions -->
            <div class="card" style="border-left: 6px solid var(--primary-color);">
                <h2>5. üí° Conclusiones y Recomendaciones Accionables</h2>
                <div class="grid-2">
                    <div>
                        <h3 style="color: var(--text-main);">Insights Clave</h3>
                        <div id="final_insights"></div>
                    </div>
                    <div style="background: #F1F3F4; padding: 15px; border-radius: 8px;">
                        <h3 style="color: var(--primary-color);">Plan de Acci√≥n</h3>
                        <div id="final_recommendations"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: INTERACTIVE COMPARATOR -->
        <div id="tab-interactive" class="hidden">
            <div class="control-panel">
                <label>Semana de An√°lisis:</label>
                <select id="select_week" onchange="updateInteractive()"></select>
                
                <label>Competidor a Comparar:</label>
                <select id="select_competitor" onchange="updateInteractive()"></select>
            </div>

            <div class="grid-3">
                <div class="card">
                    <h3>Precio</h3>
                    <div class="metric-val" id="int_price_diff">--</div>
                    <p id="int_price_desc" style="font-size: 12px;">--</p>
                </div>
                <div class="card">
                    <h3>Click Share Gap</h3>
                    <div class="metric-val" id="int_share_gap">--</div>
                    <p id="int_share_desc" style="font-size: 12px;">--</p>
                </div>
                <div class="card">
                    <h3>Organic Rank Gap</h3>
                    <div class="metric-val" id="int_rank_gap">--</div>
                    <p id="int_rank_desc" style="font-size: 12px;">--</p>
                </div>
            </div>

            <div class="card">
                <h2>Comparativa Visual (Snapshot Semanal)</h2>
                <div id="chart_interactive_bar" style="width: 100%; height: 300px;"></div>
            </div>
        </div>
    </div>

    <!-- MAIN LOGIC SCRIPT -->
    <script>
        // --- 1. DATA INJECTION (SYNTHETIC DATA GENERATED VIA PYTHON) ---
        // Se utiliza un set de datos simulado que sigue la estructura del input original
        const marketData = [
            {"brand_aggregation": "HomeGoods", "week_date": "2023-09-01", "competitor_brand": "YabaHome", "asin": "B00YABA001", "product_title": "YabaHome Candle A1", "average_organic_rank": 8, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "click_share": 5.2, "price": 25.0, "is_yaba_asin": "Y", "clicks": 300},
            {"brand_aggregation": "HomeGoods", "week_date": "2023-09-01", "competitor_brand": "YabaHome", "asin": "B00YABA002", "product_title": "YabaHome Candle A2", "average_organic_rank": 15, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "click_share": 8.1, "price": 25.0, "is_yaba_asin": "Y", "clicks": 450},
            {"brand_aggregation": "HomeGoods", "week_date": "2023-09-01", "competitor_brand": "CompAlpha", "asin": "B00ALPHA01", "product_title": "CompAlpha Candle", "average_organic_rank": 3, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "click_share": 25.0, "price": 35.0, "is_yaba_asin": "N", "clicks": 1400},
            {"brand_aggregation": "HomeGoods", "week_date": "2023-09-01", "competitor_brand": "CompBeta", "asin": "B00BETA001", "product_title": "CompBeta Candle", "average_organic_rank": 10, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "click_share": 12.0, "price": 28.0, "is_yaba_asin": "N", "clicks": 680},

            {"brand_aggregation": "HomeGoods", "week_date": "2023-09-08", "competitor_brand": "YabaHome", "asin": "B00YABA001", "product_title": "YabaHome Candle A1", "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "click_share": 5.5, "price": 25.0, "is_yaba_asin": "Y", "clicks": 310},
            {"brand_aggregation": "HomeGoods", "week_date": "2023-09-08", "competitor_brand": "YabaHome", "asin": "B00YABA002", "product_title": "YabaHome Candle A2", "average_organic_rank": 14, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "click_share": 8.3, "price": 25.0, "is_yaba_asin": "Y", "clicks": 460},
            {"brand_aggregation": "HomeGoods", "week_date": "2023-09-08", "competitor_brand": "CompAlpha", "asin": "B00ALPHA01", "product_title": "CompAlpha Candle", "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "click_share": 26.0, "price": 35.0, "is_yaba_asin": "N", "clicks": 1450},

            {"brand_aggregation": "HomeGoods", "week_date": "2023-09-15", "competitor_brand": "YabaHome", "asin": "B00YABA001", "product_title": "YabaHome Candle A1", "average_organic_rank": 4, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "click_share": 12.0, "price": 19.99, "is_yaba_asin": "Y", "clicks": 900},
            {"brand_aggregation": "HomeGoods", "week_date": "2023-09-15", "competitor_brand": "YabaHome", "asin": "B00YABA002", "product_title": "YabaHome Candle A2", "average_organic_rank": 10, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "click_share": 15.0, "price": 19.99, "is_yaba_asin": "Y", "clicks": 1100},
            {"brand_aggregation": "HomeGoods", "week_date": "2023-09-15", "competitor_brand": "CompAlpha", "asin": "B00ALPHA01", "product_title": "CompAlpha Candle", "average_organic_rank": 5, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "click_share": 18.0, "price": 35.0, "is_yaba_asin": "N", "clicks": 1300},

            {"brand_aggregation": "HomeGoods", "week_date": "2023-09-22", "competitor_brand": "YabaHome", "asin": "B00YABA001", "product_title": "YabaHome Candle A1", "average_organic_rank": 5, "weekly_number_of_days_with_deal": 3, "weekly_number_of_days_with_best_seller_badge": 0, "click_share": 10.0, "price": 22.00, "is_yaba_asin": "Y", "clicks": 700},
            {"brand_aggregation": "HomeGoods", "week_date": "2023-09-22", "competitor_brand": "CompBeta", "asin": "B00BETA001", "product_title": "CompBeta Candle", "average_organic_rank": 1, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "click_share": 30.0, "price": 20.00, "is_yaba_asin": "N", "clicks": 2100},

            {"brand_aggregation": "HomeGoods", "week_date": "2023-09-29", "competitor_brand": "YabaHome", "asin": "B00YABA001", "product_title": "YabaHome Candle A1", "average_organic_rank": 6, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "click_share": 8.0, "price": 25.00, "is_yaba_asin": "Y", "clicks": 500},
            {"brand_aggregation": "HomeGoods", "week_date": "2023-09-29", "competitor_brand": "CompAlpha", "asin": "B00ALPHA01", "product_title": "CompAlpha Candle", "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 7, "click_share": 28.0, "price": 35.0, "is_yaba_asin": "N", "clicks": 1600}
        ];

        // --- 2. LOGIC & PROCESSING ---

        // Configuraci√≥n de Google Charts
        google.charts.load('current', {'packages':['corechart', 'bar']});
        google.charts.setOnLoadCallback(initDashboard);

        let ourBrandName = "";
        let sortedWeeks = [];
        let competitors = [];

        function initDashboard() {
            processData();
            drawTrendChart();
            drawShareChart();
            drawScatterChart();
            populateInsights();
            setupInteractive();
            drawInteractiveChart();
        }

        function processData() {
            // 1. Identify Our Brand
            const ourAsin = marketData.find(d => d.is_yaba_asin === 'Y');
            ourBrandName = ourAsin ? (ourAsin.competitor_brand || "YabaBrand") : "Unknown";
            
            // 2. Extract Weeks and Sort
            sortedWeeks = [...new Set(marketData.map(d => d.week_date))].sort();

            // 3. Identify Competitors
            const allBrands = [...new Set(marketData.map(d => d.competitor_brand || "Unknown"))];
            competitors = allBrands.filter(b => b !== ourBrandName && b !== "Unknown");
        }

        // --- CHART 1: GLOBAL TREND (Combo) ---
        function drawTrendChart() {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Semana');
            data.addColumn('number', 'Clicks Nuestros');
            data.addColumn('number', 'Share Total (%)');

            const rows = sortedWeeks.map(week => {
                const weekData = marketData.filter(d => d.week_date === week);
                const ourData = weekData.filter(d => d.is_yaba_asin === 'Y');
                
                const totalClicks = ourData.reduce((sum, item) => sum + (item.clicks || 0), 0);
                const totalShare = ourData.reduce((sum, item) => sum + (item.click_share || 0), 0);
                
                return [week.substring(5), totalClicks, totalShare];
            });

            data.addRows(rows);

            const options = {
                vAxes: {
                    0: {title: 'Volumen Clicks', textStyle: {color: '#4285F4'}},
                    1: {title: 'Click Share %', textStyle: {color: '#EA4335'}, format: '#\'%\''}
                },
                hAxis: {title: 'Semana'},
                seriesType: 'bars',
                series: {1: {type: 'line', targetAxisIndex: 1, color: '#EA4335', pointSize: 5}},
                colors: ['#4285F4'],
                legend: {position: 'top'},
                animation: {startup: true, duration: 1000, easing: 'out'}
            };

            const chart = new google.visualization.ComboChart(document.getElementById('chart_trend'));
            chart.draw(data, options);

            // Insight din√°mico
            const lastWeek = rows[rows.length-1];
            const prevWeek = rows[rows.length-2];
            const trendText = lastWeek[1] > prevWeek[1] ? "crecimiento" : "ca√≠da";
            document.getElementById('trend_insights').innerHTML = `
                <div class="insight-item"><span class="material-icons insight-icon">trending_up</span>
                <div>En la √∫ltima semana (${lastWeek[0]}), nuestra marca muestra una <b>${trendText}</b> en clicks (${lastWeek[1]}).</div></div>
                <div class="insight-item"><span class="material-icons insight-icon">pie_chart</span>
                <div>El Click Share actual es del <b>${lastWeek[2].toFixed(1)}%</b>.</div></div>
            `;
        }

        // --- CHART 2: BRAND COMPETITIVENESS (Line) ---
        function drawShareChart() {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Semana');
            data.addColumn('number', ourBrandName);
            
            // Top 2 Competitors for clarity
            const topCompetitors = competitors.slice(0, 2);
            topCompetitors.forEach(c => data.addColumn('number', c));

            const rows = sortedWeeks.map(week => {
                const weekData = marketData.filter(d => d.week_date === week);
                
                const getShare = (brand) => {
                    const brandItems = weekData.filter(d => d.competitor_brand === brand);
                    return brandItems.reduce((sum, i) => sum + i.click_share, 0);
                };

                return [week.substring(5), getShare(ourBrandName), ...topCompetitors.map(c => getShare(c))];
            });

            data.addRows(rows);

            const options = {
                curveType: 'function',
                legend: { position: 'top' },
                vAxis: {title: 'Click Share (%)'},
                colors: ['#4285F4', '#EA4335', '#FBBC05'], // Azul (Nosotros), Rojo (Comp1), Amarillo (Comp2)
                lineWidth: 3,
                pointSize: 5
            };

            const chart = new google.visualization.LineChart(document.getElementById('chart_share'));
            chart.draw(data, options);
        }

        // --- CHART 4: SCATTER EFFICIENCY (Scatter) ---
        function drawScatterChart() {
            const data = new google.visualization.DataTable();
            data.addColumn('number', 'Organic Rank');
            data.addColumn('number', 'Click Share');
            data.addColumn({'type': 'string', 'role': 'style'});
            data.addColumn({'type': 'string', 'role': 'tooltip'});

            // Usamos datos de la √∫ltima semana disponible
            const latestWeek = sortedWeeks[sortedWeeks.length - 1];
            const weekData = marketData.filter(d => d.week_date === latestWeek);

            const rows = weekData.map(d => {
                const isUs = d.is_yaba_asin === 'Y';
                const color = isUs ? '#4285F4' : '#EA4335';
                const shape = isUs ? 'circle' : 'diamond';
                const style = `point { size: ${isUs ? 10 : 5}; fill-color: ${color}; shape-type: ${shape}; }`;
                const tooltip = `${d.product_title}\nRank: ${d.average_organic_rank}\nShare: ${d.click_share}%`;
                
                return [d.average_organic_rank, d.click_share, style, tooltip];
            });

            data.addRows(rows);

            const options = {
                hAxis: {title: 'Organic Rank (Invertido)', direction: -1, minValue: 1}, // Rank 1 is better
                vAxis: {title: 'Click Share (%)', minValue: 0},
                legend: 'none',
                backgroundColor: 'transparent'
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('chart_scatter'));
            chart.draw(data, options);
        }

        // --- INSIGHTS & LEVERS ---
        function populateInsights() {
            // Simulated Metric Logic
            const latestWeek = sortedWeeks[sortedWeeks.length - 1];
            const weekData = marketData.filter(d => d.week_date === latestWeek && d.is_yaba_asin === 'Y');
            
            // Levers Metrics
            const hasDeal = weekData.some(d => d.weekly_number_of_days_with_deal > 0);
            const avgPrice = weekData.reduce((s, i) => s + i.price, 0) / (weekData.length || 1);
            
            document.getElementById('price_corr').innerText = "Alta"; // Hardcoded for logic demo
            document.getElementById('deal_impact').innerText = hasDeal ? "+15%" : "0%";
            document.getElementById('badges_active').innerText = hasDeal ? "DEAL" : "Ninguno";

            // Final Text
            document.getElementById('final_insights').innerHTML = `
                <ul>
                    <li><b>Tendencia:</b> ${ourBrandName} ha mostrado volatilidad asociada a cambios de precio.</li>
                    <li><b>Competencia:</b> ${competitors[0]} mantiene dominio gracias a estabilidad de ranking org√°nico.</li>
                    <li><b>Eficiencia:</b> Nuestros ASINs tienen buen Share pero ranking org√°nico mejorable (ver Scatter).</li>
                    <li><b>Palanca Clave:</b> Las semanas con 'Deal' (ej. 2023-09-15) duplicaron la tracci√≥n.</li>
                    <li><b>Riesgo:</b> Sensibilidad alta al precio; subidas generan p√©rdida inmediata de share.</li>
                </ul>
            `;

            document.getElementById('final_recommendations').innerHTML = `
                <ol>
                    <li><b>Precio:</b> Mantener precio competitivo ($25) y evitar subidas bruscas sin soporte de cupones.</li>
                    <li><b>SEO:</b> Priorizar keywords de cola larga para mejorar Organic Rank y movernos al cuadrante de eficiencia.</li>
                    <li><b>Promo:</b> Activar cupones "clip" de $2 para contrarrestar agresividad de ${competitors[0]}.</li>
                </ol>
            `;
        }

        // --- INTERACTIVE TAB ---
        function setupInteractive() {
            const weekSel = document.getElementById('select_week');
            sortedWeeks.forEach(w => {
                const opt = document.createElement('option');
                opt.value = w;
                opt.text = w;
                weekSel.appendChild(opt);
            });
            weekSel.value = sortedWeeks[sortedWeeks.length - 1];

            const compSel = document.getElementById('select_competitor');
            competitors.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.text = c;
                compSel.appendChild(opt);
            });
        }

        function updateInteractive() {
            const week = document.getElementById('select_week').value;
            const comp = document.getElementById('select_competitor').value;

            // Get Data
            const weekData = marketData.filter(d => d.week_date === week);
            const ourData = weekData.filter(d => d.is_yaba_asin === 'Y');
            const compData = weekData.filter(d => d.competitor_brand === comp);

            // Calculate Avg Price
            const ourPrice = ourData.length ? ourData[0].price : 0;
            const compPrice = compData.length ? compData[0].price : 0;
            const priceDiff = ourPrice - compPrice;
            
            document.getElementById('int_price_diff').innerText = `${priceDiff > 0 ? '+' : ''}${priceDiff.toFixed(2)}`;
            document.getElementById('int_price_diff').className = `metric-val ${priceDiff > 0 ? 'text-red' : 'text-green'}`;
            document.getElementById('int_price_desc').innerText = `Nosotros: $${ourPrice} vs ${comp}: $${compPrice}`;

            // Calculate Share Gap
            const ourShare = ourData.reduce((s, i) => s + i.click_share, 0);
            const compShare = compData.reduce((s, i) => s + i.click_share, 0);
            const shareGap = ourShare - compShare;

            document.getElementById('int_share_gap').innerText = `${shareGap > 0 ? '+' : ''}${shareGap.toFixed(1)}%`;
            document.getElementById('int_share_gap').className = `metric-val ${shareGap > 0 ? 'text-green' : 'text-red'}`;

            drawInteractiveChart(ourShare, compShare, comp);
        }

        function drawInteractiveChart(ourShare = 0, compShare = 0, compName = "Competidor") {
            const data = google.visualization.arrayToDataTable([
                ['Marca', 'Click Share', { role: 'style' }],
                [ourBrandName, ourShare, '#4285F4'],
                [compName, compShare, '#EA4335']
            ]);

            const options = {
                title: 'Comparativa Directa de Cuota',
                legend: { position: 'none' },
                vAxis: { minValue: 0 }
            };

            const chart = new google.visualization.ColumnChart(document.getElementById('chart_interactive_bar'));
            chart.draw(data, options);
        }

        // --- UTILS ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('#tab-static, #tab-interactive').forEach(d => d.classList.add('hidden'));
            
            event.target.classList.add('active');
            document.getElementById(`tab-${tabId}`).classList.remove('hidden');
            
            // Redraw charts due to display:none issues
            if(tabId === 'static') { drawTrendChart(); drawShareChart(); drawScatterChart(); }
            else { updateInteractive(); }
        }

        window.addEventListener('resize', () => {
            drawTrendChart();
            drawShareChart();
            drawScatterChart();
            updateInteractive();
        });
    </script>
</body>
</html>