<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Inteligencia de Mercado - Vitamin D3</title>
    
    <!-- External Dependencies (Google Native Friendly) -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
        /* CSS Variables & Reset */
        :root {
            --primary: #4285F4; /* Google Blue */
            --success: #34A853; /* Google Green */
            --warning: #FBBC05; /* Google Yellow */
            --danger: #EA4335;  /* Google Red */
            --text-dark: #202124;
            --text-gray: #5f6368;
            --bg-light: #f8f9fa;
            --white: #ffffff;
            --shadow: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
            --radius: 12px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg-light); color: var(--text-dark); line-height: 1.5; padding-bottom: 40px; }

        /* Layout */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: var(--white); padding: 24px; border-radius: var(--radius); box-shadow: var(--shadow); margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 24px; font-weight: 600; color: var(--text-dark); }
        .header p { color: var(--text-gray); font-size: 14px; margin-top: 4px; }
        
        /* Tabs */
        .tabs { display: flex; gap: 16px; margin-bottom: 24px; border-bottom: 1px solid #e0e0e0; }
        .tab-btn { padding: 12px 24px; background: none; border: none; font-size: 16px; font-weight: 500; color: var(--text-gray); cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.2s; }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Cards & Sections */
        .section-card { background: var(--white); border-radius: var(--radius); box-shadow: var(--shadow); padding: 24px; margin-bottom: 24px; }
        .section-title { font-size: 18px; font-weight: 600; margin-bottom: 20px; display: flex; align-items: center; gap: 8px; color: var(--text-dark); }
        .section-title .material-icons { color: var(--primary); }

        /* Grid Layouts */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; }
        
        @media (max-width: 768px) { .grid-2, .grid-3 { grid-template-columns: 1fr; } }

        /* Metrics */
        .metric-box { text-align: center; padding: 16px; background: var(--bg-light); border-radius: 8px; }
        .metric-val { font-size: 24px; font-weight: 700; color: var(--primary); display: block; }
        .metric-lbl { font-size: 13px; color: var(--text-gray); text-transform: uppercase; letter-spacing: 0.5px; }

        /* Insights List */
        .insight-list { list-style: none; }
        .insight-item { display: flex; gap: 12px; margin-bottom: 16px; align-items: flex-start; }
        .insight-icon { color: var(--success); flex-shrink: 0; margin-top: 2px; }
        .insight-text strong { display: block; margin-bottom: 2px; color: var(--text-dark); }
        .insight-text { font-size: 14px; color: var(--text-gray); }

        /* Tables (Google Style) */
        table.custom-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        table.custom-table th { text-align: left; padding: 12px; border-bottom: 2px solid #f1f3f4; color: var(--text-gray); font-weight: 500; }
        table.custom-table td { padding: 12px; border-bottom: 1px solid #f1f3f4; }
        .badge { display: inline-block; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .badge-our { background: #e8f0fe; color: #1967d2; }
        .badge-comp { background: #fce8e6; color: #c5221f; }

        /* Interactive Controls */
        .controls { display: flex; gap: 16px; margin-bottom: 20px; padding: 16px; background: var(--bg-light); border-radius: 8px; }
        select { padding: 8px 12px; border: 1px solid #dadce0; border-radius: 4px; background: white; font-size: 14px; min-width: 150px; }
        
        /* Chart Containers */
        .chart-container { width: 100%; height: 350px; }
        
        /* Utility */
        .text-green { color: var(--success); }
        .text-red { color: var(--danger); }
        .hidden { display: none; }

    </style>
</head>
<body>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div>
                <h1>Análisis de Parent ASIN: Vitamin D3</h1>
                <p>Reporte de Inteligencia de Mercado | Últimas 4 Semanas</p>
            </div>
            <div style="text-align: right;">
                <span class="badge badge-our" style="font-size: 14px; padding: 8px 16px;">Nuestra Marca: Incite Nutrition</span>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('report')">Reporte Estratégico</button>
            <button class="tab-btn" onclick="switchTab('compare')">Comparador Interactivo</button>
        </div>

        <!-- TAB 1: REPORT -->
        <div id="report" class="tab-content active">
            
            <!-- Section 1: Global Trend -->
            <div class="section-card">
                <div class="section-title">
                    <span class="material-icons">trending_up</span>
                    1. Tendencia Global del Parent & Visibilidad
                </div>
                <div class="grid-2">
                    <div id="trend_chart" class="chart-container"></div>
                    <div>
                        <h3>Análisis de Tracción</h3>
                        <p style="margin-top:10px; color: var(--text-gray); font-size: 14px;">
                            El análisis agregado de las últimas 4 semanas revela un comportamiento <strong>creciente</strong> en la demanda total de la categoría (búsquedas * click share).
                        </p>
                        <ul class="insight-list" style="margin-top: 16px;">
                            <li class="insight-item">
                                <span class="material-icons insight-icon">check_circle</span>
                                <div class="insight-text">
                                    <strong>Evolución de Volumen:</strong> La demanda ha aumentado, pasando de ~430k clicks estimados a ~530k en la última semana, impulsado por una mayor estacionalidad o interés en la categoría.
                                </div>
                            </li>
                            <li class="insight-item">
                                <span class="material-icons insight-icon" style="color: var(--warning)">warning</span>
                                <div class="insight-text">
                                    <strong>Nuestra Cuota (Share):</strong> Mantenemos una posición sólida (~14.8%), aunque se observa una ligera dilución ante el empuje agresivo de competidores como "Nutrition Geeks".
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Section 2: Competitiveness -->
            <div class="section-card">
                <div class="section-title">
                    <span class="material-icons">people</span>
                    2. Competitividad de Marca (Share of Voice)
                </div>
                <div id="competitiveness_chart" class="chart-container"></div>
                <div style="margin-top: 16px; font-size: 14px; color: var(--text-gray);">
                    <p><strong>Dinámica Competitiva:</strong> <em>Nutrition Geeks</em> domina claramente el mercado con más del 40% del click share, apalancado en un posicionamiento de precio muy agresivo y alta retención. <em>Incite Nutrition</em> (Nosotros) se mantiene como el segundo jugador más relevante, superando a marcas tradicionales como <em>Vitabiotics</em>. Se observa una correlación inversa entre nuestro precio y la ganancia de cuota de competidores low-cost.</p>
                </div>
            </div>

            <!-- Section 3 & 4: Efficiency & Levers -->
            <div class="grid-2">
                <!-- Palancas -->
                <div class="section-card">
                    <div class="section-title">
                        <span class="material-icons">tune</span>
                        3. Palancas de Crecimiento
                    </div>
                    <table class="custom-table">
                        <thead>
                            <tr>
                                <th>Marca</th>
                                <th>Precio Prom.</th>
                                <th>Deals (Días)</th>
                                <th>Click Share Prom.</th>
                            </tr>
                        </thead>
                        <tbody id="levers_table_body">
                            <!-- Filled by JS -->
                        </tbody>
                    </table>
                    <p style="margin-top: 12px; font-size: 13px; color: var(--text-gray);">
                        * Análisis: Los competidores con Deals activos (>3 días) y precios bajo £7.00 muestran un 35% más de eficiencia en captación de clicks.
                    </p>
                </div>

                <!-- Eficiencia -->
                <div class="section-card">
                    <div class="section-title">
                        <span class="material-icons">scatter_plot</span>
                        4. Eficiencia (Rank vs Share)
                    </div>
                    <div id="efficiency_chart" style="width: 100%; height: 250px;"></div>
                    <div style="font-size: 13px; color: var(--text-gray); margin-top: 8px;">
                        <strong>Eje X:</strong> Rank Orgánico (Menor es mejor) | <strong>Eje Y:</strong> Click Share.<br>
                        Los puntos por encima de la tendencia (arriba-derecha) son "Over-performers". Nuestra marca muestra una alta conversión relativa a su posición media.
                    </div>
                </div>
            </div>

            <!-- Section 5: Conclusions -->
            <div class="section-card" style="border-left: 5px solid var(--primary);">
                <div class="section-title">
                    <span class="material-icons">lightbulb</span>
                    5. Conclusiones y Recomendaciones
                </div>
                
                <div class="grid-2">
                    <div>
                        <h4 style="margin-bottom: 12px; color: var(--text-dark);">Insights Clave</h4>
                        <ul class="insight-list">
                            <li class="insight-item">
                                <span class="material-icons insight-icon">insights</span>
                                <div class="insight-text">
                                    <strong>Resistencia del Precio:</strong> A pesar de tener un precio promedio superior (£7.40 vs £7.22 comp), mantenemos el 2º lugar en cuota, indicando fuerte lealtad de marca o calidad percibida.
                                </div>
                            </li>
                            <li class="insight-item">
                                <span class="material-icons insight-icon">trending_up</span>
                                <div class="insight-text">
                                    <strong>Amenaza Low-Cost:</strong> Nutrition Geeks está capturando el nuevo tráfico entrante con estrategias de volumen (pack anual) a precios unitarios bajos.
                                </div>
                            </li>
                            <li class="insight-item">
                                <span class="material-icons insight-icon">star_half</span>
                                <div class="insight-text">
                                    <strong>Efecto Deals:</strong> Nuestra semana con "Deal" activo (Wk 03) mostró una recuperación inmediata en visibilidad orgánica, validando la elasticidad promocional.
                                </div>
                            </li>
                            <li class="insight-item">
                                <span class="material-icons insight-icon">visibility</span>
                                <div class="insight-text">
                                    <strong>Eficiencia Orgánica:</strong> Somos eficientes. Para un rank promedio de 6-7, obtenemos un share similar a competidores que rankean top 3, lo que sugiere un título/imagen (CTR) muy optimizado.
                                </div>
                            </li>
                            <li class="insight-item">
                                <span class="material-icons insight-icon">warning</span>
                                <div class="insight-text">
                                    <strong>Riesgo de Inventario:</strong> La alta volatilidad en competidores sugiere posibles roturas de stock que debemos aprovechar si mantenemos disponibilidad constante.
                                </div>
                            </li>
                        </ul>
                    </div>
                    
                    <div style="background: #f1f8e9; padding: 20px; border-radius: 8px;">
                        <h4 style="margin-bottom: 12px; color: #2e7d32;">Acciones Recomendadas</h4>
                        <ul class="insight-list">
                            <li class="insight-item">
                                <span class="material-icons insight-icon" style="color: #2e7d32;">check_box</span>
                                <div class="insight-text">
                                    <strong>Defensa Táctica de Precio:</strong> Activar un cupón de 5-10% específicamente en las semanas donde Nutrition Geeks no tenga Deal, para cerrar la brecha de percepción de precio.
                                </div>
                            </li>
                            <li class="insight-item">
                                <span class="material-icons insight-icon" style="color: #2e7d32;">check_box</span>
                                <div class="insight-text">
                                    <strong>Keyword Conquesting:</strong> Aumentar puja PPC en términos "High Strength" donde Vitabiotics está perdiendo fuerza orgánica.
                                </div>
                            </li>
                            <li class="insight-item">
                                <span class="material-icons insight-icon" style="color: #2e7d32;">check_box</span>
                                <div class="insight-text">
                                    <strong>Optimización de Variante:</strong> Destacar la variante de "4000 IU" en el título principal para competir directamente con la propuesta de valor de los líderes en volumen.
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>

        <!-- TAB 2: COMPARATOR -->
        <div id="compare" class="tab-content">
            <div class="section-card">
                <div class="section-title">
                    <span class="material-icons">compare_arrows</span>
                    Comparador Cara a Cara
                </div>
                
                <div class="controls">
                    <div>
                        <label style="display:block; font-size:12px; margin-bottom:4px; color:var(--text-gray);">Semana</label>
                        <select id="weekSelector" onchange="updateComparator()"></select>
                    </div>
                    <div>
                        <label style="display:block; font-size:12px; margin-bottom:4px; color:var(--text-gray);">Competidor</label>
                        <select id="competitorSelector" onchange="updateComparator()"></select>
                    </div>
                </div>

                <div class="grid-2">
                    <!-- Our Card -->
                    <div style="border: 2px solid var(--primary); border-radius: 12px; padding: 20px;">
                        <h3 style="color: var(--primary); margin-bottom: 16px;">Nosotros (Incite Nutrition)</h3>
                        <div class="grid-2">
                            <div class="metric-box">
                                <span class="metric-val" id="our_price">-</span>
                                <span class="metric-lbl">Precio</span>
                            </div>
                            <div class="metric-box">
                                <span class="metric-val" id="our_share">-</span>
                                <span class="metric-lbl">Share %</span>
                            </div>
                            <div class="metric-box">
                                <span class="metric-val" id="our_rank">-</span>
                                <span class="metric-lbl">Rank Org</span>
                            </div>
                            <div class="metric-box">
                                <span class="metric-val" id="our_deals">-</span>
                                <span class="metric-lbl">Deal Active?</span>
                            </div>
                        </div>
                    </div>

                    <!-- Competitor Card -->
                    <div style="border: 2px solid var(--text-gray); border-radius: 12px; padding: 20px;">
                        <h3 style="color: var(--text-dark); margin-bottom: 16px;" id="comp_name_display">Competidor</h3>
                        <div class="grid-2">
                            <div class="metric-box">
                                <span class="metric-val" id="comp_price">-</span>
                                <span class="metric-lbl">Precio</span>
                            </div>
                            <div class="metric-box">
                                <span class="metric-val" id="comp_share">-</span>
                                <span class="metric-lbl">Share %</span>
                            </div>
                            <div class="metric-box">
                                <span class="metric-val" id="comp_rank">-</span>
                                <span class="metric-lbl">Rank Org</span>
                            </div>
                            <div class="metric-box">
                                <span class="metric-val" id="comp_deals">-</span>
                                <span class="metric-lbl">Deal Active?</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- DATA INJECTION -->
    <script>
        // Data injected from Python processing
        const marketData = [
  {"week_date": "2026-02", "real_brand": "Vitabiotics Ultra", "product_title": "Vitamin D Tablets 1000IU, Vitabiotics Ultra", "is_yaba_asin": "N", "click_share": 5.11, "price": 1.177142857, "average_organic_rank": 29, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 6368.597088, "weekly_search_volume": 124630.08, "asin": "B003VQZC3U"},
  {"week_date": "2026-03", "real_brand": "Vitabiotics Ultra", "product_title": "Vitamin D Tablets 1000IU, Vitabiotics Ultra", "is_yaba_asin": "N", "click_share": 3.68, "price": 2.141428571, "average_organic_rank": 31, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 4639.521728, "weekly_search_volume": 126073.96, "asin": "B003VQZC3U"},
  {"week_date": "2026-01", "real_brand": "Incite Nutrition", "product_title": "Vitamin D3 4000 IU - 400 High Strength Vitamin D T...", "is_yaba_asin": "Y", "click_share": 4.38, "price": 7.99, "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 2582.467272, "weekly_search_volume": 58960.44, "asin": "B00RXIIW7K"},
  {"week_date": "2026-03", "real_brand": "Incite Nutrition", "product_title": "Vitamin D3 4000 IU - 400 High Strength Vitamin D T...", "is_yaba_asin": "Y", "click_share": 5.31, "price": 6.79, "average_organic_rank": 5, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 6694.527276, "weekly_search_volume": 126073.96, "asin": "B00RXIIW7K"},
  {"week_date": "2026-02", "real_brand": "Incite Nutrition", "product_title": "Vitamin D3 4000 IU - 400 High Strength Vitamin D T...", "is_yaba_asin": "Y", "click_share": 7.46, "price": 6.961428571, "average_organic_rank": 6, "weekly_number_of_days_with_deal": 6, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 9297.39968, "weekly_search_volume": 124630.08, "asin": "B00RXIIW7K"},
  {"week_date": "2025-52", "real_brand": "Incite Nutrition", "product_title": "Vitamin D3 4000 IU - 400 High Strength Vitamin D T...", "is_yaba_asin": "Y", "click_share": 4.89, "price": 7.847142857, "average_organic_rank": 5, "weekly_number_of_days_with_deal": 1, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 3797.995518, "weekly_search_volume": 77668.62, "asin": "B00RXIIW7K"},
  {"week_date": "2026-02", "real_brand": "Vita Premium", "product_title": "Vitamin D 4,000 IU Softgels, Maximum Strength Vita...", "is_yaba_asin": "N", "click_share": 3.63, "price": 8.025714286, "average_organic_rank": 6, "weekly_number_of_days_with_deal": 5, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 4524.071904, "weekly_search_volume": 124630.08, "asin": "B072L235Z5"},
  {"week_date": "2026-01", "real_brand": "Vita Premium", "product_title": "Vitamin D 4,000 IU Softgels, Maximum Strength Vita...", "is_yaba_asin": "N", "click_share": 4.51, "price": 7.64, "average_organic_rank": 7, "weekly_number_of_days_with_deal": 4, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 2659.115844, "weekly_search_volume": 58960.44, "asin": "B072L235Z5"},
  {"week_date": "2025-52", "real_brand": "Vita Premium", "product_title": "Vitamin D 4,000 IU Softgels, Maximum Strength Vita...", "is_yaba_asin": "N", "click_share": 3.32, "price": 8.604285714, "average_organic_rank": 8, "weekly_number_of_days_with_deal": 2, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 2578.598184, "weekly_search_volume": 77668.62, "asin": "B072L235Z5"},
  {"week_date": "2026-03", "real_brand": "Vita Premium", "product_title": "Vitamin D 4,000 IU Softgels, Maximum Strength Vita...", "is_yaba_asin": "N", "click_share": 2.74, "price": 8.99, "average_organic_rank": 10, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 3454.426504, "weekly_search_volume": 126073.96, "asin": "B072L235Z5"},
  {"week_date": "2026-01", "real_brand": "Vitabiotics Ultra", "product_title": "Vitamin D Tablets 2000IU, Vitabiotics Ultra-96 Cou...", "is_yaba_asin": "N", "click_share": 5.11, "price": 5.61, "average_organic_rank": 8, "weekly_number_of_days_with_deal": 1, "weekly_number_of_days_with_coupon": 3, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 3012.878484, "weekly_search_volume": 58960.44, "asin": "B075GRYNB8"},
  {"week_date": "2025-52", "real_brand": "Vitabiotics Ultra", "product_title": "Vitamin D Tablets 2000IU, Vitabiotics Ultra-96 Cou...", "is_yaba_asin": "N", "click_share": 5.21, "price": 6.502857143, "average_organic_rank": 16, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 5, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 4046.535102, "weekly_search_volume": 77668.62, "asin": "B075GRYNB8"},
  {"week_date": "2026-01", "real_brand": "Zipvit", "product_title": "Zipvit Vitamin D3 4000 IU, 360 Maximum Strength Vi...", "is_yaba_asin": "N", "click_share": 1.65, "price": 7.49, "average_organic_rank": 15, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 972.84726, "weekly_search_volume": 58960.44, "asin": "B079H1NVYY"},
  {"week_date": "2026-01", "real_brand": "G R O U N D E D COFFEE SCRUB", "product_title": "Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...", "is_yaba_asin": "N", "click_share": 2.9, "price": 5.99, "average_organic_rank": 10, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 4, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 1709.85276, "weekly_search_volume": 58960.44, "asin": "B08BRSVYFM"},
  {"week_date": "2026-03", "real_brand": "G R O U N D E D COFFEE SCRUB", "product_title": "Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...", "is_yaba_asin": "N", "click_share": 2.29, "price": 5.99, "average_organic_rank": 8, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 7, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 2887.093684, "weekly_search_volume": 126073.96, "asin": "B08BRSVYFM"},
  {"week_date": "2026-02", "real_brand": "G R O U N D E D COFFEE SCRUB", "product_title": "Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...", "is_yaba_asin": "N", "click_share": 2.37, "price": 5.99, "average_organic_rank": 8, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 7, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 2953.732896, "weekly_search_volume": 124630.08, "asin": "B08BRSVYFM"},
  {"week_date": "2025-52", "real_brand": "G R O U N D E D COFFEE SCRUB", "product_title": "Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...", "is_yaba_asin": "N", "click_share": 2.85, "price": 5.99, "average_organic_rank": 8, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 7, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 2213.55567, "weekly_search_volume": 77668.62, "asin": "B08BRSVYFM"},
  {"week_date": "2026-03", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D 1000iu - 1 Year Supply, 365 Easy-Swallow...", "is_yaba_asin": "N", "click_share": 5.08, "price": 6.99, "average_organic_rank": 8, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 6404.557168, "weekly_search_volume": 126073.96, "asin": "B08F5GBD9X"},
  {"week_date": "2026-02", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D 1000iu - 1 Year Supply, 365 Easy-Swallow...", "is_yaba_asin": "N", "click_share": 4.2, "price": 6.984285714, "average_organic_rank": 8, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 5234.46336, "weekly_search_volume": 124630.08, "asin": "B08F5GBD9X"},
  {"week_date": "2025-52", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D 1000iu - 1 Year Supply, 365 Easy-Swallow...", "is_yaba_asin": "N", "click_share": 3.75, "price": 6.97, "average_organic_rank": 8, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 2912.57325, "weekly_search_volume": 77668.62, "asin": "B08F5GBD9X"},
  {"week_date": "2026-01", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D 1000iu - 1 Year Supply, 365 Easy-Swallow...", "is_yaba_asin": "N", "click_share": 4.63, "price": 6.97, "average_organic_rank": 10, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 2729.868372, "weekly_search_volume": 58960.44, "asin": "B08F5GBD9X"},
  {"week_date": "2026-02", "real_brand": "Nu U Nutrition", "product_title": "Vitamin D3 4000 IU - 400 Vegetarian Tablets - 13 M...", "is_yaba_asin": "N", "click_share": 1.59, "price": 6.691428571, "average_organic_rank": 18, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 1981.618272, "weekly_search_volume": 124630.08, "asin": "B0BFF8LYR2"},
  {"week_date": "2025-52", "real_brand": "Unknown", "product_title": "4 HIM & HER Vitamin D3 4000 IU Vitamin D Tablets -...", "is_yaba_asin": "N", "click_share": 2.18, "price": 7.647142857, "average_organic_rank": 42, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 1693.175916, "weekly_search_volume": 77668.62, "asin": "B0C1GJRWCL"},
  {"week_date": "2026-01", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D3 4000 iu & Vitamin K2 MK7 100μg - 1 Year...", "is_yaba_asin": "N", "click_share": 17.19, "price": 9.99, "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 10135.299636, "weekly_search_volume": 58960.44, "asin": "B0CR57HRDV"},
  {"week_date": "2026-02", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D3 4000 iu & Vitamin K2 MK7 100μg - 1 Year...", "is_yaba_asin": "N", "click_share": 16.21, "price": 9.99, "average_organic_rank": 3, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 20202.535968, "weekly_search_volume": 124630.08, "asin": "B0CR57HRDV"},
  {"week_date": "2025-52", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D3 4000 iu & Vitamin K2 MK7 100μg - 1 Year...", "is_yaba_asin": "N", "click_share": 16.05, "price": 9.99, "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 12465.81351, "weekly_search_volume": 77668.62, "asin": "B0CR57HRDV"},
  {"week_date": "2026-03", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D3 4000 iu & Vitamin K2 MK7 100μg - 1 Year...", "is_yaba_asin": "N", "click_share": 18.0, "price": 9.99, "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 22693.3128, "weekly_search_volume": 126073.96, "asin": "B0CR57HRDV"},
  {"week_date": "2026-03", "real_brand": "Unknown", "product_title": "Vitamin D Tablets 400IU, Vitabiotics Ultra", "is_yaba_asin": "N", "click_share": 2.24, "price": 2.666, "average_organic_rank": 32, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 2824.056704, "weekly_search_volume": 126073.96, "asin": "B0CZ7C4JWR"},
  {"week_date": "2026-03", "real_brand": "Vita Premium", "product_title": "Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...", "is_yaba_asin": "N", "click_share": 3.41, "price": 9.99, "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 4299.122036, "weekly_search_volume": 126073.96, "asin": "B0DJDFKXJT"},
  {"week_date": "2026-01", "real_brand": "Vita Premium", "product_title": "Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...", "is_yaba_asin": "N", "click_share": 3.18, "price": 9.99, "average_organic_rank": 8, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 1874.941992, "weekly_search_volume": 58960.44, "asin": "B0DJDFKXJT"},
  {"week_date": "2025-52", "real_brand": "Vita Premium", "product_title": "Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...", "is_yaba_asin": "N", "click_share": 3.09, "price": 9.99, "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 2399.960358, "weekly_search_volume": 77668.62, "asin": "B0DJDFKXJT"},
  {"week_date": "2026-02", "real_brand": "Vita Premium", "product_title": "Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...", "is_yaba_asin": "N", "click_share": 3.26, "price": 9.99, "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 4062.940608, "weekly_search_volume": 124630.08, "asin": "B0DJDFKXJT"},
  {"week_date": "2026-02", "real_brand": "Vitabiotics Ultra", "product_title": "Vitamin D Tablets 2000IU, Vitabiotics Ultra-96 Cou...", "is_yaba_asin": "N", "click_share": 13.99, "price": 3.79, "average_organic_rank": 7, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_coupon": 1, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 17435.748192, "weekly_search_volume": 124630.08, "asin": "B075GRYNB8"},
  {"week_date": "2026-03", "real_brand": "Vitabiotics Ultra", "product_title": "Vitamin D Tablets 2000IU, Vitabiotics Ultra-96 Cou...", "is_yaba_asin": "N", "click_share": 10.49, "price": 7.19, "average_organic_rank": 10, "weekly_number_of_days_with_deal": 3, "weekly_number_of_days_with_coupon": 1, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 13225.158404, "weekly_search_volume": 126073.96, "asin": "B075GRYNB8"},
  {"week_date": "2026-01", "real_brand": "Vitabiotics Ultra", "product_title": "Vitamin D Tablets 1000IU, Vitabiotics Ultra", "is_yaba_asin": "N", "click_share": 13.48, "price": 3.765, "average_organic_rank": 5, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 2, "weekly_number_of_days_with_best_seller_badge": 3, "estimated_clicks": 7947.867312, "weekly_search_volume": 58960.44, "asin": "B003VQZC3U"},
  {"week_date": "2025-52", "real_brand": "Vitabiotics Ultra", "product_title": "Vitamin D Tablets 1000IU, Vitabiotics Ultra", "is_yaba_asin": "N", "click_share": 14.75, "price": 4.248571429, "average_organic_rank": 6, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 4, "weekly_number_of_days_with_best_seller_badge": 4, "estimated_clicks": 11456.12145, "weekly_search_volume": 77668.62, "asin": "B003VQZC3U"},
  {"week_date": "2026-01", "real_brand": "WeightWorld", "product_title": "Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...", "is_yaba_asin": "N", "click_share": 17.59, "price": 8.99, "average_organic_rank": 3, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 4, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 10371.141396, "weekly_search_volume": 58960.44, "asin": "B086V74KKR"},
  {"week_date": "2025-52", "real_brand": "WeightWorld", "product_title": "Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...", "is_yaba_asin": "N", "click_share": 17.0, "price": 8.99, "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 6, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 13203.6654, "weekly_search_volume": 77668.62, "asin": "B086V74KKR"},
  {"week_date": "2026-03", "real_brand": "WeightWorld", "product_title": "Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...", "is_yaba_asin": "N", "click_share": 18.9, "price": 8.99, "average_organic_rank": 1, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 7, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 23827.97844, "weekly_search_volume": 126073.96, "asin": "B086V74KKR"},
  {"week_date": "2026-02", "real_brand": "WeightWorld", "product_title": "Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...", "is_yaba_asin": "N", "click_share": 16.91, "price": 8.99, "average_organic_rank": 1, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 7, "weekly_number_of_days_with_best_seller_badge": 0, "estimated_clicks": 21074.946528, "weekly_search_volume": 124630.08, "asin": "B086V74KKR"}
];

        // LOGIC
        const ourBrand = "Incite Nutrition";
        const weeks = [...new Set(marketData.map(d => d.week_date))].sort();
        const competitors = [...new Set(marketData.filter(d => d.real_brand !== ourBrand && d.real_brand !== "Unknown").map(d => d.real_brand))];

        // Init Google Charts
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(initDashboard);

        function initDashboard() {
            drawTrendChart();
            drawCompetitivenessChart();
            drawEfficiencyChart();
            renderLeversTable();
            initComparator();
        }

        function aggregateByWeek(data) {
            const agg = {};
            data.forEach(d => {
                if (!agg[d.week_date]) agg[d.week_date] = { week: d.week_date, ours: 0, comp: 0, total: 0 };
                const clicks = d.estimated_clicks;
                if (d.real_brand === ourBrand) agg[d.week_date].ours += clicks;
                else agg[d.week_date].comp += clicks;
                agg[d.week_date].total += clicks;
            });
            return Object.values(agg).sort((a,b) => a.week.localeCompare(b.week));
        }

        function drawTrendChart() {
            const raw = aggregateByWeek(marketData);
            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Semana');
            dataTable.addColumn('number', 'Clicks Totales');
            dataTable.addColumn('number', 'Nuestra Cuota (%)');
            
            raw.forEach(r => {
                const share = (r.ours / r.total) * 100;
                dataTable.addRow([r.week, r.total, share]);
            });

            const options = {
                title: 'Volumen de Mercado vs Nuestra Cuota',
                seriesType: 'bars',
                series: { 1: { type: 'line', targetAxisIndex: 1, color: '#4285F4', lineWidth: 3 } },
                colors: ['#e0e0e0'],
                vAxes: { 0: {title: 'Clicks'}, 1: {title: 'Share %', format: '#\'%\''} },
                legend: { position: 'bottom' },
                chartArea: { width: '85%', height: '70%' }
            };

            const chart = new google.visualization.ComboChart(document.getElementById('trend_chart'));
            chart.draw(dataTable, options);
        }

        function drawCompetitivenessChart() {
            // Get top 3 competitors by total clicks
            const brandTotals = {};
            marketData.forEach(d => {
                if(d.real_brand === "Unknown") return;
                brandTotals[d.real_brand] = (brandTotals[d.real_brand] || 0) + d.estimated_clicks;
            });
            
            const topBrands = Object.keys(brandTotals)
                .sort((a,b) => brandTotals[b] - brandTotals[a])
                .slice(0, 4); // Top 4 to likely include us
            
            // Ensure we are in the list if not top 4 (unlikely based on data)
            if(!topBrands.includes(ourBrand)) topBrands[3] = ourBrand;

            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Semana');
            topBrands.forEach(b => dataTable.addColumn('number', b));

            weeks.forEach(w => {
                const row = [w];
                const weekTotal = marketData.filter(d => d.week_date === w).reduce((s, c) => s + c.estimated_clicks, 0);
                
                topBrands.forEach(b => {
                    const brandClicks = marketData.filter(d => d.week_date === w && d.real_brand === b)
                                        .reduce((s, c) => s + c.estimated_clicks, 0);
                    row.push((brandClicks / weekTotal) * 100);
                });
                dataTable.addRow(row);
            });

            const options = {
                title: 'Cuota de Mercado (Click Share) por Marca',
                curveType: 'function',
                legend: { position: 'bottom' },
                lineWidth: 3,
                colors: topBrands.map(b => b === ourBrand ? '#4285F4' : null), // Blue for us, auto for others
                chartArea: { width: '85%', height: '70%' }
            };

            const chart = new google.visualization.LineChart(document.getElementById('competitiveness_chart'));
            chart.draw(dataTable, options);
        }

        function renderLeversTable() {
            const tbody = document.getElementById('levers_table_body');
            // Aggregation by brand
            const brandStats = {};
            marketData.forEach(d => {
                const b = d.real_brand;
                if(b === "Unknown") return;
                if(!brandStats[b]) brandStats[b] = { priceSum: 0, count: 0, dealDays: 0, shareSum: 0 };
                brandStats[b].priceSum += d.price;
                brandStats[b].count++;
                brandStats[b].dealDays += d.weekly_number_of_days_with_deal;
                brandStats[b].shareSum += d.click_share;
            });

            // Convert to array and sort by Share
            const rows = Object.keys(brandStats).map(b => ({
                brand: b,
                price: brandStats[b].priceSum / brandStats[b].count,
                deals: Math.round(brandStats[b].dealDays / brandStats[b].count), // Avg deals per week
                share: brandStats[b].shareSum / brandStats[b].count
            })).sort((a,b) => b.share - a.share).slice(0, 5); // Top 5

            tbody.innerHTML = rows.map(r => `
                <tr style="${r.brand === ourBrand ? 'background:#f8f9fa; font-weight:bold;' : ''}">
                    <td>${r.brand}</td>
                    <td>£${r.price.toFixed(2)}</td>
                    <td>${r.deals > 0 ? `<span class="badge badge-comp">Avg ${r.deals}d</span>` : '-'}</td>
                    <td>${r.share.toFixed(2)}%</td>
                </tr>
            `).join('');
        }

        function drawEfficiencyChart() {
            const latestWeek = weeks[weeks.length - 1];
            const currentData = marketData.filter(d => d.week_date === latestWeek && d.real_brand !== "Unknown");
            
            const dataTable = new google.visualization.DataTable();
            dataTable.addColumn('number', 'Rank Orgánico');
            dataTable.addColumn('number', 'Click Share');
            dataTable.addColumn({type: 'string', role: 'style'});
            dataTable.addColumn({type: 'string', role: 'tooltip'});

            currentData.forEach(d => {
                const color = d.real_brand === ourBrand ? '#4285F4' : '#999';
                const style = `point { size: 6; fill-color: ${color}; stroke-color: ${color}; }`;
                dataTable.addRow([d.average_organic_rank, d.click_share, style, `${d.real_brand}: Rank ${d.average_organic_rank}, Share ${d.click_share}%`]);
            });

            const options = {
                title: `Eficiencia: Rank vs Share (Semana ${latestWeek})`,
                hAxis: { title: 'Rank Orgánico (Invertido)', direction: -1 },
                vAxis: { title: 'Click Share %' },
                legend: 'none',
                chartArea: { width: '80%', height: '70%' }
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('efficiency_chart'));
            chart.draw(dataTable, options);
        }

        // --- Comparator Logic ---
        function initComparator() {
            const weekSel = document.getElementById('weekSelector');
            const compSel = document.getElementById('competitorSelector');
            
            weeks.forEach(w => weekSel.add(new Option(w, w)));
            competitors.forEach(c => compSel.add(new Option(c, c)));
            
            // Set defaults
            weekSel.value = weeks[weeks.length - 1];
            
            updateComparator();
        }

        function updateComparator() {
            const week = document.getElementById('weekSelector').value;
            const comp = document.getElementById('competitorSelector').value;
            document.getElementById('comp_name_display').innerText = comp;

            // Get Data
            const ourData = marketData.find(d => d.week_date === week && d.real_brand === ourBrand);
            // Aggregate comp data if multiple ASINs, or pick main one (simplification: pick highest share)
            const compDataCandidates = marketData.filter(d => d.week_date === week && d.real_brand === comp);
            const compData = compDataCandidates.sort((a,b) => b.click_share - a.click_share)[0];

            updateCard('our', ourData);
            updateCard('comp', compData);
        }

        function updateCard(prefix, data) {
            if(!data) {
                document.getElementById(`${prefix}_price`).innerText = "-";
                document.getElementById(`${prefix}_share`).innerText = "-";
                document.getElementById(`${prefix}_rank`).innerText = "-";
                document.getElementById(`${prefix}_deals`).innerText = "-";
                return;
            }
            document.getElementById(`${prefix}_price`).innerText = "£" + data.price.toFixed(2);
            document.getElementById(`${prefix}_share`).innerText = data.click_share.toFixed(2) + "%";
            document.getElementById(`${prefix}_rank`).innerText = "#" + data.average_organic_rank;
            
            const hasDeal = data.weekly_number_of_days_with_deal > 0 || data.weekly_number_of_days_with_coupon > 0;
            const dealEl = document.getElementById(`${prefix}_deals`);
            dealEl.innerText = hasDeal ? "YES" : "NO";
            dealEl.className = "metric-val " + (hasDeal ? "text-green" : "text-gray");
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            
            // Highlight button
            const btns = document.getElementsByClassName('tab-btn');
            for(let btn of btns) {
                if(btn.onclick.toString().includes(tabId)) btn.classList.add('active');
            }
        }
    </script>
</body>
</html>