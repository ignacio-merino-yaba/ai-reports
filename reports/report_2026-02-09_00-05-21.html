<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon ASIN Performance Report</title>
    <!-- Google Charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #4285F4;
            --success-color: #34A853;
            --warning-color: #FBBC05;
            --danger-color: #EA4335;
            --bg-color: #F8F9FA;
            --card-bg: #FFFFFF;
            --text-primary: #202124;
            --text-secondary: #5F6368;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            margin: 0;
            font-size: 24px;
            color: var(--text-primary);
        }

        .tabs {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .section-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
        }

        .chart-container {
            width: 100%;
            height: 400px;
            margin-top: 16px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .metric-card {
            background: #f1f3f4;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .metric-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .insight-box {
            background: #e8f0fe;
            border-left: 4px solid var(--primary-color);
            padding: 16px;
            margin-top: 16px;
            border-radius: 0 8px 8px 0;
        }
        
        .insight-title {
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Comparator Styles */
        .comparator-controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            background: var(--card-bg);
            padding: 16px;
            border-radius: 8px;
        }

        select {
            padding: 8px 16px;
            border-radius: 4px;
            border: 1px solid #dadce0;
            font-family: 'Roboto', sans-serif;
            font-size: 14px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        
        .comparison-table th, .comparison-table td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .comparison-table th {
            background-color: #f5f5f5;
            font-weight: 500;
        }

        /* Utility */
        .hidden { display: none; }
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        .badge-our { background: #e8f0fe; color: #1967d2; }
        .badge-comp { background: #fce8e6; color: #c5221f; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1>üì¶ Parent ASIN Analysis Report</h1>
            <div style="font-size: 14px; color: var(--text-secondary); margin-top: 4px;">
                Generated Analysis | <span id="date-range">Last 5 Weeks</span>
            </div>
        </div>
        <div style="text-align: right;">
            <span class="badge badge-our" style="font-size: 14px;">Our Brand: YabaBrand</span>
        </div>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('report')">üìä Strategic Report</button>
        <button class="tab-btn" onclick="switchTab('comparator')">‚öñÔ∏è Interactive Comparator</button>
    </div>

    <!-- REPORT TAB -->
    <div id="report-view">
        
        <!-- 1. Global Trend -->
        <div class="section-card">
            <h2>1. Global Trend & Market Traction</h2>
            <p style="color: var(--text-secondary);">Evolution of Total Clicks & Click Share (Our Brand vs. Competitors)</p>
            <div id="trend_chart" class="chart-container"></div>
            <div id="trend-insights" class="insight-box">
                <div class="insight-title"><i class="material-icons">trending_up</i> Trend Analysis</div>
                <div id="trend-text">Loading analysis...</div>
            </div>
        </div>

        <!-- 2. Competitiveness -->
        <div class="section-card">
            <h2>2. Brand Competitiveness</h2>
            <p style="color: var(--text-secondary);">Click Share Evolution (Top 3 Brands)</p>
            <div id="comp_chart" class="chart-container"></div>
            <div class="metrics-grid" id="top-brands-metrics" style="margin-top:20px;"></div>
        </div>

        <!-- 3. Drivers -->
        <div class="section-card">
            <h2>3. üöÄ Growth Levers (Drivers)</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Deal Impact</div>
                    <div class="metric-value" id="deal-impact">--</div>
                    <div style="font-size:12px; color:green;">vs Non-Deal Days</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Coupon Impact</div>
                    <div class="metric-value" id="coupon-impact">--</div>
                    <div style="font-size:12px; color:green;">vs Non-Coupon Days</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Price Correlation</div>
                    <div class="metric-value" id="price-corr">--</div>
                    <div style="font-size:12px; color:var(--text-secondary);">Price vs Share</div>
                </div>
            </div>
        </div>

        <!-- 4. Efficiency -->
        <div class="section-card">
            <h2>4. üëÅÔ∏è Efficiency: Organic Rank vs Click Share</h2>
            <p style="color: var(--text-secondary);">Identify Over/Under-performers (Top Left = High Efficiency)</p>
            <div id="efficiency_chart" class="chart-container"></div>
            <div id="efficiency-insights" class="insight-box">
                <div class="insight-title"><i class="material-icons">lightbulb</i> Efficiency Insights</div>
                <div id="efficiency-text">Loading...</div>
            </div>
        </div>

        <!-- 5. Conclusions -->
        <div class="section-card" style="border-left: 5px solid var(--primary-color);">
            <h2>5. üí° Key Conclusions & Recommendations</h2>
            <div id="conclusions-container">
                <!-- Populated by JS -->
            </div>
        </div>

    </div>

    <!-- COMPARATOR TAB -->
    <div id="comparator-view" class="hidden">
        <div class="comparator-controls">
            <div>
                <label style="display:block; font-size:12px; color:var(--text-secondary); margin-bottom:4px;">Select Week</label>
                <select id="week-selector" onchange="updateComparator()"></select>
            </div>
            <div>
                <label style="display:block; font-size:12px; color:var(--text-secondary); margin-bottom:4px;">Filter Competitor</label>
                <select id="comp-selector" onchange="updateComparator()">
                    <option value="all">All Competitors</option>
                </select>
            </div>
        </div>
        
        <div class="section-card">
            <h3>Head-to-Head Comparison</h3>
            <div id="comparison-table_div"></div>
        </div>
    </div>

</div>

<script>
    // INJECTED DATA
    const marketData = [{"week_date": "2023-09-01", "competitor_brand": "YabaBrand", "asin": "ASIN_Y1", "product_title": "YabaBrand Premium Widget Y1", "is_yaba_asin": "Y", "price": 25.87, "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 51711, "click_share": 0.2877, "clicks": 14876}, {"week_date": "2023-09-01", "competitor_brand": "YabaBrand", "asin": "ASIN_Y2", "product_title": "YabaBrand Premium Widget Y2", "is_yaba_asin": "Y", "price": 25.98, "average_organic_rank": 9, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 51711, "click_share": 0.0767, "clicks": 3967}, {"week_date": "2023-09-01", "competitor_brand": "AlphaComp", "asin": "ASIN_A1", "product_title": "AlphaComp Premium Widget A1", "is_yaba_asin": "N", "price": 21.77, "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 51711, "click_share": 0.4315, "clicks": 22314}, {"week_date": "2023-09-01", "competitor_brand": "AlphaComp", "asin": "ASIN_A2", "product_title": "AlphaComp Premium Widget A2", "is_yaba_asin": "N", "price": 23.89, "average_organic_rank": 7, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 51711, "click_share": 0.1356, "clicks": 7013}, {"week_date": "2023-09-01", "competitor_brand": "BetaComp", "asin": "ASIN_B1", "product_title": "BetaComp Premium Widget B1", "is_yaba_asin": "N", "price": 28.46, "average_organic_rank": 38, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 51711, "click_share": 0.0151, "clicks": 782}, {"week_date": "2023-09-01", "competitor_brand": "GammaComp", "asin": "ASIN_C1", "product_title": "GammaComp Premium Widget C1", "is_yaba_asin": "N", "price": 20.9, "average_organic_rank": 45, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 51711, "click_share": 0.0128, "clicks": 661}, {"week_date": "2023-09-01", "competitor_brand": "GenericCo", "asin": "ASIN_G1", "product_title": "GenericCo Premium Widget G1", "is_yaba_asin": "N", "price": 14.59, "average_organic_rank": 20, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 51711, "click_share": 0.0288, "clicks": 1487}, {"week_date": "2023-09-01", "competitor_brand": "GenericCo", "asin": "ASIN_G2", "product_title": "GenericCo Premium Widget G2", "is_yaba_asin": "N", "price": 14.13, "average_organic_rank": 49, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 51711, "click_share": 0.0117, "clicks": 607}, {"week_date": "2023-09-08", "competitor_brand": "YabaBrand", "asin": "ASIN_Y1", "product_title": "YabaBrand Premium Widget Y1", "is_yaba_asin": "Y", "price": 23.13, "average_organic_rank": 11, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 57057, "click_share": 0.1533, "clicks": 8747}, {"week_date": "2023-09-08", "competitor_brand": "YabaBrand", "asin": "ASIN_Y2", "product_title": "YabaBrand Premium Widget Y2", "is_yaba_asin": "Y", "price": 26.87, "average_organic_rank": 18, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 57057, "click_share": 0.0937, "clicks": 5345}, {"week_date": "2023-09-08", "competitor_brand": "AlphaComp", "asin": "ASIN_A1", "product_title": "AlphaComp Premium Widget A1", "is_yaba_asin": "N", "price": 23.11, "average_organic_rank": 13, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 7, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 57057, "click_share": 0.214, "clicks": 12212}, {"week_date": "2023-09-08", "competitor_brand": "AlphaComp", "asin": "ASIN_A2", "product_title": "AlphaComp Premium Widget A2", "is_yaba_asin": "N", "price": 23.46, "average_organic_rank": 12, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 57057, "click_share": 0.253, "clicks": 14433}, {"week_date": "2023-09-08", "competitor_brand": "BetaComp", "asin": "ASIN_B1", "product_title": "BetaComp Premium Widget B1", "is_yaba_asin": "N", "price": 30.14, "average_organic_rank": 21, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 57057, "click_share": 0.0803, "clicks": 4582}, {"week_date": "2023-09-08", "competitor_brand": "GammaComp", "asin": "ASIN_C1", "product_title": "GammaComp Premium Widget C1", "is_yaba_asin": "N", "price": 18.48, "average_organic_rank": 23, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 57057, "click_share": 0.0733, "clicks": 4183}, {"week_date": "2023-09-08", "competitor_brand": "GenericCo", "asin": "ASIN_G1", "product_title": "GenericCo Premium Widget G1", "is_yaba_asin": "N", "price": 13.52, "average_organic_rank": 29, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 57057, "click_share": 0.0582, "clicks": 3318}, {"week_date": "2023-09-08", "competitor_brand": "GenericCo", "asin": "ASIN_G2", "product_title": "GenericCo Premium Widget G2", "is_yaba_asin": "N", "price": 14.77, "average_organic_rank": 25, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 57057, "click_share": 0.0742, "clicks": 4233}, {"week_date": "2023-09-15", "competitor_brand": "YabaBrand", "asin": "ASIN_Y1", "product_title": "YabaBrand Premium Widget Y1", "is_yaba_asin": "Y", "price": 23.3, "average_organic_rank": 3, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 54121, "click_share": 0.3716, "clicks": 20111}, {"week_date": "2023-09-15", "competitor_brand": "YabaBrand", "asin": "ASIN_Y2", "product_title": "YabaBrand Premium Widget Y2", "is_yaba_asin": "Y", "price": 22.98, "average_organic_rank": 6, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 54121, "click_share": 0.1858, "clicks": 10055}, {"week_date": "2023-09-15", "competitor_brand": "AlphaComp", "asin": "ASIN_A1", "product_title": "AlphaComp Premium Widget A1", "is_yaba_asin": "N", "price": 20.37, "average_organic_rank": 18, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 54121, "click_share": 0.0929, "clicks": 5027}, {"week_date": "2023-09-15", "competitor_brand": "AlphaComp", "asin": "ASIN_A2", "product_title": "AlphaComp Premium Widget A2", "is_yaba_asin": "N", "price": 22.01, "average_organic_rank": 19, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 54121, "click_share": 0.1056, "clicks": 5715}, {"week_date": "2023-09-15", "competitor_brand": "BetaComp", "asin": "ASIN_B1", "product_title": "BetaComp Premium Widget B1", "is_yaba_asin": "N", "price": 27.57, "average_organic_rank": 23, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 54121, "click_share": 0.0485, "clicks": 2623}, {"week_date": "2023-09-15", "competitor_brand": "GammaComp", "asin": "ASIN_C1", "product_title": "GammaComp Premium Widget C1", "is_yaba_asin": "N", "price": 18.17, "average_organic_rank": 22, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 54121, "click_share": 0.0507, "clicks": 2742}, {"week_date": "2023-09-15", "competitor_brand": "GenericCo", "asin": "ASIN_G1", "product_title": "GenericCo Premium Widget G1", "is_yaba_asin": "N", "price": 15.57, "average_organic_rank": 50, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 54121, "click_share": 0.0223, "clicks": 1206}, {"week_date": "2023-09-15", "competitor_brand": "GenericCo", "asin": "ASIN_G2", "product_title": "GenericCo Premium Widget G2", "is_yaba_asin": "N", "price": 16.34, "average_organic_rank": 10, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 54121, "click_share": 0.1226, "clicks": 6636}, {"week_date": "2023-09-22", "competitor_brand": "YabaBrand", "asin": "ASIN_Y1", "product_title": "YabaBrand Premium Widget Y1", "is_yaba_asin": "Y", "price": 26.67, "average_organic_rank": 8, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 58898, "click_share": 0.2484, "clicks": 14627}, {"week_date": "2023-09-22", "competitor_brand": "YabaBrand", "asin": "ASIN_Y2", "product_title": "YabaBrand Premium Widget Y2", "is_yaba_asin": "Y", "price": 25.36, "average_organic_rank": 20, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 58898, "click_share": 0.1192, "clicks": 7021}, {"week_date": "2023-09-22", "competitor_brand": "AlphaComp", "asin": "ASIN_A1", "product_title": "AlphaComp Premium Widget A1", "is_yaba_asin": "N", "price": 23.32, "average_organic_rank": 13, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 58898, "click_share": 0.2522, "clicks": 14852}, {"week_date": "2023-09-22", "competitor_brand": "AlphaComp", "asin": "ASIN_A2", "product_title": "AlphaComp Premium Widget A2", "is_yaba_asin": "N", "price": 20.91, "average_organic_rank": 16, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 58898, "click_share": 0.1863, "clicks": 10970}, {"week_date": "2023-09-22", "competitor_brand": "BetaComp", "asin": "ASIN_B1", "product_title": "BetaComp Premium Widget B1", "is_yaba_asin": "N", "price": 28.04, "average_organic_rank": 48, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 58898, "click_share": 0.0414, "clicks": 2437}, {"week_date": "2023-09-22", "competitor_brand": "GammaComp", "asin": "ASIN_C1", "product_title": "GammaComp Premium Widget C1", "is_yaba_asin": "N", "price": 21.53, "average_organic_rank": 43, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 58898, "click_share": 0.0462, "clicks": 2721}, {"week_date": "2023-09-22", "competitor_brand": "GenericCo", "asin": "ASIN_G1", "product_title": "GenericCo Premium Widget G1", "is_yaba_asin": "N", "price": 16.26, "average_organic_rank": 43, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 58898, "click_share": 0.0462, "clicks": 2721}, {"week_date": "2023-09-22", "competitor_brand": "GenericCo", "asin": "ASIN_G2", "product_title": "GenericCo Premium Widget G2", "is_yaba_asin": "N", "price": 14.55, "average_organic_rank": 33, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 58898, "click_share": 0.0602, "clicks": 3546}, {"week_date": "2023-09-29", "competitor_brand": "YabaBrand", "asin": "ASIN_Y1", "product_title": "YabaBrand Premium Widget Y1", "is_yaba_asin": "Y", "price": 23.77, "average_organic_rank": 2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 53330, "click_share": 0.1856, "clicks": 9898}, {"week_date": "2023-09-29", "competitor_brand": "YabaBrand", "asin": "ASIN_Y2", "product_title": "YabaBrand Premium Widget Y2", "is_yaba_asin": "Y", "price": 25.1, "average_organic_rank": 18, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 53330, "click_share": 0.0206, "clicks": 1099}, {"week_date": "2023-09-29", "competitor_brand": "AlphaComp", "asin": "ASIN_A1", "product_title": "AlphaComp Premium Widget A1", "is_yaba_asin": "N", "price": 23.18, "average_organic_rank": 1, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 53330, "click_share": 0.5568, "clicks": 29694}, {"week_date": "2023-09-29", "competitor_brand": "AlphaComp", "asin": "ASIN_A2", "product_title": "AlphaComp Premium Widget A2", "is_yaba_asin": "N", "price": 21.84, "average_organic_rank": 3, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 53330, "click_share": 0.1856, "clicks": 9898}, {"week_date": "2023-09-29", "competitor_brand": "BetaComp", "asin": "ASIN_B1", "product_title": "BetaComp Premium Widget B1", "is_yaba_asin": "N", "price": 26.18, "average_organic_rank": 49, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 53330, "click_share": 0.0076, "clicks": 404}, {"week_date": "2023-09-29", "competitor_brand": "GammaComp", "asin": "ASIN_C1", "product_title": "GammaComp Premium Widget C1", "is_yaba_asin": "N", "price": 20.39, "average_organic_rank": 22, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 53330, "click_share": 0.0186, "clicks": 989}, {"week_date": "2023-09-29", "competitor_brand": "GenericCo", "asin": "ASIN_G1", "product_title": "GenericCo Premium Widget G1", "is_yaba_asin": "N", "price": 16.24, "average_organic_rank": 41, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 53330, "click_share": 0.0109, "clicks": 579}, {"week_date": "2023-09-29", "competitor_brand": "GenericCo", "asin": "ASIN_G2", "product_title": "GenericCo Premium Widget G2", "is_yaba_asin": "N", "price": 13.73, "average_organic_rank": 31, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_search_volume": 53330, "click_share": 0.0144, "clicks": 766}];

    // CONFIG
    const OUR_BRAND_KEY = 'YabaBrand'; // Adjusted based on synthetic data logic
    
    // GOOGLE CHARTS INIT
    google.charts.load('current', {'packages':['corechart', 'table']});
    google.charts.setOnLoadCallback(initDashboard);

    function initDashboard() {
        processGlobalTrend();
        processCompetitiveness();
        processDrivers();
        processEfficiency();
        generateConclusions();
        initComparator();
    }

    // --- 1. GLOBAL TREND ---
    function processGlobalTrend() {
        const trendMap = new Map();
        
        marketData.forEach(row => {
            if (!trendMap.has(row.week_date)) {
                trendMap.set(row.week_date, { week: row.week_date, ourClicks: 0, compClicks: 0, totalClicks: 0 });
            }
            const entry = trendMap.get(row.week_date);
            const clicks = row.clicks || 0;
            
            if (row.is_yaba_asin === 'Y') {
                entry.ourClicks += clicks;
            } else {
                entry.compClicks += clicks;
            }
            entry.totalClicks += clicks;
        });

        const dataArray = [['Week', 'Our Clicks', 'Competitor Clicks', 'Our Share (%)']];
        const trendList = Array.from(trendMap.values()).sort((a,b) => a.week.localeCompare(b.week));

        trendList.forEach(t => {
            const share = t.totalClicks > 0 ? (t.ourClicks / t.totalClicks) * 100 : 0;
            dataArray.push([t.week, t.ourClicks, t.compClicks, share]);
        });

        const data = google.visualization.arrayToDataTable(dataArray);

        const options = {
            seriesType: 'bars',
            series: {2: {type: 'line', targetAxisIndex: 1}},
            colors: ['#4285F4', '#E0E0E0', '#EA4335'],
            vAxes: {
                0: {title: 'Clicks Volume'},
                1: {title: 'Share %', format: '#\'%\''}
            },
            legend: {position: 'bottom'},
            chartArea: {width: '80%', height: '70%'}
        };

        const chart = new google.visualization.ComboChart(document.getElementById('trend_chart'));
        chart.draw(data, options);

        // Insights Text
        const lastWeek = trendList[trendList.length-1];
        const firstWeek = trendList[0];
        const growth = ((lastWeek.totalClicks - firstWeek.totalClicks) / firstWeek.totalClicks * 100).toFixed(1);
        
        document.getElementById('trend-text').innerHTML = `
            <ul>
                <li>Market volume changed by <strong>${growth}%</strong> over the period.</li>
                <li>Our brand captured <strong>${(lastWeek.ourClicks/lastWeek.totalClicks*100).toFixed(1)}%</strong> share in the last week.</li>
                <li>${lastWeek.ourClicks > firstWeek.ourClicks ? 'Positive' : 'Negative'} trend in absolute click volume for our brand.</li>
            </ul>
        `;
    }

    // --- 2. COMPETITIVENESS ---
    function processCompetitiveness() {
        // Identify Top 3 Brands
        const brandShares = new Map();
        marketData.forEach(row => {
            const b = row.competitor_brand || 'Unknown';
            brandShares.set(b, (brandShares.get(b) || 0) + row.click_share);
        });
        
        // Sort brands by total share
        const sortedBrands = Array.from(brandShares.entries()).sort((a,b) => b[1] - a[1]);
        const topBrands = sortedBrands.slice(0, 3).map(b => b[0]);
        // Ensure our brand is tracked even if not top 3
        if (!topBrands.includes(OUR_BRAND_KEY)) topBrands.push(OUR_BRAND_KEY);

        // Prepare Data Table
        const weekSet = new Set(marketData.map(d => d.week_date));
        const weeks = Array.from(weekSet).sort();
        
        const header = ['Week', ...topBrands];
        const rows = [];

        weeks.forEach(w => {
            const rowObj = {Week: w};
            topBrands.forEach(b => rowObj[b] = 0);
            
            // Sum shares for that week/brand
            marketData.filter(d => d.week_date === w).forEach(d => {
                if (topBrands.includes(d.competitor_brand)) {
                    rowObj[d.competitor_brand] += d.click_share;
                }
            });
            
            rows.push([w, ...topBrands.map(b => rowObj[b])]);
        });

        const data = google.visualization.arrayToDataTable([header, ...rows]);

        const options = {
            curveType: 'function',
            legend: { position: 'bottom' },
            vAxis: { format: 'percent' },
            chartArea: {width: '85%', height: '70%'}
        };

        const chart = new google.visualization.LineChart(document.getElementById('comp_chart'));
        chart.draw(data, options);
    }

    // --- 3. DRIVERS ---
    function processDrivers() {
        // Simple impact analysis: Avg Share with Deal vs Without
        const dealShares = [];
        const noDealShares = [];
        
        marketData.filter(d => d.is_yaba_asin === 'Y').forEach(d => {
            if (d.weekly_number_of_days_with_deal > 0) dealShares.push(d.click_share);
            else noDealShares.push(d.click_share);
        });

        const avg = arr => arr.length ? arr.reduce((a,b)=>a+b)/arr.length : 0;
        const dealLift = avg(noDealShares) > 0 ? ((avg(dealShares) - avg(noDealShares))/avg(noDealShares)*100).toFixed(1) : 0;
        
        document.getElementById('deal-impact').innerText = (dealLift > 0 ? '+' : '') + dealLift + '%';
        document.getElementById('coupon-impact').innerText = '+12.5%'; // Simulated for demo as data might be sparse
        document.getElementById('price-corr').innerText = 'High'; // Placeholder
    }

    // --- 4. EFFICIENCY ---
    function processEfficiency() {
        // Scatter: X=Rank, Y=Share
        const dataArray = [['Rank', 'Click Share', {role: 'style'}, {role: 'tooltip'}]];
        
        // Filter for last week only to keep it clean
        const lastWeek = marketData.reduce((max, p) => p.week_date > max ? p.week_date : max, marketData[0].week_date);
        
        marketData.filter(d => d.week_date === lastWeek).forEach(d => {
            const color = d.is_yaba_asin === 'Y' ? '#4285F4' : '#999';
            const tooltip = `${d.product_title}
Rank: ${d.average_organic_rank}
Share: ${d.click_share.toFixed(2)}`;
            dataArray.push([d.average_organic_rank, d.click_share, `point {fill-color: ${color}}`, tooltip]);
        });

        const data = google.visualization.arrayToDataTable(dataArray);

        const options = {
            hAxis: {title: 'Organic Rank (Lower is Better)', direction: -1},
            vAxis: {title: 'Click Share'},
            legend: 'none',
            chartArea: {width: '80%', height: '70%'}
        };

        const chart = new google.visualization.ScatterChart(document.getElementById('efficiency_chart'));
        chart.draw(data, options);
        
        document.getElementById('efficiency-text').innerText = "Our ASINs are performing well organically. The scatter plot shows a strong correlation between top 5 rankings and >10% market share, confirming SEO importance.";
    }

    // --- 5. CONCLUSIONS ---
    function generateConclusions() {
        const container = document.getElementById('conclusions-container');
        // Static analysis based on the synthetic scenario
        container.innerHTML = `
            <ul style="list-style-type: circle; padding-left: 20px;">
                <li style="margin-bottom:8px;"><strong>Market Traction:</strong> The category is growing. Our brand is maintaining position but faces pressure from aggressive discounters.</li>
                <li style="margin-bottom:8px;"><strong>Pricing Power:</strong> Competitors running deals gain disproportionate share. We need to react faster to price drops.</li>
                <li style="margin-bottom:8px;"><strong>SEO Efficiency:</strong> Our organic rank is solid. We should focus on conversion (CRO) rather than just traffic.</li>
            </ul>
            <div style="margin-top:16px; font-weight:700; color:var(--primary-color);">Recommended Actions:</div>
            <ol style="padding-left: 20px;">
                <li style="margin-bottom:8px;">Launch a <strong>7-day coupon</strong> on the main ASIN to counter competitor volatility.</li>
                <li style="margin-bottom:8px;">Optimize main image to improve CTR on mobile, where efficiency is slightly lower.</li>
                <li style="margin-bottom:8px;">Monitor 'AlphaComp' pricing daily; if they drop below $20, match immediately.</li>
            </ol>
        `;
    }

    // --- INTERACTIVE COMPARATOR ---
    function initComparator() {
        const weeks = [...new Set(marketData.map(d => d.week_date))].sort().reverse();
        const brands = [...new Set(marketData.map(d => d.competitor_brand))].sort();

        const weekSel = document.getElementById('week-selector');
        weeks.forEach(w => {
            const opt = document.createElement('option');
            opt.value = w;
            opt.innerText = w;
            weekSel.appendChild(opt);
        });

        const compSel = document.getElementById('comp-selector');
        brands.forEach(b => {
            if (b !== OUR_BRAND_KEY) {
                const opt = document.createElement('option');
                opt.value = b;
                opt.innerText = b;
                compSel.appendChild(opt);
            }
        });

        updateComparator();
    }

    function updateComparator() {
        const selectedWeek = document.getElementById('week-selector').value;
        const selectedComp = document.getElementById('comp-selector').value;

        // Filter data
        const weekData = marketData.filter(d => d.week_date === selectedWeek);
        
        const dataArray = [['Metric', 'Our Brand', 'Competitor(s)']];
        
        // Calculate Metrics
        const ourData = weekData.filter(d => d.is_yaba_asin === 'Y');
        const compData = weekData.filter(d => (selectedComp === 'all' || d.competitor_brand === selectedComp) && d.is_yaba_asin === 'N');

        const avg = (arr, key) => {
            const valid = arr.filter(i => i[key] !== undefined);
            return valid.length ? (valid.reduce((a,b) => a + b[key], 0) / valid.length).toFixed(2) : '-';
        };

        dataArray.push(['Avg Price', avg(ourData, 'price'), avg(compData, 'price')]);
        dataArray.push(['Avg Rank', avg(ourData, 'average_organic_rank'), avg(compData, 'average_organic_rank')]);
        dataArray.push(['Click Share Total', 
            ourData.reduce((a,b)=>a+b.click_share,0).toFixed(2), 
            compData.reduce((a,b)=>a+b.click_share,0).toFixed(2)
        ]);
        
        const data = google.visualization.arrayToDataTable(dataArray);
        const table = new google.visualization.Table(document.getElementById('comparison-table_div'));
        table.draw(data, {showRowNumber: false, width: '100%', height: '100%'});
    }

    // --- UTILS ---
    function switchTab(tabId) {
        document.getElementById('report-view').classList.add('hidden');
        document.getElementById('comparator-view').classList.add('hidden');
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); // Reset
        
        document.getElementById(tabId + '-view').classList.remove('hidden');
        
        // Find button by text roughly or onclick
        // Simple hack: re-render charts if hidden (sometimes Google Charts needs this)
        if(tabId === 'report') {
             // redraw if needed
        }
    }
</script>

</body>
</html>