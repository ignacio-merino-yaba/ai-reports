<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YABA Market Intelligence: NaturaleBio Report</title>
    
    <!-- Google Charts -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- Google Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        :root {
            --primary: #4285F4; /* Google Blue */
            --success: #34A853; /* Google Green */
            --warning: #FBBC05; /* Google Yellow */
            --danger: #EA4335;  /* Google Red */
            --gray-100: #F8F9FA;
            --gray-200: #E8EAED;
            --gray-600: #5F6368;
            --gray-800: #202124;
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--gray-100);
            color: var(--gray-800);
            margin: 0;
            padding: 20px;
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header & Tabs */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        .header h1 { margin: 0; font-size: 24px; font-weight: 600; color: var(--primary); }
        .header p { margin: 4px 0 0; color: var(--gray-600); font-size: 14px; }

        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }
        .tab-btn {
            background: white;
            border: 1px solid var(--gray-200);
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        .tab-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 2px 6px rgba(66, 133, 244, 0.3);
        }
        .tab-btn:hover:not(.active) { background: var(--gray-200); }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .full-width { grid-column: span 2; }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.02);
        }
        
        .card h2 {
            font-size: 18px;
            margin: 0 0 16px 0;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray-800);
        }
        
        .card h2 .material-icons { color: var(--gray-600); font-size: 20px; }

        .chart-container {
            width: 100%;
            height: 300px;
        }

        /* Metrics Row */
        .metrics-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        .metric-card {
            background: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .metric-val { font-size: 24px; font-weight: 700; color: var(--primary); }
        .metric-label { font-size: 13px; color: var(--gray-600); margin-top: 4px; }
        
        /* Insights Section */
        .insights-section {
            background: #E8F0FE;
            border-left: 4px solid var(--primary);
        }
        .insights-list li { margin-bottom: 8px; }
        .rec-list li { margin-bottom: 8px; color: var(--danger); font-weight: 500; }

        /* Interactive Section */
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            background: white;
            padding: 16px;
            border-radius: 12px;
        }
        select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
            font-family: inherit;
        }
        
        .hidden { display: none; }
        
        /* Table Styles */
        .data-table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { text-align: left; padding: 12px; background: var(--gray-100); border-bottom: 2px solid var(--gray-200); }
        td { padding: 12px; border-bottom: 1px solid var(--gray-200); }
        tr:last-child td { border-bottom: none; }
        .highlight { color: var(--success); font-weight: bold; }
        
        @media (max-width: 768px) {
            .dashboard-grid { grid-template-columns: 1fr; }
            .metrics-row { grid-template-columns: repeat(2, 1fr); }
            .full-width { grid-column: span 1; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div>
            <h1>YABA Intelligence Report</h1>
            <p>Parent ASIN Analysis | Brand: <strong id="brandName">NaturaleBio</strong></p>
        </div>
        <div style="text-align: right;">
            <p>Last Reporting Week: <strong>2026-01</strong></p>
        </div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('static')">
            <span class="material-icons">assessment</span> Strategic Report
        </button>
        <button class="tab-btn" onclick="switchTab('interactive')">
            <span class="material-icons">compare_arrows</span> Interactive Comparator
        </button>
    </div>

    <!-- PESTAÃ‘A 1: REPORTE ESTRATÃ‰GICO -->
    <div id="static-tab">
        <!-- KPIs -->
        <div class="metrics-row">
            <div class="metric-card">
                <div class="metric-val" id="kpi-share">28.9%</div>
                <div class="metric-label">My Total Click Share</div>
            </div>
            <div class="metric-card">
                <div class="metric-val" id="kpi-rank">2.0</div>
                <div class="metric-label">Avg. Organic Rank</div>
            </div>
            <div class="metric-card">
                <div class="metric-val" id="kpi-price">â‚¬8.89</div>
                <div class="metric-label">My Avg. Price</div>
            </div>
            <div class="metric-card">
                <div class="metric-val" id="kpi-comp-gap">+17.8%</div>
                <div class="metric-label">Gap vs Next Competitor</div>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- 1. Tendencia Global -->
            <div class="card full-width">
                <h2><span class="material-icons">trending_up</span> 1. Global Parent Trend (Volume vs Share)</h2>
                <p style="font-size: 13px; color: #666; margin-bottom: 10px;">
                    Bars represent Total Market Clicks. The Line represents <span style="color:#4285F4; font-weight:bold;">NaturaleBio's</span> Share of Clicks.
                </p>
                <div id="trend_chart" class="chart-container"></div>
            </div>

            <!-- 2. Competitividad de Marca -->
            <div class="card full-width">
                <h2><span class="material-icons">pie_chart</span> 2. Brand Competitiveness (Share Evolution)</h2>
                <div id="comp_chart" class="chart-container"></div>
            </div>

            <!-- 3. Efficiency -->
            <div class="card">
                <h2><span class="material-icons">scatter_plot</span> 4. Rank Efficiency (Rank vs Share)</h2>
                <p style="font-size: 12px; color: #666;">Bubble Size = Search Volume. <span style="color:#4285F4">Blue = Me</span>, <span style="color:#EA4335">Red = Comp</span>.</p>
                <div id="efficiency_chart" class="chart-container"></div>
            </div>

            <!-- 3. Palancas -->
            <div class="card">
                <h2><span class="material-icons">tune</span> 3. Growth Levers (Price Strategy)</h2>
                <div id="levers_chart" class="chart-container"></div>
            </div>

            <!-- 5. Conclusiones -->
            <div class="card full-width insights-section">
                <h2><span class="material-icons">lightbulb</span> 5. Key Conclusions & Recommendations</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h3 style="font-size: 16px; margin-bottom: 10px;">ðŸ”Ž Strategic Insights</h3>
                        <ul class="insights-list" style="font-size: 14px; padding-left: 20px;">
                            <li><strong>Dominant Position:</strong> NaturaleBio leads the category with ~28.9% total Click Share, maintaining growth (+0.8pp vs previous week).</li>
                            <li><strong>Price Advantage:</strong> At â‚¬8.89, we are significantly more aggressive than the market average (â‚¬10.95), which is a key driver for efficiency.</li>
                            <li><strong>Efficiency King:</strong> With an organic rank of #2, we capture disproportionately high traffic compared to competitors like NKD Living or WeightWorld.</li>
                            <li><strong>Competitor Weakness:</strong> Main rival 'NEW LEAF PRODUCTS' lost significant traction (13.3% â†’ 9.7%) despite holding Rank #3, likely due to a higher price point (â‚¬13.29).</li>
                            <li><strong>Emerging Threat:</strong> 'Natural Health 4 Life' is slowly gaining ground (11.8% â†’ 12.8%) with a premium product (â‚¬17.62), suggesting a segment of customers insensitive to price.</li>
                        </ul>
                    </div>
                    <div>
                        <h3 style="font-size: 16px; margin-bottom: 10px;">ðŸš€ Actionable Recommendations</h3>
                        <ul class="rec-list" style="font-size: 14px; padding-left: 20px;">
                            <li><strong>Defend Price Leader Status:</strong> Maintain the â‚¬8.89 price point as it effectively blocks 'NEW LEAF' and 'NKD Living'. Any price increase >â‚¬9.50 risks losing the #2 Organic Rank.</li>
                            <li><strong>Target Premium Keywords:</strong> Launch a defensive Sponsored Brand campaign targeting 'Natural Health 4 Life' keywords to capture their premium traffic.</li>
                            <li><strong>Conversion Optimization:</strong> Since organic rank is maxed out (#2), focus on Listing Images to increase Click-Through-Rate (CTR) further, as the gap to #1 is minimal.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PESTAÃ‘A 2: INTERACTIVO -->
    <div id="interactive-tab" class="hidden">
        <div class="card">
            <h2><span class="material-icons">search</span> Head-to-Head Comparator</h2>
            <div class="controls">
                <div>
                    <label style="font-size: 12px; font-weight: bold; display: block; margin-bottom: 4px;">Select Week</label>
                    <select id="weekSelector" onchange="updateInteractive()">
                        <option value="2026-01">2026-01 (Latest)</option>
                        <option value="2025-52">2025-52</option>
                    </select>
                </div>
                <div>
                    <label style="font-size: 12px; font-weight: bold; display: block; margin-bottom: 4px;">Compare Against</label>
                    <select id="compSelector" onchange="updateInteractive()">
                        <option value="All">All Competitors</option>
                        <option value="NEW LEAF PRODUCTS">NEW LEAF PRODUCTS</option>
                        <option value="NKD Living">NKD Living</option>
                        <option value="Natural Health 4 Life">Natural Health 4 Life</option>
                        <option value="WeightWorld">WeightWorld</option>
                    </select>
                </div>
            </div>
            
            <div id="interactive_table" class="data-table-container">
                <!-- Table injected by JS -->
            </div>
        </div>
    </div>

</div>

<script type="text/javascript">
    // DATA INJECTION FROM PYTHON
    const marketData = {"trend": [["Week", "My Clicks", "Comp Clicks", "My Share (%)"], ["2025-52", 337.0, 862.0, 28.13], ["2026-01", 1584.0, 3892.0, 28.93]], "comp_chart": [["Week", "NaturaleBio", "Natural Health 4 Life", "NEW LEAF PRODUCTS", "WeightWorld", "Others"], ["2025-52", 28.13, 14.63, 16.54, 11.41, 29.28], ["2026-01", 28.93, 15.92, 12.04, 10.92, 32.19]], "efficiency": [["ID", "Organic Rank", "Click Share", "Type", "Size"], ["NEW LEAF PRODUCTS - 13.29", 3, 9.71, "Comp", 6.78801], ["NKD Living - 9.99", 5, 5.88, "Comp", 6.78801], ["NKD Living - 9.99", 3, 5.8, "Comp", 6.78801], ["Natural Health 4 Life - 17.62", 7, 12.84, "Comp", 6.78801], ["Horb\u00e4ach - 7.99", 12, 1.19, "Comp", 6.78801], ["The Worldwide Mint - 5.45", 9, 7.06, "Comp", 6.78801], ["Solgar - 12.29", 13, 4.24, "Comp", 6.78801], ["Vinco - 9.99", 21, 1.8, "Comp", 6.78801], ["WeightWorld - 11.96", 5, 8.81, "Comp", 6.78801], ["NaturaleBio - 8.89", 2, 23.34, "Me", 6.78801]], "insights": {"trend_val": 0.8, "price_my": 8.89, "price_mkt": 10.95, "top_comp": ["Natural Health 4 Life", "NEW LEAF PRODUCTS", "WeightWorld"], "my_brand": "NaturaleBio", "current_share": 28.93}, "raw_data": [{"Week": "2026-01", "Brand": "NEW LEAF PRODUCTS", "ASIN": "B08WM1VP8V", "Title": "Fibre Supplement 4000mg Psyllium Husk with Acidoph......", "Price": 13.29, "Rank": 3, "Share": 9.71, "IsMe": "N"}, {"Week": "2025-52", "Brand": "NEW LEAF PRODUCTS", "ASIN": "B08WM1VP8V", "Title": "Fibre Supplement 4000mg Psyllium Husk with Acidoph......", "Price": 13.29, "Rank": 3, "Share": 13.35, "IsMe": "N"}, {"Week": "2025-52", "Brand": "NKD Living", "ASIN": "B07BZ59D68", "Title": "NKD Living Psyllium Husk Powder (500g) | Tested fo......", "Price": 9.99, "Rank": 3, "Share": 9.17, "IsMe": "N"}, {"Week": "2026-01", "Brand": "NKD Living", "ASIN": "B07BZ59D68", "Title": "NKD Living Psyllium Husk Powder (500g) | Tested fo......", "Price": 9.99, "Rank": 5, "Share": 5.88, "IsMe": "N"}, {"Week": "2025-52", "Brand": "NKD Living", "ASIN": "B08FQYKS82", "Title": "NKD Living Whole Psyllium husks (500g)...", "Price": 9.99, "Rank": 4, "Share": 3.65, "IsMe": "N"}, {"Week": "2026-01", "Brand": "NKD Living", "ASIN": "B08FQYKS82", "Title": "NKD Living Whole Psyllium husks (500g)...", "Price": 9.99, "Rank": 3, "Share": 5.8, "IsMe": "N"}, {"Week": "2025-52", "Brand": "Natural Health 4 Life", "ASIN": "B07PX2TYXN", "Title": "Natural Health 4 Life Vegetable Fibre Psyllium Hus......", "Price": 17.49, "Rank": 6, "Share": 11.81, "IsMe": "N"}, {"Week": "2026-01", "Brand": "Natural Health 4 Life", "ASIN": "B07PX2TYXN", "Title": "Natural Health 4 Life Vegetable Fibre Psyllium Hus......", "Price": 17.62, "Rank": 7, "Share": 12.84, "IsMe": "N"}, {"Week": "2026-01", "Brand": "Horb\u00e4ach", "ASIN": "B0CYQ1ZKV6", "Title": "Psyllium Husk Capsules 5000mg with Acidophilus | N......", "Price": 7.99, "Rank": 12, "Share": 1.19, "IsMe": "N"}, {"Week": "2025-52", "Brand": "REBIRTH WELLNESS BE YOURSELF | ONLY BETTER", "ASIN": "B0F227549B", "Title": "Psyllium Husk Fibre Supplement 4000mg with Probiot......", "Price": 9.95, "Rank": 18, "Share": 1.8, "IsMe": "N"}, {"Week": "2026-01", "Brand": "The Worldwide Mint", "ASIN": "B0F3JB86T3", "Title": "Psyllium Husk Powder 200g | 100% Pure & Natural | ......", "Price": 5.45, "Rank": 9, "Share": 7.06, "IsMe": "N"}, {"Week": "2025-52", "Brand": "The Worldwide Mint", "ASIN": "B0F3JB86T3", "Title": "Psyllium Husk Powder 200g | 100% Pure & Natural | ......", "Price": 5.45, "Rank": 17, "Share": 4.33, "IsMe": "N"}, {"Week": "2026-01", "Brand": "Solgar", "ASIN": "B005P0WGNE", "Title": "Solgar Psyllium Husks Fibre 500 Mg Vegetable Capsu......", "Price": 12.29, "Rank": 13, "Share": 4.24, "IsMe": "N"}, {"Week": "2025-52", "Brand": "Solgar", "ASIN": "B005P0WGNE", "Title": "Solgar Psyllium Husks Fibre 500 Mg Vegetable Capsu......", "Price": 14.261428571, "Rank": 11, "Share": 3.45, "IsMe": "N"}, {"Week": "2026-01", "Brand": "Vinco", "ASIN": "B0FW6P4NKY", "Title": "Vinco Fibre Supplement 5000mg Psyllium Husk with A......", "Price": 9.99, "Rank": 21, "Share": 1.8, "IsMe": "N"}, {"Week": "2026-01", "Brand": "WeightWorld", "ASIN": "B0B1QQNZ2S", "Title": "WeightWorld Organic Psyllium Husk Capsules | 1400m......", "Price": 11.96, "Rank": 5, "Share": 8.81, "IsMe": "N"}, {"Week": "2025-52", "Brand": "WeightWorld", "ASIN": "B0B1QQNZ2S", "Title": "WeightWorld Organic Psyllium Husk Capsules | 1400m......", "Price": 11.678571429, "Rank": 7, "Share": 9.21, "IsMe": "N"}, {"Week": "2025-52", "Brand": "Wholefood Earth", "ASIN": "B07F88MZ4K", "Title": "Wholefood Earth Organic Psyllium Husk Powder 250g ......", "Price": 8.881428571, "Rank": 19, "Share": 1.23, "IsMe": "N"}, {"Week": "2025-52", "Brand": "NaturaleBio", "ASIN": "B07L9WJ4P2", "Title": "NaturaleBio Organic Psyllium Husk - 99% Purity - 2......", "Price": 8.89, "Rank": 2, "Share": 22.7, "IsMe": "Y"}, {"Week": "2026-01", "Brand": "NaturaleBio", "ASIN": "B07L9WJ4P2", "Title": "NaturaleBio Organic Psyllium Husk - 99% Purity - 2......", "Price": 8.89, "Rank": 2, "Share": 23.34, "IsMe": "Y"}]};

    // INIT GOOGLE CHARTS
    google.charts.load('current', {'packages':['corechart', 'bar']});
    google.charts.setOnLoadCallback(drawCharts);

    function drawCharts() {
        drawTrendChart();
        drawCompChart();
        drawEfficiencyChart();
        drawLeversChart();
        updateInteractive(); // Init table
    }

    function drawTrendChart() {
        const data = google.visualization.arrayToDataTable(marketData.trend);
        const options = {
            seriesType: 'bars',
            series: { 2: {type: 'line', targetAxisIndex: 1, color: '#4285F4', lineWidth: 3} },
            vAxes: {
                0: {title: 'Estimated Clicks'},
                1: {title: 'My Share (%)', format: '#\'%\''}
            },
            colors: ['#4285F4', '#E8EAED'],
            legend: { position: 'bottom' },
            animation: { startup: true, duration: 1000, easing: 'out' },
            chartArea: { width: '85%', height: '70%' }
        };
        const chart = new google.visualization.ComboChart(document.getElementById('trend_chart'));
        chart.draw(data, options);
    }

    function drawCompChart() {
        const data = google.visualization.arrayToDataTable(marketData.comp_chart);
        const options = {
            curveType: 'function',
            legend: { position: 'bottom' },
            colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853', '#9AA0A6'],
            lineWidth: 3,
            vAxis: { title: 'Share of Clicks (%)' },
            chartArea: { width: '90%', height: '70%' },
            pointSize: 5
        };
        const chart = new google.visualization.LineChart(document.getElementById('comp_chart'));
        chart.draw(data, options);
    }

    function drawEfficiencyChart() {
        const data = google.visualization.arrayToDataTable(marketData.efficiency);
        const options = {
            title: 'Lower Rank (Better) vs Higher Share',
            hAxis: { title: 'Organic Rank (Lower is Better)', direction: 1 },
            vAxis: { title: 'Click Share (%)' },
            legend: 'none',
            bubble: { textStyle: { fontSize: 11 } },
            colors: ['#EA4335', '#4285F4'], // Red for Comp, Blue for Me (Alphabetical sorting: Comp, Me)
            chartArea: { width: '85%', height: '80%' }
        };
        // Color fix logic: Data sorts Comp first, so Comp gets color[0]
        const chart = new google.visualization.BubbleChart(document.getElementById('efficiency_chart'));
        chart.draw(data, options);
    }

    function drawLeversChart() {
        // Prepare Data for Price Comparison (Me vs Top 3 Avg)
        const myPrice = marketData.insights.price_my;
        const mktPrice = marketData.insights.price_mkt;
        
        const data = google.visualization.arrayToDataTable([
            ['Entity', 'Avg Price (â‚¬)', { role: 'style' }],
            ['NaturaleBio', myPrice, '#4285F4'],
            ['Market Avg', mktPrice, '#EA4335']
        ]);

        const options = {
            legend: { position: 'none' },
            vAxis: { title: 'Price (â‚¬)' },
            chartArea: { width: '70%', height: '80%' }
        };

        const chart = new google.visualization.ColumnChart(document.getElementById('levers_chart'));
        chart.draw(data, options);
    }

    // INTERACTIVE LOGIC
    function switchTab(tabId) {
        document.getElementById('static-tab').classList.add('hidden');
        document.getElementById('interactive-tab').classList.add('hidden');
        document.getElementsByClassName('tab-btn')[0].classList.remove('active');
        document.getElementsByClassName('tab-btn')[1].classList.remove('active');

        document.getElementById(tabId + '-tab').classList.remove('hidden');
        if(tabId === 'static') document.getElementsByClassName('tab-btn')[0].classList.add('active');
        else document.getElementsByClassName('tab-btn')[1].classList.add('active');
        
        // Redraw table on switch
        if(tabId === 'interactive') updateInteractive();
    }

    function updateInteractive() {
        const week = document.getElementById('weekSelector').value;
        const comp = document.getElementById('compSelector').value;
        const container = document.getElementById('interactive_table');
        
        let html = `<table><thead><tr>
            <th>ASIN</th>
            <th>Brand</th>
            <th>Title</th>
            <th>Price</th>
            <th>Rank</th>
            <th>Share</th>
        </tr></thead><tbody>`;
        
        const filtered = marketData.raw_data.filter(d => {
            const weekMatch = d.Week === week;
            const compMatch = comp === 'All' ? true : d.Brand === comp;
            return weekMatch && compMatch;
        });

        // Always show My Brand for comparison context
        const myBrandData = marketData.raw_data.filter(d => d.Week === week && d.IsMe === 'Y');
        
        // Merge without duplicates
        const displayData = [...new Map([...myBrandData, ...filtered].map(item => [item['ASIN'], item])).values()];
        
        // Sort: Me first, then by Share desc
        displayData.sort((a, b) => {
            if (a.IsMe === 'Y') return -1;
            if (b.IsMe === 'Y') return 1;
            return b.Share - a.Share;
        });

        displayData.forEach(r => {
            const isMe = r.IsMe === 'Y';
            const style = isMe ? 'background: #E8F0FE; font-weight: bold;' : '';
            const priceColor = r.Price > 10 ? '#EA4335' : '#34A853'; // Simple heuristic
            
            html += `<tr style="${style}">
                <td><a href="https://www.amazon.co.uk/dp/${r.ASIN}" target="_blank" style="text-decoration:none; color:#4285F4;">${r.ASIN}</a></td>
                <td>${r.Brand}</td>
                <td title="${r.Title}">${r.Title.substring(0, 30)}...</td>
                <td style="color:${priceColor}">â‚¬${r.Price}</td>
                <td>#${r.Rank}</td>
                <td>${r.Share}%</td>
            </tr>`;
        });
        
        html += '</tbody></table>';
        container.innerHTML = html;
    }

    // UPDATE KPI METRICS IN UI
    document.getElementById('brandName').innerText = marketData.insights.my_brand;
    // KPI values are statically set in HTML for speed, but could be dynamic:
    // document.getElementById('kpi-share').innerText = marketData.insights.current_share + '%';

</script>

</body>
</html>