<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Rendimiento ASIN: Vitamin D3</title>
    <!-- Google Charts -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        :root {
            --primary: #4285F4; /* Google Blue */
            --success: #34A853; /* Google Green */
            --warning: #FBBC05; /* Google Yellow */
            --danger: #EA4335;  /* Google Red */
            --gray: #F1F3F4;
            --text: #202124;
            --subtext: #5f6368;
            --card-bg: #ffffff;
            --border-radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        body {
            font-family: 'Roboto', 'Segoe UI', sans-serif;
            background-color: #f8f9fa;
            color: var(--text);
            margin: 0;
            padding: 0;
            line-height: 1.5;
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: var(--card-bg);
            padding: 24px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--text);
        }

        .badge {
            background: #e8f0fe;
            color: var(--primary);
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: transparent;
            font-size: 1rem;
            font-weight: 500;
            color: var(--subtext);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards & Grid */
        .grid {
            display: grid;
            gap: 24px;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            margin-bottom: 24px;
        }

        .grid-2 { grid-template-columns: 1fr 1fr; }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }

        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .card h2 {
            margin-top: 0;
            font-size: 1.25rem;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .metric-big {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin: 16px 0;
        }

        .metric-label {
            color: var(--subtext);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .trend-up { color: var(--success); display: flex; align-items: center; font-size: 0.9rem;}
        .trend-down { color: var(--danger); display: flex; align-items: center; font-size: 0.9rem;}

        /* Insights List */
        .insight-list {
            list-style: none;
            padding: 0;
        }
        
        .insight-list li {
            padding: 12px 0;
            border-bottom: 1px solid var(--gray);
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .insight-icon {
            color: var(--warning);
        }

        /* Comparator Styles */
        .comparator-controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            background: white;
            padding: 16px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        select {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1rem;
            flex: 1;
        }

        .comp-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        .comp-table th, .comp-table td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid var(--gray);
        }
        
        .comp-table th {
            color: var(--subtext);
            font-weight: 500;
        }

        /* Charts Container */
        .chart-container {
            width: 100%;
            height: 350px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
            .comparator-controls { flex-direction: column; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div>
            <span class="badge">ANÁLISIS DE PARENT ASIN</span>
            <h1 id="page-title">Cargando datos...</h1>
            <p style="color: var(--subtext); margin: 4px 0 0 0;" id="date-range">...</p>
        </div>
        <div>
            <span class="badge" style="background:var(--primary); color:white" id="our-brand-badge">Nuestra Marca: ...</span>
        </div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('static')">Reporte Estratégico</button>
        <button class="tab-btn" onclick="switchTab('interactive')">Comparador Interactivo</button>
    </div>

    <!-- PESTAÑA 1: REPORTE ESTÁTICO -->
    <div id="tab-static" class="tab-content active">
        
        <!-- Sección 1: Tendencia Global -->
        <div class="card" style="margin-bottom: 24px;">
            <h2><span class="material-icons">show_chart</span> 1. Tendencia Global del Parent</h2>
            <div class="grid grid-3">
                <div>
                    <div class="metric-label">Clicks Totales (Última Sem.)</div>
                    <div class="metric-big" id="total-clicks">0</div>
                    <div id="clicks-trend"></div>
                </div>
                <div>
                    <div class="metric-label">Share Nuestra Marca</div>
                    <div class="metric-big" id="our-share">0%</div>
                    <div id="share-trend"></div>
                </div>
                <div>
                    <div class="metric-label">Competidor Top</div>
                    <div class="metric-big" id="top-competitor" style="font-size: 1.5rem;">-</div>
                    <div class="metric-label" id="top-comp-share">0% Share</div>
                </div>
            </div>
            <div id="chart_global_trend" class="chart-container"></div>
            <p style="font-style: italic; color: var(--subtext); margin-top:10px;" id="trend-insight">...</p>
        </div>

        <!-- Sección 2: Competitividad -->
        <div class="card" style="margin-bottom: 24px;">
            <h2><span class="material-icons">group</span> 2. Competitividad de Marca (Share of Voice)</h2>
            <div id="chart_brand_comp" class="chart-container"></div>
            <p id="comp-insight" style="margin-top: 10px; color: var(--subtext);"></p>
        </div>

        <!-- Sección 3 y 4: Palancas y Eficiencia -->
        <div class="grid grid-2">
            <div class="card">
                <h2><span class="material-icons">tune</span> 3. Impacto de Palancas (Deals/Badges)</h2>
                <ul class="insight-list" id="levers-list">
                    <!-- Dinámico -->
                </ul>
            </div>
            <div class="card">
                <h2><span class="material-icons">scatter_plot</span> 4. Eficiencia (Rank vs Share)</h2>
                <div id="chart_efficiency" class="chart-container"></div>
                <p style="font-size: 0.9rem; color: var(--subtext);">* Eje X: Rank (Menor es mejor) | Eje Y: Click Share. Puntos arriba a la izquierda son más eficientes.</p>
            </div>
        </div>

        <!-- Sección 5: Conclusiones -->
        <div class="card">
            <h2><span class="material-icons">lightbulb</span> 5. Conclusiones y Recomendaciones</h2>
            <div class="grid grid-2">
                <div>
                    <h3 style="color: var(--primary);">Insights Clave</h3>
                    <ul class="insight-list" id="final-insights"></ul>
                </div>
                <div>
                    <h3 style="color: var(--success);">Recomendaciones</h3>
                    <ul class="insight-list" id="final-recommendations"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- PESTAÑA 2: INTERACTIVO -->
    <div id="tab-interactive" class="tab-content">
        <div class="comparator-controls">
            <div>
                <label>Semana de Análisis</label>
                <select id="sel-week" onchange="updateComparator()"></select>
            </div>
            <div>
                <label>Competidor a Comparar</label>
                <select id="sel-comp" onchange="updateComparator()"></select>
            </div>
        </div>

        <div class="grid grid-2">
            <!-- Nuestra Marca -->
            <div class="card" style="border-top: 4px solid var(--primary);">
                <h3 id="comp-us-title">Nosotros</h3>
                <table class="comp-table">
                    <tr><td>Precio Promedio</td><td id="us-price">-</td></tr>
                    <tr><td>Click Share</td><td id="us-share">-</td></tr>
                    <tr><td>Rank Orgánico</td><td id="us-rank">-</td></tr>
                    <tr><td>Días con Deal</td><td id="us-deal">-</td></tr>
                    <tr><td>Conversión Est. (Proxy)</td><td id="us-eff">-</td></tr>
                </table>
            </div>
            <!-- Competidor -->
            <div class="card" style="border-top: 4px solid var(--danger);">
                <h3 id="comp-them-title">Competidor</h3>
                <table class="comp-table">
                    <tr><td>Precio Promedio</td><td id="them-price">-</td></tr>
                    <tr><td>Click Share</td><td id="them-share">-</td></tr>
                    <tr><td>Rank Orgánico</td><td id="them-rank">-</td></tr>
                    <tr><td>Días con Deal</td><td id="them-deal">-</td></tr>
                    <tr><td>Conversión Est. (Proxy)</td><td id="them-eff">-</td></tr>
                </table>
            </div>
        </div>
        
        <div class="card">
            <h2>Análisis Diferencial</h2>
            <p id="comparator-diff-text">Selecciona una semana y competidor para ver el análisis.</p>
        </div>
    </div>

</div>

<script>
    // --- 1. DATOS INYECTADOS ---
    const marketData = [{"week_date": "2025-52", "parent_asin": "Vitamin D3", "asin": "B003VQZC3U", "product_title": "Vitamin D Tablets 1000IU, Vitabiotics Ultra", "resolved_brand": "Vitabiotics Ultra", "is_yaba_asin": "N", "clicks": 11456.121449999999, "click_share": 14.75, "average_organic_rank": 6, "price": 4.248571429, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 4, "weekly_number_of_days_with_coupon": 4, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2025-52", "parent_asin": "Vitamin D3", "asin": "B00RXIIW7K", "product_title": "Vitamin D3 4000 IU - 400 High Strength Vitamin D T...", "resolved_brand": "Incite Nutrition", "is_yaba_asin": "Y", "clicks": 3797.9955179999997, "click_share": 4.89, "average_organic_rank": 5, "price": 7.847142857, "weekly_number_of_days_with_deal": 1, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2025-52", "parent_asin": "Vitamin D3", "asin": "B0DJDFKXJT", "product_title": "Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...", "resolved_brand": "Vita Premium", "is_yaba_asin": "N", "clicks": 2399.960358, "click_share": 3.09, "average_organic_rank": 7, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2025-52", "parent_asin": "Vitamin D3", "asin": "B072L235Z5", "product_title": "Vitamin D 4,000 IU Softgels, Maximum Strength Vita...", "resolved_brand": "Vita Premium", "is_yaba_asin": "N", "clicks": 2578.598184, "click_share": 3.32, "average_organic_rank": 8, "price": 8.604285714, "weekly_number_of_days_with_deal": 2, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2025-52", "parent_asin": "Vitamin D3", "asin": "B0CR57HRDV", "product_title": "Vitamin D3 4000 iu & Vitamin K2 MK7 100\u03bcg - 1 Year...", "resolved_brand": "Nutrition Geeks", "is_yaba_asin": "N", "clicks": 12465.81351, "click_share": 16.05, "average_organic_rank": 2, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2025-52", "parent_asin": "Vitamin D3", "asin": "B0C1GJRWCL", "product_title": "4 HIM & HER Vitamin D3 4000 IU Vitamin D Tablets -...", "resolved_brand": "4", "is_yaba_asin": "N", "clicks": 1693.175916, "click_share": 2.18, "average_organic_rank": 42, "price": 7.647142857, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2025-52", "parent_asin": "Vitamin D3", "asin": "B08F5GBD9X", "product_title": "Vitamin D 1000iu - 1 Year Supply, 365 Easy-Swallow...", "resolved_brand": "Nutrition Geeks", "is_yaba_asin": "N", "clicks": 2912.57325, "click_share": 3.75, "average_organic_rank": 8, "price": 6.97, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2025-52", "parent_asin": "Vitamin D3", "asin": "B075GRYNB8", "product_title": "Vitamin D Tablets 2000IU, Vitabiotics Ultra-96 Cou...", "resolved_brand": "Vitabiotics Ultra", "is_yaba_asin": "N", "clicks": 4046.535102, "click_share": 5.21, "average_organic_rank": 16, "price": 6.502857143, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 5, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2025-52", "parent_asin": "Vitamin D3", "asin": "B08BRSVYFM", "product_title": "Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...", "resolved_brand": "G R O U N D E D COFFEE SCRUB", "is_yaba_asin": "N", "clicks": 2213.5556699999997, "click_share": 2.85, "average_organic_rank": 8, "price": 5.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2025-52", "parent_asin": "Vitamin D3", "asin": "B086V74KKR", "product_title": "Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...", "resolved_brand": "WeightWorld", "is_yaba_asin": "N", "clicks": 13203.6654, "click_share": 17.0, "average_organic_rank": 2, "price": 8.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 6, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-01", "parent_asin": "Vitamin D3", "asin": "B00RXIIW7K", "product_title": "Vitamin D3 4000 IU - 400 High Strength Vitamin D T...", "resolved_brand": "Incite Nutrition", "is_yaba_asin": "Y", "clicks": 2582.467272, "click_share": 4.38, "average_organic_rank": 7, "price": 7.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-01", "parent_asin": "Vitamin D3", "asin": "B0DJDFKXJT", "product_title": "Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...", "resolved_brand": "Vita Premium", "is_yaba_asin": "N", "clicks": 1874.9419920000003, "click_share": 3.18, "average_organic_rank": 8, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-01", "parent_asin": "Vitamin D3", "asin": "B0CR57HRDV", "product_title": "Vitamin D3 4000 iu & Vitamin K2 MK7 100\u03bcg - 1 Year...", "resolved_brand": "Nutrition Geeks", "is_yaba_asin": "N", "clicks": 10135.299636000002, "click_share": 17.19, "average_organic_rank": 2, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-01", "parent_asin": "Vitamin D3", "asin": "B08F5GBD9X", "product_title": "Vitamin D 1000iu - 1 Year Supply, 365 Easy-Swallow...", "resolved_brand": "Nutrition Geeks", "is_yaba_asin": "N", "clicks": 2729.8683720000004, "click_share": 4.63, "average_organic_rank": 10, "price": 6.97, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-01", "parent_asin": "Vitamin D3", "asin": "B086V74KKR", "product_title": "Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...", "resolved_brand": "WeightWorld", "is_yaba_asin": "N", "clicks": 10371.141396, "click_share": 17.59, "average_organic_rank": 3, "price": 8.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 4, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-01", "parent_asin": "Vitamin D3", "asin": "B08BRSVYFM", "product_title": "Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...", "resolved_brand": "G R O U N D E D COFFEE SCRUB", "is_yaba_asin": "N", "clicks": 1709.85276, "click_share": 2.9, "average_organic_rank": 10, "price": 5.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 4, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-01", "parent_asin": "Vitamin D3", "asin": "B003VQZC3U", "product_title": "Vitamin D Tablets 1000IU, Vitabiotics Ultra", "resolved_brand": "Vitabiotics Ultra", "is_yaba_asin": "N", "clicks": 7947.867312, "click_share": 13.48, "average_organic_rank": 5, "price": 3.765, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 2, "weekly_number_of_days_with_coupon": 3, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-01", "parent_asin": "Vitamin D3", "asin": "B079H1NVYY", "product_title": "Zipvit Vitamin D3 4000 IU, 360 Maximum Strength Vi...", "resolved_brand": "Zipvit", "is_yaba_asin": "N", "clicks": 972.8472600000001, "click_share": 1.65, "average_organic_rank": 15, "price": 7.49, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-01", "parent_asin": "Vitamin D3", "asin": "B075GRYNB8", "product_title": "Vitamin D Tablets 2000IU, Vitabiotics Ultra-96 Cou...", "resolved_brand": "Vitabiotics Ultra", "is_yaba_asin": "N", "clicks": 3012.8784840000003, "click_share": 5.11, "average_organic_rank": 8, "price": 5.61, "weekly_number_of_days_with_deal": 1, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 3, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-01", "parent_asin": "Vitamin D3", "asin": "B072L235Z5", "product_title": "Vitamin D 4,000 IU Softgels, Maximum Strength Vita...", "resolved_brand": "Vita Premium", "is_yaba_asin": "N", "clicks": 2659.1158440000004, "click_share": 4.51, "average_organic_rank": 7, "price": 7.64, "weekly_number_of_days_with_deal": 4, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-02", "parent_asin": "Vitamin D3", "asin": "B072L235Z5", "product_title": "Vitamin D 4,000 IU Softgels, Maximum Strength Vita...", "resolved_brand": "Vita Premium", "is_yaba_asin": "N", "clicks": 4524.071904, "click_share": 3.63, "average_organic_rank": 6, "price": 8.025714286, "weekly_number_of_days_with_deal": 5, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-02", "parent_asin": "Vitamin D3", "asin": "B00RXIIW7K", "product_title": "Vitamin D3 4000 IU - 400 High Strength Vitamin D T...", "resolved_brand": "Incite Nutrition", "is_yaba_asin": "Y", "clicks": 9297.403968, "click_share": 7.46, "average_organic_rank": 6, "price": 6.961428571, "weekly_number_of_days_with_deal": 6, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-02", "parent_asin": "Vitamin D3", "asin": "B08BRSVYFM", "product_title": "Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...", "resolved_brand": "G R O U N D E D COFFEE SCRUB", "is_yaba_asin": "N", "clicks": 2953.7328960000004, "click_share": 2.37, "average_organic_rank": 8, "price": 5.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-02", "parent_asin": "Vitamin D3", "asin": "B003VQZC3U", "product_title": "Vitamin D Tablets 1000IU, Vitabiotics Ultra", "resolved_brand": "Vitabiotics Ultra", "is_yaba_asin": "N", "clicks": 6368.597088000001, "click_share": 5.11, "average_organic_rank": 29, "price": 1.177142857, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-02", "parent_asin": "Vitamin D3", "asin": "B08F5GBD9X", "product_title": "Vitamin D 1000iu - 1 Year Supply, 365 Easy-Swallow...", "resolved_brand": "Nutrition Geeks", "is_yaba_asin": "N", "clicks": 5234.463360000001, "click_share": 4.2, "average_organic_rank": 8, "price": 6.984285714, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-02", "parent_asin": "Vitamin D3", "asin": "B0DJDFKXJT", "product_title": "Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...", "resolved_brand": "Vita Premium", "is_yaba_asin": "N", "clicks": 4062.940608, "click_share": 3.26, "average_organic_rank": 7, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-02", "parent_asin": "Vitamin D3", "asin": "B0BFF8LYR2", "product_title": "Vitamin D3 4000 IU - 400 Vegetarian Tablets - 13 M...", "resolved_brand": "Nu U Nutrition", "is_yaba_asin": "N", "clicks": 1981.6182720000002, "click_share": 1.59, "average_organic_rank": 18, "price": 6.691428571, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-02", "parent_asin": "Vitamin D3", "asin": "B075GRYNB8", "product_title": "Vitamin D Tablets 2000IU, Vitabiotics Ultra-96 Cou...", "resolved_brand": "Vitabiotics Ultra", "is_yaba_asin": "N", "clicks": 17435.748192, "click_share": 13.99, "average_organic_rank": 7, "price": 3.79, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 1, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-02", "parent_asin": "Vitamin D3", "asin": "B086V74KKR", "product_title": "Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...", "resolved_brand": "WeightWorld", "is_yaba_asin": "N", "clicks": 21074.946528, "click_share": 16.91, "average_organic_rank": 1, "price": 8.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-02", "parent_asin": "Vitamin D3", "asin": "B0CR57HRDV", "product_title": "Vitamin D3 4000 iu & Vitamin K2 MK7 100\u03bcg - 1 Year...", "resolved_brand": "Nutrition Geeks", "is_yaba_asin": "N", "clicks": 20202.535968000004, "click_share": 16.21, "average_organic_rank": 3, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-03", "parent_asin": "Vitamin D3", "asin": "B003VQZC3U", "product_title": "Vitamin D Tablets 1000IU, Vitabiotics Ultra", "resolved_brand": "Vitabiotics Ultra", "is_yaba_asin": "N", "clicks": 4639.521728, "click_share": 3.68, "average_organic_rank": 31, "price": 2.141428571, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-03", "parent_asin": "Vitamin D3", "asin": "B072L235Z5", "product_title": "Vitamin D 4,000 IU Softgels, Maximum Strength Vita...", "resolved_brand": "Vita Premium", "is_yaba_asin": "N", "clicks": 3454.4265040000005, "click_share": 2.74, "average_organic_rank": 10, "price": 8.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-03", "parent_asin": "Vitamin D3", "asin": "B086V74KKR", "product_title": "Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...", "resolved_brand": "WeightWorld", "is_yaba_asin": "N", "clicks": 23827.97844, "click_share": 18.9, "average_organic_rank": 1, "price": 8.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-03", "parent_asin": "Vitamin D3", "asin": "B0CZ7C4JWR", "product_title": "Vitamin D Tablets 400IU, Vitabiotics Ultra", "resolved_brand": "Vitamin", "is_yaba_asin": "N", "clicks": 2824.0567040000005, "click_share": 2.24, "average_organic_rank": 32, "price": 2.666, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-03", "parent_asin": "Vitamin D3", "asin": "B0CR57HRDV", "product_title": "Vitamin D3 4000 iu & Vitamin K2 MK7 100\u03bcg - 1 Year...", "resolved_brand": "Nutrition Geeks", "is_yaba_asin": "N", "clicks": 22693.3128, "click_share": 18.0, "average_organic_rank": 2, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-03", "parent_asin": "Vitamin D3", "asin": "B075GRYNB8", "product_title": "Vitamin D Tablets 2000IU, Vitabiotics Ultra-96 Cou...", "resolved_brand": "Vitabiotics Ultra", "is_yaba_asin": "N", "clicks": 13225.158404000002, "click_share": 10.49, "average_organic_rank": 10, "price": 7.19, "weekly_number_of_days_with_deal": 3, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 1, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-03", "parent_asin": "Vitamin D3", "asin": "B08F5GBD9X", "product_title": "Vitamin D 1000iu - 1 Year Supply, 365 Easy-Swallow...", "resolved_brand": "Nutrition Geeks", "is_yaba_asin": "N", "clicks": 6404.557168, "click_share": 5.08, "average_organic_rank": 8, "price": 6.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-03", "parent_asin": "Vitamin D3", "asin": "B08BRSVYFM", "product_title": "Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...", "resolved_brand": "G R O U N D E D COFFEE SCRUB", "is_yaba_asin": "N", "clicks": 2887.0936840000004, "click_share": 2.29, "average_organic_rank": 8, "price": 5.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 7, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-03", "parent_asin": "Vitamin D3", "asin": "B0DJDFKXJT", "product_title": "Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...", "resolved_brand": "Vita Premium", "is_yaba_asin": "N", "clicks": 4299.122036, "click_share": 3.41, "average_organic_rank": 7, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}, {"week_date": "2026-03", "parent_asin": "Vitamin D3", "asin": "B00RXIIW7K", "product_title": "Vitamin D3 4000 IU - 400 High Strength Vitamin D T...", "resolved_brand": "Incite Nutrition", "is_yaba_asin": "Y", "clicks": 6694.527276, "click_share": 5.31, "average_organic_rank": 5, "price": 6.79, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 0, "organic_or_not": 0, "container": 0}];

    // --- 2. CONFIGURACIÓN ---
    let OUR_BRAND = "";
    let PARENT_NAME = "";
    let TOP_COMPETITORS = [];
    let WEEKS = [];

    // --- 3. PROCESAMIENTO ---
    function processData() {
        // Identificar parent y marca
        PARENT_NAME = marketData[0].parent_asin;
        const ourRow = marketData.find(d => d.is_yaba_asin === 'Y');
        OUR_BRAND = ourRow ? ourRow.resolved_brand : "Marca Desconocida";
        
        // Semanas únicas
        WEEKS = [...new Set(marketData.map(d => d.week_date))].sort();

        // Identificar Top 3 Competidores (por share total)
        const brandShares = {};
        marketData.forEach(d => {
            if (d.resolved_brand === OUR_BRAND) return;
            brandShares[d.resolved_brand] = (brandShares[d.resolved_brand] || 0) + d.click_share;
        });
        TOP_COMPETITORS = Object.entries(brandShares)
            .sort((a,b) => b[1] - a[1])
            .slice(0, 3)
            .map(x => x[0]);
        
        // Rellenar UI inicial
        document.getElementById('page-title').textContent = `Reporte: ${PARENT_NAME}`;
        document.getElementById('date-range').textContent = `Periodo: ${WEEKS[0]} a ${WEEKS[WEEKS.length-1]}`;
        document.getElementById('our-brand-badge').textContent = `Nuestra Marca: ${OUR_BRAND}`;
        
        // Rellenar Selectors
        const selWeek = document.getElementById('sel-week');
        WEEKS.forEach(w => {
            let opt = document.createElement('option');
            opt.value = w; opt.text = w;
            selWeek.add(opt);
        });
        selWeek.value = WEEKS[WEEKS.length-1]; // Default last week

        const selComp = document.getElementById('sel-comp');
        TOP_COMPETITORS.forEach(c => {
            let opt = document.createElement('option');
            opt.value = c; opt.text = c;
            selComp.add(opt);
        });
    }

    // --- 4. GOOGLE CHARTS ---
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(init);

    function init() {
        processData();
        drawGlobalTrend();
        drawBrandComp();
        drawEfficiency();
        generateInsights();
        updateComparator();
    }

    function drawGlobalTrend() {
        // Agrupar por semana
        const weekData = WEEKS.map(week => {
            const weekRows = marketData.filter(d => d.week_date === week);
            const totalClicks = weekRows.reduce((sum, r) => sum + r.clicks, 0);
            
            // Share ponderado
            const totalShareVal = weekRows.reduce((sum, r) => sum + r.click_share, 0); // Esto suma > 100 si hay keywords, cuidado.
            // Mejor: Calcular share de nuestra marca sobre el total de clicks calculados
            const ourClicks = weekRows.filter(r => r.resolved_brand === OUR_BRAND).reduce((sum, r) => sum + r.clicks, 0);
            
            // Si clicks totales es 0 (raro), share es 0
            const realShare = totalClicks > 0 ? (ourClicks / totalClicks) * 100 : 0;

            return [week, totalClicks, realShare];
        });

        const data = google.visualization.arrayToDataTable([
            ['Semana', 'Clicks Totales Mercado', 'Nuestro Share (%)'],
            ...weekData
        ]);

        const options = {
            seriesType: 'bars',
            series: { 1: {type: 'line', targetAxisIndex: 1} },
            colors: ['#dadce0', '#4285F4'],
            vAxes: { 0: {title: 'Volumen Clicks'}, 1: {title: 'Share %', format: '#\'%\''} },
            legend: { position: 'bottom' },
            chartArea: { width: '85%', height: '70%' }
        };

        new google.visualization.ComboChart(document.getElementById('chart_global_trend')).draw(data, options);
        
        // Update Metrics Card
        const lastWeek = weekData[weekData.length-1];
        const prevWeek = weekData.length > 1 ? weekData[weekData.length-2] : lastWeek;
        
        document.getElementById('total-clicks').innerText = Math.round(lastWeek[1]).toLocaleString();
        document.getElementById('our-share').innerText = lastWeek[2].toFixed(2) + '%';
        
        const trendDiv = document.getElementById('clicks-trend');
        const diff = lastWeek[1] - prevWeek[1];
        trendDiv.innerHTML = diff >= 0 
            ? `<span class="trend-up"><span class="material-icons">trending_up</span> +${((diff/prevWeek[1])*100).toFixed(1)}% vs sem. ant.</span>`
            : `<span class="trend-down"><span class="material-icons">trending_down</span> ${((diff/prevWeek[1])*100).toFixed(1)}% vs sem. ant.</span>`;

        // Insight Text Trend
        const shareDiff = lastWeek[2] - prevWeek[2];
        document.getElementById('trend-insight').innerText = shareDiff > 0 
            ? `Ganamos visibilidad (+${shareDiff.toFixed(2)} pts) en un mercado ${diff > 0 ? 'creciente' : 'decreciente'}.`
            : `Perdimos visibilidad (${shareDiff.toFixed(2)} pts) esta semana.`;
    }

    function drawBrandComp() {
        // Header: Week, Us, Comp1, Comp2, Comp3, Rest
        const header = ['Semana', OUR_BRAND, ...TOP_COMPETITORS, 'Resto'];
        
        const rows = WEEKS.map(week => {
            const weekRows = marketData.filter(d => d.week_date === week);
            const totalClicks = weekRows.reduce((sum, r) => sum + r.clicks, 0);
            
            if(totalClicks === 0) return [week, 0, 0, 0, 0, 0];

            // Helper para calcular share real basado en clicks
            const getShare = (brand) => {
                const clicks = weekRows.filter(r => r.resolved_brand === brand).reduce((s, r) => s + r.clicks, 0);
                return (clicks / totalClicks) * 100;
            };

            const us = getShare(OUR_BRAND);
            const c1 = getShare(TOP_COMPETITORS[0]);
            const c2 = getShare(TOP_COMPETITORS[1]);
            const c3 = getShare(TOP_COMPETITORS[2]);
            const rest = 100 - (us + c1 + c2 + c3);

            return [week, us, c1, c2, c3, rest];
        });

        const data = google.visualization.arrayToDataTable([header, ...rows]);

        const options = {
            curveType: 'function',
            colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853', '#9AA0A6'], // Us(Blue), Comp1(Red), Comp2(Yellow), Comp3(Green), Rest(Gray)
            lineWidth: 3,
            legend: { position: 'bottom' },
            vAxis: { format: '#\'%\'' },
            chartArea: { width: '90%', height: '70%' }
        };

        new google.visualization.LineChart(document.getElementById('chart_brand_comp')).draw(data, options);
        
        // Top Competitor Card Update
        const lastRow = rows[rows.length-1];
        // Indices: 1=Us, 2=C1, 3=C2, 4=C3. Max of 2,3,4
        const comps = [
            {name: TOP_COMPETITORS[0], val: lastRow[2]},
            {name: TOP_COMPETITORS[1], val: lastRow[3]},
            {name: TOP_COMPETITORS[2], val: lastRow[4]}
        ];
        const top = comps.sort((a,b) => b.val - a.val)[0];
        document.getElementById('top-competitor').innerText = top.name;
        document.getElementById('top-comp-share').innerText = top.val.toFixed(1) + '% Share';
        
        document.getElementById('comp-insight').innerText = `${top.name} lidera la competencia. Nuestra marca se sitúa en ${(lastRow[1]).toFixed(1)}%.`;
    }

    function drawEfficiency() {
        // Scatter: X=Rank, Y=Share. Us vs All Others (Latest Week)
        const lastWeek = WEEKS[WEEKS.length-1];
        const rows = marketData.filter(d => d.week_date === lastWeek);

        // [Rank, Share, Tooltip, Color]
        // Note: Google Charts scatter needs numerical columns primarily.
        // We will create 2 series: Us, Others.
        
        const dataArray = [['Rank', 'Share', {'type': 'string', 'role': 'style'}, {'type': 'string', 'role': 'tooltip'}]];
        
        rows.forEach(r => {
            const isUs = r.resolved_brand === OUR_BRAND;
            const color = isUs ? 'point { fill-color: #4285F4; size: 6; }' : 'point { fill-color: #9AA0A6; }';
            const tooltip = `${r.resolved_brand}\nRank: ${r.average_organic_rank}\nShare: ${r.click_share}%`;
            dataArray.push([r.average_organic_rank, r.click_share, color, tooltip]);
        });

        const data = google.visualization.arrayToDataTable(dataArray);

        const options = {
            hAxis: { title: 'Rank Orgánico (Invertido)', direction: -1 },
            vAxis: { title: 'Click Share %' },
            legend: 'none',
            chartArea: { width: '85%', height: '75%' }
        };

        new google.visualization.ScatterChart(document.getElementById('chart_efficiency')).draw(data, options);
    }

    function generateInsights() {
        // Lógica simple para generar texto
        const ul = document.getElementById('levers-list');
        const lastWeek = WEEKS[WEEKS.length-1];
        const currentData = marketData.filter(d => d.week_date === lastWeek);
        const usData = currentData.filter(d => d.resolved_brand === OUR_BRAND);
        
        // 1. Deals
        const hasDeal = usData.some(d => d.weekly_number_of_days_with_deal > 0);
        ul.innerHTML += `<li><span class="material-icons insight-icon">local_offer</span> ${hasDeal ? 'Tuvimos Deals activos esta semana.' : 'No activamos Deals esta semana.'}</li>`;
        
        // 2. Coupon
        const hasCoupon = usData.some(d => d.weekly_number_of_days_with_coupon > 0);
        ul.innerHTML += `<li><span class="material-icons insight-icon">confirmation_number</span> ${hasCoupon ? 'Cupones activos presentes.' : 'Sin estrategia de cupones activa.'}</li>`;

        // 3. Price Check
        const ourAvgPrice = usData.reduce((s,x)=>s+x.price,0) / (usData.length||1);
        const mktAvgPrice = currentData.reduce((s,x)=>s+x.price,0) / currentData.length;
        const priceDiff = ((ourAvgPrice - mktAvgPrice)/mktAvgPrice)*100;
        
        ul.innerHTML += `<li><span class="material-icons insight-icon">attach_money</span> Nuestro precio es un ${Math.abs(priceDiff).toFixed(1)}% ${priceDiff > 0 ? 'mayor' : 'menor'} que el promedio del mercado.</li>`;

        // FINAL CONCLUSIONS & RECS
        const ulConc = document.getElementById('final-insights');
        const ulRec = document.getElementById('final-recommendations');
        
        // Insight 1: Trend
        const lastWeekClicks = WEEKS.map(w => marketData.filter(d=>d.week_date===w).reduce((s,r)=>s+r.clicks,0));
        const trendSlope = lastWeekClicks[lastWeekClicks.length-1] - lastWeekClicks[0];
        ulConc.innerHTML += `<li>La demanda del parent ${trendSlope > 0 ? 'ha crecido' : 'ha disminuido'} en el periodo analizado.</li>`;
        
        // Insight 2: Share dominance
        ulConc.innerHTML += `<li>Competencia fuerte de marcas como ${TOP_COMPETITORS.slice(0,2).join(', ')}.</li>`;

        // Rec 1: Price
        if(priceDiff > 20) {
            ulRec.innerHTML += `<li>Considerar ajuste de precio: Estamos significativamente por encima del mercado.</li>`;
        } else {
            ulRec.innerHTML += `<li>Mantener monitoreo de precios: Posicionamiento competitivo adecuado.</li>`;
        }

        // Rec 2: Rank
        ulRec.innerHTML += `<li>Enfocar esfuerzos SEO en keywords donde el Rank > 10 para recuperar eficiencia orgánica.</li>`;
        
        // Rec 3: Deals
        if(!hasDeal && !hasCoupon) {
            ulRec.innerHTML += `<li>Activar una promoción (Cupón/Deal) para reactivar conversión a corto plazo.</li>`;
        }
    }

    function updateComparator() {
        const week = document.getElementById('sel-week').value;
        const compName = document.getElementById('sel-comp').value;
        
        const weekRows = marketData.filter(d => d.week_date === week);
        
        // Get weighted averages for Us vs Them
        const getMetrics = (brand) => {
            const rows = weekRows.filter(r => r.resolved_brand === brand);
            if(rows.length === 0) return null;
            
            const clicks = rows.reduce((s,r)=>s+r.clicks,0);
            const share = rows.reduce((s,r)=>s+r.click_share,0); // Aprox sum
            const avgPrice = rows.reduce((s,r)=>s+r.price,0) / rows.length;
            const avgRank = rows.reduce((s,r)=>s+r.average_organic_rank,0) / rows.length;
            const dealDays = Math.max(...rows.map(r=>r.weekly_number_of_days_with_deal));
            
            return { price: avgPrice, share, rank: avgRank, deal: dealDays };
        };

        const usM = getMetrics(OUR_BRAND);
        const themM = getMetrics(compName);

        // Update DOM
        document.getElementById('comp-us-title').innerText = OUR_BRAND;
        document.getElementById('comp-them-title').innerText = compName;

        if(usM) {
            document.getElementById('us-price').innerText = usM.price.toFixed(2);
            document.getElementById('us-share').innerText = usM.share.toFixed(2) + '%';
            document.getElementById('us-rank').innerText = usM.rank.toFixed(1);
            document.getElementById('us-deal').innerText = usM.deal;
            // Efficiency Proxy: Share / (1/Rank) -> Just heuristic
            document.getElementById('us-eff').innerText = (usM.share / (100/usM.rank)).toFixed(2);
        }

        if(themM) {
            document.getElementById('them-price').innerText = themM.price.toFixed(2);
            document.getElementById('them-share').innerText = themM.share.toFixed(2) + '%';
            document.getElementById('them-rank').innerText = themM.rank.toFixed(1);
            document.getElementById('them-deal').innerText = themM.deal;
            document.getElementById('them-eff').innerText = (themM.share / (100/themM.rank)).toFixed(2);
        }

        // Diff Text
        if(usM && themM) {
            const priceGap = usM.price - themM.price;
            const shareGap = usM.share - themM.share;
            document.getElementById('comparator-diff-text').innerHTML = 
                `En la semana <b>${week}</b>, tu precio es <b>${priceGap > 0 ? 'más alto' : 'más bajo'}</b> (${Math.abs(priceGap).toFixed(2)}) que ${compName}. 
                Tu cuota de mercado es <b>${shareGap > 0 ? 'superior' : 'inferior'}</b> en un ${Math.abs(shareGap).toFixed(2)}%.`;
        } else {
            document.getElementById('comparator-diff-text').innerText = "Datos insuficientes para comparar en esta semana.";
        }
    }

    function switchTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        
        document.getElementById(`tab-${tabId}`).classList.add('active');
        // Find button
        const btnIndex = tabId === 'static' ? 0 : 1;
        document.querySelectorAll('.tab-btn')[btnIndex].classList.add('active');
    }
</script>

</body>
</html>