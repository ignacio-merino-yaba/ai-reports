<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Inteligencia de Mercado: Matcha Premium</title>
    <!-- Google Charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #4285F4; /* Google Blue */
            --success: #34A853; /* Google Green */
            --warning: #FBBC05; /* Google Yellow */
            --danger: #EA4335;  /* Google Red */
            --gray-100: #F1F3F4;
            --gray-200: #E8EAED;
            --gray-700: #5F6368;
            --gray-900: #202124;
            --white: #FFFFFF;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --card-radius: 16px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--gray-100);
            color: var(--gray-900);
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
        }

        /* Layout & Grid */
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 24px;
        }

        .header {
            background: var(--white);
            padding: 24px 32px;
            border-bottom: 1px solid var(--gray-200);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin: 0;
            color: var(--gray-900);
        }

        .header .meta {
            color: var(--gray-700);
            font-size: 14px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            padding: 0 24px;
        }

        .tab-btn {
            padding: 12px 24px;
            border-radius: 50px;
            border: none;
            background: var(--white);
            color: var(--gray-700);
            font-weight: 500;
            cursor: pointer;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-btn.active {
            background: var(--primary);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: var(--white);
            border-radius: var(--card-radius);
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray-900);
        }

        /* Grid for Charts */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .chart-container {
            width: 100%;
            height: 350px;
        }

        /* Insights Section */
        .insights-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        .insight-box {
            background: #F8F9FA;
            border-left: 4px solid var(--primary);
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 0 8px 8px 0;
        }
        
        .insight-box h4 { margin: 0 0 8px 0; font-size: 15px; color: var(--primary); }
        .insight-box p { margin: 0; font-size: 14px; line-height: 1.5; color: var(--gray-700); }

        .recommendation-box {
            background: #E8F5E9;
            border-left: 4px solid var(--success);
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 0 8px 8px 0;
        }
        .recommendation-box h4 { margin: 0 0 8px 0; font-size: 15px; color: var(--success); }
        .recommendation-box p { margin: 0; font-size: 14px; color: var(--gray-900); }

        /* Comparator Styles */
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }

        select {
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
            background: var(--white);
            font-family: inherit;
            font-size: 14px;
            min-width: 200px;
        }

        .kpi-row {
            display: flex;
            gap: 24px;
            margin-bottom: 24px;
        }

        .kpi-card {
            flex: 1;
            background: var(--white);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            box-shadow: var(--shadow);
        }
        
        .kpi-card h3 { font-size: 13px; text-transform: uppercase; color: var(--gray-700); margin: 0 0 8px 0; letter-spacing: 0.5px; }
        .kpi-card .value { font-size: 28px; font-weight: 700; color: var(--gray-900); }
        .kpi-card .sub { font-size: 12px; margin-top: 4px; }
        .text-green { color: var(--success); }
        .text-red { color: var(--danger); }

        /* Badge Pills */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-right: 4px;
        }
        .badge-our { background: #E3F2FD; color: #1976D2; }
        .badge-comp { background: #FFEBEE; color: #D32F2F; }

    </style>
</head>
<body>

    <!-- DATA INJECTION -->
    <script>
        const marketData = [{"week_date": "2026-01", "reporting_date": "2026-01-03", "parent_asin": "Matcha Premium", "asin": "B08YRXQ2JH", "product_title": "Double Dragon | 100% Organic | Premium Matcha Gree...", "competitor_brand": "Double Dragon", "is_yaba_asin": "N", "click_share": 4.92, "clicks": 1207.0, "price": 6.98, "organic_rank": 11, "deal_days": 0, "coupon_days": 0, "best_seller_days": 0, "amazon_choice_days": 0, "keyword": "matcha powder", "link": "https://www.amazon.co.uk/s?k=matcha+powder"}, {"week_date": "2026-01", "reporting_date": "2026-01-03", "parent_asin": "Matcha Premium", "asin": "B06XTYYYJ8", "product_title": "Heapwell Matcha Powder - 50g | High Grade Japanese...", "competitor_brand": "Heapwell Superfoods", "is_yaba_asin": "N", "click_share": 7.28, "clicks": 1786.0, "price": 9.99, "organic_rank": 6, "deal_days": 0, "coupon_days": 0, "best_seller_days": 0, "amazon_choice_days": 0, "keyword": "matcha powder", "link": "https://www.amazon.co.uk/s?k=matcha+powder"}, {"week_date": "2026-01", "reporting_date": "2026-01-03", "parent_asin": "Matcha Premium", "asin": "B09DQ1PWGX", "product_title": "PerfectTed Organic Matcha Powder, Ceremonial Grade...", "competitor_brand": "Perfect Ted", "is_yaba_asin": "N", "click_share": 4.68, "clicks": 1148.0, "price": 2.1225, "organic_rank": 34, "deal_days": 0, "coupon_days": 0, "best_seller_days": 0, "amazon_choice_days": 0, "keyword": "matcha powder", "link": "https://www.amazon.co.uk/s?k=matcha+powder"}, {"week_date": "2026-01", "reporting_date": "2026-01-03", "parent_asin": "Matcha Premium", "asin": "B0F21VZMJQ", "product_title": "PerfectTed Original Matcha Powder, Ceremonial Grad...", "competitor_brand": "Perfect Ted", "is_yaba_asin": "N", "click_share": 7.54, "clicks": 1850.0, "price": 16.99, "organic_rank": 4, "deal_days": 0, "coupon_days": 1, "best_seller_days": 0, "amazon_choice_days": 0, "keyword": "matcha powder", "link": "https://www.amazon.co.uk/s?k=matcha+powder"}, {"week_date": "2026-01", "reporting_date": "2026-01-03", "parent_asin": "Matcha Premium", "asin": "B0D9M91WZD", "product_title": "PerfectTed Vanilla Bean Matcha Powder, Ceremonial ...", "competitor_brand": "Perfect Ted", "is_yaba_asin": "N", "click_share": 2.37, "clicks": 581.0, "price": 11.0, "organic_rank": 11, "deal_days": 0, "coupon_days": 0, "best_seller_days": 0, "amazon_choice_days": 0, "keyword": "matcha powder", "link": "https://www.amazon.co.uk/s?k=matcha+powder"}, {"week_date": "2026-01", "reporting_date": "2026-01-03", "parent_asin": "Matcha Premium", "asin": "B082DKRSB4", "product_title": "SuperSelf Organic Matcha Powder - Ceremonial Grade...", "competitor_brand": "SuperSelf", "is_yaba_asin": "N", "click_share": 4.06, "clicks": 996.0, "price": 14.86, "organic_rank": 7, "deal_days": 4, "coupon_days": 4, "best_seller_days": 0, "amazon_choice_days": 0, "keyword": "matcha powder", "link": "https://www.amazon.co.uk/s?k=matcha+powder"}, {"week_date": "2026-01", "reporting_date": "2026-01-03", "parent_asin": "Matcha Premium", "asin": "B08YK2RPBZ", "product_title": "SuperSelf Organic Matcha Powder - Ceremonial Grade...", "competitor_brand": "SuperSelf", "is_yaba_asin": "N", "click_share": 13.48, "clicks": 3307.0, "price": 9.9, "organic_rank": 3, "deal_days": 0, "coupon_days": 0, "best_seller_days": 0, "amazon_choice_days": 0, "keyword": "matcha powder", "link": "https://www.amazon.co.uk/s?k=matcha+powder"}, {"week_date": "2026-01", "reporting_date": "2026-01-03", "parent_asin": "Matcha Premium", "asin": "B079VQ52MK", "product_title": "NaturaleBio Japanese Organic Matcha Green Tea Powd...", "competitor_brand": "NaturaleBio", "is_yaba_asin": "Y", "click_share": 3.19, "clicks": 783.0, "price": 20.99, "organic_rank": 7, "deal_days": 0, "coupon_days": 0, "best_seller_days": 0, "amazon_choice_days": 0, "keyword": "matcha powder", "link": "https://www.amazon.co.uk/s?k=matcha+powder"}, {"week_date": "2026-01", "reporting_date": "2026-01-03", "parent_asin": "Matcha Premium", "asin": "B07B29VZ6W", "product_title": "NaturaleBio Japanese Organic Matcha Green Tea Powd...", "competitor_brand": "NaturaleBio", "is_yaba_asin": "Y", "click_share": 2.03, "clicks": 498.0, "price": 16.49, "organic_rank": 10, "deal_days": 0, "coupon_days": 0, "best_seller_days": 0, "amazon_choice_days": 0, "keyword": "matcha powder", "link": "https://www.amazon.co.uk/s?k=matcha+powder"}, {"week_date": "2026-01", "reporting_date": "2026-01-03", "parent_asin": "Matcha Premium", "asin": "B06XQ5DCYJ", "product_title": "NaturaleBio Japanese Organic Matcha Green Tea Powd...", "competitor_brand": "NaturaleBio", "is_yaba_asin": "Y", "click_share": 14.18, "clicks": 3478.0, "price": 12.49, "organic_rank": 1, "deal_days": 0, "coupon_days": 4, "best_seller_days": 0, "amazon_choice_days": 0, "keyword": "matcha powder", "link": "https://www.amazon.co.uk/s?k=matcha+powder"}];
    </script>

    <!-- HEADER -->
    <div class="header">
        <div>
            <h1>An치lisis Parent ASIN: <span style="color:var(--primary)">Matcha Premium</span></h1>
            <div class="meta">Reporting Date: 2026-01-03 | Market: UK</div>
        </div>
        <div>
            <!-- Google Logo or Brand Logo could go here -->
            <span class="material-icons" style="color:var(--primary); font-size: 32px;">analytics</span>
        </div>
    </div>

    <!-- TABS -->
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('static')">
            <span class="material-icons">dashboard</span> Reporte Estrat칠gico
        </button>
        <button class="tab-btn" onclick="switchTab('interactive')">
            <span class="material-icons">compare_arrows</span> Comparador Interactivo
        </button>
    </div>

    <div class="container">

        <!-- TAB 1: STATIC REPORT -->
        <div id="static" class="tab-content active">
            
            <!-- SECTION 1: GLOBAL TREND -->
            <div class="card">
                <div class="card-title">
                    <span class="material-icons text-blue-500">trending_up</span>
                    1. Tendencia Global del Parent & Visibilidad
                </div>
                <div class="grid-2">
                    <div id="trend_chart" class="chart-container"></div>
                    <div>
                        <div class="insight-box" style="height: 90%;">
                            <h4>An치lisis de Tendencia</h4>
                            <p><strong>Volumen:</strong> Mercado activo con >24k b칰squedas semanales.</p>
                            <br>
                            <p><strong>Nuestra Posici칩n (NaturaleBio):</strong> Lideramos en Click Share agregado (~19.4%) gracias al rendimiento estelar del ASIN B06XQ5DCYJ (Rank 1).</p>
                            <br>
                            <p><strong>Din치mica:</strong> La competencia es feroz. "SuperSelf" nos sigue de cerca con un 17.5% de cuota, apalanc치ndose en precios m치s bajos en sus variantes clave.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECTION 2: COMPETITIVENESS -->
            <div class="card">
                <div class="card-title">
                    <span class="material-icons">group</span>
                    2. Competitividad de Marca (Share of Voice)
                </div>
                <div id="competitiveness_chart" class="chart-container" style="height: 400px;"></div>
                <p style="margin-top:16px; font-size:13px; color:var(--gray-700)">*Gr치fico muestra la evoluci칩n del Click Share total por marca. En este reporte "snapshot", se muestra el estado actual.</p>
            </div>

            <!-- SECTION 3 & 4: LEVERS & EFFICIENCY -->
            <div class="grid-2">
                <!-- Palancas -->
                <div class="card">
                    <div class="card-title">
                        <span class="material-icons">tune</span>
                        3. Palancas de Venta (Deals & Coupons)
                    </div>
                    <div id="levers_table"></div>
                    <div style="margin-top:12px; font-size:14px; color:var(--gray-700)">
                        <strong>Insight:</strong> Nuestra variante Top (B06XQ5DCYJ) tiene <strong>4 d칤as de Cupones</strong>, correlacionando directamente con su posici칩n #1. SuperSelf utiliza Deals agresivos (4 d칤as) en su variante B082DKRSB4.
                    </div>
                </div>

                <!-- Eficiencia -->
                <div class="card">
                    <div class="card-title">
                        <span class="material-icons">scatter_plot</span>
                        4. Eficiencia: Organic Rank vs Click Share
                    </div>
                    <div id="efficiency_chart" class="chart-container"></div>
                    <div style="margin-top:12px; font-size:14px; color:var(--gray-700)">
                        <strong>Lectura:</strong> Los puntos arriba a la izquierda son "Estrellas" (Alto Rank, Alto Share). 
                        <br>
                        <span style="color:var(--primary); font-weight:bold;">NaturaleBio</span> domina el cuadrante de eficiencia.
                        <span style="color:#EA4335; font-weight:bold;">SuperSelf</span> obtiene mucho share (13.48%) siendo Rank 3, posiblemente por su precio de 춲9.90.
                    </div>
                </div>
            </div>

            <!-- SECTION 5: INSIGHTS & RECOMMENDATIONS -->
            <div class="insights-grid">
                <div class="card">
                    <div class="card-title">
                        <span class="material-icons">lightbulb</span>
                        5. Conclusiones y Recomendaciones
                    </div>
                    
                    <div class="insight-box">
                        <h4>游끥 Dominio de NaturaleBio</h4>
                        <p>Nuestra marca posee el ASIN l칤der (B06XQ5DCYJ) con 14.18% de cuota y Rank Org치nico 1. La estrategia de Cupones (4 d칤as) est치 protegiendo esta posici칩n eficazmente.</p>
                    </div>

                    <div class="insight-box">
                        <h4>丘멆잺 Amenaza de Precio (SuperSelf)</h4>
                        <p>El competidor SuperSelf tiene un ASIN (B08YK2RPBZ) con 13.5% de cuota a un precio de 춲9.90. Es una amenaza directa a nuestros ASINs de mayor precio (춲16-20).</p>
                    </div>

                    <div class="recommendation-box">
                        <h4>游 Acci칩n 1: Blindar el Top Seller</h4>
                        <p>Mantener la actividad de Cupones en B06XQ5DCYJ. No retirar incentivos mientras SuperSelf mantenga presi칩n de precio/deals.</p>
                    </div>

                    <div class="recommendation-box">
                        <h4>游눯 Acci칩n 2: Revisar Pricing en Gama Alta</h4>
                        <p>Nuestro ASIN B079VQ52MK (춲20.99) tiene baja eficiencia (Rank 7, Share 3%). Evaluar una promoci칩n temporal para reactivar conversi칩n o justificar el premium en el listing.</p>
                    </div>
                     <div class="recommendation-box">
                        <h4>游댌 Acci칩n 3: Contenci칩n de 'Perfect Ted'</h4>
                        <p>Perfect Ted tiene alta presencia (3 variantes) pero share fragmentado. Monitorizar si consolidan tr치fico en una sola variante.</p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">
                        <span class="material-icons">visibility</span>
                        Other Insights
                    </div>
                    <ul style="padding-left: 20px; font-size: 14px; line-height: 1.6; color: var(--gray-700);">
                        <li><strong>Dispersi칩n de Precios:</strong> El mercado oscila entre 춲6.98 (Low End) y 춲20.99 (NaturaleBio High End). Somos la opci칩n Premium.</li>
                        <li><strong>Anomal칤a Perfect Ted:</strong> Aparece un precio de 춲2.12 en datos. Verificar si es un error de feed o un tama침o de muestra agresivo.</li>
                        <li><strong>Dependencia del Rank 1:</strong> El 73% de nuestro tr치fico total proviene de un solo ASIN. Riesgo de concentraci칩n.</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- TAB 2: INTERACTIVE COMPARATOR -->
        <div id="interactive" class="tab-content">
            <div class="controls">
                <select id="weekSelector" onchange="updateComparator()">
                    <!-- Populated by JS -->
                </select>
                <select id="competitorSelector" onchange="updateComparator()">
                    <!-- Populated by JS -->
                </select>
            </div>

            <div class="kpi-row">
                <!-- Our Brand KPI -->
                <div class="kpi-card" style="border-top: 4px solid var(--primary);">
                    <h3 id="ourBrandName">NaturaleBio</h3>
                    <div class="value" id="ourShare">0%</div>
                    <div class="sub">Click Share Avg</div>
                    <div style="margin-top:12px; font-size:14px;">
                        Avg Price: <strong id="ourPrice">춲0.00</strong>
                    </div>
                </div>

                <!-- VS -->
                <div style="display:flex; align-items:center; justify-content:center; font-weight:bold; color:var(--gray-200); font-size:24px;">VS</div>

                <!-- Competitor KPI -->
                <div class="kpi-card" style="border-top: 4px solid var(--danger);">
                    <h3 id="compBrandName">Competitor</h3>
                    <div class="value" id="compShare">0%</div>
                    <div class="sub">Click Share Avg</div>
                    <div style="margin-top:12px; font-size:14px;">
                        Avg Price: <strong id="compPrice">춲0.00</strong>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">Detalle ASIN vs ASIN</div>
                <div id="comparison_table"></div>
            </div>
        </div>

    </div>

    <!-- LOGIC -->
    <script type="text/javascript">
        // --- 1. CONFIG & INIT ---
        google.charts.load('current', {'packages':['corechart', 'table']});
        google.charts.setOnLoadCallback(initDashboard);

        // Global State
        let uniqueWeeks = [];
        let brands = [];
        let ourBrand = "";
        
        function initDashboard() {
            processData();
            drawCharts();
            populateSelectors();
            updateComparator(); // Init interactive tab
        }

        // --- 2. DATA PROCESSING ---
        function processData() {
            // Identify our brand based on YABA flag
            const ourRow = marketData.find(d => d.is_yaba_asin === 'Y');
            ourBrand = ourRow ? ourRow.competitor_brand : "Our Brand";

            // Extract Unique Weeks
            uniqueWeeks = [...new Set(marketData.map(d => d.week_date))].sort();

            // Extract Unique Competitor Brands (excluding ours)
            brands = [...new Set(marketData
                .filter(d => d.competitor_brand !== ourBrand)
                .map(d => d.competitor_brand)
            )];
        }

        function getBrandMetrics(brandName, week) {
            const subset = marketData.filter(d => d.competitor_brand === brandName && d.week_date === week);
            if (subset.length === 0) return { share: 0, price: 0, count: 0 };

            const totalShare = subset.reduce((sum, item) => sum + item.click_share, 0);
            const avgPrice = subset.reduce((sum, item) => sum + item.price, 0) / subset.length;
            
            return { share: totalShare, price: avgPrice, count: subset.length };
        }

        // --- 3. CHARTS RENDERING ---
        function drawCharts() {
            drawTrendChart();
            drawCompetitivenessChart();
            drawEfficiencyChart();
            drawLeversTable();
        }

        function drawTrendChart() {
            // Aggregated Clicks by Our Brand vs Competitors per Week
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Week');
            data.addColumn('number', 'Our Clicks');
            data.addColumn('number', 'Competitor Clicks');
            data.addColumn('number', 'Our Share %');

            uniqueWeeks.forEach(week => {
                const weekData = marketData.filter(d => d.week_date === week);
                
                const ourClicks = weekData.filter(d => d.is_yaba_asin === 'Y')
                                          .reduce((sum, d) => sum + d.clicks, 0);
                
                const compClicks = weekData.filter(d => d.is_yaba_asin === 'N')
                                           .reduce((sum, d) => sum + d.clicks, 0);
                
                const totalClicks = ourClicks + compClicks;
                const ourShare = totalClicks > 0 ? (ourClicks / totalClicks) * 100 : 0;

                data.addRow([week, ourClicks, compClicks, ourShare]);
            });

            const options = {
                title: 'Total Clicks & Share Evolution',
                vAxes: {
                    0: {title: 'Clicks Volume'},
                    1: {title: 'Share %', format: '#\'%\'', maxValue: 100}
                },
                hAxis: {title: 'Week'},
                seriesType: 'bars',
                series: {
                    0: {targetAxisIndex: 0, color: '#4285F4'}, // Us
                    1: {targetAxisIndex: 0, color: '#E0E0E0'}, // Comps
                    2: {targetAxisIndex: 1, type: 'line', color: '#34A853', lineWidth: 3} // Share Line
                },
                isStacked: true,
                legend: {position: 'bottom'},
                chartArea: {width: '80%', height: '70%'}
            };

            const chart = new google.visualization.ComboChart(document.getElementById('trend_chart'));
            chart.draw(data, options);
        }

        function drawCompetitivenessChart() {
            // Top 3 Competitors + Us
            // Find top 3 brands by total share
            const brandShares = {};
            marketData.forEach(d => {
                if (!brandShares[d.competitor_brand]) brandShares[d.competitor_brand] = 0;
                brandShares[d.competitor_brand] += d.click_share;
            });
            
            // Sort brands
            const sortedBrands = Object.keys(brandShares)
                .filter(b => b !== ourBrand)
                .sort((a,b) => brandShares[b] - brandShares[a])
                .slice(0, 3);

            const displayBrands = [ourBrand, ...sortedBrands];

            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Week');
            displayBrands.forEach(b => data.addColumn('number', b));

            uniqueWeeks.forEach(week => {
                const row = [week];
                displayBrands.forEach(brand => {
                    const share = marketData
                        .filter(d => d.week_date === week && d.competitor_brand === brand)
                        .reduce((sum, d) => sum + d.click_share, 0);
                    row.push(share);
                });
                data.addRow(row);
            });

            const options = {
                curveType: 'function',
                legend: { position: 'bottom' },
                colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853'], // Blue for us, others distinct
                vAxis: { title: 'Total Click Share %' },
                chartArea: {width: '85%', height: '70%'},
                pointSize: 5
            };

            const chart = new google.visualization.LineChart(document.getElementById('competitiveness_chart'));
            chart.draw(data, options);
        }

        function drawEfficiencyChart() {
            // Scatter: X=Rank (inverted), Y=Click Share, Color=Brand Type
            const data = new google.visualization.DataTable();
            data.addColumn('number', 'Organic Rank');
            data.addColumn('number', 'Click Share');
            data.addColumn({type: 'string', role: 'style'});
            data.addColumn({type: 'string', role: 'tooltip'});

            const latestWeek = uniqueWeeks[uniqueWeeks.length - 1]; // Focus on latest
            const weekData = marketData.filter(d => d.week_date === latestWeek);

            weekData.forEach(d => {
                const isUs = d.is_yaba_asin === 'Y';
                const color = isUs ? '#4285F4' : '#EA4335';
                const stroke = isUs ? '#1967D2' : '#C5221F';
                // Tooltip
                const tooltip = `${d.competitor_brand}\nASIN: ${d.asin}\nRank: ${d.organic_rank}\nShare: ${d.click_share}%`;
                
                data.addRow([
                    d.organic_rank, 
                    d.click_share, 
                    `point { fill-color: ${color}; stroke-color: ${stroke}; size: 7; }`,
                    tooltip
                ]);
            });

            const options = {
                title: 'Efficiency Matrix (Latest Week)',
                hAxis: { title: 'Organic Rank (Lower is Better)', direction: -1 }, // Invert axis
                vAxis: { title: 'Click Share %' },
                legend: 'none',
                chartArea: {width: '85%', height: '70%'}
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('efficiency_chart'));
            chart.draw(data, options);
        }

        function drawLeversTable() {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Brand');
            data.addColumn('string', 'ASIN');
            data.addColumn('number', 'Price (춲)');
            data.addColumn('number', 'Share %');
            data.addColumn('number', 'Deal Days');
            data.addColumn('number', 'Coupon Days');

            // Sort by Share Descending
            const sorted = [...marketData].filter(d => d.week_date === uniqueWeeks[uniqueWeeks.length-1])
                                          .sort((a,b) => b.click_share - a.click_share);

            sorted.forEach(d => {
                data.addRow([
                    d.competitor_brand,
                    d.asin,
                    d.price,
                    d.click_share,
                    d.deal_days,
                    d.coupon_days
                ]);
            });

            const table = new google.visualization.Table(document.getElementById('levers_table'));
            table.draw(data, {showRowNumber: true, width: '100%', height: '100%'});
        }

        // --- 4. INTERACTIVE TAB LOGIC ---
        function populateSelectors() {
            const weekSel = document.getElementById('weekSelector');
            const compSel = document.getElementById('competitorSelector');

            uniqueWeeks.forEach(w => {
                const opt = document.createElement('option');
                opt.value = w;
                opt.text = w;
                weekSel.appendChild(opt);
            });

            brands.forEach(b => {
                const opt = document.createElement('option');
                opt.value = b;
                opt.text = b;
                compSel.appendChild(opt);
            });
            // Select first competitor by default
            if(brands.length > 0) compSel.value = brands[0];
        }

        function updateComparator() {
            const week = document.getElementById('weekSelector').value;
            const comp = document.getElementById('competitorSelector').value;

            // Update KPIs
            const ourMetrics = getBrandMetrics(ourBrand, week);
            const compMetrics = getBrandMetrics(comp, week);

            document.getElementById('ourBrandName').textContent = ourBrand;
            document.getElementById('ourShare').textContent = ourMetrics.share.toFixed(1) + '%';
            document.getElementById('ourPrice').textContent = '춲' + ourMetrics.price.toFixed(2);

            document.getElementById('compBrandName').textContent = comp;
            document.getElementById('compShare').textContent = compMetrics.share.toFixed(1) + '%';
            document.getElementById('compPrice').textContent = '춲' + compMetrics.price.toFixed(2);

            // Update Table
            drawComparisonTable(week, comp);
        }

        function drawComparisonTable(week, compBrand) {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'ASIN');
            data.addColumn('string', 'Product Title');
            data.addColumn('number', 'Rank');
            data.addColumn('number', 'Share %');
            data.addColumn('number', 'Price');
            data.addColumn('string', 'Badges');

            const relevantData = marketData.filter(d => 
                d.week_date === week && 
                (d.competitor_brand === ourBrand || d.competitor_brand === compBrand)
            ).sort((a,b) => b.click_share - a.click_share);

            relevantData.forEach(d => {
                let badges = "";
                if(d.deal_days > 0) badges += "Deal ";
                if(d.coupon_days > 0) badges += "Cpn ";
                if(d.best_seller_days > 0) badges += "BS ";
                
                data.addRow([
                    d.asin,
                    d.product_title.substring(0, 30) + '...',
                    d.organic_rank,
                    d.click_share,
                    d.price,
                    badges
                ]);
            });

            const table = new google.visualization.Table(document.getElementById('comparison_table'));
            table.draw(data, {showRowNumber: false, width: '100%', height: '100%', allowHtml: true});
        }

        // --- 5. UI UTILS ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            
            // Find button based on onclick attribute or text (simplest way here)
            const btns = document.querySelectorAll('.tab-btn');
            if(tabId === 'static') btns[0].classList.add('active');
            else btns[1].classList.add('active');
            
            // Redraw charts if switching to static (fix google charts hidden div issue)
            if(tabId === 'static') drawCharts();
        }

        // Resize listener
        window.onresize = () => {
            if(document.getElementById('static').classList.contains('active')) drawCharts();
        };

    </script>
</body>
</html>