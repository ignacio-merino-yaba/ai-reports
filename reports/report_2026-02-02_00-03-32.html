<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Inteligencia de Mercado - Parent ASIN</title>
    
    <!-- Google Charts -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #4285F4; /* Google Blue */
            --secondary-color: #EA4335; /* Google Red */
            --tertiary-color: #34A853; /* Google Green */
            --bg-color: #F8F9FA;
            --card-bg: #FFFFFF;
            --text-main: #202124;
            --text-muted: #5F6368;
            --border-radius: 16px;
        }

        body {
            font-family: 'Roboto', 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Header */
        header {
            background-color: var(--card-bg);
            padding: 24px;
            border-bottom: 1px solid #E0E0E0;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 24px;
            font-weight: 500;
            margin: 0;
            color: var(--text-main);
        }

        .meta-info {
            font-size: 14px;
            color: var(--text-muted);
            text-align: right;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            border-bottom: 1px solid #E0E0E0;
            padding-bottom: 0;
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: none;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-muted);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
            padding: 24px;
            margin-bottom: 24px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 500;
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .metric-item {
            background: #F1F3F4;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
        }

        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 4px;
        }

        .metric-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Charts */
        .chart-container {
            width: 100%;
            height: 400px;
        }

        /* Insights List */
        .insights-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .insight-item {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            align-items: flex-start;
        }

        .insight-icon {
            color: var(--primary-color);
            margin-top: 2px;
        }

        .insight-content h4 {
            margin: 0 0 4px 0;
            font-size: 16px;
        }

        .insight-content p {
            margin: 0;
            font-size: 14px;
            color: var(--text-muted);
            line-height: 1.5;
        }

        /* Interactive Controls */
        .controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }

        select {
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid #DADCE0;
            font-size: 14px;
            color: var(--text-main);
            background-color: #fff;
            outline: none;
        }

        /* Utils */
        .text-green { color: var(--tertiary-color); }
        .text-red { color: var(--secondary-color); }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
        }
        .badge-our { background-color: #E8F0FE; color: var(--primary-color); }
        .badge-comp { background-color: #FCE8E6; color: var(--secondary-color); }

        /* Hide logic */
        .tab-content { display: none; }
        .tab-content.active { display: block; }

    </style>
</head>
<body>

    <header>
        <div>
            <h1>Análisis de Parent ASIN</h1>
            <div style="font-size: 14px; color: var(--text-muted); margin-top: 4px;">Parent: Coconut oil</div>
        </div>
        <div class="meta-info">
            <div>Report Generated: 2026-01-03</div>
            <div>Source: Market Intelligence</div>
        </div>
    </header>

    <div class="container">
        <!-- Navigation -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('static')">Reporte Estático</button>
            <button class="tab-btn" onclick="switchTab('interactive')">Comparador Interactivo</button>
        </div>

        <!-- TAB 1: STATIC REPORT -->
        <div id="static" class="tab-content active">
            
            <!-- SECTION 1: TRENDS -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="material-icons">trending_up</span>
                        1. Tendencia Global del Parent
                    </div>
                </div>
                <div class="metrics-grid" id="global-metrics">
                    <!-- JS will populate -->
                </div>
                <div id="chart_trend" class="chart-container"></div>
                <div style="padding-top: 16px; border-top: 1px solid #f0f0f0;">
                    <p class="insight-content">
                        <strong>Análisis de Tracción:</strong> El mercado muestra un volumen de búsqueda estable de ~5,111 búsquedas semanales. 
                        Nuestra marca (NaturaleBio) mantiene el liderazgo con una cuota combinada del <strong>22.1%</strong>, 
                        superando al competidor más cercano ("by Amazon") por 3 puntos porcentuales.
                    </p>
                </div>
            </div>

            <!-- SECTION 2: BRAND COMPETITIVENESS -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="material-icons">pie_chart</span>
                        2. Competitividad de Marca (Share of Voice)
                    </div>
                </div>
                <div id="chart_competitiveness" class="chart-container"></div>
                <div class="metrics-grid" style="margin-top: 16px;">
                    <div class="metric-item">
                        <div class="metric-value" style="color: #4285F4">22.14%</div>
                        <div class="metric-label">NaturaleBio (Nosotros)</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value" style="color: #EA4335">18.98%</div>
                        <div class="metric-label">by Amazon</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value" style="color: #FBBC04">8.67%</div>
                        <div class="metric-label">Eco nature</div>
                    </div>
                </div>
            </div>

            <!-- SECTION 3: DRIVERS -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="material-icons">local_offer</span>
                        3. Palancas de Crecimiento (Precios & Promos)
                    </div>
                </div>
                <div id="chart_drivers" class="chart-container"></div>
            </div>

            <!-- SECTION 4: EFFICIENCY -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="material-icons">scatter_plot</span>
                        4. Eficiencia (Organic Rank vs Click Share)
                    </div>
                </div>
                <div id="chart_efficiency" class="chart-container"></div>
                <p style="font-size: 13px; color: #666; margin-top: 8px; text-align: center;">
                    *Eje Y: Click Share (Logrado) vs Eje X: Rank Orgánico (Posición). Puntos arriba a la izquierda son "Sobreperformers".
                </p>
            </div>

            <!-- SECTION 5: CONCLUSIONS -->
            <div class="card" style="border-left: 5px solid var(--primary-color);">
                <div class="card-header">
                    <div class="card-title">
                        <span class="material-icons">lightbulb</span>
                        5. Conclusiones y Recomendaciones
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <div>
                        <h3 style="font-size: 16px; margin-bottom: 16px; color: var(--primary-color);">Insights Clave</h3>
                        <ul class="insights-list">
                            <li class="insight-item">
                                <span class="material-icons insight-icon">check_circle</span>
                                <div class="insight-content">
                                    <h4>Dominio Fragmentado</h4>
                                    <p>Aunque lideramos como marca (22% share), "by Amazon" tiene el ASIN individual más fuerte (19% share) vs nuestro mejor ASIN (13.5%).</p>
                                </div>
                            </li>
                            <li class="insight-item">
                                <span class="material-icons insight-icon">warning</span>
                                <div class="insight-content">
                                    <h4>Amenaza de Precios Bajos</h4>
                                    <p>"Planète au Naturel" está capturando 7.3% del mercado con un precio extremadamente agresivo (€5.90), muy por debajo de nuestro rango (€9-19).</p>
                                </div>
                            </li>
                            <li class="insight-item">
                                <span class="material-icons insight-icon">trending_up</span>
                                <div class="insight-content">
                                    <h4>Correlación Cupones/Share</h4>
                                    <p>"by Amazon" activó cupones 3 días a la semana, coincidiendo con su alto performance. Nuestra activación fue baja (1 día en top ASIN).</p>
                                </div>
                            </li>
                            <li class="insight-item">
                                <span class="material-icons insight-icon">stars</span>
                                <div class="insight-content">
                                    <h4>Eficiencia Orgánica</h4>
                                    <p>Nuestro Rank #1 es altamente eficiente, pero nuestros ASINs secundarios en Rank #6 podrían canibalizarse entre sí sin mayor diferenciación.</p>
                                </div>
                            </li>
                            <li class="insight-item">
                                <span class="material-icons insight-icon">visibility</span>
                                <div class="insight-content">
                                    <h4>Visibilidad vs Conversión</h4>
                                    <p>A pesar de tener mejor posicionamiento orgánico promedio, competidores con precios medios ("Eco nature") mantienen cuotas saludables sin grandes descuentos.</p>
                                </div>
                            </li>
                        </ul>
                    </div>

                    <div>
                        <h3 style="font-size: 16px; margin-bottom: 16px; color: var(--secondary-color);">Recomendaciones Accionables</h3>
                        <ul class="insights-list">
                            <li class="insight-item">
                                <span class="material-icons insight-icon" style="color: var(--secondary-color)">bolt</span>
                                <div class="insight-content">
                                    <h4>Defensa contra "by Amazon"</h4>
                                    <p>Igualar o superar la frecuencia de cupones de "by Amazon" (actualmente 3 días/sem) en nuestro ASIN principal para recuperar el share perdido.</p>
                                </div>
                            </li>
                            <li class="insight-item">
                                <span class="material-icons insight-icon" style="color: var(--secondary-color)">sell</span>
                                <div class="insight-content">
                                    <h4>Estrategia de Precio en ASINs Secundarios</h4>
                                    <p>Considerar bajar el precio del ASIN de 1L (€19.49) temporalmente para competir mejor contra opciones de volumen más baratas.</p>
                                </div>
                            </li>
                            <li class="insight-item">
                                <span class="material-icons insight-icon" style="color: var(--secondary-color)">search</span>
                                <div class="insight-content">
                                    <h4>Optimización de Títulos</h4>
                                    <p>Revisar títulos de ASINs secundarios para asegurar que ataquen long-tails específicas y no compitan directamente por la misma keyword genérica "olio di cocco".</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- SECTION 6: OTHER INSIGHTS -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="material-icons">travel_explore</span>
                        6. Other Insights & Oportunidades
                    </div>
                </div>
                <p class="insight-content">
                    Se detecta un competidor emergente <strong>"CocoNativo"</strong> con un precio premium (€18.95) logrando un 6.6% de share a pesar de un Rank #9. 
                    Esto sugiere un segmento de clientes inelásticos al precio que buscan calidad "Extra Virgen/Premium". 
                    Podríamos posicionar nuestro ASIN más caro (€19.49) enfatizando atributos de calidad superior para atacar este nicho directamente.
                </p>
            </div>

        </div>

        <!-- TAB 2: INTERACTIVE -->
        <div id="interactive" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="material-icons">compare_arrows</span>
                        Comparador Directo
                    </div>
                </div>
                
                <div class="controls">
                    <select id="compSelect" onchange="updateInteractive()">
                        <option value="ALL">Ver Todos los Competidores</option>
                        <!-- JS populated -->
                    </select>
                </div>

                <div id="table_interactive"></div>
            </div>
        </div>

    </div>

    <!-- DATA INJECTION -->
    <script>
        // DATA PROCESSED FROM CSV
        const marketData = [{"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "week_date": "2026-01", "keywords": "olio di cocco", "brand": "Plan\u00e8te au Naturel", "asin": "B0D6S1L6PL", "product_title": "Olio di Cocco Bio 150 ml - Plan\u00e8te au Naturel - Cr...", "is_yaba_asin": "N", "clicks": 372.637827, "click_share": 7.29, "price": 5.9, "organic_rank": 4, "deal_days": 0, "coupon_days": 0, "best_seller_days": 0, "amazon_choice_days": 0, "search_volume": 5111.63, "our_brand_name": "NaturaleBio"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "week_date": "2026-01", "keywords": "olio di cocco", "brand": "by Amazon", "asin": "B07W8PPQQM", "product_title": "by Amazon - Olio di cocco vergine biologico, 950 m...", "is_yaba_asin": "N", "clicks": 970.187374, "click_share": 18.98, "price": 13.33, "organic_rank": 2, "deal_days": 0, "coupon_days": 3, "best_seller_days": 0, "amazon_choice_days": 3, "search_volume": 5111.63, "our_brand_name": "NaturaleBio"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "week_date": "2026-01", "keywords": "olio di cocco", "brand": "CocoNativo", "asin": "B073P974FR", "product_title": "CocoNativo Biologico Extra Vergine Olio di Cocco, ...", "is_yaba_asin": "N", "clicks": 338.390, "click_share": 6.62, "price": 18.95, "organic_rank": 9, "deal_days": 0, "coupon_days": 0, "best_seller_days": 0, "amazon_choice_days": 0, "search_volume": 5111.63, "our_brand_name": "NaturaleBio"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "week_date": "2026-01", "keywords": "olio di cocco", "brand": "Eco nature", "asin": "B08HK4YWGH", "product_title": "Eco nature, Olio di cocco bio, 200g", "is_yaba_asin": "N", "clicks": 443.178321, "click_share": 8.67, "price": 4.5, "organic_rank": 3, "deal_days": 0, "coupon_days": 0, "best_seller_days": 0, "amazon_choice_days": 0, "search_volume": 5111.63, "our_brand_name": "NaturaleBio"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "week_date": "2026-01", "keywords": "olio di cocco", "brand": "NaturaleBio", "asin": "B01M0LGD6A", "product_title": "NaturaleBio Organic Virgin Coconut Oil 200 ml. Raw...", "is_yaba_asin": "Y", "clicks": 690.581213, "click_share": 13.51, "price": 8.99, "organic_rank": 1, "deal_days": 0, "coupon_days": 1, "best_seller_days": 0, "amazon_choice_days": 1, "search_volume": 5111.63, "our_brand_name": "NaturaleBio"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "week_date": "2026-01", "keywords": "olio di cocco", "brand": "BENVOLIO", "asin": "B0CH11HMCS", "product_title": "BENVOLIO - Olio di Cocco Biologico Deodorato | 950...", "is_yaba_asin": "N", "clicks": 217.755438, "click_share": 4.26, "price": 10.9, "organic_rank": 7, "deal_days": 0, "coupon_days": 0, "best_seller_days": 0, "amazon_choice_days": 0, "search_volume": 5111.63, "our_brand_name": "NaturaleBio"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "week_date": "2026-01", "keywords": "olio di cocco", "brand": "Monte Nativo", "asin": "B07TMGBPL7", "product_title": "Olio di Cocco Biologico Extra Vergin Monte Nativo ...", "is_yaba_asin": "N", "clicks": 77.696776, "click_share": 1.52, "price": 17.95, "organic_rank": 14, "deal_days": 0, "coupon_days": 0, "best_seller_days": 0, "amazon_choice_days": 0, "search_volume": 5111.63, "our_brand_name": "NaturaleBio"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "week_date": "2026-01", "keywords": "olio di cocco", "brand": "Pipkin", "asin": "B0FVM32PSK", "product_title": "Pipkin Olio di Cocco 100% Biologico e Puro 1L \u2013 Na...", "is_yaba_asin": "N", "clicks": 146.703781, "click_share": 2.87, "price": 14.99, "organic_rank": 9, "deal_days": 0, "coupon_days": 0, "best_seller_days": 0, "amazon_choice_days": 0, "search_volume": 5111.63, "our_brand_name": "NaturaleBio"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "week_date": "2026-01", "keywords": "olio di cocco", "brand": "NaturaleBio", "asin": "B01JA3S1F8", "product_title": "NaturaleBio Olio di Cocco Biologico Vergine 500 ml...", "is_yaba_asin": "Y", "clicks": 210.088, "click_share": 4.11, "price": 13.99, "organic_rank": 6, "deal_days": 0, "coupon_days": 0, "best_seller_days": 0, "amazon_choice_days": 0, "search_volume": 5111.63, "our_brand_name": "NaturaleBio"}, {"brand_aggregation": "naturalebio", "parent_asin": "Coconut oil", "week_date": "2026-01", "keywords": "olio di cocco", "brand": "NaturaleBio", "asin": "B01JIB2T32", "product_title": "NaturaleBio Olio di Cocco Biologico Vergine 1000 m...", "is_yaba_asin": "Y", "clicks": 231.045676, "click_share": 4.52, "price": 19.49, "organic_rank": 6, "deal_days": 0, "coupon_days": 0, "best_seller_days": 0, "amazon_choice_days": 0, "search_volume": 5111.63, "our_brand_name": "NaturaleBio"}];

        // LOGIC
        const OUR_BRAND = marketData[0].our_brand_name;
        
        // Helper: Get Aggregates
        function getAggregates() {
            const ourData = marketData.filter(d => d.is_yaba_asin === 'Y');
            const compData = marketData.filter(d => d.is_yaba_asin === 'N');
            
            const totalClicks = marketData.reduce((acc, c) => acc + c.clicks, 0);
            const ourClicks = ourData.reduce((acc, c) => acc + c.clicks, 0);
            const compClicks = compData.reduce((acc, c) => acc + c.clicks, 0);
            
            const ourShare = (ourClicks / totalClicks) * 100;
            const compShare = (compClicks / totalClicks) * 100;

            return { totalClicks, ourClicks, compClicks, ourShare, compShare };
        }

        // Init Charts
        google.charts.load('current', {'packages':['corechart', 'table']});
        google.charts.setOnLoadCallback(drawDashboard);

        function drawDashboard() {
            drawTrendChart();
            drawCompetitivenessChart();
            drawDriversChart(); // Actually using this for drivers (Price vs Share)
            drawEfficiencyChart();
            populateMetrics();
            setupInteractive();
        }

        function populateMetrics() {
            const agg = getAggregates();
            const html = `
                <div class="metric-item">
                    <div class="metric-value">${Math.round(agg.totalClicks).toLocaleString()}</div>
                    <div class="metric-label">Clicks Totales (Semana)</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" style="color: #4285F4">${agg.ourShare.toFixed(1)}%</div>
                    <div class="metric-label">Nuestro Share</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value" style="color: #EA4335">${agg.compShare.toFixed(1)}%</div>
                    <div class="metric-label">Share Competencia</div>
                </div>
            `;
            document.getElementById('global-metrics').innerHTML = html;
        }

        function drawTrendChart() {
            // Since we have 1 week, we show Clicks Share by Brand Group (Us vs Comp)
            const agg = getAggregates();
            const data = google.visualization.arrayToDataTable([
                ['Grupo', 'Clicks', { role: 'style' }],
                ['Nosotros', agg.ourClicks, '#4285F4'],
                ['Competencia', agg.compClicks, '#EA4335']
            ]);

            const options = {
                title: 'Distribución Total de Clicks',
                chartArea: {width: '80%', height: '80%'},
                legend: { position: 'none' },
                vAxis: { title: 'Clicks Estimados' }
            };

            const chart = new google.visualization.ColumnChart(document.getElementById('chart_trend'));
            chart.draw(data, options);
        }

        function drawCompetitivenessChart() {
            // Aggregate share by brand
            const brandShares = {};
            marketData.forEach(d => {
                if (!brandShares[d.brand]) brandShares[d.brand] = 0;
                brandShares[d.brand] += d.click_share;
            });

            // Convert to array and sort
            let sortedBrands = Object.keys(brandShares).map(b => [b, brandShares[b]]);
            sortedBrands.sort((a, b) => b[1] - a[1]);

            // Take Top 5 + Others
            const dataArr = [['Brand', 'Click Share', { role: 'style' }]];
            sortedBrands.forEach(item => {
                const color = item[0] === OUR_BRAND ? '#4285F4' : '#9AA0A6';
                dataArr.push([item[0], item[1], color]);
            });

            const data = google.visualization.arrayToDataTable(dataArr);
            
            const options = {
                title: 'Cuota de Mercado por Marca',
                chartArea: {width: '80%', height: '70%'},
                legend: { position: 'none' },
                vAxis: { title: 'Share %' },
                hAxis: { slantedText: true, slantedTextAngle: 45 }
            };

            const chart = new google.visualization.ColumnChart(document.getElementById('chart_competitiveness'));
            chart.draw(data, options);
        }

        function drawDriversChart() {
            // Price vs Click Share analysis
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'ASIN');
            data.addColumn('number', 'Precio');
            data.addColumn('number', 'Click Share');
            data.addColumn({type: 'string', role: 'style'}); // Color
            data.addColumn({type: 'string', role: 'tooltip'});

            marketData.forEach(row => {
                const color = row.is_yaba_asin === 'Y' ? '#4285F4' : '#EA4335';
                data.addRow([
                    row.brand, 
                    row.price, 
                    row.click_share, 
                    `point { fill-color: ${color}; }`,
                    `${row.product_title}\nPrecio: €${row.price}\nShare: ${row.click_share}%`
                ]);
            });

            const options = {
                title: 'Elasticidad: Precio vs Click Share',
                hAxis: { title: 'Precio (€)' },
                vAxis: { title: 'Click Share (%)' },
                legend: { position: 'none' },
                chartArea: {width: '80%', height: '80%'}
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('chart_drivers'));
            chart.draw(data, options);
        }

        function drawEfficiencyChart() {
            // Rank vs Share
            const data = new google.visualization.DataTable();
            data.addColumn('number', 'Rank Orgánico');
            data.addColumn('number', 'Click Share (%)');
            data.addColumn({type: 'string', role: 'style'});
            data.addColumn({type: 'string', role: 'tooltip'});

            marketData.forEach(row => {
                const color = row.is_yaba_asin === 'Y' ? '#4285F4' : '#EA4335';
                const label = row.brand + " (Rank " + row.organic_rank + ")";
                data.addRow([
                    row.organic_rank, 
                    row.click_share, 
                    `point { size: 6; fill-color: ${color}; }`,
                    `${row.product_title}\nRank: ${row.organic_rank}\nShare: ${row.click_share}%`
                ]);
            });

            const options = {
                title: 'Eficiencia de Posicionamiento',
                hAxis: { title: 'Ranking Orgánico (Menor es mejor)', direction: 1 }, // Standard direction
                vAxis: { title: 'Click Share (%)' },
                legend: { position: 'none' },
                chartArea: {width: '80%', height: '80%'}
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('chart_efficiency'));
            chart.draw(data, options);
        }

        // --- Interactive Tab Logic ---
        function setupInteractive() {
            const select = document.getElementById('compSelect');
            const brands = [...new Set(marketData.filter(d => d.is_yaba_asin === 'N').map(d => d.brand))];
            
            brands.forEach(b => {
                const opt = document.createElement('option');
                opt.value = b;
                opt.innerText = b;
                select.appendChild(opt);
            });
            
            updateInteractive();
        }

        function updateInteractive() {
            const selectedComp = document.getElementById('compSelect').value;
            
            // Filter data: Our ASINs + Selected Comp (or all if ALL)
            let filtered = marketData.filter(d => {
                if (d.is_yaba_asin === 'Y') return true;
                if (selectedComp === 'ALL') return true;
                return d.brand === selectedComp;
            });

            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Marca');
            data.addColumn('string', 'ASIN');
            data.addColumn('number', 'Precio');
            data.addColumn('number', 'Share %');
            data.addColumn('number', 'Rank');
            data.addColumn('number', 'Deal Days');

            filtered.forEach(row => {
                data.addRow([
                    row.brand,
                    row.asin,
                    row.price,
                    row.click_share,
                    row.organic_rank,
                    row.deal_days + row.coupon_days // Combined promos
                ]);
            });

            const table = new google.visualization.Table(document.getElementById('table_interactive'));
            table.draw(data, {showRowNumber: true, width: '100%', height: '100%'});
        }

        // Tab Switcher
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active'); // highlight button

            // Redraw charts if needed (sometimes hidden charts don't render dims correctly)
            if(tabId === 'static') {
                drawDashboard();
            } else {
                updateInteractive();
            }
        }

    </script>
</body>
</html>