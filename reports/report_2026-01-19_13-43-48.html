<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parent ASIN Market Intelligence Report</title>
    
    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
    
    <!-- Custom Styles -->
    <style>
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f5f5f7; color: #1d1d1f; }
        .card { background: white; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03); padding: 24px; transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05); }
        .stat-value { font-size: 2rem; font-weight: 700; letter-spacing: -0.025em; }
        .stat-label { font-size: 0.875rem; color: #6e6e73; font-weight: 500; }
        .yaba-blue { color: #007aff; }
        .comp-red { color: #ff3b30; }
        .section-title { font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem; }
        .tab-btn { padding: 8px 16px; border-radius: 20px; font-weight: 500; transition: all 0.2s; }
        .tab-btn.active { background: #1d1d1f; color: white; }
        .tab-btn.inactive { background: #e5e5e7; color: #6e6e73; hover: bg-gray-300; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- DATA INJECTION -->
    <script>
        // Data processed from the CSV input
        const marketData = [{"parent_asin":"Matcha Premium","date":"2025-12-20","week":"2025-51","keywords":"matcha","competitor_brand":"Jean","asin":"B0F5BVFRC1","product_title":"Jean & Len Handcreme I Love You So Matcha, f\u00fcr nor...","average_organic_rank":12.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":1.92,"price":3.0957142857,"weekly_search_volume":60848.28,"is_yaba_asin":"N","estimated_clicks":1168.286976,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-20","week":"2025-51","keywords":"matcha","competitor_brand":"VAHDAM","asin":"B07MD4LB49","product_title":"VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A...","average_organic_rank":8.0,"weekly_number_of_days_with_deal":5.0,"weekly_number_of_days_with_coupon":0.0,"click_share":3.49,"price":4.25,"weekly_search_volume":60848.28,"is_yaba_asin":"N","estimated_clicks":2123.604972,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-20","week":"2025-51","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B07SZFD3P9","product_title":"NaturaleBio Matcha Ceremonial Grade 100g. Original...","average_organic_rank":22.0,"weekly_number_of_days_with_deal":7.0,"weekly_number_of_days_with_coupon":0.0,"click_share":2.95,"price":2.57,"weekly_search_volume":60848.28,"is_yaba_asin":"Y","estimated_clicks":1795.02426,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-20","week":"2025-51","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B079VQ52MK","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","average_organic_rank":5.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":3.69,"price":3.13,"weekly_search_volume":60848.28,"is_yaba_asin":"Y","estimated_clicks":2245.301532,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-20","week":"2025-51","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B06XQ69YCQ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","average_organic_rank":5.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":3.85,"price":3.15,"weekly_search_volume":60848.28,"is_yaba_asin":"Y","estimated_clicks":2342.65878,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-20","week":"2025-51","keywords":"matcha","competitor_brand":"Special Leaves","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...","average_organic_rank":14.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":7.0,"click_share":3.48,"price":4.53,"weekly_search_volume":60848.28,"is_yaba_asin":"N","estimated_clicks":2117.520144,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-20","week":"2025-51","keywords":"matcha","competitor_brand":"Special Leaves","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...","average_organic_rank":14.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":7.0,"click_share":3.48,"price":4.53,"weekly_search_volume":60848.28,"is_yaba_asin":"N","estimated_clicks":2117.520144,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-20","week":"2025-51","keywords":"matcha","competitor_brand":"Ceremonial","asin":"B0G1T7N675","product_title":"Ceremonial Matcha Pulver BIO-Qualit\u00e4t 50g ideal zu...","average_organic_rank":12.0,"weekly_number_of_days_with_deal":7.0,"weekly_number_of_days_with_coupon":0.0,"click_share":2.56,"price":3.71,"weekly_search_volume":60848.28,"is_yaba_asin":"N","estimated_clicks":1557.715968,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-20","week":"2025-51","keywords":"matcha","competitor_brand":"Ceremonial","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","average_organic_rank":5.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":8.85,"price":4.22,"weekly_search_volume":60848.28,"is_yaba_asin":"N","estimated_clicks":5385.07278,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-20","week":"2025-51","keywords":"matcha","competitor_brand":"NORITUAL LAB","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","average_organic_rank":5.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":8.85,"price":4.22,"weekly_search_volume":60848.28,"is_yaba_asin":"N","estimated_clicks":5385.07278,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-20","week":"2025-51","keywords":"matcha","competitor_brand":"NORITUAL LAB","asin":"B0CNRX8G5S","product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","average_organic_rank":2.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":16.66,"price":3.14,"weekly_search_volume":60848.28,"is_yaba_asin":"N","estimated_clicks":10137.323448,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-20","week":"2025-51","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B06XQ5DCYJ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","average_organic_rank":2.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":11.18,"price":3.15,"weekly_search_volume":60848.28,"is_yaba_asin":"Y","estimated_clicks":6802.837704,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-27","week":"2025-52","keywords":"matcha","competitor_brand":"VAHDAM","asin":"B07K1WBH4K","product_title":"VAHDAM, Vanille Matcha Gr\u00fcner Tee Pulver (100g, 50...","average_organic_rank":20.0,"weekly_number_of_days_with_deal":3.0,"weekly_number_of_days_with_coupon":0.0,"click_share":1.47,"price":2.29,"weekly_search_volume":47736.8,"is_yaba_asin":"N","estimated_clicks":701.73096,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-27","week":"2025-52","keywords":"matcha","competitor_brand":"Special Leaves","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...","average_organic_rank":13.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":7.0,"click_share":3.4,"price":4.7,"weekly_search_volume":47736.8,"is_yaba_asin":"N","estimated_clicks":1623.0512,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-27","week":"2025-52","keywords":"matcha","competitor_brand":"Special Leaves","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...","average_organic_rank":13.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":7.0,"click_share":3.4,"price":4.7,"weekly_search_volume":47736.8,"is_yaba_asin":"N","estimated_clicks":1623.0512,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-27","week":"2025-52","keywords":"matcha","competitor_brand":"Ceremonial","asin":"B0G1T7N675","product_title":"Ceremonial Matcha Pulver BIO-Qualit\u00e4t 50g ideal zu...","average_organic_rank":0.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":0.0,"price":0.0,"weekly_search_volume":47736.8,"is_yaba_asin":"N","estimated_clicks":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-27","week":"2025-52","keywords":"matcha","competitor_brand":"Jean","asin":"B0F5BVFRC1","product_title":"Jean & Len Handcreme I Love You So Matcha, f\u00fcr nor...","average_organic_rank":0.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":0.0,"price":0.0,"weekly_search_volume":47736.8,"is_yaba_asin":"N","estimated_clicks":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-27","week":"2025-52","keywords":"matcha","competitor_brand":"bioKontor","asin":"B08XVX8V1T","product_title":"Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...","average_organic_rank":10.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":2.44,"price":3.4,"weekly_search_volume":47736.8,"is_yaba_asin":"N","estimated_clicks":1164.77792,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-27","week":"2025-52","keywords":"matcha","competitor_brand":"bioKontor","asin":"B08XVX8V1T","product_title":"Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...","average_organic_rank":10.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":2.44,"price":3.4,"weekly_search_volume":47736.8,"is_yaba_asin":"N","estimated_clicks":1164.77792,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-27","week":"2025-52","keywords":"matcha","competitor_brand":"VAHDAM","asin":"B07MD4LB49","product_title":"VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A...","average_organic_rank":7.0,"weekly_number_of_days_with_deal":3.0,"weekly_number_of_days_with_coupon":0.0,"click_share":4.19,"price":5.29,"weekly_search_volume":47736.8,"is_yaba_asin":"N","estimated_clicks":2000.17192,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-27","week":"2025-52","keywords":"matcha","competitor_brand":"Ceremonial","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","average_organic_rank":6.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":8.42,"price":4.24,"weekly_search_volume":47736.8,"is_yaba_asin":"N","estimated_clicks":4019.43856,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-27","week":"2025-52","keywords":"matcha","competitor_brand":"NORITUAL LAB","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","average_organic_rank":6.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":8.42,"price":4.24,"weekly_search_volume":47736.8,"is_yaba_asin":"N","estimated_clicks":4019.43856,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-27","week":"2025-52","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B079VQ52MK","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","average_organic_rank":5.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":3.49,"price":3.36,"weekly_search_volume":47736.8,"is_yaba_asin":"Y","estimated_clicks":1666.01432,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-27","week":"2025-52","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B06XQ69YCQ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","average_organic_rank":4.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":3.75,"price":3.25,"weekly_search_volume":47736.8,"is_yaba_asin":"Y","estimated_clicks":1790.13,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-27","week":"2025-52","keywords":"matcha","competitor_brand":"NORITUAL LAB","asin":"B0CNRX8G5S","product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","average_organic_rank":2.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":18.77,"price":3.35,"weekly_search_volume":47736.8,"is_yaba_asin":"N","estimated_clicks":8960.19736,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-27","week":"2025-52","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B06XQ5DCYJ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","average_organic_rank":2.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":11.66,"price":3.37,"weekly_search_volume":47736.8,"is_yaba_asin":"Y","estimated_clicks":5566.11088,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2025-12-27","week":"2025-52","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B07SZFD3P9","product_title":"NaturaleBio Matcha Ceremonial Grade 100g. Original...","average_organic_rank":23.0,"weekly_number_of_days_with_deal":1.0,"weekly_number_of_days_with_coupon":0.0,"click_share":2.93,"price":2.43,"weekly_search_volume":47736.8,"is_yaba_asin":"Y","estimated_clicks":1398.68824,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2026-01-03","week":"2026-01","keywords":"matcha","competitor_brand":"bioKontor","asin":"B08XVX8V1T","product_title":"Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...","average_organic_rank":10.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":2.39,"price":3.91,"weekly_search_volume":26944.6,"is_yaba_asin":"N","estimated_clicks":643.97594,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2026-01-03","week":"2026-01","keywords":"matcha","competitor_brand":"bioKontor","asin":"B08XVX8V1T","product_title":"Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...","average_organic_rank":10.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":2.39,"price":3.91,"weekly_search_volume":26944.6,"is_yaba_asin":"N","estimated_clicks":643.97594,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2026-01-03","week":"2026-01","keywords":"matcha","competitor_brand":"VAHDAM","asin":"B07MD4LB49","product_title":"VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A...","average_organic_rank":9.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":3.15,"price":5.19,"weekly_search_volume":26944.6,"is_yaba_asin":"N","estimated_clicks":848.7549,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2026-01-03","week":"2026-01","keywords":"matcha","competitor_brand":"Jean","asin":"B0F5BVFRC1","product_title":"Jean & Len Handcreme I Love You So Matcha, f\u00fcr nor...","average_organic_rank":0.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":0.0,"price":0.0,"weekly_search_volume":26944.6,"is_yaba_asin":"N","estimated_clicks":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2026-01-03","week":"2026-01","keywords":"matcha","competitor_brand":"UNREAL\u00ae","asin":"B0F9B1LWQQ","product_title":"UNREAL\u00ae 100g Ceremonial Bio Matcha \u2013 100% Japanisc...","average_organic_rank":19.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":1.57,"price":1.96,"weekly_search_volume":26944.6,"is_yaba_asin":"N","estimated_clicks":423.03022,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2026-01-03","week":"2026-01","keywords":"matcha","competitor_brand":"Special Leaves","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...","average_organic_rank":16.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":4.0,"click_share":3.0,"price":4.47,"weekly_search_volume":26944.6,"is_yaba_asin":"N","estimated_clicks":808.338,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2026-01-03","week":"2026-01","keywords":"matcha","competitor_brand":"Special Leaves","asin":"B0DRP6Y6XC","product_title":"Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...","average_organic_rank":16.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":4.0,"click_share":3.0,"price":4.47,"weekly_search_volume":26944.6,"is_yaba_asin":"N","estimated_clicks":808.338,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2026-01-03","week":"2026-01","keywords":"matcha","competitor_brand":"Ceremonial","asin":"B0G1T7N675","product_title":"Ceremonial Matcha Pulver BIO-Qualit\u00e4t 50g ideal zu...","average_organic_rank":0.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":0.0,"price":0.0,"weekly_search_volume":26944.6,"is_yaba_asin":"N","estimated_clicks":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2026-01-03","week":"2026-01","keywords":"matcha","competitor_brand":"Ceremonial","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","average_organic_rank":6.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":7.38,"price":4.54,"weekly_search_volume":26944.6,"is_yaba_asin":"N","estimated_clicks":1988.51148,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2026-01-03","week":"2026-01","keywords":"matcha","competitor_brand":"NORITUAL LAB","asin":"B0FSL3C3Z8","product_title":"Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...","average_organic_rank":6.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":7.38,"price":4.54,"weekly_search_volume":26944.6,"is_yaba_asin":"N","estimated_clicks":1988.51148,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2026-01-03","week":"2026-01","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B079VQ52MK","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","average_organic_rank":5.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":3.66,"price":3.36,"weekly_search_volume":26944.6,"is_yaba_asin":"Y","estimated_clicks":986.17236,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2026-01-03","week":"2026-01","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B06XQ69YCQ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","average_organic_rank":5.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":3.35,"price":3.02,"weekly_search_volume":26944.6,"is_yaba_asin":"Y","estimated_clicks":902.6441,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2026-01-03","week":"2026-01","keywords":"matcha","competitor_brand":"NORITUAL LAB","asin":"B0CNRX8G5S","product_title":"Ceremonial Matcha - Reines Matcha Pulver aus Japan...","average_organic_rank":2.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":19.34,"price":3.36,"weekly_search_volume":26944.6,"is_yaba_asin":"N","estimated_clicks":5211.08564,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2026-01-03","week":"2026-01","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B06XQ5DCYJ","product_title":"NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...","average_organic_rank":2.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":12.9,"price":3.37,"weekly_search_volume":26944.6,"is_yaba_asin":"Y","estimated_clicks":3475.8534,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0},{"parent_asin":"Matcha Premium","date":"2026-01-03","week":"2026-01","keywords":"matcha","competitor_brand":"NaturaleBio","asin":"B07SZFD3P9","product_title":"NaturaleBio Matcha Ceremonial Grade 100g. Original...","average_organic_rank":0.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":2.68,"price":2.06,"weekly_search_volume":26944.6,"is_yaba_asin":"Y","estimated_clicks":722.11528,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":8.0},{"parent_asin":"Matcha Premium","date":"2026-01-03","week":"2026-01","keywords":"matcha","competitor_brand":"VAHDAM","asin":"B07K1WBH4K","product_title":"VAHDAM, Vanille Matcha Gr\u00fcner Tee Pulver (100g, 50...","average_organic_rank":0.0,"weekly_number_of_days_with_deal":0.0,"weekly_number_of_days_with_coupon":0.0,"click_share":0.0,"price":0.0,"weekly_search_volume":26944.6,"is_yaba_asin":"N","estimated_clicks":0.0,"weekly_number_of_days_with_amazon_choice_badge":0.0,"weekly_number_of_days_with_best_seller_badge":0.0}];
    </script>

    <!-- REACT APP -->
    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        const { LineChart, Line, AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, ScatterChart, Scatter, ZAxis, BarChart, Bar } = Recharts;

        // --- ICONS ---
        const Icon = ({ name, size = 20, color = "currentColor" }) => {
            const paths = {
                trendingUp: "M23 6l-9.5 9.5-5-5L1 18",
                users: "M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2 M16 3.13a4 4 0 0 1 0 7.75 M23 21v-2a4 4 0 0 0-3-3.87",
                tag: "M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z M7 7h.01",
                award: "M12 15l-2 5l-2-5l-2 5l-2-5l-2 5a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2l-2-5l-2 5l-2-5l-2 5l-2-5z",
                zap: "M13 2L3 14h9l-1 8 10-12h-9l1-8z",
                barChart: "M18 20V10 M12 20V4 M6 20v-6",
                search: "M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z",
                alert: "M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z",
                check: "M20 6L9 17l-5-5"
            };
            
            // Special handling for paths that are strokes (like trendingUp) vs fills
            const isStroke = ["trendingUp", "activity", "search", "check"].includes(name);

            return (
                <svg 
                    width={size} 
                    height={size} 
                    viewBox="0 0 24 24" 
                    fill="none" 
                    stroke={color} 
                    strokeWidth="2" 
                    strokeLinecap="round" 
                    strokeLinejoin="round"
                    style={{display: 'inline-block', verticalAlign: 'middle'}}
                >
                    <path d={paths[name] || ""} />
                </svg>
            );
        };

        // --- UTILS ---
        const formatNumber = (num) => new Intl.NumberFormat('es-ES', { maximumFractionDigits: 1 }).format(num);
        const formatCurrency = (num) => new Intl.NumberFormat('es-DE', { style: 'currency', currency: 'EUR' }).format(num);

        // --- COMPONENTS ---

        const KPICard = ({ title, value, subtext, trend, icon, color }) => (
            <div className="card">
                <div className="flex justify-between items-start mb-2">
                    <div className={`p-2 rounded-lg bg-${color}-50`}>
                        <Icon name={icon} color={color === 'blue' ? '#007aff' : '#ff3b30'} />
                    </div>
                    {trend && (
                        <span className={`text-xs font-semibold px-2 py-1 rounded-full ${trend > 0 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                            {trend > 0 ? '+' : ''}{trend}%
                        </span>
                    )}
                </div>
                <div className="stat-value text-gray-900">{value}</div>
                <div className="stat-label mt-1">{title}</div>
                {subtext && <div className="text-xs text-gray-400 mt-2">{subtext}</div>}
            </div>
        );

        const Section = ({ title, icon, children }) => (
            <div className="mb-12">
                <div className="section-title text-gray-800">
                    <Icon name={icon} /> {title}
                </div>
                {children}
            </div>
        );

        // --- MAIN DASHBOARD ---

        const Dashboard = ({ data, ourBrand, topCompetitors }) => {
            // Processing logic for charts
            const processedData = useMemo(() => {
                // 1. Global Trend Data
                const dates = [...new Set(data.map(d => d.date))].sort();
                
                const trendData = dates.map(date => {
                    const weekData = data.filter(d => d.date === date);
                    const ourData = weekData.filter(d => d.is_yaba_asin === 'Y');
                    const compData = weekData.filter(d => d.is_yaba_asin === 'N');
                    
                    const totalEstClicks = weekData.reduce((acc, curr) => acc + curr.estimated_clicks, 0);
                    const ourEstClicks = ourData.reduce((acc, curr) => acc + curr.estimated_clicks, 0);
                    
                    return {
                        date,
                        week: weekData[0]?.week,
                        ourClicks: ourEstClicks,
                        compClicks: totalEstClicks - ourEstClicks,
                        ourShare: totalEstClicks ? (ourEstClicks / totalEstClicks) * 100 : 0,
                        compShare: totalEstClicks ? ((totalEstClicks - ourEstClicks) / totalEstClicks) * 100 : 0
                    };
                });

                // 2. Brand Competitiveness
                const brands = [ourBrand, ...topCompetitors, 'Others'];
                const brandTrendData = dates.map(date => {
                    const weekData = data.filter(d => d.date === date);
                    const totalShare = weekData.reduce((acc, curr) => acc + curr.click_share, 0); // Sum of shares isn't 100 always due to keyword overlap, but for this chart we sum shares per brand
                    
                    const entry = { date, week: weekData[0]?.week };
                    brands.forEach(b => {
                        let brandShare = 0;
                        if (b === 'Others') {
                            brandShare = weekData
                                .filter(d => d.competitor_brand !== ourBrand && !topCompetitors.includes(d.competitor_brand))
                                .reduce((acc, curr) => acc + curr.click_share, 0);
                        } else {
                            brandShare = weekData
                                .filter(d => d.competitor_brand === b)
                                .reduce((acc, curr) => acc + curr.click_share, 0);
                        }
                        entry[b] = brandShare;
                    });
                    return entry;
                });

                // 3. Efficiency (Latest Week)
                const latestDate = dates[dates.length - 1];
                const latestData = data.filter(d => d.date === latestDate);
                const efficiencyData = latestData.map(d => ({
                    ...d,
                    fill: d.is_yaba_asin === 'Y' ? '#007aff' : '#9ca3af',
                    r: d.click_share // Bubble size
                })).filter(d => d.click_share > 0);

                return { trendData, brandTrendData, efficiencyData, latestData };
            }, [data, ourBrand, topCompetitors]);

            const lastWeek = processedData.trendData[processedData.trendData.length - 1];
            const prevWeek = processedData.trendData[processedData.trendData.length - 2];
            const shareGrowth = lastWeek && prevWeek ? (lastWeek.ourShare - prevWeek.ourShare).toFixed(1) : 0;
            const clickGrowth = lastWeek && prevWeek ? ((lastWeek.ourClicks - prevWeek.ourClicks) / prevWeek.ourClicks * 100).toFixed(1) : 0;

            return (
                <div className="p-6 max-w-7xl mx-auto">
                    
                    {/* Header Metrics */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
                        <KPICard title="Total Click Share" value={`${formatNumber(lastWeek?.ourShare || 0)}%`} trend={shareGrowth} icon="barChart" color="blue" subtext="Última semana" />
                        <KPICard title="Est. Clicks Semanales" value={formatNumber(lastWeek?.ourClicks || 0)} trend={clickGrowth} icon="users" color="blue" subtext="Tráfico estimado" />
                        <KPICard title="ASINs Activos" value={processedData.latestData.filter(d => d.is_yaba_asin === 'Y').length} icon="tag" color="gray" subtext="Variantes posicionadas" />
                        <KPICard title="Top Competidor" value={topCompetitors[0]} icon="alert" color="red" subtext="Mayor amenaza" />
                    </div>

                    {/* 1. Global Trend */}
                    <Section title="Tendencia Global del Parent" icon="trendingUp">
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div className="card">
                                <h3 className="text-lg font-semibold mb-4">Evolución de Clicks Estimados</h3>
                                <div className="h-64">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <AreaChart data={processedData.trendData}>
                                            <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                            <XAxis dataKey="week" tick={{fontSize: 12}} />
                                            <YAxis tick={{fontSize: 12}} />
                                            <Tooltip />
                                            <Legend />
                                            <Area type="monotone" dataKey="ourClicks" name="Nuestros Clicks" stackId="1" stroke="#007aff" fill="#007aff" fillOpacity={0.2} />
                                            <Area type="monotone" dataKey="compClicks" name="Competencia" stackId="1" stroke="#e5e5e7" fill="#e5e5e7" />
                                        </AreaChart>
                                    </ResponsiveContainer>
                                </div>
                                <p className="text-sm text-gray-500 mt-4">
                                    {shareGrowth > 0 ? "Ganamos tracción" : "Perdemos tracción"} en la última semana. 
                                    La visibilidad total del mercado {lastWeek.ourClicks + lastWeek.compClicks > prevWeek.ourClicks + prevWeek.compClicks ? "ha aumentado" : "ha disminuido"}.
                                </p>
                            </div>
                            <div className="card">
                                <h3 className="text-lg font-semibold mb-4">Click Share: Nosotros vs Mercado</h3>
                                <div className="h-64">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <AreaChart data={processedData.trendData}>
                                            <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                            <XAxis dataKey="week" tick={{fontSize: 12}} />
                                            <YAxis tick={{fontSize: 12}} unit="%" />
                                            <Tooltip formatter={(value) => value.toFixed(1) + '%'} />
                                            <Legend />
                                            <Area type="monotone" dataKey="ourShare" name="Nuestra Cuota" stroke="#007aff" fill="#007aff" fillOpacity={0.1} strokeWidth={2} />
                                        </AreaChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                        </div>
                    </Section>

                    {/* 2. Competitiveness */}
                    <Section title="Competitividad de Marca" icon="award">
                        <div className="card">
                            <h3 className="text-lg font-semibold mb-4">Click Share por Marca (Top 3 + Nosotros)</h3>
                            <div className="h-72">
                                <ResponsiveContainer width="100%" height="100%">
                                    <LineChart data={processedData.brandTrendData}>
                                        <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                        <XAxis dataKey="week" tick={{fontSize: 12}} />
                                        <YAxis tick={{fontSize: 12}} unit="%" />
                                        <Tooltip />
                                        <Legend />
                                        <Line type="monotone" dataKey={ourBrand} stroke="#007aff" strokeWidth={3} dot={{r: 4}} />
                                        {topCompetitors.map((comp, i) => (
                                            <Line key={comp} type="monotone" dataKey={comp} stroke={['#ff3b30', '#ff9f0a', '#32ade6'][i]} strokeWidth={2} />
                                        ))}
                                        <Line type="monotone" dataKey="Others" stroke="#8e8e93" strokeDasharray="5 5" />
                                    </LineChart>
                                </ResponsiveContainer>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6 text-sm text-gray-600">
                                <div className="bg-gray-50 p-3 rounded-lg">
                                    <strong>Dominio:</strong> {topCompetitors[0]} lidera entre los competidores.
                                </div>
                                <div className="bg-gray-50 p-3 rounded-lg">
                                    <strong>Nuestra Posición:</strong> {lastWeek.ourShare > 15 ? "Líder/Co-líder del nicho" : "Challenger en crecimiento"}.
                                </div>
                                <div className="bg-gray-50 p-3 rounded-lg">
                                    <strong>Volatilidad:</strong> {Math.abs(shareGrowth) > 5 ? "Alta sensibilidad a cambios recientes" : "Mercado estable"}.
                                </div>
                            </div>
                        </div>
                    </Section>

                    {/* 3. Levers */}
                    <Section title="Palancas de Rendimiento" icon="zap">
                         <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div className="card">
                                <h3 className="text-lg font-semibold mb-2">Impacto del Precio</h3>
                                <div className="h-60">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <ScatterChart margin={{top: 20, right: 20, bottom: 20, left: 20}}>
                                            <CartesianGrid />
                                            <XAxis type="number" dataKey="price" name="Price" unit="€" tick={{fontSize: 12}} />
                                            <YAxis type="number" dataKey="click_share" name="Share" unit="%" tick={{fontSize: 12}} />
                                            <Tooltip cursor={{ strokeDasharray: '3 3' }} />
                                            <Legend />
                                            <Scatter name="Nuestros ASINs" data={processedData.efficiencyData.filter(d => d.is_yaba_asin === 'Y')} fill="#007aff" />
                                            <Scatter name="Competidores" data={processedData.efficiencyData.filter(d => d.is_yaba_asin === 'N')} fill="#9ca3af" />
                                        </ScatterChart>
                                    </ResponsiveContainer>
                                </div>
                                <p className="text-xs text-gray-500 mt-2">Correlación Precio-Share. ¿Los líderes son los más baratos?</p>
                            </div>
                            <div className="card">
                                <h3 className="text-lg font-semibold mb-2">Efectividad de Promociones</h3>
                                <div className="space-y-4 mt-4">
                                    {[
                                        { label: 'Deals', key: 'weekly_number_of_days_with_deal' },
                                        { label: 'Coupons', key: 'weekly_number_of_days_with_coupon' }
                                    ].map(metric => {
                                        const withPromo = processedData.latestData.filter(d => d[metric.key] > 0);
                                        const withoutPromo = processedData.latestData.filter(d => d[metric.key] === 0);
                                        const avgShareWith = withPromo.length ? withPromo.reduce((a,b)=>a+b.click_share,0)/withPromo.length : 0;
                                        const avgShareWithout = withoutPromo.length ? withoutPromo.reduce((a,b)=>a+b.click_share,0)/withoutPromo.length : 0;
                                        
                                        return (
                                            <div key={metric.key} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                                <span className="font-medium text-gray-700">{metric.label} Impact</span>
                                                <div className="flex gap-4 text-sm">
                                                    <span className="text-gray-500">Sin: {avgShareWithout.toFixed(1)}%</span>
                                                    <span className="text-green-600 font-bold">Con: {avgShareWith.toFixed(1)}%</span>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    </Section>

                    {/* 4. Efficiency */}
                    <Section title="Eficiencia: Rank vs Click Share" icon="barChart">
                        <div className="card">
                            <h3 className="text-lg font-semibold mb-4">Mapa de Eficiencia Orgánica</h3>
                            <div className="h-80">
                                <ResponsiveContainer width="100%" height="100%">
                                    <ScatterChart margin={{top: 20, right: 20, bottom: 20, left: 20}}>
                                        <CartesianGrid />
                                        <XAxis type="number" dataKey="average_organic_rank" name="Rank" reversed={true} label={{ value: 'Organic Rank (Mejor ->)', position: 'insideBottomRight', offset: -10 }} />
                                        <YAxis type="number" dataKey="click_share" name="Share" unit="%" label={{ value: 'Click Share', angle: -90, position: 'insideLeft' }} />
                                        <Tooltip cursor={{ strokeDasharray: '3 3' }} content={({active, payload}) => {
                                            if (active && payload && payload.length) {
                                                const d = payload[0].payload;
                                                return (
                                                    <div className="bg-white p-2 border shadow-lg rounded text-xs">
                                                        <p className="font-bold">{d.product_title.substring(0,30)}...</p>
                                                        <p>Rank: {d.average_organic_rank} | Share: {d.click_share}%</p>
                                                        <p>Brand: {d.competitor_brand}</p>
                                                    </div>
                                                );
                                            }
                                            return null;
                                        }} />
                                        <Scatter name="Nuestros ASINs" data={processedData.efficiencyData.filter(d => d.is_yaba_asin === 'Y')} fill="#007aff" />
                                        <Scatter name="Competidores" data={processedData.efficiencyData.filter(d => d.is_yaba_asin === 'N')} fill="#e5e5e7" />
                                    </ScatterChart>
                                </ResponsiveContainer>
                            </div>
                            <div className="mt-4 text-sm text-gray-600">
                                <span className="inline-block w-3 h-3 bg-blue-500 rounded-full mr-2"></span>Nuestros ASINs
                                <span className="inline-block w-3 h-3 bg-gray-300 rounded-full ml-4 mr-2"></span>Competidores
                                <p className="mt-2 italic">
                                    * Los puntos por encima de la tendencia visual son "Overperformers" (consiguen más clicks de los esperados por su ranking).
                                </p>
                            </div>
                        </div>
                    </Section>

                    {/* 5. Insights */}
                    <Section title="Conclusiones y Recomendaciones" icon="check">
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div className="card bg-blue-50 border border-blue-100">
                                <h3 className="font-bold text-blue-900 mb-4 flex items-center"><Icon name="search" size={18} /> Insights Clave</h3>
                                <ul className="space-y-3 text-sm text-blue-800">
                                    <li className="flex gap-2"><span className="font-bold">•</span> La marca {ourBrand} muestra una tendencia {shareGrowth >= 0 ? 'positiva' : 'negativa'} ({shareGrowth}%) en la última semana.</li>
                                    <li className="flex gap-2"><span className="font-bold">•</span> El competidor {topCompetitors[0]} domina el segmento con una estrategia de precio {processedData.latestData.find(d=>d.competitor_brand===topCompetitors[0])?.price < processedData.latestData.find(d=>d.is_yaba_asin==='Y')?.price ? 'agresiva' : 'premium'}.</li>
                                    <li className="flex gap-2"><span className="font-bold">•</span> Eficiencia: Nuestros ASINs {processedData.efficiencyData.filter(d=>d.is_yaba_asin==='Y' && d.click_share > 5 && d.average_organic_rank > 5).length > 0 ? "son altamente eficientes (alto share con rank medio)" : "dependen estrictamente del rank top 3"}.</li>
                                    <li className="flex gap-2"><span className="font-bold">•</span> Palancas: El uso de Deals {processedData.latestData.some(d=>d.is_yaba_asin==='Y' && d.weekly_number_of_days_with_deal > 0) ? "está activo" : "es nulo"} en nuestra marca esta semana.</li>
                                    <li className="flex gap-2"><span className="font-bold">•</span> Riesgo: {processedData.latestData.filter(d=>d.is_yaba_asin==='N' && d.click_share > processedData.latestData.find(my=>my.is_yaba_asin==='Y')?.click_share).length} ASINs competidores nos superan en Click Share individual.</li>
                                </ul>
                            </div>
                            <div className="card bg-green-50 border border-green-100">
                                <h3 className="font-bold text-green-900 mb-4 flex items-center"><Icon name="check" size={18} /> Recomendaciones</h3>
                                <ul className="space-y-3 text-sm text-green-800">
                                    <li className="flex gap-2"><span className="font-bold">1.</span> {shareGrowth < 0 ? "Activar cupón de defensa inmediato para recuperar Share." : "Mantener precio actual y enfocar budget en keywords de oportunidad."}</li>
                                    <li className="flex gap-2"><span className="font-bold">2.</span> Analizar el listing de {topCompetitors[0]} para identificar keywords gap donde ellos rankean y nosotros no.</li>
                                    <li className="flex gap-2"><span className="font-bold">3.</span> Optimizar imágenes principales de ASINs con Organic Rank &lt; 5 pero Click Share bajo (Underperformers).</li>
                                </ul>
                            </div>
                        </div>
                    </Section>
                </div>
            );
        };

        // --- COMPARATOR TOOL ---
        
        const Comparator = ({ data, ourBrand, topCompetitors }) => {
            const weeks = [...new Set(data.map(d => d.week))].sort().reverse();
            const [selectedWeek, setSelectedWeek] = useState(weeks[0]);
            const [selectedComp, setSelectedComp] = useState(topCompetitors[0]);

            const weekData = data.filter(d => d.week === selectedWeek);
            
            const ourStats = {
                share: weekData.filter(d => d.is_yaba_asin === 'Y').reduce((a,b) => a+b.click_share, 0),
                price: weekData.filter(d => d.is_yaba_asin === 'Y').reduce((a,b) => a+b.price, 0) / (weekData.filter(d => d.is_yaba_asin === 'Y').length || 1),
                rank: weekData.filter(d => d.is_yaba_asin === 'Y').reduce((a,b) => a+b.average_organic_rank, 0) / (weekData.filter(d => d.is_yaba_asin === 'Y').length || 1),
            };

            const compStats = {
                share: weekData.filter(d => d.competitor_brand === selectedComp).reduce((a,b) => a+b.click_share, 0),
                price: weekData.filter(d => d.competitor_brand === selectedComp).reduce((a,b) => a+b.price, 0) / (weekData.filter(d => d.competitor_brand === selectedComp).length || 1),
                rank: weekData.filter(d => d.competitor_brand === selectedComp).reduce((a,b) => a+b.average_organic_rank, 0) / (weekData.filter(d => d.competitor_brand === selectedComp).length || 1),
            };

            const StatRow = ({ label, us, them, unit = '', inverse = false }) => {
                const diff = us - them;
                const win = inverse ? diff < 0 : diff > 0;
                return (
                    <div className="flex items-center justify-between py-4 border-b border-gray-100 last:border-0">
                        <span className="text-gray-500 w-1/3">{label}</span>
                        <div className="w-1/3 text-center font-bold text-blue-600 text-xl">{us.toFixed(1)}{unit}</div>
                        <div className="w-1/3 text-center font-bold text-gray-400 text-xl">{them.toFixed(1)}{unit}</div>
                    </div>
                );
            };

            return (
                <div className="max-w-4xl mx-auto p-8">
                    <div className="flex gap-4 mb-8">
                        <select className="p-2 rounded-lg border bg-white" value={selectedWeek} onChange={e => setSelectedWeek(e.target.value)}>
                            {weeks.map(w => <option key={w} value={w}>Semana {w}</option>)}
                        </select>
                        <select className="p-2 rounded-lg border bg-white" value={selectedComp} onChange={e => setSelectedComp(e.target.value)}>
                            {topCompetitors.map(c => <option key={c} value={c}>{c}</option>)}
                        </select>
                    </div>

                    <div className="card">
                        <div className="flex justify-between mb-6 pb-4 border-b">
                            <div className="w-1/3 text-center">
                                <h3 className="text-2xl font-bold text-blue-600">{ourBrand}</h3>
                                <span className="text-xs text-blue-400 uppercase tracking-wider">Nosotros</span>
                            </div>
                            <div className="w-1/3 text-center pt-2">
                                <span className="text-gray-300 font-bold text-xl">VS</span>
                            </div>
                            <div className="w-1/3 text-center">
                                <h3 className="text-2xl font-bold text-gray-700">{selectedComp}</h3>
                                <span className="text-xs text-gray-400 uppercase tracking-wider">Competidor</span>
                            </div>
                        </div>

                        <StatRow label="Click Share Total" us={ourStats.share} them={compStats.share} unit="%" />
                        <StatRow label="Precio Promedio" us={ourStats.price} them={compStats.price} unit="€" inverse={true} />
                        <StatRow label="Rank Orgánico Promedio" us={ourStats.rank} them={compStats.rank} inverse={true} />
                    </div>

                    <div className="mt-8 text-center text-gray-500 text-sm">
                        * Comparativa directa basada en los datos de la semana seleccionada.
                    </div>
                </div>
            );
        };

        // --- ROOT APP ---

        const App = () => {
            const [activeTab, setActiveTab] = useState('report');
            
            // Logic to identify brands dynamically from 'marketData'
            const { ourBrand, topCompetitors } = useMemo(() => {
                // 1. Identify Our Brand
                const ourBrandRow = marketData.find(d => d.is_yaba_asin === 'Y');
                const myBrand = ourBrandRow ? ourBrandRow.competitor_brand : "Unknown";

                // 2. Identify Competitors
                const shareByBrand = {};
                marketData.forEach(d => {
                    if (d.competitor_brand !== myBrand) {
                        shareByBrand[d.competitor_brand] = (shareByBrand[d.competitor_brand] || 0) + d.click_share;
                    }
                });
                
                const sortedComps = Object.entries(shareByBrand)
                    .sort((a, b) => b[1] - a[1])
                    .map(e => e[0])
                    .slice(0, 3);

                return { ourBrand: myBrand, topCompetitors: sortedComps };
            }, []);

            return (
                <div className="min-h-screen pb-20">
                    <div className="bg-white shadow-sm sticky top-0 z-10 border-b border-gray-200">
                        <div className="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
                            <h1 className="text-xl font-bold tracking-tight text-gray-900">
                                Market Intelligence <span className="text-gray-400 font-normal">| {ourBrand}</span>
                            </h1>
                            <div className="flex gap-2 bg-gray-100 p-1 rounded-full">
                                <button 
                                    onClick={() => setActiveTab('report')}
                                    className={`tab-btn ${activeTab === 'report' ? 'active' : 'inactive'}`}
                                >
                                    Reporte General
                                </button>
                                <button 
                                    onClick={() => setActiveTab('compare')}
                                    className={`tab-btn ${activeTab === 'compare' ? 'active' : 'inactive'}`}
                                >
                                    Comparador
                                </button>
                            </div>
                        </div>
                    </div>

                    {activeTab === 'report' ? (
                        <Dashboard data={marketData} ourBrand={ourBrand} topCompetitors={topCompetitors} />
                    ) : (
                        <Comparator data={marketData} ourBrand={ourBrand} topCompetitors={topCompetitors} />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>