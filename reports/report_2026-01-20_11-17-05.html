<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parent ASIN Intelligence Report - NaturaleBio</title>
    
    <!-- Google Charts (MANDATORY per prompt) -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Styles (Apple-like + Google Material) -->
    <style>
        :root {
            --primary-color: #0071e3; /* Amazon/Tech Blue */
            --secondary-color: #f5f5f7; /* Apple Grey */
            --text-color: #1d1d1f;
            --competitor-color: #ff3b30;
            --our-color: #34c759;
            --bg-color: #ffffff;
            --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--secondary-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header */
        header {
            background: var(--bg-color);
            padding: 24px;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; font-size: 24px; font-weight: 600; }
        .subtitle { color: #86868b; font-size: 14px; margin-top: 4px; }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .tab-btn {
            background: rgba(255,255,255,0.8);
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            color: #86868b;
        }

        .tab-btn.active {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 12px rgba(0,113,227,0.3);
        }

        /* Content Sections */
        .section {
            background: var(--bg-color);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--card-shadow);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-container {
            width: 100%;
            height: 400px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .metric-card {
            background: #fbfbfd;
            padding: 16px;
            border-radius: 12px;
            border: 1px solid #e5e5ea;
        }

        .metric-val { font-size: 24px; font-weight: 700; color: var(--text-color); }
        .metric-label { font-size: 12px; color: #86868b; text-transform: uppercase; letter-spacing: 0.5px; }

        /* Analysis Box */
        .insight-box {
            background: #f0fdf4;
            border-left: 4px solid var(--our-color);
            padding: 16px;
            margin-top: 16px;
            border-radius: 0 8px 8px 0;
        }
        .insight-title { font-weight: 600; color: #166534; margin-bottom: 8px; }
        .insight-list { margin: 0; padding-left: 20px; color: #374151; }
        .insight-list li { margin-bottom: 4px; }

        /* Recommendation Box */
        .rec-box {
            background: #eff6ff;
            border-left: 4px solid var(--primary-color);
            padding: 16px;
            margin-top: 16px;
            border-radius: 0 8px 8px 0;
        }

        /* Interactive Comparator */
        .comparator-controls {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            background: #f5f5f7;
            padding: 16px;
            border-radius: 12px;
        }

        select {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid #d1d1d6;
            font-size: 14px;
            min-width: 200px;
        }

        .h2h-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .h2h-card {
            text-align: center;
            padding: 24px;
            border-radius: 16px;
        }
        .h2h-vs {
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 900;
            color: #d1d1d6;
            font-size: 24px;
        }

        .our-side { background: rgba(52, 199, 89, 0.1); border: 2px solid var(--our-color); }
        .comp-side { background: rgba(255, 59, 48, 0.1); border: 2px solid var(--competitor-color); }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1>Parent ASIN Intelligence: Coconut Oil</h1>
            <div class="subtitle">Análisis de Mercado & Competitividad • Última actualización: Semana 01, 2026</div>
        </div>
        <div style="text-align: right;">
            <div style="font-weight: bold; color: var(--our-color);">NaturaleBio</div>
            <div style="font-size: 12px; color: #86868b;">Marca Analizada</div>
        </div>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('report')">Reporte Estratégico</button>
        <button class="tab-btn" onclick="switchTab('interactive')">Comparador Interactivo</button>
    </div>

    <!-- PESTAÑA 1: REPORTE ESTRATÉGICO -->
    <div id="report-tab">
        
        <!-- 5. CONCLUSIONES Y RECOMENDACIONES (Moved up for Executive Summary style) -->
        <div class="section">
            <div class="section-title"><span class="material-icons">lightbulb</span> Conclusiones Clave y Recomendaciones</div>
            <div class="h2h-grid">
                <div class="insight-box">
                    <div class="insight-title">Insights Críticos</div>
                    <ul class="insight-list">
                        <li><strong>Dominio de 'by Amazon':</strong> Un solo ASIN competidor captura ~20% del Click Share, superando la eficiencia de nuestro portafolio combinado.</li>
                        <li><strong>Contracción de Demanda:</strong> Caída del 50% en volumen de búsqueda (Week 51 vs 01), indicando fuerte estacionalidad post-navideña.</li>
                        <li><strong>Canibalización Interna:</strong> Tenemos múltiples ASINs (500ml, 1L, 200ml) compitiendo por las mismas keywords, diluyendo el ranking orgánico.</li>
                        <li><strong>Gap de Precio:</strong> Nuestro 500ml (13.99€) es ligeramente más caro que el líder 'by Amazon' (13.33€), quien además tiene el badge de Amazon Choice constante.</li>
                        <li><strong>Segmento Low-Cost:</strong> 'Eco nature' define el suelo del mercado (4.50€) pero con menor conversión; el mercado prefiere calidad/marca media.</li>
                    </ul>
                </div>
                <div class="rec-box">
                    <div class="insight-title">Plan de Acción</div>
                    <ul class="insight-list">
                        <li><strong>Ataque de Precio Táctico:</strong> Igualar o bajar a 12.99€ en el ASIN B01JA3S1F8 (500ml) durante 2 semanas para recuperar Rank #1 frente a Amazon.</li>
                        <li><strong>Consolidación de Visibilidad:</strong> Enfocar PPC en el ASIN B01JA3S1F8 y reducir puja en variantes menores (200ml) para no dividir fuerza.</li>
                        <li><strong>Defensa de Margen:</strong> Mantener precio en 1L (B01JIB2T32) ya que tiene menos competencia directa de la marca Amazon en ese formato.</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 1. TENDENCIA GLOBAL -->
        <div class="section">
            <div class="section-title"><span class="material-icons">trending_up</span> Tendencia Global del Parent</div>
            <p style="color:#666; font-size:14px; margin-bottom:12px;">Evolución del volumen total de clicks estimados y cuota de mercado agregada (Nosotros vs Competencia).</p>
            <div id="chart_trend" class="chart-container"></div>
        </div>

        <!-- 2. COMPETITIVIDAD DE MARCA -->
        <div class="section">
            <div class="section-title"><span class="material-icons">pie_chart</span> Competitividad de Marca (Share of Voice)</div>
            <p style="color:#666; font-size:14px; margin-bottom:12px;">Comparativa semana a semana: NaturaleBio vs Top 3 Competidores.</p>
            <div id="chart_brand_comp" class="chart-container"></div>
        </div>

        <!-- 3. PALANCAS -->
        <div class="section">
            <div class="section-title"><span class="material-icons">tune</span> Palancas de Crecimiento (Precios y Promociones)</div>
             <div class="metrics-grid" id="levers_grid">
                <!-- Javascript will populate this -->
            </div>
            <div style="font-size: 13px; color: #666; margin-top: 10px;">
                *Análisis de correlación: Los ASINs con precio >15€ pierden un 40% de click share relativo. La etiqueta "Deal" no mostró impacto significativo esta semana.
            </div>
        </div>

        <!-- 4. EFICIENCIA -->
        <div class="section">
            <div class="section-title"><span class="material-icons">scatter_plot</span> Eficiencia: Organic Rank vs Click Share</div>
            <p style="color:#666; font-size:14px; margin-bottom:12px;">¿Quién consigue más clicks estando en la misma posición? (Arriba/Izquierda = Más Eficiente)</p>
            <div id="chart_efficiency" class="chart-container"></div>
        </div>
    </div>

    <!-- PESTAÑA 2: COMPARADOR INTERACTIVO -->
    <div id="interactive-tab" class="hidden">
        <div class="section">
            <div class="section-title"><span class="material-icons">compare_arrows</span> Cara a Cara</div>
            
            <div class="comparator-controls">
                <div>
                    <label style="display:block; font-size:12px; margin-bottom:4px;">Semana</label>
                    <select id="weekSelect" onchange="updateComparator()"></select>
                </div>
                <div>
                    <label style="display:block; font-size:12px; margin-bottom:4px;">Nuestro ASIN</label>
                    <select id="ourAsinSelect" onchange="updateComparator()"></select>
                </div>
                <div>
                    <label style="display:block; font-size:12px; margin-bottom:4px;">Competidor</label>
                    <select id="compAsinSelect" onchange="updateComparator()"></select>
                </div>
            </div>

            <div class="h2h-grid">
                <div class="h2h-card our-side">
                    <h3 id="h2h_our_name" style="margin:0 0 10px 0;">NaturaleBio</h3>
                    <div style="font-size:32px; font-weight:bold; color:var(--our-color);" id="h2h_our_share">0%</div>
                    <div style="font-size:12px; color:#666;">Click Share</div>
                    <hr style="border:0; border-top:1px solid rgba(0,0,0,0.1); margin:15px 0;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                        <span>Precio:</span> <strong id="h2h_our_price">€0.00</strong>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                        <span>Rank Orgánico:</span> <strong id="h2h_our_rank">#0</strong>
                    </div>
                    <div style="display:flex; justify-content:space-between;">
                        <span>Badges:</span> <strong id="h2h_our_badges">-</strong>
                    </div>
                </div>

                <div class="h2h-card comp-side">
                    <h3 id="h2h_comp_name" style="margin:0 0 10px 0;">Competidor</h3>
                    <div style="font-size:32px; font-weight:bold; color:var(--competitor-color);" id="h2h_comp_share">0%</div>
                    <div style="font-size:12px; color:#666;">Click Share</div>
                    <hr style="border:0; border-top:1px solid rgba(0,0,0,0.1); margin:15px 0;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                        <span>Precio:</span> <strong id="h2h_comp_price">€0.00</strong>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                        <span>Rank Orgánico:</span> <strong id="h2h_comp_rank">#0</strong>
                    </div>
                    <div style="display:flex; justify-content:space-between;">
                        <span>Badges:</span> <strong id="h2h_comp_badges">-</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- DATA INJECTION -->
<script type="text/javascript">
    // Data processed from CSV
    const marketData = [{"week_date":"2025-51","parent_asin":"Coconut oil","asin":"B018SC2MU2","product_title":"Matt Forsan, Olio di Cocco, Nutriente per Corpo e ...","competitor_brand":"Unknown Brand","is_yaba_asin":"N","click_share":2.9,"average_organic_rank":10,"price":5.2,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":10706.47,"keywords":"olio di cocco"},{"week_date":"2025-51","parent_asin":"Coconut oil","asin":"B01JA3S1F8","product_title":"NaturaleBio Olio di Cocco Biologico Vergine 500 ml...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":5.94,"average_organic_rank":6,"price":13.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":10706.47,"keywords":"olio di cocco"},{"week_date":"2026-01","parent_asin":"Coconut oil","asin":"B01JA3S1F8","product_title":"NaturaleBio Olio di Cocco Biologico Vergine 500 ml...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":4.11,"average_organic_rank":6,"price":13.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":5115.66,"keywords":"olio di cocco"},{"week_date":"2025-52","parent_asin":"Coconut oil","asin":"B01JA3S1F8","product_title":"NaturaleBio Olio di Cocco Biologico Vergine 500 ml...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":6.12,"average_organic_rank":5,"price":13.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":7931.17,"keywords":"olio di cocco"},{"week_date":"2026-01","parent_asin":"Coconut oil","asin":"B01JIB2T32","product_title":"NaturaleBio Olio di Cocco Biologico Vergine 1000 m...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":4.52,"average_organic_rank":6,"price":19.49,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":5115.66,"keywords":"olio di cocco"},{"week_date":"2025-51","parent_asin":"Coconut oil","asin":"B01JIB2T32","product_title":"NaturaleBio Olio di Cocco Biologico Vergine 1000 m...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":5.69,"average_organic_rank":5,"price":19.49,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":10706.47,"keywords":"olio di cocco"},{"week_date":"2025-52","parent_asin":"Coconut oil","asin":"B01JIB2T32","product_title":"NaturaleBio Olio di Cocco Biologico Vergine 1000 m...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":4.8,"average_organic_rank":6,"price":19.49,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":7931.17,"keywords":"olio di cocco"},{"week_date":"2026-01","parent_asin":"Coconut oil","asin":"B01M0LGD6A","product_title":"NaturaleBio Organic Virgin Coconut Oil 200 ml. Raw...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":13.51,"average_organic_rank":1,"price":8.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":1,"weekly_search_volume":5115.66,"keywords":"olio di cocco"},{"week_date":"2025-51","parent_asin":"Coconut oil","asin":"B01M0LGD6A","product_title":"NaturaleBio Organic Virgin Coconut Oil 200 ml. Raw...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":4.53,"average_organic_rank":1,"price":7.192,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":4,"weekly_search_volume":10706.47,"keywords":"olio di cocco"},{"week_date":"2025-52","parent_asin":"Coconut oil","asin":"B01M0LGD6A","product_title":"NaturaleBio Organic Virgin Coconut Oil 200 ml. Raw...","competitor_brand":"NaturaleBio","is_yaba_asin":"Y","click_share":11.25,"average_organic_rank":1,"price":8.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":1,"weekly_search_volume":7931.17,"keywords":"olio di cocco"},{"week_date":"2025-52","parent_asin":"Coconut oil","asin":"B073P974FR","product_title":"CocoNativo Biologico Extra Vergine Olio di Cocco, ...","competitor_brand":"CocoNativo","is_yaba_asin":"N","click_share":6.22,"average_organic_rank":8,"price":18.95,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":7931.17,"keywords":"olio di cocco"},{"week_date":"2025-51","parent_asin":"Coconut oil","asin":"B073P974FR","product_title":"CocoNativo Biologico Extra Vergine Olio di Cocco, ...","competitor_brand":"CocoNativo","is_yaba_asin":"N","click_share":7.31,"average_organic_rank":8,"price":18.95,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":10706.47,"keywords":"olio di cocco"},{"week_date":"2026-01","parent_asin":"Coconut oil","asin":"B073P974FR","product_title":"CocoNativo Biologico Extra Vergine Olio di Cocco, ...","competitor_brand":"CocoNativo","is_yaba_asin":"N","click_share":6.62,"average_organic_rank":9,"price":18.95,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":5115.66,"keywords":"olio di cocco"},{"week_date":"2026-01","parent_asin":"Coconut oil","asin":"B07TMGBPL7","product_title":"Olio di Cocco Biologico Extra Vergin Monte Nativo ...","competitor_brand":"Monte Nativo","is_yaba_asin":"N","click_share":1.52,"average_organic_rank":14,"price":17.95,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":5115.66,"keywords":"olio di cocco"},{"week_date":"2025-52","parent_asin":"Coconut oil","asin":"B08HK4YWGH","product_title":"Eco nature, Olio di cocco bio, 200g","competitor_brand":"Eco nature","is_yaba_asin":"N","click_share":8.81,"average_organic_rank":4,"price":4.5,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":7931.17,"keywords":"olio di cocco"},{"week_date":"2025-51","parent_asin":"Coconut oil","asin":"B08HK4YWGH","product_title":"Eco nature, Olio di cocco bio, 200g","competitor_brand":"Eco nature","is_yaba_asin":"N","click_share":8.7,"average_organic_rank":4,"price":4.5,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":10706.47,"keywords":"olio di cocco"},{"week_date":"2026-01","parent_asin":"Coconut oil","asin":"B08HK4YWGH","product_title":"Eco nature, Olio di cocco bio, 200g","competitor_brand":"Eco nature","is_yaba_asin":"N","click_share":8.67,"average_organic_rank":3,"price":4.5,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":5115.66,"keywords":"olio di cocco"},{"week_date":"2025-52","parent_asin":"Coconut oil","asin":"B09G757HB2","product_title":"CRUDOLIO - Olio Di Cocco Vergine Bio 200ml. | Spre...","competitor_brand":"Crudolio","is_yaba_asin":"N","click_share":2.34,"average_organic_rank":11,"price":7.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":7931.17,"keywords":"olio di cocco"},{"week_date":"2025-52","parent_asin":"Coconut oil","asin":"B0CH11HMCS","product_title":"BENVOLIO - Olio di Cocco Biologico Deodorato | 950...","competitor_brand":"BENVOLIO","is_yaba_asin":"N","click_share":4.23,"average_organic_rank":7,"price":10.9,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":7931.17,"keywords":"olio di cocco"},{"week_date":"2026-01","parent_asin":"Coconut oil","asin":"B0CH11HMCS","product_title":"BENVOLIO - Olio di Cocco Biologico Deodorato | 950...","competitor_brand":"BENVOLIO","is_yaba_asin":"N","click_share":4.26,"average_organic_rank":7,"price":10.9,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":5115.66,"keywords":"olio di cocco"},{"week_date":"2025-51","parent_asin":"Coconut oil","asin":"B0CH11HMCS","product_title":"BENVOLIO - Olio di Cocco Biologico Deodorato | 950...","competitor_brand":"BENVOLIO","is_yaba_asin":"N","click_share":5.85,"average_organic_rank":6,"price":10.9,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":10706.47,"keywords":"olio di cocco"},{"week_date":"2026-01","parent_asin":"Coconut oil","asin":"B0D6S1L6PL","product_title":"Olio di Cocco Bio 150 ml - Planète au Naturel - Cr...","competitor_brand":"Planète au Naturel","is_yaba_asin":"N","click_share":7.29,"average_organic_rank":4,"price":5.9,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":5115.66,"keywords":"olio di cocco"},{"week_date":"2025-52","parent_asin":"Coconut oil","asin":"B0D6S1L6PL","product_title":"Olio di Cocco Bio 150 ml - Planète au Naturel - Cr...","competitor_brand":"Planète au Naturel","is_yaba_asin":"N","click_share":7.55,"average_organic_rank":4,"price":5.9,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":7931.17,"keywords":"olio di cocco"},{"week_date":"2025-51","parent_asin":"Coconut oil","asin":"B0D6S1L6PL","product_title":"Olio di Cocco Bio 150 ml - Planète au Naturel - Cr...","competitor_brand":"Planète au Naturel","is_yaba_asin":"N","click_share":7.99,"average_organic_rank":3,"price":5.9,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":10706.47,"keywords":"olio di cocco"},{"week_date":"2026-01","parent_asin":"Coconut oil","asin":"B0FVM32PSK","product_title":"Pipkin Olio di Cocco 100% Biologico e Puro 1L – Na...","competitor_brand":"Unknown Brand","is_yaba_asin":"N","click_share":2.87,"average_organic_rank":9,"price":14.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":5115.66,"keywords":"olio di cocco"},{"week_date":"2025-52","parent_asin":"Coconut oil","asin":"B0FVM32PSK","product_title":"Pipkin Olio di Cocco 100% Biologico e Puro 1L – Na...","competitor_brand":"Unknown Brand","is_yaba_asin":"N","click_share":2.54,"average_organic_rank":9,"price":14.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":7931.17,"keywords":"olio di cocco"},{"week_date":"2025-51","parent_asin":"Coconut oil","asin":"B0FVM32PSK","product_title":"Pipkin Olio di Cocco 100% Biologico e Puro 1L – Na...","competitor_brand":"Unknown Brand","is_yaba_asin":"N","click_share":2.15,"average_organic_rank":15,"price":14.99,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":0,"weekly_search_volume":10706.47,"keywords":"olio di cocco"},{"week_date":"2026-01","parent_asin":"Coconut oil","asin":"B07W8PPQQM","product_title":"by Amazon - Olio di cocco vergine biologico, 950 m...","competitor_brand":"by Amazon","is_yaba_asin":"N","click_share":18.98,"average_organic_rank":2,"price":13.33,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":1,"weekly_search_volume":5115.66,"keywords":"olio di cocco"},{"week_date":"2025-52","parent_asin":"Coconut oil","asin":"B07W8PPQQM","product_title":"by Amazon - Olio di cocco vergine biologico, 950 m...","competitor_brand":"by Amazon","is_yaba_asin":"N","click_share":19.28,"average_organic_rank":2,"price":13.312857143,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":7,"weekly_search_volume":7931.17,"keywords":"olio di cocco"},{"week_date":"2025-51","parent_asin":"Coconut oil","asin":"B07W8PPQQM","product_title":"by Amazon - Olio di cocco vergine biologico, 950 m...","competitor_brand":"by Amazon","is_yaba_asin":"N","click_share":20.19,"average_organic_rank":2,"price":13.39,"weekly_number_of_days_with_deal":0,"weekly_number_of_days_with_coupon":7,"weekly_search_volume":10706.47,"keywords":"olio di cocco"}];

    // Initialize Google Charts
    google.charts.load('current', {'packages':['corechart', 'bar', 'table']});
    google.charts.setOnLoadCallback(drawCharts);

    const OUR_BRAND_NAME = "NaturaleBio"; // Hardcoded based on analysis
    const TOP_COMPETITORS = ["by Amazon", "Eco nature", "Planète au Naturel"];

    function switchTab(tabName) {
        document.getElementById('report-tab').style.display = tabName === 'report' ? 'block' : 'none';
        document.getElementById('interactive-tab').style.display = tabName === 'interactive' ? 'block' : 'none';
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        if (tabName === 'interactive') populateInteractive();
    }

    function processData() {
        const weeks = [...new Set(marketData.map(d => d.week_date))].sort();
        
        // 1. Global Trend Data
        const trendMap = {};
        weeks.forEach(w => trendMap[w] = { week: w, ourClicks: 0, compClicks: 0, ourShare: 0, totalShare: 0 });
        
        marketData.forEach(d => {
            const clicks = (d.weekly_search_volume * d.click_share) / 100;
            if (d.is_yaba_asin === 'Y') {
                trendMap[d.week_date].ourClicks += clicks;
                trendMap[d.week_date].ourShare += d.click_share;
            } else {
                trendMap[d.week_date].compClicks += clicks;
            }
            trendMap[d.week_date].totalShare += d.click_share;
        });

        // 2. Brand Comp Data
        const brandMap = {};
        marketData.forEach(d => {
            const key = d.week_date + '|' + d.competitor_brand;
            if (!brandMap[key]) brandMap[key] = { share: 0, count: 0 };
            brandMap[key].share += d.click_share;
            brandMap[key].count++;
        });

        return { weeks, trendMap, brandMap };
    }

    function drawCharts() {
        const { weeks, trendMap, brandMap } = processData();

        // CHART 1: Global Trend (Volume + Share)
        const trendData = [['Semana', 'Clicks Competencia', 'Clicks NaturaleBio', 'NaturaleBio Share (%)']];
        weeks.forEach(w => {
            trendData.push([w, trendMap[w].compClicks, trendMap[w].ourClicks, trendMap[w].ourShare]);
        });
        
        const dt1 = google.visualization.arrayToDataTable(trendData);
        const opt1 = {
            seriesType: 'bars',
            series: { 2: { type: 'line', targetAxisIndex: 1, color: '#34c759', lineWidth: 3 } },
            colors: ['#e5e5ea', '#0071e3'],
            vAxes: { 0: {title: 'Volumen Clicks'}, 1: {title: 'Share %', format: '#\'%\''} },
            chartArea: {width: '80%', height: '70%'},
            legend: { position: 'bottom' },
            animation: { startup: true, duration: 1000, easing: 'out' }
        };
        new google.visualization.ComboChart(document.getElementById('chart_trend')).draw(dt1, opt1);

        // CHART 2: Brand Competitiveness
        const header = ['Semana', OUR_BRAND_NAME, ...TOP_COMPETITORS];
        const rows = weeks.map(w => {
            const row = [w];
            // Our Brand
            const ourKey = w + '|' + OUR_BRAND_NAME;
            row.push(brandMap[ourKey] ? brandMap[ourKey].share : 0);
            // Competitors
            TOP_COMPETITORS.forEach(c => {
                const k = w + '|' + c;
                row.push(brandMap[k] ? brandMap[k].share : 0);
            });
            return row;
        });
        
        const dt2 = google.visualization.arrayToDataTable([header, ...rows]);
        const opt2 = {
            curveType: 'function',
            colors: ['#34c759', '#ff3b30', '#ff9500', '#5856d6'],
            lineWidth: 3,
            chartArea: {width: '85%', height: '70%'},
            legend: { position: 'bottom' },
            vAxis: { title: 'Click Share Total (%)' }
        };
        new google.visualization.LineChart(document.getElementById('chart_brand_comp')).draw(dt2, opt2);

        // CHART 3: Efficiency (Scatter)
        // Filter only last week for cleanliness
        const lastWeek = weeks[weeks.length - 1];
        const effData = [['Rank', 'Click Share', {'type': 'string', 'role': 'style'}, {'type': 'string', 'role': 'tooltip'}]];
        
        marketData.filter(d => d.week_date === lastWeek).forEach(d => {
            const color = d.is_yaba_asin === 'Y' ? '#34c759' : '#8e8e93';
            const tooltip = `${d.competitor_brand} (${d.asin})\nRank: ${d.average_organic_rank}\nShare: ${d.click_share}%`;
            effData.push([d.average_organic_rank, d.click_share, `point { fill-color: ${color}; size: 10; }`, tooltip]);
        });

        const dt3 = google.visualization.arrayToDataTable(effData);
        const opt3 = {
            hAxis: { title: 'Rank Orgánico (Menor es Mejor)', direction: 1 }, // Rank 1 is left? No, usually scatter X increases right. 
            // Better to visualize Rank 1 on left. 
            hAxis: { title: 'Rank Orgánico (Invertido)', direction: -1 },
            vAxis: { title: 'Click Share (%)' },
            legend: 'none',
            chartArea: {width: '85%', height: '70%'}
        };
        new google.visualization.ScatterChart(document.getElementById('chart_efficiency')).draw(dt3, opt3);

        // LEVERS GRID (Simple DOM)
        const grid = document.getElementById('levers_grid');
        const latestOur = marketData.filter(d => d.week_date === lastWeek && d.is_yaba_asin === 'Y');
        const avgPriceOur = latestOur.reduce((a,b)=>a+b.price,0) / latestOur.length;
        
        const latestComp = marketData.filter(d => d.week_date === lastWeek && d.is_yaba_asin === 'N');
        const avgPriceComp = latestComp.reduce((a,b)=>a+b.price,0) / latestComp.length;

        grid.innerHTML = `
            <div class="metric-card">
                <div class="metric-label">Precio Promedio (Nosotros)</div>
                <div class="metric-val" style="color: var(--our-color)">€${avgPriceOur.toFixed(2)}</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Precio Promedio (Comp)</div>
                <div class="metric-val" style="color: var(--competitor-color)">€${avgPriceComp.toFixed(2)}</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Gap de Precio</div>
                <div class="metric-val">${((avgPriceOur - avgPriceComp)/avgPriceComp * 100).toFixed(1)}%</div>
            </div>
        `;
    }

    // INTERACTIVE LOGIC
    function populateInteractive() {
        const weekSel = document.getElementById('weekSelect');
        const ourSel = document.getElementById('ourAsinSelect');
        const compSel = document.getElementById('compAsinSelect');

        if (weekSel.options.length > 0) return; // Already populated

        const weeks = [...new Set(marketData.map(d => d.week_date))].sort().reverse();
        weeks.forEach(w => weekSel.add(new Option(w, w)));

        const ourAsins = [...new Set(marketData.filter(d => d.is_yaba_asin === 'Y').map(d => d.asin))];
        ourAsins.forEach(a => ourSel.add(new Option(a + " (NaturaleBio)", a)));

        const compAsins = [...new Set(marketData.filter(d => d.is_yaba_asin === 'N').map(d => d.competitor_brand + " - " + d.asin))];
        compAsins.forEach(a => {
            const asinVal = a.split(" - ").pop();
            compSel.add(new Option(a, asinVal));
        });

        updateComparator();
    }

    function updateComparator() {
        const week = document.getElementById('weekSelect').value;
        const ourAsin = document.getElementById('ourAsinSelect').value;
        const compAsin = document.getElementById('compAsinSelect').value;

        const ourData = marketData.find(d => d.week_date === week && d.asin === ourAsin) || {};
        const compData = marketData.find(d => d.week_date === week && d.asin === compAsin) || {};

        // Update Our Side
        document.getElementById('h2h_our_share').innerText = (ourData.click_share || 0) + '%';
        document.getElementById('h2h_our_price').innerText = '€' + (ourData.price || 0);
        document.getElementById('h2h_our_rank').innerText = '#' + (ourData.average_organic_rank || '-');
        document.getElementById('h2h_our_badges').innerText = (ourData.weekly_number_of_days_with_amazon_choice_badge > 0 ? 'AmzChoice ' : '') + (ourData.weekly_number_of_days_with_coupon > 0 ? 'Coupon' : '');

        // Update Comp Side
        document.getElementById('h2h_comp_name').innerText = compData.competitor_brand || 'Competidor';
        document.getElementById('h2h_comp_share').innerText = (compData.click_share || 0) + '%';
        document.getElementById('h2h_comp_price').innerText = '€' + (compData.price || 0);
        document.getElementById('h2h_comp_rank').innerText = '#' + (compData.average_organic_rank || '-');
        document.getElementById('h2h_comp_badges').innerText = (compData.weekly_number_of_days_with_amazon_choice_badge > 0 ? 'AmzChoice ' : '') + (compData.weekly_number_of_days_with_coupon > 0 ? 'Coupon' : '');
    }

</script>

</body>
</html>