<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Intelligence Report - Amazon ASIN Analysis</title>
    
    <!-- External Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Recharts (UMD) -->
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F5F5F7; /* Apple Gray */
            color: #1D1D1F;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8; 
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }
        
        .chart-tooltip {
            background-color: rgba(255, 255, 255, 0.98);
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            font-size: 13px;
        }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { 
        AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,
        LineChart, Line, Legend, BarChart, Bar, ScatterChart, Scatter, ZAxis, Cell
    } = Recharts;

    const { 
        TrendingUp, TrendingDown, Users, ShoppingCart, Target, Award, 
        AlertCircle, CheckCircle, Zap, Search, Activity, DollarSign 
    } = lucide;

    // --- DATA INJECTION START ---
    const marketData = {"meta": {"our_brand": "Naturalebio", "last_week": "2026-01", "top_competitors": ["Noritual Lab", "Vahdam", "Special Leaves"]}, "trend_chart": [{"name": "2025-51", "Competitor": 63.04, "Us": 36.96}, {"name": "2025-52", "Competitor": 63.93, "Us": 36.07}, {"name": "2026-01", "Competitor": 61.98, "Us": 38.02}], "brand_chart": [{"name": "2025-51", "Noritual Lab": 43.51, "Rest of Market": 7.64, "Special Leaves": 5.94, "Us": 36.96, "Vahdam": 5.95}, {"name": "2025-52", "Noritual Lab": 44.93, "Rest of Market": 4.03, "Special Leaves": 5.62, "Us": 36.07, "Vahdam": 9.35}, {"name": "2026-01", "Noritual Lab": 44.97, "Rest of Market": 6.66, "Special Leaves": 5.05, "Us": 38.02, "Vahdam": 5.3}], "levers": [{"competitor_brand": "Naturalebio", "price": 19.906875, "click_share": 5.6475, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_coupon": 0.0, "average_organic_rank": 4.0}, {"competitor_brand": "Noritual Lab", "price": 19.73375, "click_share": 13.36, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_coupon": 0.0, "average_organic_rank": 4.0}, {"competitor_brand": "Special Leaves", "price": 10.39, "click_share": 3.0, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_coupon": 4.0, "average_organic_rank": 16.0}, {"competitor_brand": "Vahdam", "price": 10.43, "click_share": 3.15, "weekly_number_of_days_with_deal": 0.0, "weekly_number_of_days_with_coupon": 0.0, "average_organic_rank": 9.0}], "scatter": [{"asin": "B06XQ5DCYJ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "is_yaba_asin": "Y", "average_organic_rank": 2.0, "click_share": 12.9, "competitor_brand": "Naturalebio", "price": 14.6075, "weekly_number_of_days_with_deal": 0.0, "bubble_type": "Us"}, {"asin": "B06XQ69YCQ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "is_yaba_asin": "Y", "average_organic_rank": 5.0, "click_share": 3.35, "competitor_brand": "Naturalebio", "price": 10.2225, "weekly_number_of_days_with_deal": 0.0, "bubble_type": "Us"}, {"asin": "B079VQ52MK", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "is_yaba_asin": "Y", "average_organic_rank": 5.0, "click_share": 3.66, "competitor_brand": "Naturalebio", "price": 24.5275, "weekly_number_of_days_with_deal": 0.0, "bubble_type": "Us"}, {"asin": "B07MD4LB49", "product_title": "VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A...", "is_yaba_asin": "N", "average_organic_rank": 9.0, "click_share": 3.15, "competitor_brand": "Vahdam", "price": 10.43, "weekly_number_of_days_with_deal": 0.0, "bubble_type": "Competitor"}, {"asin": "B07SZFD3P9", "product_title": "NaturaleBio Matcha Ceremonial Grade 100g. Original...", "is_yaba_asin": "Y", "average_organic_rank": null, "click_share": 2.68, "competitor_brand": "Naturalebio", "price": 30.27, "weekly_number_of_days_with_deal": null, "bubble_type": "Us"}, {"asin": "B08XVX8V1T", "product_title": "Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...", "is_yaba_asin": "N", "average_organic_rank": 10.0, "click_share": 2.39, "competitor_brand": "Biokontor", "price": 11.9975, "weekly_number_of_days_with_deal": 0.0, "bubble_type": "Competitor"}, {"asin": "B0CNRX8G5S", "product_title": "Ceremonial Matcha - Reines Matcha Pulver aus Japan...", "is_yaba_asin": "N", "average_organic_rank": 2.0, "click_share": 19.34, "competitor_brand": "Noritual Lab", "price": 23.91, "weekly_number_of_days_with_deal": 0.0, "bubble_type": "Competitor"}, {"asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...", "is_yaba_asin": "N", "average_organic_rank": 16.0, "click_share": 3.0, "competitor_brand": "Special Leaves", "price": 10.39, "weekly_number_of_days_with_deal": 0.0, "bubble_type": "Competitor"}, {"asin": "B0F9B1LWQQ", "product_title": "UNREAL\u00ae 100g Ceremonial Bio Matcha \u2013 100% Japanisc...", "is_yaba_asin": "N", "average_organic_rank": 19.0, "click_share": 1.57, "competitor_brand": "Unknown Brand", "price": 31.2725, "weekly_number_of_days_with_deal": 0.0, "bubble_type": "Competitor"}, {"asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...", "is_yaba_asin": "N", "average_organic_rank": 6.0, "click_share": 7.38, "competitor_brand": "Noritual Lab", "price": 15.5575, "weekly_number_of_days_with_deal": 0.0, "bubble_type": "Competitor"}], "comparison_raw": [{"week_date": "2025-51", "competitor_brand": "Naturalebio", "asin": "B06XQ5DCYJ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "price": 14.084285714, "click_share": 11.18, "average_organic_rank": 2.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "Y"}, {"week_date": "2025-51", "competitor_brand": "Naturalebio", "asin": "B06XQ69YCQ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "price": 9.2, "click_share": 3.85, "average_organic_rank": 5.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "Y"}, {"week_date": "2025-51", "competitor_brand": "Naturalebio", "asin": "B079VQ52MK", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "price": 23.075714286, "click_share": 3.69, "average_organic_rank": 5.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "Y"}, {"week_date": "2025-51", "competitor_brand": "Vahdam", "asin": "B07MD4LB49", "product_title": "VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A...", "price": 9.005714286, "click_share": 3.49, "average_organic_rank": 8.0, "weekly_number_of_days_with_deal": 5.0, "is_yaba_asin": "N"}, {"week_date": "2025-51", "competitor_brand": "Naturalebio", "asin": "B07SZFD3P9", "product_title": "NaturaleBio Matcha Ceremonial Grade 100g. Original...", "price": 26.748571429, "click_share": 2.95, "average_organic_rank": 22.0, "weekly_number_of_days_with_deal": 7.0, "is_yaba_asin": "Y"}, {"week_date": "2025-51", "competitor_brand": "Noritual Lab", "asin": "B0CNRX8G5S", "product_title": "Ceremonial Matcha - Reines Matcha Pulver aus Japan...", "price": 24.03, "click_share": 16.66, "average_organic_rank": 2.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "N"}, {"week_date": "2025-51", "competitor_brand": "Special Leaves", "asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...", "price": 10.44, "click_share": 3.48, "average_organic_rank": 14.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "N"}, {"week_date": "2025-51", "competitor_brand": "Unknown Brand", "asin": "B0F5BVFRC1", "product_title": "Jean & Len Handcreme I Love You So Matcha, f\u00fcr nor...", "price": 3.095714286, "click_share": 1.92, "average_organic_rank": 12.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "N"}, {"week_date": "2025-51", "competitor_brand": "Noritual Lab", "asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...", "price": 15.635714286, "click_share": 8.85, "average_organic_rank": 5.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "N"}, {"week_date": "2025-51", "competitor_brand": "Ceremonial Matcha Pulver Bio", "asin": "B0G1T7N675", "product_title": "Ceremonial Matcha Pulver BIO-Qualit\u00e4t 50g ideal zu...", "price": 8.898571429, "click_share": 2.56, "average_organic_rank": 12.0, "weekly_number_of_days_with_deal": 7.0, "is_yaba_asin": "N"}, {"week_date": "2025-52", "competitor_brand": "Naturalebio", "asin": "B06XQ5DCYJ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "price": 15.058571429, "click_share": 11.66, "average_organic_rank": 2.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "Y"}, {"week_date": "2025-52", "competitor_brand": "Naturalebio", "asin": "B06XQ69YCQ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "price": 10.538571429, "click_share": 3.75, "average_organic_rank": 4.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "Y"}, {"week_date": "2025-52", "competitor_brand": "Naturalebio", "asin": "B079VQ52MK", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "price": 24.855714286, "click_share": 3.49, "average_organic_rank": 5.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "Y"}, {"week_date": "2025-52", "competitor_brand": "Vahdam", "asin": "B07K1WBH4K", "product_title": "VAHDAM, Vanille Matcha Gr\u00fcner Tee Pulver (100g, 50...", "price": 9.895714286, "click_share": 1.47, "average_organic_rank": 20.0, "weekly_number_of_days_with_deal": 3.0, "is_yaba_asin": "N"}, {"week_date": "2025-52", "competitor_brand": "Vahdam", "asin": "B07MD4LB49", "product_title": "VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A...", "price": 9.895714286, "click_share": 4.19, "average_organic_rank": 7.0, "weekly_number_of_days_with_deal": 3.0, "is_yaba_asin": "N"}, {"week_date": "2025-52", "competitor_brand": "Naturalebio", "asin": "B07SZFD3P9", "product_title": "NaturaleBio Matcha Ceremonial Grade 100g. Original...", "price": 30.704285714, "click_share": 2.93, "average_organic_rank": 23.0, "weekly_number_of_days_with_deal": 1.0, "is_yaba_asin": "Y"}, {"week_date": "2025-52", "competitor_brand": "Biokontor", "asin": "B08XVX8V1T", "product_title": "Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...", "price": 12.367142857, "click_share": 2.44, "average_organic_rank": 10.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "N"}, {"week_date": "2025-52", "competitor_brand": "Noritual Lab", "asin": "B0CNRX8G5S", "product_title": "Ceremonial Matcha - Reines Matcha Pulver aus Japan...", "price": 24.648571429, "click_share": 18.77, "average_organic_rank": 2.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "N"}, {"week_date": "2025-52", "competitor_brand": "Special Leaves", "asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...", "price": 10.71, "click_share": 3.4, "average_organic_rank": 13.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "N"}, {"week_date": "2025-52", "competitor_brand": "Noritual Lab", "asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...", "price": 16.037142857, "click_share": 8.42, "average_organic_rank": 6.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "N"}, {"week_date": "2026-01", "competitor_brand": "Naturalebio", "asin": "B06XQ5DCYJ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "price": 14.6075, "click_share": 12.9, "average_organic_rank": 2.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "Y"}, {"week_date": "2026-01", "competitor_brand": "Naturalebio", "asin": "B06XQ69YCQ", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "price": 10.2225, "click_share": 3.35, "average_organic_rank": 5.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "Y"}, {"week_date": "2026-01", "competitor_brand": "Naturalebio", "asin": "B079VQ52MK", "product_title": "NaturaleBio Matcha Tee Pulver Bio - Premium-Qualit...", "price": 24.5275, "click_share": 3.66, "average_organic_rank": 5.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "Y"}, {"week_date": "2026-01", "competitor_brand": "Vahdam", "asin": "B07MD4LB49", "product_title": "VAHDAM, Matcha Gr\u00fcntee Pulver (100g, 50+ Tassen) A...", "price": 10.43, "click_share": 3.15, "average_organic_rank": 9.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "N"}, {"week_date": "2026-01", "competitor_brand": "Naturalebio", "asin": "B07SZFD3P9", "product_title": "NaturaleBio Matcha Ceremonial Grade 100g. Original...", "price": 30.27, "click_share": 2.68, "average_organic_rank": null, "weekly_number_of_days_with_deal": null, "is_yaba_asin": "Y"}, {"week_date": "2026-01", "competitor_brand": "Biokontor", "asin": "B08XVX8V1T", "product_title": "Bio Matcha Pulver 100 g \u2013 Japan Matcha Tee, 100% n...", "price": 11.9975, "click_share": 2.39, "average_organic_rank": 10.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "N"}, {"week_date": "2026-01", "competitor_brand": "Noritual Lab", "asin": "B0CNRX8G5S", "product_title": "Ceremonial Matcha - Reines Matcha Pulver aus Japan...", "price": 23.91, "click_share": 19.34, "average_organic_rank": 2.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "N"}, {"week_date": "2026-01", "competitor_brand": "Special Leaves", "asin": "B0DRP6Y6XC", "product_title": "Matcha Pulver - 90g - 100% Nat\u00fcrlich & Fein Gemahl...", "price": 10.39, "click_share": 3.0, "average_organic_rank": 16.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "N"}, {"week_date": "2026-01", "competitor_brand": "Unknown Brand", "asin": "B0F9B1LWQQ", "product_title": "UNREAL\u00ae 100g Ceremonial Bio Matcha \u2013 100% Japanisc...", "price": 31.2725, "click_share": 1.57, "average_organic_rank": 19.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "N"}, {"week_date": "2026-01", "competitor_brand": "Noritual Lab", "asin": "B0FSL3C3Z8", "product_title": "Ceremonial Matcha Ryoku - Reines Gr\u00fcntee-Pulver au...", "price": 15.5575, "click_share": 7.38, "average_organic_rank": 6.0, "weekly_number_of_days_with_deal": 0.0, "is_yaba_asin": "N"}], "generated_insights": ["La tendencia global de Naturalebio est\u00e1 creciendo (38.0% vs 36.1% semana anterior).", "El competidor m\u00e1s fuerte es Noritual Lab, manteniendo una presencia s\u00f3lida en el Top 3.", "Analizar impacto de precios en la \u00faltima semana muestra correlaci\u00f3n mixta.", "Eficiencia de rango org\u00e1nico sugiere oportunidades de optimizaci\u00f3n en t\u00edtulos.", "D\u00edas de oferta han mostrado picos puntuales de conversi\u00f3n."], "recommendations": ["Ajustar precio en variantes de bajo rendimiento.", "Incrementar d\u00edas de cup\u00f3n para contrarrestar a competidores agresivos.", "Revisar t\u00edtulos de ASINs con buen rank pero bajo click share."]};
    // --- DATA INJECTION END ---

    // COLORS
    const COLOR_US = '#3B82F6';
    const COLOR_COMP_1 = '#EF4444';
    const COLOR_COMP_2 = '#10B981';
    const COLOR_COMP_3 = '#F59E0B';
    const COLOR_OTHER = '#9CA3AF';

    const Card = ({ children, className = "" }) => (
        <div className={`glass-card rounded-2xl p-6 ${className}`}>
            {children}
        </div>
    );

    const StatCard = ({ title, value, subtext, icon: Icon, trend }) => (
        <Card>
            <div className="flex justify-between items-start mb-2">
                <div className="p-2 bg-blue-50 rounded-lg">
                    <Icon size={20} className="text-blue-600" />
                </div>
                {trend && (
                    <span className={`text-xs font-medium px-2 py-1 rounded-full ${trend > 0 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                        {trend > 0 ? '+' : ''}{trend}%
                    </span>
                )}
            </div>
            <h3 className="text-gray-500 text-sm font-medium">{title}</h3>
            <div className="mt-1 flex items-baseline">
                <span className="text-2xl font-bold text-gray-900">{value}</span>
                {subtext && <span className="ml-2 text-sm text-gray-400">{subtext}</span>}
            </div>
        </Card>
    );

    const CustomTooltip = ({ active, payload, label }) => {
        if (active && payload && payload.length) {
            return (
                <div className="chart-tooltip">
                    <p className="font-semibold mb-2">{label}</p>
                    {payload.map((entry, index) => (
                        <div key={index} className="flex items-center gap-2 text-sm">
                            <div className="w-2 h-2 rounded-full" style={{ backgroundColor: entry.color }} />
                            <span className="text-gray-600">{entry.name}:</span>
                            <span className="font-medium text-gray-900">{entry.value}%</span>
                        </div>
                    ))}
                </div>
            );
        }
        return null;
    };

    const ReportTab = () => {
        const lastWeek = marketData.trend_chart[marketData.trend_chart.length - 1];
        const ourShare = lastWeek ? lastWeek.Us : 0;
        const compShare = lastWeek ? lastWeek.Competitor : 0;

        return (
            <div className="space-y-8 animate-fade-in">
                {/* Header Stats */}
                <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <StatCard 
                        title="Click Share Total (Nosotros)" 
                        value={`${ourShare}%`} 
                        subtext="Semana Actual"
                        icon={Target}
                    />
                    <StatCard 
                        title="Click Share (Competencia)" 
                        value={`${compShare}%`} 
                        subtext="Semana Actual"
                        icon={Users}
                    />
                    <StatCard 
                        title="Top Competidor" 
                        value={marketData.meta.top_competitors[0] || "N/A"} 
                        subtext="Mayor Amenaza"
                        icon={AlertCircle}
                    />
                    <StatCard 
                        title="Ranking Orgánico Promedio" 
                        value={marketData.levers.find(l => l.competitor_brand === marketData.meta.our_brand)?.average_organic_rank?.toFixed(1) || "-"} 
                        subtext="Nuestros ASINs"
                        icon={Search}
                    />
                </div>

                {/* Section 1: Global Trend */}
                <Card>
                    <div className="flex justify-between items-center mb-6">
                        <div>
                            <h2 className="text-lg font-bold text-gray-900">Tendencia Global del Parent</h2>
                            <p className="text-sm text-gray-500">Click Share: Nosotros vs Competencia</p>
                        </div>
                    </div>
                    <div className="h-72 w-full">
                        <ResponsiveContainer width="100%" height="100%">
                            <AreaChart data={marketData.trend_chart}>
                                <defs>
                                    <linearGradient id="colorUs" x1="0" y1="0" x2="0" y2="1">
                                        <stop offset="5%" stopColor={COLOR_US} stopOpacity={0.1}/>
                                        <stop offset="95%" stopColor={COLOR_US} stopOpacity={0}/>
                                    </linearGradient>
                                    <linearGradient id="colorComp" x1="0" y1="0" x2="0" y2="1">
                                        <stop offset="5%" stopColor={COLOR_OTHER} stopOpacity={0.1}/>
                                        <stop offset="95%" stopColor={COLOR_OTHER} stopOpacity={0}/>
                                    </linearGradient>
                                </defs>
                                <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#E5E7EB" />
                                <XAxis dataKey="name" axisLine={false} tickLine={false} tick={{fill: '#6B7280', fontSize: 12}} />
                                <YAxis axisLine={false} tickLine={false} tick={{fill: '#6B7280', fontSize: 12}} unit="%" />
                                <Tooltip content={<CustomTooltip />} />
                                <Area type="monotone" dataKey="Us" name="Nosotros" stroke={COLOR_US} fillOpacity={1} fill="url(#colorUs)" strokeWidth={2} />
                                <Area type="monotone" dataKey="Competitor" name="Competencia" stroke={COLOR_OTHER} fillOpacity={1} fill="url(#colorComp)" strokeWidth={2} />
                                <Legend />
                            </AreaChart>
                        </ResponsiveContainer>
                    </div>
                </Card>

                {/* Section 2: Brand Competitiveness */}
                <Card>
                    <div className="mb-6">
                        <h2 className="text-lg font-bold text-gray-900">Competitividad de Marca</h2>
                        <p className="text-sm text-gray-500">Evolución de cuota de mercado por marca</p>
                    </div>
                    <div className="h-72 w-full">
                        <ResponsiveContainer width="100%" height="100%">
                            <LineChart data={marketData.brand_chart}>
                                <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#E5E7EB" />
                                <XAxis dataKey="name" axisLine={false} tickLine={false} tick={{fill: '#6B7280', fontSize: 12}} />
                                <YAxis axisLine={false} tickLine={false} tick={{fill: '#6B7280', fontSize: 12}} unit="%" />
                                <Tooltip content={<CustomTooltip />} />
                                <Line type="monotone" dataKey="Us" name={marketData.meta.our_brand} stroke={COLOR_US} strokeWidth={3} dot={{r: 4}} />
                                {marketData.meta.top_competitors[0] && <Line type="monotone" dataKey={marketData.meta.top_competitors[0]} stroke={COLOR_COMP_1} strokeWidth={2} dot={false} />}
                                {marketData.meta.top_competitors[1] && <Line type="monotone" dataKey={marketData.meta.top_competitors[1]} stroke={COLOR_COMP_2} strokeWidth={2} dot={false} />}
                                <Line type="monotone" dataKey="Rest of Market" stroke={COLOR_OTHER} strokeWidth={1} strokeDasharray="5 5" dot={false} />
                                <Legend />
                            </LineChart>
                        </ResponsiveContainer>
                    </div>
                </Card>

                {/* Section 3 & 4: Levers & Efficiency */}
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    {/* Levers Table/Chart */}
                    <Card>
                        <div className="mb-4">
                            <h2 className="text-lg font-bold text-gray-900">Palancas de Crecimiento (Última Semana)</h2>
                            <p className="text-sm text-gray-500">Comparativa de Precio y Promociones</p>
                        </div>
                        <div className="overflow-x-auto">
                            <table className="min-w-full text-sm text-left text-gray-500">
                                <thead className="text-xs text-gray-700 uppercase bg-gray-50">
                                    <tr>
                                        <th className="px-4 py-3">Marca</th>
                                        <th className="px-4 py-3">Precio Avg</th>
                                        <th className="px-4 py-3">Share %</th>
                                        <th className="px-4 py-3">Deals/Sem</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {marketData.levers.map((row, idx) => (
                                        <tr key={idx} className="bg-white border-b hover:bg-gray-50">
                                            <td className="px-4 py-3 font-medium text-gray-900">
                                                {row.competitor_brand}
                                            </td>
                                            <td className="px-4 py-3">€{row.price.toFixed(2)}</td>
                                            <td className="px-4 py-3">{row.click_share.toFixed(1)}%</td>
                                            <td className="px-4 py-3">
                                                {row.weekly_number_of_days_with_deal > 0 ? (
                                                    <span className="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">
                                                        {row.weekly_number_of_days_with_deal.toFixed(1)} días
                                                    </span>
                                                ) : '-'}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </Card>

                    {/* Efficiency Scatter */}
                    <Card>
                        <div className="mb-4">
                            <h2 className="text-lg font-bold text-gray-900">Eficiencia Orgánica</h2>
                            <p className="text-sm text-gray-500">Rank Orgánico (X) vs Click Share (Y)</p>
                        </div>
                        <div className="h-64 w-full">
                            <ResponsiveContainer width="100%" height="100%">
                                <ScatterChart margin={{ top: 20, right: 20, bottom: 20, left: 0 }}>
                                    <CartesianGrid strokeDasharray="3 3" />
                                    <XAxis type="number" dataKey="average_organic_rank" name="Rank" reversed={true} unit="" tick={{fontSize: 12}} label={{ value: 'Ranking Orgánico (Mejor ←)', position: 'insideBottom', offset: -10, fontSize: 10 }} />
                                    <YAxis type="number" dataKey="click_share" name="Share" unit="%" tick={{fontSize: 12}} label={{ value: 'Click Share', angle: -90, position: 'insideLeft', fontSize: 10 }} />
                                    <Tooltip cursor={{ strokeDasharray: '3 3' }} content={({ active, payload }) => {
                                        if (active && payload && payload.length) {
                                            const data = payload[0].payload;
                                            return (
                                                <div className="chart-tooltip border-l-4" style={{ borderLeftColor: data.bubble_type === 'Us' ? COLOR_US : COLOR_COMP_1 }}>
                                                    <p className="font-bold text-gray-900 text-xs mb-1 w-48 truncate">{data.product_title}</p>
                                                    <p className="text-xs">Rank: {data.average_organic_rank ? data.average_organic_rank.toFixed(0) : 'N/A'}</p>
                                                    <p className="text-xs">Share: {data.click_share}%</p>
                                                    <p className="text-xs">Precio: €{data.price.toFixed(2)}</p>
                                                </div>
                                            );
                                        }
                                        return null;
                                    }}/>
                                    <Scatter name="ASINs" data={marketData.scatter}>
                                        {marketData.scatter.map((entry, index) => (
                                            <Cell key={`cell-${index}`} fill={entry.bubble_type === 'Us' ? COLOR_US : COLOR_COMP_1} fillOpacity={0.6} stroke={entry.bubble_type === 'Us' ? COLOR_US : COLOR_COMP_1} />
                                        ))}
                                    </Scatter>
                                </ScatterChart>
                            </ResponsiveContainer>
                        </div>
                    </Card>
                </div>

                {/* Section 5: Insights & Recommendations */}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <Card className="bg-gradient-to-br from-blue-50 to-white">
                        <div className="flex items-center gap-2 mb-4">
                            <Zap className="text-blue-600" size={24} />
                            <h2 className="text-lg font-bold text-gray-900">Insights Clave</h2>
                        </div>
                        <ul className="space-y-3">
                            {marketData.generated_insights.map((insight, idx) => (
                                <li key={idx} className="flex gap-3 items-start text-sm text-gray-700">
                                    <span className="mt-1 w-1.5 h-1.5 rounded-full bg-blue-500 shrink-0" />
                                    {insight}
                                </li>
                            ))}
                        </ul>
                    </Card>

                    <Card className="bg-gradient-to-br from-green-50 to-white">
                        <div className="flex items-center gap-2 mb-4">
                            <CheckCircle className="text-green-600" size={24} />
                            <h2 className="text-lg font-bold text-gray-900">Recomendaciones</h2>
                        </div>
                        <ul className="space-y-3">
                            {marketData.recommendations.map((rec, idx) => (
                                <li key={idx} className="flex gap-3 items-start text-sm text-gray-700">
                                    <span className="mt-1 w-1.5 h-1.5 rounded-full bg-green-500 shrink-0" />
                                    {rec}
                                </li>
                            ))}
                        </ul>
                    </Card>
                </div>
            </div>
        );
    };

    const InteractiveTab = () => {
        const [selectedWeek, setSelectedWeek] = React.useState(marketData.meta.last_week);
        const [selectedCompetitor, setSelectedCompetitor] = React.useState(marketData.meta.top_competitors[0]);

        const weeks = [...new Set(marketData.comparison_raw.map(d => d.week_date))].sort();
        const competitors = marketData.meta.top_competitors;

        // Filter Data
        const ourData = marketData.comparison_raw.filter(d => d.week_date === selectedWeek && d.is_yaba_asin === 'Y');
        const compData = marketData.comparison_raw.filter(d => d.week_date === selectedWeek && d.competitor_brand === selectedCompetitor);

        // Averages
        const avg = (data, key) => {
            const valid = data.filter(d => d[key] != null);
            if (!valid.length) return 0;
            return valid.reduce((a, b) => a + b[key], 0) / valid.length;
        };

        return (
            <div className="space-y-6 animate-fade-in">
                {/* Controls */}
                <Card className="flex flex-col sm:flex-row gap-4 items-center justify-between">
                    <div className="flex gap-2 items-center">
                        <Activity className="text-gray-400" size={20} />
                        <h2 className="font-semibold text-gray-700">Comparador Cara a Cara</h2>
                    </div>
                    <div className="flex gap-4">
                        <select 
                            className="bg-gray-100 border-none rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-blue-500"
                            value={selectedWeek}
                            onChange={(e) => setSelectedWeek(e.target.value)}
                        >
                            {weeks.map(w => <option key={w} value={w}>Semana {w}</option>)}
                        </select>
                        <select 
                            className="bg-gray-100 border-none rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-blue-500"
                            value={selectedCompetitor}
                            onChange={(e) => setSelectedCompetitor(e.target.value)}
                        >
                            {competitors.map(c => <option key={c} value={c}>{c}</option>)}
                        </select>
                    </div>
                </Card>

                {/* Head to Head Stats */}
                <div className="grid grid-cols-2 gap-4 md:gap-8">
                    {/* US */}
                    <div className="space-y-4">
                        <div className="text-center pb-2 border-b-2 border-blue-500">
                            <h3 className="font-bold text-lg text-gray-900">{marketData.meta.our_brand}</h3>
                        </div>
                        <div className="grid gap-3">
                            <Card className="p-4 flex justify-between items-center">
                                <span className="text-sm text-gray-500">Precio Promedio</span>
                                <span className="font-bold text-lg">€{avg(ourData, 'price').toFixed(2)}</span>
                            </Card>
                            <Card className="p-4 flex justify-between items-center">
                                <span className="text-sm text-gray-500">Share Promedio</span>
                                <span className="font-bold text-lg">{avg(ourData, 'click_share').toFixed(1)}%</span>
                            </Card>
                            <Card className="p-4 flex justify-between items-center">
                                <span className="text-sm text-gray-500">Rank Promedio</span>
                                <span className="font-bold text-lg">{avg(ourData, 'average_organic_rank').toFixed(0)}</span>
                            </Card>
                        </div>
                    </div>

                    {/* THEM */}
                    <div className="space-y-4">
                        <div className="text-center pb-2 border-b-2 border-red-500">
                            <h3 className="font-bold text-lg text-gray-900">{selectedCompetitor}</h3>
                        </div>
                        <div className="grid gap-3">
                            <Card className="p-4 flex justify-between items-center">
                                <span className="text-sm text-gray-500">Precio Promedio</span>
                                <span className={`font-bold text-lg ${avg(compData, 'price') < avg(ourData, 'price') ? 'text-green-600' : ''}`}>
                                    €{avg(compData, 'price').toFixed(2)}
                                </span>
                            </Card>
                            <Card className="p-4 flex justify-between items-center">
                                <span className="text-sm text-gray-500">Share Promedio</span>
                                <span className={`font-bold text-lg ${avg(compData, 'click_share') > avg(ourData, 'click_share') ? 'text-red-600' : ''}`}>
                                    {avg(compData, 'click_share').toFixed(1)}%
                                </span>
                            </Card>
                            <Card className="p-4 flex justify-between items-center">
                                <span className="text-sm text-gray-500">Rank Promedio</span>
                                <span className="font-bold text-lg">{avg(compData, 'average_organic_rank').toFixed(0)}</span>
                            </Card>
                        </div>
                    </div>
                </div>
            </div>
        );
    };

    const App = () => {
        const [activeTab, setActiveTab] = React.useState('report');

        return (
            <div className="max-w-6xl mx-auto px-4 py-8 min-h-screen">
                <header className="mb-8 text-center md:text-left">
                    <h1 className="text-3xl font-bold tracking-tight text-gray-900">Market Intelligence</h1>
                    <p className="text-gray-500 mt-1">Análisis detallado de {marketData.meta.our_brand} y el panorama competitivo.</p>
                </header>

                <div className="flex justify-center md:justify-start mb-6 bg-white p-1 rounded-xl shadow-sm inline-flex border border-gray-100">
                    <button 
                        onClick={() => setActiveTab('report')}
                        className={`px-6 py-2 rounded-lg text-sm font-medium transition-all ${activeTab === 'report' ? 'bg-gray-900 text-white shadow-md' : 'text-gray-500 hover:text-gray-900'}`}
                    >
                        Reporte Estático
                    </button>
                    <button 
                        onClick={() => setActiveTab('interactive')}
                        className={`px-6 py-2 rounded-lg text-sm font-medium transition-all ${activeTab === 'interactive' ? 'bg-gray-900 text-white shadow-md' : 'text-gray-500 hover:text-gray-900'}`}
                    >
                        Comparador Interactivo
                    </button>
                </div>

                <main>
                    {activeTab === 'report' ? <ReportTab /> : <InteractiveTab />}
                </main>

                <footer className="mt-12 text-center text-xs text-gray-400 py-4 border-t border-gray-200">
                    Generado automáticamente • Datos confidenciales • {new Date().getFullYear()}
                </footer>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>

</body>
</html>