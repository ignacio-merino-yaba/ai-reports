<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte de Rendimiento ASIN: Incite Nutrition</title>
    <!-- Google Charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        /* CSS Reset & Variables */
        :root {
            --primary: #007AFF; /* Apple Blue */
            --primary-light: #E5F1FF;
            --success: #34C759;
            --danger: #FF3B30;
            --text-main: #1D1D1F;
            --text-sec: #86868B;
            --bg-body: #F5F5F7;
            --bg-card: #FFFFFF;
            --radius: 16px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font);
            background-color: var(--bg-body);
            color: var(--text-main);
            line-height: 1.5;
            padding-bottom: 40px;
        }

        /* Layout Utilities */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .grid {
            display: grid;
            gap: 20px;
        }
        
        .grid-2 { grid-template-columns: 1fr 1fr; }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-4 { grid-template-columns: repeat(4, 1fr); }

        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
        }

        /* Components */
        .card {
            background: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 24px;
            transition: transform 0.2s ease;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-main);
        }

        .metric-value {
            font-size: 32px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .metric-label {
            font-size: 13px;
            color: var(--text-sec);
            font-weight: 500;
            text-transform: uppercase;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 600;
        }
        .badge-blue { background: var(--primary-light); color: var(--primary); }
        .badge-green { background: #E8F5E9; color: var(--success); }
        .badge-red { background: #FFEBEE; color: var(--danger); }

        /* Header */
        header {
            background: var(--bg-card);
            border-bottom: 1px solid rgba(0,0,0,0.1);
            padding: 20px 0;
            margin-bottom: 30px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { font-size: 24px; font-weight: 700; }
        .subtitle { color: var(--text-sec); font-size: 14px; }

        /* Tabs */
        .tabs {
            display: flex;
            background: rgba(118, 118, 128, 0.12);
            padding: 4px;
            border-radius: 12px;
            width: fit-content;
        }

        .tab-btn {
            padding: 8px 20px;
            border: none;
            background: transparent;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-main);
            border-radius: 8px;
            cursor: pointer;
        }

        .tab-btn.active {
            background: var(--bg-card);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Sections */
        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin: 40px 0 20px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-container {
            width: 100%;
            height: 350px;
        }

        .insight-box {
            background: #F2F7FF;
            border-left: 4px solid var(--primary);
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
            font-size: 14px;
        }

        .rec-list li {
            margin-bottom: 8px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        
        .material-icons { font-size: 20px; vertical-align: middle; }
        
        /* Interactive Controls */
        select {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-family: var(--font);
            font-size: 14px;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

    <header>
        <div class="container header-content">
            <div>
                <h1>Análisis de Rendimiento: Vitamin D3</h1>
                <div class="subtitle">Marca Analizada: <span style="color:var(--primary); font-weight:700;">Incite Nutrition</span> | Última Actualización: 2026-03</div>
            </div>
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('static')">Reporte Ejecutivo</button>
                <button class="tab-btn" onclick="switchTab('interactive')">Comparador Dinámico</button>
            </div>
        </div>
    </header>

    <div class="container">
        
        <!-- PESTAÑA 1: REPORTE ESTÁTICO -->
        <div id="tab-static">
            
            <!-- 1. Tendencia Global -->
            <div class="section-title">
                <span class="material-icons">trending_up</span>
                1. Tendencia Global del Parent
            </div>
            <div class="grid grid-2">
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Volumen de Clicks y Share</span>
                    </div>
                    <div id="trend_chart" class="chart-container"></div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Insights de Tracción</span>
                    </div>
                    <p style="margin-bottom: 12px;"><strong>Análisis Temporal:</strong> El parent ASIN de Incite Nutrition muestra una <span style="color:var(--success); font-weight:600;">tendencia general positiva</span> en volumen absoluto de clics durante el periodo de 4 semanas. Aunque la cuota de mercado (Click Share) tuvo un pico del 9.01% en la semana 2026-02, se observa una corrección a la baja hacia el 8.18% en la última semana (2026-03).</p>
                    <p><strong>Causa Raíz:</strong> La visibilidad orgánica se mantiene sólida (Rank medio ~3-4). Sin embargo, la intensificación promocional de competidores como <em>Nutrition Geeks</em> (con alta retención de share) está fragmentando el mercado.</p>
                    <div class="insight-box">
                        <strong>Conclusión:</strong> Nuestros ASINs ganan tracción en volumen bruto gracias a la demanda estacional, pero pierden ligera eficiencia en cuota frente a competidores agresivos en precio/volumen.
                    </div>
                </div>
            </div>

            <!-- 2. Competitividad de Marca -->
            <div class="section-title">
                <span class="material-icons">flag</span>
                2. Competitividad de Marca (Share of Voice)
            </div>
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Curva de Click Share: Incite vs Top 3 Competidores</span>
                </div>
                <div id="brand_chart" class="chart-container"></div>
                <div style="margin-top: 20px; font-size: 14px; color: #555;">
                    <p>• <strong>Dominio:</strong> <em>WeightWorld</em> lidera el segmento de alto volumen (gracias a sus variantes de "1+ Year Supply" y Deals frecuentes).</p>
                    <p>• <strong>Nuestra Posición:</strong> Incite Nutrition se mantiene competitiva en el Top 3, peleando directamente con <em>Vita Premium</em>.</p>
                    <p>• <strong>Amenaza:</strong> <em>Nutrition Geeks</em> muestra picos de alta eficiencia, correlacionados con precios bajos (~7.99).</p>
                </div>
            </div>

            <!-- 3. Palancas -->
            <div class="section-title">
                <span class="material-icons">tune</span>
                3. Palancas de Crecimiento
            </div>
            <div class="grid grid-3">
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Precio vs Share</span>
                    </div>
                    <div class="metric-value">£6.79</div>
                    <div class="metric-label">Nuestro Precio Promedio (Última Sem.)</div>
                    <p style="margin-top:10px; font-size:13px;">Vs Mercado: Somos <strong>más competitivos</strong> que Nutrition Geeks (£7.99) y WeightWorld (£8.99). Esta ventaja de precio es nuestro mayor driver de conversión orgánica.</p>
                </div>
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Impacto de Deals</span>
                    </div>
                    <div class="metric-value" style="color:var(--danger);">0 Días</div>
                    <div class="metric-label">Deals Activos (Nosotros)</div>
                    <p style="margin-top:10px; font-size:13px;">Competidores como <strong>WeightWorld</strong> activaron Deals durante 7 días, capturando cuotas superiores al 18%. La ausencia de promociones limita nuestros picos de tráfico.</p>
                </div>
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Eficiencia Orgánica</span>
                    </div>
                    <div class="metric-value" style="color:var(--success);">Rank 3.0</div>
                    <div class="metric-label">Posición Orgánica Promedio</div>
                    <p style="margin-top:10px; font-size:13px;">A pesar de no tener deals, mantenemos un posicionamiento orgánico de élite. Esto indica alta relevancia y buena tasa de conversión base.</p>
                </div>
            </div>

            <!-- 4. Eficiencia -->
            <div class="section-title">
                <span class="material-icons">scatter_plot</span>
                4. Eficiencia: Organic Rank vs Click Share
            </div>
            <div class="grid grid-2">
                <div class="card">
                    <div id="efficiency_chart" class="chart-container"></div>
                </div>
                <div class="card">
                    <div class="card-header"><span class="card-title">Análisis de Eficiencia</span></div>
                    <ul class="rec-list">
                        <li><span class="material-icons" style="color:var(--success)">check_circle</span> <strong>Overperformers:</strong> ASINs que logran >5% de share con ranks 1-5. Incite Nutrition está en este cuadrante gracias a su precio atractivo.</li>
                        <li><span class="material-icons" style="color:var(--danger)">warning</span> <strong>Oportunidad:</strong> WeightWorld logra shares masivos (~20%) con ranks similares (1-2) apalancándose en la insignia de Deal.</li>
                        <li><span class="material-icons" style="color:var(--primary)">info</span> <strong>Insight:</strong> El rank orgánico por sí solo tiene un techo de cristal (~8-9% share). Para romper el techo y llegar al 15-20% (nivel líder de categoría), es necesario activar Deal badges.</li>
                    </ul>
                </div>
            </div>

            <!-- 5. Conclusiones y Recomendaciones -->
            <div class="section-title">
                <span class="material-icons">lightbulb</span>
                5. Conclusiones y Plan de Acción
            </div>
            <div class="grid grid-2">
                <div class="card" style="border-left: 5px solid var(--primary);">
                    <div class="card-header"><span class="card-title">Insights Clave</span></div>
                    <ul class="rec-list">
                        <li>1. <strong>Solidez Orgánica:</strong> Incite Nutrition tiene una base muy sana. Sin promociones agresivas, mantiene un share del ~8% y Top 3 en ranking.</li>
                        <li>2. <strong>Sensibilidad al Precio:</strong> El precio de £6.79 es un escudo defensivo efectivo contra marcas premium, pero no suficiente para ganar a los "Deal Hunters".</li>
                        <li>3. <strong>El "Gap" Promocional:</strong> La diferencia entre nuestro 8% de share y el 20% del líder (WeightWorld) se explica casi exclusivamente por los "Limited Time Deals".</li>
                        <li>4. <strong>Competencia Emergente:</strong> Nutrition Geeks está agresivo en visibilidad pagada/orgánica, robando tráfico con formatos de "1 Year Supply".</li>
                        <li>5. <strong>Contención:</strong> Vita Premium está perdiendo fuerza frente a nosotros en las últimas semanas.</li>
                    </ul>
                </div>
                <div class="card" style="border-left: 5px solid var(--success);">
                    <div class="card-header"><span class="card-title">Recomendaciones Accionables</span></div>
                    <ul class="rec-list">
                        <li><span class="material-icons">rocket_launch</span> <strong>Activar Lightning Deals:</strong> Programar deals quincenales para intentar romper la barrera del 10% de share y atacar el dominio de WeightWorld.</li>
                        <li><span class="material-icons">sell</span> <strong>Estrategia de Precio:</strong> Mantener el precio < £7.00. Es nuestra ventaja competitiva única (somos la opción "Value" de calidad). Subir precio ahora erosionaría el rank orgánico.</li>
                        <li><span class="material-icons">view_carousel</span> <strong>Variantes de Volumen:</strong> Evaluar lanzar o potenciar formatos de "365 softgels" o "1 Year Supply" si no son el foco principal, ya que es el estándar de los competidores Top.</li>
                    </ul>
                </div>
            </div>
            
            <!-- 6. Other Insights -->
             <div class="section-title">
                <span class="material-icons">analytics</span>
                6. Other Insights
            </div>
            <div class="card">
                <p><strong>Formato "1 Year Supply":</strong> Se detecta un patrón claro en los títulos de los competidores líderes (Nutrition Geeks, WeightWorld, Nu U). Todos enfatizan "1 Year Supply" o "365/400 Tablets". El consumidor de Vitamin D3 busca valor a largo plazo y conveniencia. Asegurar que nuestro título destaque esta propuesta de valor en los primeros 50 caracteres es crítico para el CTR.</p>
            </div>

        </div>

        <!-- PESTAÑA 2: COMPARADOR INTERACTIVO -->
        <div id="tab-interactive" class="hidden">
            <div class="card" style="margin-bottom: 20px;">
                <div class="grid grid-3" style="align-items: end;">
                    <div>
                        <label style="font-size:12px; font-weight:600; color:var(--text-sec);">Semana a analizar</label>
                        <select id="weekSelector" style="width:100%; margin-top:5px;" onchange="updateInteractive()">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div>
                        <label style="font-size:12px; font-weight:600; color:var(--text-sec);">Competidor a comparar</label>
                        <select id="compSelector" style="width:100%; margin-top:5px;" onchange="updateInteractive()">
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div style="text-align: right; color: var(--text-sec); font-size: 12px;">
                        Comparando <strong>Incite Nutrition</strong> vs Selección
                    </div>
                </div>
            </div>

            <div class="grid grid-4">
                <div class="card">
                    <div class="metric-label">Diferencial de Precio</div>
                    <div id="price-diff" class="metric-value">--</div>
                    <div id="price-desc" style="font-size:12px;">--</div>
                </div>
                <div class="card">
                    <div class="metric-label">Share Gap</div>
                    <div id="share-diff" class="metric-value">--</div>
                    <div id="share-desc" style="font-size:12px;">--</div>
                </div>
                <div class="card">
                    <div class="metric-label">Rank Gap</div>
                    <div id="rank-diff" class="metric-value">--</div>
                    <div id="rank-desc" style="font-size:12px;">--</div>
                </div>
                <div class="card">
                    <div class="metric-label">Promo Status</div>
                    <div id="promo-status" class="metric-value" style="font-size: 20px;">--</div>
                </div>
            </div>
            
            <div class="card" style="margin-top:20px;">
                <div class="card-header"><span class="card-title">Tabla Detallada de la Semana</span></div>
                <div id="table_div"></div>
            </div>
        </div>

    </div>

    <script type="text/javascript">
        // INJECTION OF DATA FROM PYTHON
        // Note: In a real scenario, this JSON is generated by the backend.
        const marketData = [
  {"week_date": "2025-52", "real_brand": "Nu U Nutrition", "product_title": "Nu U Nutrition - Vitamin D 4000IU - 365 Softgel Ca...", "asin": "B07HM81L42", "is_yaba_asin": "N", "click_share": 1.51, "estimated_clicks": 181.68, "average_organic_rank": 13.0, "price": 9.97, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 3.03},
  {"week_date": "2026-03", "real_brand": "Nutrition Geeks", "product_title": "\"Nutrition Geeks, Vitamin D 4000 iu - 1 Year Supply...", "asin": "B0BQCNJ7WR", "is_yaba_asin": "N", "click_share": 5.34, "estimated_clicks": 1095.53, "average_organic_rank": 16.0, "price": 7.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 4.16},
  {"week_date": "2026-01", "real_brand": "Nutrition Geeks", "product_title": "\"Nutrition Geeks, Vitamin D 4000 iu - 1 Year Supply...", "asin": "B0BQCNJ7WR", "is_yaba_asin": "N", "click_share": 3.42, "estimated_clicks": 334.06, "average_organic_rank": 22.0, "price": 7.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 3.66},
  {"week_date": "2026-02", "real_brand": "Nutrition Geeks", "product_title": "\"Nutrition Geeks, Vitamin D 4000 iu - 1 Year Supply...", "asin": "B0BQCNJ7WR", "is_yaba_asin": "N", "click_share": 3.92, "estimated_clicks": 786.52, "average_organic_rank": 18.0, "price": 7.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 3.43},
  {"week_date": "2025-52", "real_brand": "Nutrition Geeks", "product_title": "\"Nutrition Geeks, Vitamin D 4000 iu - 1 Year Supply...", "asin": "B0BQCNJ7WR", "is_yaba_asin": "N", "click_share": 3.81, "estimated_clicks": 458.41, "average_organic_rank": 12.0, "price": 7.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 4.35},
  {"week_date": "2026-01", "real_brand": "Nutrition Geeks", "product_title": "\"Vitamin D 1000iu - 1 Year Supply, 365 Easy-Swallow...", "asin": "B08F5GBD9X", "is_yaba_asin": "N", "click_share": 2.02, "estimated_clicks": 197.31, "average_organic_rank": 10.0, "price": 6.97, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 3.17},
  {"week_date": "2026-02", "real_brand": "Nutrition Geeks", "product_title": "\"Vitamin D 1000iu - 1 Year Supply, 365 Easy-Swallow...", "asin": "B08F5GBD9X", "is_yaba_asin": "N", "click_share": 2.07, "estimated_clicks": 415.33, "average_organic_rank": 8.0, "price": 6.98, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 3.21},
  {"week_date": "2026-03", "real_brand": "Nutrition Geeks", "product_title": "\"Vitamin D 1000iu - 1 Year Supply, 365 Easy-Swallow...", "asin": "B08F5GBD9X", "is_yaba_asin": "N", "click_share": 2.22, "estimated_clicks": 455.44, "average_organic_rank": 7.0, "price": 6.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 3.37},
  {"week_date": "2026-02", "real_brand": "Vita Premium", "product_title": "\"Vitamin D 4,000 IU Softgels, Maximum Strength Vita...", "asin": "B072L235Z5", "is_yaba_asin": "N", "click_share": 5.32, "estimated_clicks": 1067.42, "average_organic_rank": 4.0, "price": 8.03, "weekly_number_of_days_with_deal": 5, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 4.22},
  {"week_date": "2026-03", "real_brand": "Vita Premium", "product_title": "\"Vitamin D 4,000 IU Softgels, Maximum Strength Vita...", "asin": "B072L235Z5", "is_yaba_asin": "N", "click_share": 3.77, "estimated_clicks": 773.43, "average_organic_rank": 6.0, "price": 8.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 3.71},
  {"week_date": "2025-52", "real_brand": "Vita Premium", "product_title": "\"Vitamin D 4,000 IU Softgels, Maximum Strength Vita...", "asin": "B072L235Z5", "is_yaba_asin": "N", "click_share": 6.82, "estimated_clicks": 820.57, "average_organic_rank": 4.0, "price": 8.6, "weekly_number_of_days_with_deal": 2, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 2, "impression_share": 3.66},
  {"week_date": "2026-01", "real_brand": "Vita Premium", "product_title": "\"Vitamin D 4,000 IU Softgels, Maximum Strength Vita...", "asin": "B072L235Z5", "is_yaba_asin": "N", "click_share": 6.44, "estimated_clicks": 629.04, "average_organic_rank": 4.0, "price": 7.64, "weekly_number_of_days_with_deal": 4, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 4.24},
  {"week_date": "2026-02", "real_brand": "Vita Premium", "product_title": "\"Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...", "asin": "B0DJDFKXJT", "is_yaba_asin": "N", "click_share": 3.55, "estimated_clicks": 712.28, "average_organic_rank": 7.0, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 5.26},
  {"week_date": "2026-01", "real_brand": "Vita Premium", "product_title": "\"Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...", "asin": "B0DJDFKXJT", "is_yaba_asin": "N", "click_share": 4.43, "estimated_clicks": 432.71, "average_organic_rank": 7.0, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 5.11},
  {"week_date": "2025-52", "real_brand": "Vita Premium", "product_title": "\"Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...", "asin": "B0DJDFKXJT", "is_yaba_asin": "N", "click_share": 3.85, "estimated_clicks": 463.23, "average_organic_rank": 6.0, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 5.54},
  {"week_date": "2026-03", "real_brand": "Vita Premium", "product_title": "\"Vitamin D 4,000 IU Tablets, Maximum Strength Vitam...", "asin": "B0DJDFKXJT", "is_yaba_asin": "N", "click_share": 3.93, "estimated_clicks": 806.26, "average_organic_rank": 5.0, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 4.98},
  {"week_date": "2026-02", "real_brand": "Vitabiotics Ultra", "product_title": "\"Vitamin D Tablets 2000IU, Vitabiotics Ultra-96 Cou...", "asin": "B075GRYNB8", "is_yaba_asin": "N", "click_share": 1.91, "estimated_clicks": 383.23, "average_organic_rank": 24.0, "price": 3.79, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 1.21},
  {"week_date": "2026-02", "real_brand": "Incite Nutrition", "product_title": "Vitamin D3 4000 IU - 400 High Strength Vitamin D T...", "asin": "B00RXIIW7K", "is_yaba_asin": "Y", "click_share": 9.01, "estimated_clicks": 1807.8, "average_organic_rank": 4.0, "price": 6.96, "weekly_number_of_days_with_deal": 6, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 5.59},
  {"week_date": "2026-01", "real_brand": "Incite Nutrition", "product_title": "Vitamin D3 4000 IU - 400 High Strength Vitamin D T...", "asin": "B00RXIIW7K", "is_yaba_asin": "Y", "click_share": 5.27, "estimated_clicks": 514.76, "average_organic_rank": 5.0, "price": 7.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 4.79},
  {"week_date": "2025-52", "real_brand": "Incite Nutrition", "product_title": "Vitamin D3 4000 IU - 400 High Strength Vitamin D T...", "asin": "B00RXIIW7K", "is_yaba_asin": "Y", "click_share": 6.98, "estimated_clicks": 839.82, "average_organic_rank": 3.0, "price": 7.85, "weekly_number_of_days_with_deal": 1, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 4.72},
  {"week_date": "2026-03", "real_brand": "Incite Nutrition", "product_title": "Vitamin D3 4000 IU - 400 High Strength Vitamin D T...", "asin": "B00RXIIW7K", "is_yaba_asin": "Y", "click_share": 8.18, "estimated_clicks": 1678.17, "average_organic_rank": 4.0, "price": 6.79, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 4.1},
  {"week_date": "2026-03", "real_brand": "Nu U Nutrition", "product_title": "Vitamin D3 4000 IU - 400 Vegetarian Tablets - 13 M...", "asin": "B0BFF8LYR2", "is_yaba_asin": "N", "click_share": 2.33, "estimated_clicks": 478.01, "average_organic_rank": 13.0, "price": 7.53, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 3.71},
  {"week_date": "2025-52", "real_brand": "Nu U Nutrition", "product_title": "Vitamin D3 4000 IU - 400 Vegetarian Tablets - 13 M...", "asin": "B0BFF8LYR2", "is_yaba_asin": "N", "click_share": 1.94, "estimated_clicks": 233.42, "average_organic_rank": 12.0, "price": 6.96, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 3.22},
  {"week_date": "2026-01", "real_brand": "Nu U Nutrition", "product_title": "Vitamin D3 4000 IU - 400 Vegetarian Tablets - 13 M...", "asin": "B0BFF8LYR2", "is_yaba_asin": "N", "click_share": 2.3, "estimated_clicks": 224.66, "average_organic_rank": 9.0, "price": 6.49, "weekly_number_of_days_with_deal": 3, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 3.43},
  {"week_date": "2026-02", "real_brand": "Nu U Nutrition", "product_title": "Vitamin D3 4000 IU - 400 Vegetarian Tablets - 13 M...", "asin": "B0BFF8LYR2", "is_yaba_asin": "N", "click_share": 2.24, "estimated_clicks": 449.44, "average_organic_rank": 12.0, "price": 6.69, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 4.08},
  {"week_date": "2026-02", "real_brand": "G R O U N D E D COFFEE SCRUB", "product_title": "\"Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...", "asin": "B08BRSVYFM", "is_yaba_asin": "N", "click_share": 4.09, "estimated_clicks": 820.63, "average_organic_rank": 6.0, "price": 5.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 4.47},
  {"week_date": "2026-03", "real_brand": "G R O U N D E D COFFEE SCRUB", "product_title": "\"Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...", "asin": "B08BRSVYFM", "is_yaba_asin": "N", "click_share": 3.99, "estimated_clicks": 818.57, "average_organic_rank": 6.0, "price": 5.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 3.99},
  {"week_date": "2026-01", "real_brand": "G R O U N D E D COFFEE SCRUB", "product_title": "\"Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...", "asin": "B08BRSVYFM", "is_yaba_asin": "N", "click_share": 5.18, "estimated_clicks": 505.97, "average_organic_rank": 5.0, "price": 5.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 4, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 4.58},
  {"week_date": "2025-52", "real_brand": "G R O U N D E D COFFEE SCRUB", "product_title": "\"Vitamin D3 4000 IU Micro Tablets - 365 Day Supply,...", "asin": "B08BRSVYFM", "is_yaba_asin": "N", "click_share": 4.56, "estimated_clicks": 548.65, "average_organic_rank": 6.0, "price": 5.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 7, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 4.57},
  {"week_date": "2026-03", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D3 4000 iu & Vitamin K2 MK7 100μg - 1 Year...", "asin": "B0CR57HRDV", "is_yaba_asin": "N", "click_share": 19.91, "estimated_clicks": 4084.63, "average_organic_rank": 4.0, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 6.32},
  {"week_date": "2026-02", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D3 4000 iu & Vitamin K2 MK7 100μg - 1 Year...", "asin": "B0CR57HRDV", "is_yaba_asin": "N", "click_share": 18.56, "estimated_clicks": 3723.94, "average_organic_rank": 5.0, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 6.26},
  {"week_date": "2026-01", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D3 4000 iu & Vitamin K2 MK7 100μg - 1 Year...", "asin": "B0CR57HRDV", "is_yaba_asin": "N", "click_share": 19.01, "estimated_clicks": 1856.85, "average_organic_rank": 5.0, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 6.24},
  {"week_date": "2025-52", "real_brand": "Nutrition Geeks", "product_title": "Vitamin D3 4000 iu & Vitamin K2 MK7 100μg - 1 Year...", "asin": "B0CR57HRDV", "is_yaba_asin": "N", "click_share": 18.64, "estimated_clicks": 2242.74, "average_organic_rank": 4.0, "price": 9.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 6.25},
  {"week_date": "2026-03", "real_brand": "WeightWorld", "product_title": "Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...", "asin": "B086V74KKR", "is_yaba_asin": "N", "click_share": 20.0, "estimated_clicks": 4103.1, "average_organic_rank": 1.0, "price": 8.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 4.88},
  {"week_date": "2025-52", "real_brand": "WeightWorld", "product_title": "Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...", "asin": "B086V74KKR", "is_yaba_asin": "N", "click_share": 18.05, "estimated_clicks": 2171.75, "average_organic_rank": 1.0, "price": 8.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 4.46},
  {"week_date": "2026-02", "real_brand": "WeightWorld", "product_title": "Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...", "asin": "B086V74KKR", "is_yaba_asin": "N", "click_share": 19.32, "estimated_clicks": 3876.43, "average_organic_rank": 1.0, "price": 8.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 4.73},
  {"week_date": "2026-01", "real_brand": "WeightWorld", "product_title": "Vitamin D3 4000IU - 1+ Year Supply - 400 Tablets -...", "asin": "B086V74KKR", "is_yaba_asin": "N", "click_share": 17.88, "estimated_clicks": 1746.47, "average_organic_rank": 1.0, "price": 8.99, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 4.42},
  {"week_date": "2026-01", "real_brand": "Zipvit", "product_title": "\"Zipvit Vitamin D3 4000 IU, 360 Maximum Strength Vi...", "asin": "B079H1NVYY", "is_yaba_asin": "N", "click_share": 2.27, "estimated_clicks": 221.73, "average_organic_rank": 10.0, "price": 7.49, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 3.5},
  {"week_date": "2025-52", "real_brand": "Zipvit", "product_title": "\"Zipvit Vitamin D3 4000 IU, 360 Maximum Strength Vi...", "asin": "B079H1NVYY", "is_yaba_asin": "N", "click_share": 1.51, "estimated_clicks": 181.68, "average_organic_rank": 15.0, "price": 8.2, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 2.93},
  {"week_date": "2026-03", "real_brand": "Zipvit", "product_title": "\"Zipvit Vitamin D3 4000 IU, 360 Maximum Strength Vi...", "asin": "B079H1NVYY", "is_yaba_asin": "N", "click_share": 1.72, "estimated_clicks": 352.87, "average_organic_rank": 17.0, "price": 7.8, "weekly_number_of_days_with_deal": 3, "weekly_number_of_days_with_coupon": 0, "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "impression_share": 2.58}
];

        const ourBrand = "Incite Nutrition";
        const topCompetitors = ['WeightWorld', 'Nutrition Geeks', 'Vita Premium'];

        // GOOGLE CHARTS SETUP
        google.charts.load('current', {'packages':['corechart', 'table']});
        google.charts.setOnLoadCallback(drawCharts);

        function drawCharts() {
            // 1. TREND CHART (Global)
            const trendData = [['Week', 'Our Clicks', 'Market Clicks', 'Our Share (%)']];
            const weeks = [...new Set(marketData.map(d => d.week_date))].sort();
            
            weeks.forEach(week => {
                const weekData = marketData.filter(d => d.week_date === week);
                const ourClicks = weekData.filter(d => d.real_brand === ourBrand).reduce((sum, d) => sum + d.estimated_clicks, 0);
                const marketClicks = weekData.reduce((sum, d) => sum + d.estimated_clicks, 0);
                const ourShare = weekData.filter(d => d.real_brand === ourBrand).reduce((sum, d) => sum + d.click_share, 0);
                
                trendData.push([week, ourClicks, marketClicks, ourShare]);
            });

            const trendTable = google.visualization.arrayToDataTable(trendData);
            const trendOptions = {
                seriesType: 'bars',
                series: {
                    0: { color: '#007AFF' },
                    1: { color: '#E5E5EA' },
                    2: { type: 'line', targetAxisIndex: 1, color: '#FF9500', lineWidth: 3 }
                },
                vAxes: {
                    0: { title: 'Clicks Estimados' },
                    1: { title: 'Click Share %', format: '#\'%\'' }
                },
                legend: { position: 'bottom' },
                chartArea: { width: '80%', height: '70%' }
            };
            new google.visualization.ComboChart(document.getElementById('trend_chart')).draw(trendTable, trendOptions);

            // 2. BRAND CHART (Competitor Lines)
            const brandDataHeader = ['Week', ourBrand, ...topCompetitors, 'Others'];
            const brandDataRows = weeks.map(week => {
                const weekData = marketData.filter(d => d.week_date === week);
                const getShare = (brand) => weekData.filter(d => d.real_brand === brand).reduce((sum, d) => sum + d.click_share, 0);
                
                const s1 = getShare(ourBrand);
                const s2 = getShare(topCompetitors[0]);
                const s3 = getShare(topCompetitors[1]);
                const s4 = getShare(topCompetitors[2]);
                const totalShare = weekData.reduce((sum, d) => sum + d.click_share, 0);
                const others = totalShare - s1 - s2 - s3 - s4;
                
                return [week, s1, s2, s3, s4, Math.max(0, others)];
            });
            
            const brandTable = google.visualization.arrayToDataTable([brandDataHeader, ...brandDataRows]);
            const brandOptions = {
                curveType: 'function',
                lineWidth: 2.5,
                colors: ['#007AFF', '#FF3B30', '#34C759', '#AF52DE', '#8E8E93'],
                legend: { position: 'bottom' },
                chartArea: { width: '85%', height: '70%' },
                vAxis: { title: 'Click Share %' }
            };
            new google.visualization.LineChart(document.getElementById('brand_chart')).draw(brandTable, brandOptions);

            // 3. EFFICIENCY CHART (Scatter Rank vs Share)
            // Filter only last week for clarity
            const lastWeek = weeks[weeks.length - 1];
            const effData = [['ASIN', 'Organic Rank', 'Click Share', 'Brand', 'Size']];
            
            marketData.filter(d => d.week_date === lastWeek).forEach(d => {
                // Invert rank for visual (Higher Y = Better Rank) or standard (Lower X = Better Rank). 
                // Let's do: X=Rank (reversed), Y=Share.
                // Note: Google Charts Scatter doesn't support categorical colors easily without style columns.
                // Simplified: Group by Brand for tooltip.
                effData.push([
                    d.product_title.substring(0, 20) + '...', 
                    d.average_organic_rank, 
                    d.click_share, 
                    d.real_brand,
                    d.estimated_clicks // Size bubble
                ]);
            });

            // Convert to DataTable to use roles for coloring if needed, simplified here:
            // Actually, simple scatter is messy with multiple series. Let's stick to simple Scatter.
            const effTable = google.visualization.arrayToDataTable(effData);
            const effOptions = {
                hAxis: { title: 'Organic Rank (Lower is Better)', direction: 1 },
                vAxis: { title: 'Click Share %' },
                legend: { position: 'none' },
                bubble: { textStyle: { fontSize: 10 } },
                colorAxis: { colors: ['#007AFF', '#FF3B30'] }, // Gradient based on brand string hash? No, just simple.
                chartArea: { width: '85%', height: '70%' }
            };
            new google.visualization.BubbleChart(document.getElementById('efficiency_chart')).draw(effTable, effOptions);
            
            // POPULATE INTERACTIVE SELECTORS
            const weekSel = document.getElementById('weekSelector');
            const compSel = document.getElementById('compSelector');
            
            if (weekSel.options.length === 0) {
                weeks.forEach(w => weekSel.add(new Option(w, w)));
                weekSel.value = weeks[weeks.length-1]; // Select last
                
                // Get all brands except ours
                const allComps = [...new Set(marketData.map(d => d.real_brand))].filter(b => b !== ourBrand).sort();
                allComps.forEach(c => compSel.add(new Option(c, c)));
                compSel.value = topCompetitors[0];
                
                updateInteractive();
            }
        }

        function switchTab(tabId) {
            document.getElementById('tab-static').classList.add('hidden');
            document.getElementById('tab-interactive').classList.add('hidden');
            document.querySelector('.tab-btn.active').classList.remove('active');
            
            document.getElementById('tab-' + tabId).classList.remove('hidden');
            event.target.classList.add('active');
            
            if(tabId === 'static') drawCharts(); // Redraw to fix dimension bugs
        }

        function updateInteractive() {
            const week = document.getElementById('weekSelector').value;
            const comp = document.getElementById('compSelector').value;
            
            const weekData = marketData.filter(d => d.week_date === week);
            const ourData = weekData.filter(d => d.real_brand === ourBrand);
            const compData = weekData.filter(d => d.real_brand === comp);
            
            // AGGREGATE METRICS
            const calcAvg = (data, key) => {
                if(!data.length) return 0;
                const total = data.reduce((sum, d) => sum + (d[key] || 0), 0);
                return total / data.length;
            };
            const calcSum = (data, key) => data.reduce((sum, d) => sum + (d[key] || 0), 0);

            const ourPrice = calcAvg(ourData, 'price');
            const compPrice = calcAvg(compData, 'price');
            const ourShare = calcSum(ourData, 'click_share');
            const compShare = calcSum(compData, 'click_share');
            const ourRank = calcAvg(ourData, 'average_organic_rank');
            const compRank = calcAvg(compData, 'average_organic_rank');
            const ourDeals = calcSum(ourData, 'weekly_number_of_days_with_deal');
            const compDeals = calcSum(compData, 'weekly_number_of_days_with_deal');

            // UPDATE CARDS
            const setDiff = (id, val, desc) => {
                const el = document.getElementById(id);
                const elDesc = document.getElementById(id.replace('diff', 'desc')); // hacky but works based on IDs
                el.innerText = val.toFixed(2);
                elDesc.innerText = desc;
                
                // Color logic
                if(id.includes('price')) el.style.color = (val < 0) ? 'var(--success)' : 'var(--danger)'; // Cheaper is green
                else if(id.includes('share')) el.style.color = (val > 0) ? 'var(--success)' : 'var(--danger)'; // More share is green
                else if(id.includes('rank')) el.style.color = (val < 0) ? 'var(--success)' : 'var(--danger)'; // Lower rank (negative diff) is green
            };

            setDiff('price-diff', ourPrice - compPrice, (ourPrice < compPrice ? 'Más barato' : 'Más caro'));
            setDiff('share-diff', ourShare - compShare, (ourShare > compShare ? 'Ganando' : 'Perdiendo'));
            setDiff('rank-diff', ourRank - compRank, (ourRank < compRank ? 'Mejor Rank' : 'Peor Rank'));
            
            document.getElementById('promo-status').innerText = 
                `${ourDeals}d vs ${compDeals}d`;

            // UPDATE TABLE
            const tableData = [['ASIN', 'Product', 'Price', 'Rank', 'Share', 'Deals']];
            [...ourData, ...compData].forEach(d => {
                tableData.push([
                    d.asin,
                    d.product_title.substring(0, 30) + '...',
                    d.price,
                    d.average_organic_rank,
                    d.click_share,
                    d.weekly_number_of_days_with_deal
                ]);
            });

            const data = google.visualization.arrayToDataTable(tableData);
            const options = { width: '100%', height: '100%' };
            new google.visualization.Table(document.getElementById('table_div')).draw(data, options);
        }
    </script>
</body>
</html>