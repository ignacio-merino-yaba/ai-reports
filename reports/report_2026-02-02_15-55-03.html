<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Intelligence Report: Parent ASIN Analysis</title>
    
    <!-- Google Charts Loader -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    
    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #4285F4;
            --success: #34A853;
            --warning: #FBBC05;
            --danger: #EA4335;
            --gray: #5F6368;
            --bg-light: #F8F9FA;
            --card-bg: #FFFFFF;
            --border-radius: 16px;
            --shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light);
            margin: 0;
            padding: 0;
            color: #202124;
            -webkit-font-smoothing: antialiased;
        }

        /* Layout & Grid */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .col-12 { grid-column: span 12; }
        .col-6 { grid-column: span 6; }
        .col-4 { grid-column: span 4; }
        .col-8 { grid-column: span 8; }

        @media (max-width: 768px) {
            .col-6, .col-4, .col-8 { grid-column: span 12; }
        }

        /* Components */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--shadow);
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #202124;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }

        .stat-label {
            font-size: 14px;
            color: var(--gray);
        }

        .badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }
        .badge-trend-up { background: #E6F4EA; color: var(--success); }
        .badge-trend-down { background: #FCE8E6; color: var(--danger); }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            background: #fff;
            padding: 8px;
            border-radius: 12px;
            width: fit-content;
            box-shadow: var(--shadow);
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            color: var(--gray);
            transition: all 0.2s;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Charts */
        .chart-container {
            width: 100%;
            height: 350px;
            position: relative;
        }

        /* Insights List */
        .insight-item {
            display: flex;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        .insight-item:last-child { border-bottom: none; }
        .insight-icon { color: var(--warning); }
        .insight-text { font-size: 14px; line-height: 1.5; }

        /* Interactive Controls */
        select {
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid #dadce0;
            font-size: 14px;
            background: white;
            min-width: 200px;
        }

        /* Comparison Table */
        .comp-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        .comp-table th { text-align: left; color: var(--gray); font-weight: 500; padding: 12px; border-bottom: 1px solid #eee; }
        .comp-table td { padding: 16px 12px; border-bottom: 1px solid #eee; font-weight: 500; }
        .comp-table .brand-us { color: var(--primary); }
        .comp-table .brand-them { color: var(--danger); }

        .vs-badge {
            background: #f1f3f4;
            color: #5f6368;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            margin: 0 8px;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- Header -->
        <header style="margin-bottom: 32px;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <span class="material-icons" style="color: var(--primary); font-size: 36px;">analytics</span>
                <h1 style="margin: 0; font-size: 28px;">Market Intelligence: Parent ASIN Report</h1>
            </div>
            <p style="color: var(--gray); margin-top: 8px;">Analysis of performance, competition, and efficiency levers.</p>
        </header>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('static')">Reporte Estático</button>
            <button class="tab-btn" onclick="switchTab('interactive')">Comparador Interactivo</button>
        </div>

        <!-- TAB 1: STATIC REPORT -->
        <div id="report-static">
            
            <!-- Section 1: Global Trend -->
            <div class="grid">
                <div class="col-12 card">
                    <div class="card-header">
                        <h2 class="card-title">1. Tendencia Global del Parent (Volume vs. Share)</h2>
                        <div id="trend-badge" class="badge">Last Week</div>
                    </div>
                    <div id="chart_trend" class="chart-container"></div>
                    <div style="margin-top: 16px; font-size: 13px; color: var(--gray); text-align: center;">
                        Barras: Volumen Total de Mercado (Clicks) | Línea: Nuestra Cuota de Click Share
                    </div>
                </div>
            </div>

            <!-- Section 2: Brand Competitiveness -->
            <div class="grid">
                <div class="col-8 card">
                    <div class="card-header">
                        <h2 class="card-title">2. Competitividad de Marca (Click Share History)</h2>
                    </div>
                    <div id="chart_competitiveness" class="chart-container"></div>
                </div>
                <div class="col-4 card" style="background: #F8F9FA; border: none; box-shadow: none;">
                    <h3 class="card-title" style="margin-bottom: 16px;">Top Competitors</h3>
                    <div id="top-competitors-list">
                        <!-- Filled by JS -->
                    </div>
                </div>
            </div>

            <!-- Section 3 & 4: Levers & Efficiency -->
            <div class="grid">
                <div class="col-6 card">
                    <div class="card-header">
                        <h2 class="card-title">3. Organic Rank vs. Click Share (Eficiencia)</h2>
                        <span class="material-icons" style="color: var(--gray)" title="Upper Left = High Efficiency">info</span>
                    </div>
                    <div id="chart_efficiency" class="chart-container"></div>
                </div>
                <div class="col-6 card">
                    <div class="card-header">
                        <h2 class="card-title">4. Palancas de Conversión (Levers)</h2>
                    </div>
                    <div id="levers-analysis" style="display: flex; flex-direction: column; gap: 16px;">
                        <!-- Filled by JS -->
                    </div>
                </div>
            </div>

            <!-- Section 5: Insights & Recommendations -->
            <div class="grid">
                <div class="col-6 card" style="border-left: 4px solid var(--primary);">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span class="material-icons" style="color: var(--primary);">lightbulb</span>
                            Conclusiones Clave (Insights)
                        </h2>
                    </div>
                    <div id="insights-container"></div>
                </div>
                <div class="col-6 card" style="border-left: 4px solid var(--success);">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span class="material-icons" style="color: var(--success);">task_alt</span>
                            Recomendaciones Accionables
                        </h2>
                    </div>
                    <div id="recommendations-container"></div>
                </div>
            </div>
        </div>

        <!-- TAB 2: INTERACTIVE COMPARATOR -->
        <div id="report-interactive" style="display: none;">
            <div class="card col-12" style="margin-bottom: 24px;">
                <div style="display: flex; gap: 24px; align-items: flex-end; padding-bottom: 20px; border-bottom: 1px solid #eee;">
                    <div>
                        <label style="display: block; font-size: 12px; color: var(--gray); margin-bottom: 8px;">Seleccionar Semana</label>
                        <select id="weekSelect" onchange="renderInteractive()"></select>
                    </div>
                    <div>
                        <label style="display: block; font-size: 12px; color: var(--gray); margin-bottom: 8px;">Comparar Contra</label>
                        <select id="compSelect" onchange="renderInteractive()"></select>
                    </div>
                </div>

                <div class="grid" style="margin-top: 24px;">
                    <!-- Head to Head Metrics -->
                    <div class="col-4">
                        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                            <div style="color: var(--gray); font-size: 14px; margin-bottom: 8px;">Diferencial de Precio</div>
                            <div id="h2h-price" style="font-size: 24px; font-weight: bold;">--</div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                            <div style="color: var(--gray); font-size: 14px; margin-bottom: 8px;">Gap de Organic Rank</div>
                            <div id="h2h-rank" style="font-size: 24px; font-weight: bold;">--</div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                            <div style="color: var(--gray); font-size: 14px; margin-bottom: 8px;">Cuota Relativa (Share)</div>
                            <div id="h2h-share" style="font-size: 24px; font-weight: bold;">--</div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 24px;">
                    <h3 style="font-size: 16px; margin-bottom: 16px;">Detalle por Keyword (Top 5 Volumen)</h3>
                    <div id="h2h-table-container"></div>
                </div>
            </div>
        </div>

    </div>

    <script type="text/javascript">
        // 1. DATA INJECTION (Synthesized from Python Step)
        const marketData = {"raw_data": [{"week_date": "2023-10-01", "keywords": "protein powder", "asin": "B00_OURS", "parent_asin": "P_OURS", "product_title": "TitanFit Whey Protein Isolate", "competitor_brand": "TitanFit", "is_yaba_asin": "Y", "price": 30.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 2, "click_share": 0.36, "weekly_search_volume": 3044, "keywords_link": "http://amazon.com/s?k=protein powder", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "TitanFit", "clicks": 1095.84}, {"week_date": "2023-10-01", "keywords": "protein powder", "asin": "B00_COMP1", "parent_asin": "P_COMP1", "product_title": "MuscleMax Gold Standard", "competitor_brand": "MuscleMax", "is_yaba_asin": "N", "price": 45.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "average_organic_rank": 1, "click_share": 0.44, "weekly_search_volume": 3358, "keywords_link": "http://amazon.com/s?k=protein powder", "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "MuscleMax", "clicks": 1477.52}, {"week_date": "2023-10-01", "keywords": "protein powder", "asin": "B00_COMP2", "parent_asin": "P_COMP2", "product_title": "GymPro Cheap Protein", "competitor_brand": "GymPro", "is_yaba_asin": "N", "price": 25.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 12, "click_share": 0.2, "weekly_search_volume": 3810, "keywords_link": "http://amazon.com/s?k=protein powder", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 3, "grams": 900, "organic_or_not": "Organic", "container": "Bag", "resolved_brand": "GymPro", "clicks": 762.0}, {"week_date": "2023-10-01", "keywords": "protein powder", "asin": "B00_UNKN", "parent_asin": "P_UNKN", "product_title": "Generic Protein Powder 1kg", "competitor_brand": null, "is_yaba_asin": "N", "price": 20.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 30, "click_share": 0.01, "weekly_search_volume": 1300, "keywords_link": "http://amazon.com/s?k=protein powder", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "Generic", "clicks": 13.0}, {"week_date": "2023-10-01", "keywords": "whey protein", "asin": "B00_OURS", "parent_asin": "P_OURS", "product_title": "TitanFit Whey Protein Isolate", "competitor_brand": "TitanFit", "is_yaba_asin": "Y", "price": 30.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 9, "click_share": 0.22, "weekly_search_volume": 4171, "keywords_link": "http://amazon.com/s?k=whey protein", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "TitanFit", "clicks": 917.62}, {"week_date": "2023-10-01", "keywords": "whey protein", "asin": "B00_COMP1", "parent_asin": "P_COMP1", "product_title": "MuscleMax Gold Standard", "competitor_brand": "MuscleMax", "is_yaba_asin": "N", "price": 45.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "average_organic_rank": 4, "click_share": 0.32, "weekly_search_volume": 2276, "keywords_link": "http://amazon.com/s?k=whey protein", "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "MuscleMax", "clicks": 728.32}, {"week_date": "2023-10-01", "keywords": "whey protein", "asin": "B00_COMP2", "parent_asin": "P_COMP2", "product_title": "GymPro Cheap Protein", "competitor_brand": "GymPro", "is_yaba_asin": "N", "price": 25.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 17, "click_share": 0.1, "weekly_search_volume": 2034, "keywords_link": "http://amazon.com/s?k=whey protein", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 3, "grams": 900, "organic_or_not": "Organic", "container": "Bag", "resolved_brand": "GymPro", "clicks": 203.4}, {"week_date": "2023-10-01", "keywords": "whey protein", "asin": "B00_UNKN", "parent_asin": "P_UNKN", "product_title": "Generic Protein Powder 1kg", "competitor_brand": null, "is_yaba_asin": "N", "price": 20.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 30, "click_share": 0.09, "weekly_search_volume": 3321, "keywords_link": "http://amazon.com/s?k=whey protein", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "Generic", "clicks": 298.89}, {"week_date": "2023-10-01", "keywords": "muscle gain supplement", "asin": "B00_OURS", "parent_asin": "P_OURS", "product_title": "TitanFit Whey Protein Isolate", "competitor_brand": "TitanFit", "is_yaba_asin": "Y", "price": 30.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 1, "click_share": 0.38, "weekly_search_volume": 2614, "keywords_link": "http://amazon.com/s?k=muscle gain supplement", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "TitanFit", "clicks": 993.32}, {"week_date": "2023-10-01", "keywords": "muscle gain supplement", "asin": "B00_COMP1", "parent_asin": "P_COMP1", "product_title": "MuscleMax Gold Standard", "competitor_brand": "MuscleMax", "is_yaba_asin": "N", "price": 45.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "average_organic_rank": 10, "click_share": 0.2, "weekly_search_volume": 3699, "keywords_link": "http://amazon.com/s?k=muscle gain supplement", "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "MuscleMax", "clicks": 739.8000000000001}, {"week_date": "2023-10-01", "keywords": "muscle gain supplement", "asin": "B00_COMP2", "parent_asin": "P_COMP2", "product_title": "GymPro Cheap Protein", "competitor_brand": "GymPro", "is_yaba_asin": "N", "price": 25.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 4, "click_share": 0.36, "weekly_search_volume": 2462, "keywords_link": "http://amazon.com/s?k=muscle gain supplement", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 3, "grams": 900, "organic_or_not": "Organic", "container": "Bag", "resolved_brand": "GymPro", "clicks": 886.3199999999999}, {"week_date": "2023-10-01", "keywords": "muscle gain supplement", "asin": "B00_UNKN", "parent_asin": "P_UNKN", "product_title": "Generic Protein Powder 1kg", "competitor_brand": null, "is_yaba_asin": "N", "price": 20.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 30, "click_share": 0.11, "weekly_search_volume": 3725, "keywords_link": "http://amazon.com/s?k=muscle gain supplement", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "Generic", "clicks": 409.75}, {"week_date": "2023-10-08", "keywords": "protein powder", "asin": "B00_OURS", "parent_asin": "P_OURS", "product_title": "TitanFit Whey Protein Isolate", "competitor_brand": "TitanFit", "is_yaba_asin": "Y", "price": 30.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 3, "click_share": 0.34, "weekly_search_volume": 1608, "keywords_link": "http://amazon.com/s?k=protein powder", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "TitanFit", "clicks": 546.72}, {"week_date": "2023-10-08", "keywords": "protein powder", "asin": "B00_COMP1", "parent_asin": "P_COMP1", "product_title": "MuscleMax Gold Standard", "competitor_brand": "MuscleMax", "is_yaba_asin": "N", "price": 45.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "average_organic_rank": 2, "click_share": 0.36, "weekly_search_volume": 1820, "keywords_link": "http://amazon.com/s?k=protein powder", "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "MuscleMax", "clicks": 655.1999999999999}, {"week_date": "2023-10-08", "keywords": "protein powder", "asin": "B00_COMP2", "parent_asin": "P_COMP2", "product_title": "GymPro Cheap Protein", "competitor_brand": "GymPro", "is_yaba_asin": "N", "price": 20.0, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 14, "click_share": 0.26, "weekly_search_volume": 3080, "keywords_link": "http://amazon.com/s?k=protein powder", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 3, "grams": 900, "organic_or_not": "Organic", "container": "Bag", "resolved_brand": "GymPro", "clicks": 800.8000000000001}, {"week_date": "2023-10-08", "keywords": "protein powder", "asin": "B00_UNKN", "parent_asin": "P_UNKN", "product_title": "Generic Protein Powder 1kg", "competitor_brand": null, "is_yaba_asin": "N", "price": 20.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 30, "click_share": 0.06, "weekly_search_volume": 2241, "keywords_link": "http://amazon.com/s?k=protein powder", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "Generic", "clicks": 134.46}, {"week_date": "2023-10-08", "keywords": "whey protein", "asin": "B00_OURS", "parent_asin": "P_OURS", "product_title": "TitanFit Whey Protein Isolate", "competitor_brand": "TitanFit", "is_yaba_asin": "Y", "price": 30.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 5, "click_share": 0.3, "weekly_search_volume": 3116, "keywords_link": "http://amazon.com/s?k=whey protein", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "TitanFit", "clicks": 934.8}, {"week_date": "2023-10-08", "keywords": "whey protein", "asin": "B00_COMP1", "parent_asin": "P_COMP1", "product_title": "MuscleMax Gold Standard", "competitor_brand": "MuscleMax", "is_yaba_asin": "N", "price": 45.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "average_organic_rank": 10, "click_share": 0.2, "weekly_search_volume": 3638, "keywords_link": "http://amazon.com/s?k=whey protein", "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "MuscleMax", "clicks": 727.6}, {"week_date": "2023-10-08", "keywords": "whey protein", "asin": "B00_COMP2", "parent_asin": "P_COMP2", "product_title": "GymPro Cheap Protein", "competitor_brand": "GymPro", "is_yaba_asin": "N", "price": 20.0, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 10, "click_share": 0.34, "weekly_search_volume": 3377, "keywords_link": "http://amazon.com/s?k=whey protein", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 3, "grams": 900, "organic_or_not": "Organic", "container": "Bag", "resolved_brand": "GymPro", "clicks": 1148.18}, {"week_date": "2023-10-08", "keywords": "whey protein", "asin": "B00_UNKN", "parent_asin": "P_UNKN", "product_title": "Generic Protein Powder 1kg", "competitor_brand": null, "is_yaba_asin": "N", "price": 20.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 30, "click_share": 0.19, "weekly_search_volume": 1356, "keywords_link": "http://amazon.com/s?k=whey protein", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "Generic", "clicks": 257.64}, {"week_date": "2023-10-08", "keywords": "muscle gain supplement", "asin": "B00_OURS", "parent_asin": "P_OURS", "product_title": "TitanFit Whey Protein Isolate", "competitor_brand": "TitanFit", "is_yaba_asin": "Y", "price": 30.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 9, "click_share": 0.22, "weekly_search_volume": 1001, "keywords_link": "http://amazon.com/s?k=muscle gain supplement", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "TitanFit", "clicks": 220.22}, {"week_date": "2023-10-08", "keywords": "muscle gain supplement", "asin": "B00_COMP1", "parent_asin": "P_COMP1", "product_title": "MuscleMax Gold Standard", "competitor_brand": "MuscleMax", "is_yaba_asin": "N", "price": 45.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "average_organic_rank": 8, "click_share": 0.24, "weekly_search_volume": 1112, "keywords_link": "http://amazon.com/s?k=muscle gain supplement", "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "MuscleMax", "clicks": 266.88}, {"week_date": "2023-10-08", "keywords": "muscle gain supplement", "asin": "B00_COMP2", "parent_asin": "P_COMP2", "product_title": "GymPro Cheap Protein", "competitor_brand": "GymPro", "is_yaba_asin": "N", "price": 20.0, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 11, "click_share": 0.32, "weekly_search_volume": 2992, "keywords_link": "http://amazon.com/s?k=muscle gain supplement", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 3, "grams": 900, "organic_or_not": "Organic", "container": "Bag", "resolved_brand": "GymPro", "clicks": 957.44}, {"week_date": "2023-10-08", "keywords": "muscle gain supplement", "asin": "B00_UNKN", "parent_asin": "P_UNKN", "product_title": "Generic Protein Powder 1kg", "competitor_brand": null, "is_yaba_asin": "N", "price": 20.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 30, "click_share": 0.02, "weekly_search_volume": 4020, "keywords_link": "http://amazon.com/s?k=muscle gain supplement", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "Generic", "clicks": 80.4}, {"week_date": "2023-10-15", "keywords": "protein powder", "asin": "B00_OURS", "parent_asin": "P_OURS", "product_title": "TitanFit Whey Protein Isolate", "competitor_brand": "TitanFit", "is_yaba_asin": "Y", "price": 24.0, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 9, "click_share": 0.48, "weekly_search_volume": 1519, "keywords_link": "http://amazon.com/s?k=protein powder", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "TitanFit", "clicks": 729.12}, {"week_date": "2023-10-15", "keywords": "protein powder", "asin": "B00_COMP1", "parent_asin": "P_COMP1", "product_title": "MuscleMax Gold Standard", "competitor_brand": "MuscleMax", "is_yaba_asin": "N", "price": 45.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "average_organic_rank": 1, "click_share": 0.46, "weekly_search_volume": 4841, "keywords_link": "http://amazon.com/s?k=protein powder", "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "MuscleMax", "clicks": 2226.86}, {"week_date": "2023-10-15", "keywords": "protein powder", "asin": "B00_COMP2", "parent_asin": "P_COMP2", "product_title": "GymPro Cheap Protein", "competitor_brand": "GymPro", "is_yaba_asin": "N", "price": 25.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 11, "click_share": 0.22, "weekly_search_volume": 1582, "keywords_link": "http://amazon.com/s?k=protein powder", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 3, "grams": 900, "organic_or_not": "Organic", "container": "Bag", "resolved_brand": "GymPro", "clicks": 348.04}, {"week_date": "2023-10-15", "keywords": "protein powder", "asin": "B00_UNKN", "parent_asin": "P_UNKN", "product_title": "Generic Protein Powder 1kg", "competitor_brand": null, "is_yaba_asin": "N", "price": 20.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 30, "click_share": 0.14, "weekly_search_volume": 3352, "keywords_link": "http://amazon.com/s?k=protein powder", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "Generic", "clicks": 469.28000000000003}, {"week_date": "2023-10-15", "keywords": "whey protein", "asin": "B00_OURS", "parent_asin": "P_OURS", "product_title": "TitanFit Whey Protein Isolate", "competitor_brand": "TitanFit", "is_yaba_asin": "Y", "price": 24.0, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 12, "click_share": 0.39, "weekly_search_volume": 4446, "keywords_link": "http://amazon.com/s?k=whey protein", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "TitanFit", "clicks": 1733.94}, {"week_date": "2023-10-15", "keywords": "whey protein", "asin": "B00_COMP1", "parent_asin": "P_COMP1", "product_title": "MuscleMax Gold Standard", "competitor_brand": "MuscleMax", "is_yaba_asin": "N", "price": 45.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "average_organic_rank": 14, "click_share": 0.12, "weekly_search_volume": 3181, "keywords_link": "http://amazon.com/s?k=whey protein", "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "MuscleMax", "clicks": 381.71999999999997}, {"week_date": "2023-10-15", "keywords": "whey protein", "asin": "B00_COMP2", "parent_asin": "P_COMP2", "product_title": "GymPro Cheap Protein", "competitor_brand": "GymPro", "is_yaba_asin": "N", "price": 25.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 6, "click_share": 0.32, "weekly_search_volume": 4937, "keywords_link": "http://amazon.com/s?k=whey protein", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 3, "grams": 900, "organic_or_not": "Organic", "container": "Bag", "resolved_brand": "GymPro", "clicks": 1579.8400000000001}, {"week_date": "2023-10-15", "keywords": "whey protein", "asin": "B00_UNKN", "parent_asin": "P_UNKN", "product_title": "Generic Protein Powder 1kg", "competitor_brand": null, "is_yaba_asin": "N", "price": 20.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 30, "click_share": 0.08, "weekly_search_volume": 3233, "keywords_link": "http://amazon.com/s?k=whey protein", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "Generic", "clicks": 258.64}, {"week_date": "2023-10-15", "keywords": "muscle gain supplement", "asin": "B00_OURS", "parent_asin": "P_OURS", "product_title": "TitanFit Whey Protein Isolate", "competitor_brand": "TitanFit", "is_yaba_asin": "Y", "price": 24.0, "weekly_number_of_days_with_deal": 7, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 8, "click_share": 0.51, "weekly_search_volume": 4411, "keywords_link": "http://amazon.com/s?k=muscle gain supplement", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "TitanFit", "clicks": 2249.61}, {"week_date": "2023-10-15", "keywords": "muscle gain supplement", "asin": "B00_COMP1", "parent_asin": "P_COMP1", "product_title": "MuscleMax Gold Standard", "competitor_brand": "MuscleMax", "is_yaba_asin": "N", "price": 45.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "average_organic_rank": 7, "click_share": 0.26, "weekly_search_volume": 2753, "keywords_link": "http://amazon.com/s?k=muscle gain supplement", "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "MuscleMax", "clicks": 715.78}, {"week_date": "2023-10-15", "keywords": "muscle gain supplement", "asin": "B00_COMP2", "parent_asin": "P_COMP2", "product_title": "GymPro Cheap Protein", "competitor_brand": "GymPro", "is_yaba_asin": "N", "price": 25.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 12, "click_share": 0.2, "weekly_search_volume": 1087, "keywords_link": "http://amazon.com/s?k=muscle gain supplement", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 3, "grams": 900, "organic_or_not": "Organic", "container": "Bag", "resolved_brand": "GymPro", "clicks": 217.4}, {"week_date": "2023-10-15", "keywords": "muscle gain supplement", "asin": "B00_UNKN", "parent_asin": "P_UNKN", "product_title": "Generic Protein Powder 1kg", "competitor_brand": null, "is_yaba_asin": "N", "price": 20.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 30, "click_share": 0.11, "weekly_search_volume": 1660, "keywords_link": "http://amazon.com/s?k=muscle gain supplement", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "Generic", "clicks": 182.6}, {"week_date": "2023-10-22", "keywords": "protein powder", "asin": "B00_OURS", "parent_asin": "P_OURS", "product_title": "TitanFit Whey Protein Isolate", "competitor_brand": "TitanFit", "is_yaba_asin": "Y", "price": 30.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "average_organic_rank": 5, "click_share": 0.3, "weekly_search_volume": 2012, "keywords_link": "http://amazon.com/s?k=protein powder", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "TitanFit", "clicks": 603.6}, {"week_date": "2023-10-22", "keywords": "protein powder", "asin": "B00_COMP1", "parent_asin": "P_COMP1", "product_title": "MuscleMax Gold Standard", "competitor_brand": "MuscleMax", "is_yaba_asin": "N", "price": 45.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "average_organic_rank": 1, "click_share": 0.42, "weekly_search_volume": 4476, "keywords_link": "http://amazon.com/s?k=protein powder", "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "MuscleMax", "clicks": 1879.9199999999998}, {"week_date": "2023-10-22", "keywords": "protein powder", "asin": "B00_COMP2", "parent_asin": "P_COMP2", "product_title": "GymPro Cheap Protein", "competitor_brand": "GymPro", "is_yaba_asin": "N", "price": 25.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 17, "click_share": 0.1, "weekly_search_volume": 4912, "keywords_link": "http://amazon.com/s?k=protein powder", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 3, "grams": 900, "organic_or_not": "Organic", "container": "Bag", "resolved_brand": "GymPro", "clicks": 491.20000000000005}, {"week_date": "2023-10-22", "keywords": "protein powder", "asin": "B00_UNKN", "parent_asin": "P_UNKN", "product_title": "Generic Protein Powder 1kg", "competitor_brand": null, "is_yaba_asin": "N", "price": 20.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 30, "click_share": 0.09, "weekly_search_volume": 2964, "keywords_link": "http://amazon.com/s?k=protein powder", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "Generic", "clicks": 266.76}, {"week_date": "2023-10-22", "keywords": "whey protein", "asin": "B00_OURS", "parent_asin": "P_OURS", "product_title": "TitanFit Whey Protein Isolate", "competitor_brand": "TitanFit", "is_yaba_asin": "Y", "price": 30.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "average_organic_rank": 10, "click_share": 0.2, "weekly_search_volume": 4578, "keywords_link": "http://amazon.com/s?k=whey protein", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "TitanFit", "clicks": 915.6}, {"week_date": "2023-10-22", "keywords": "whey protein", "asin": "B00_COMP1", "parent_asin": "P_COMP1", "product_title": "MuscleMax Gold Standard", "competitor_brand": "MuscleMax", "is_yaba_asin": "N", "price": 45.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "average_organic_rank": 2, "click_share": 0.36, "weekly_search_volume": 3503, "keywords_link": "http://amazon.com/s?k=whey protein", "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "MuscleMax", "clicks": 1261.08}, {"week_date": "2023-10-22", "keywords": "whey protein", "asin": "B00_COMP2", "parent_asin": "P_COMP2", "product_title": "GymPro Cheap Protein", "competitor_brand": "GymPro", "is_yaba_asin": "N", "price": 25.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 15, "click_share": 0.14, "weekly_search_volume": 1623, "keywords_link": "http://amazon.com/s?k=whey protein", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 3, "grams": 900, "organic_or_not": "Organic", "container": "Bag", "resolved_brand": "GymPro", "clicks": 227.22000000000003}, {"week_date": "2023-10-22", "keywords": "whey protein", "asin": "B00_UNKN", "parent_asin": "P_UNKN", "product_title": "Generic Protein Powder 1kg", "competitor_brand": null, "is_yaba_asin": "N", "price": 20.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 30, "click_share": 0.11, "weekly_search_volume": 3797, "keywords_link": "http://amazon.com/s?k=whey protein", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "Generic", "clicks": 417.67}, {"week_date": "2023-10-22", "keywords": "muscle gain supplement", "asin": "B00_OURS", "parent_asin": "P_OURS", "product_title": "TitanFit Whey Protein Isolate", "competitor_brand": "TitanFit", "is_yaba_asin": "Y", "price": 30.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "average_organic_rank": 19, "click_share": 0.02, "weekly_search_volume": 4911, "keywords_link": "http://amazon.com/s?k=muscle gain supplement", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "TitanFit", "clicks": 98.22}, {"week_date": "2023-10-22", "keywords": "muscle gain supplement", "asin": "B00_COMP1", "parent_asin": "P_COMP1", "product_title": "MuscleMax Gold Standard", "competitor_brand": "MuscleMax", "is_yaba_asin": "N", "price": 45.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 7, "average_organic_rank": 1, "click_share": 0.48, "weekly_search_volume": 2355, "keywords_link": "http://amazon.com/s?k=muscle gain supplement", "weekly_number_of_days_with_best_seller_badge": 7, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "MuscleMax", "clicks": 1130.3999999999999}, {"week_date": "2023-10-22", "keywords": "muscle gain supplement", "asin": "B00_COMP2", "parent_asin": "P_COMP2", "product_title": "GymPro Cheap Protein", "competitor_brand": "GymPro", "is_yaba_asin": "N", "price": 25.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 6, "click_share": 0.32, "weekly_search_volume": 1539, "keywords_link": "http://amazon.com/s?k=muscle gain supplement", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 3, "grams": 900, "organic_or_not": "Organic", "container": "Bag", "resolved_brand": "GymPro", "clicks": 492.48}, {"week_date": "2023-10-22", "keywords": "muscle gain supplement", "asin": "B00_UNKN", "parent_asin": "P_UNKN", "product_title": "Generic Protein Powder 1kg", "competitor_brand": null, "is_yaba_asin": "N", "price": 20.0, "weekly_number_of_days_with_deal": 0, "weekly_number_of_days_with_amazon_choice_badge": 0, "average_organic_rank": 30, "click_share": 0.15, "weekly_search_volume": 2733, "keywords_link": "http://amazon.com/s?k=muscle gain supplement", "weekly_number_of_days_with_best_seller_badge": 0, "weekly_number_of_days_with_coupon": 0, "grams": 1000, "organic_or_not": "Organic", "container": "Tub", "resolved_brand": "Generic", "clicks": 409.95}], "our_brand": "TitanFit", "top_competitors": ["MuscleMax", "GymPro", "Generic"], "insights": ["Alerta: TitanFit ha perdido cuota frente a la semana anterior.", "Competidor Principal: MuscleMax domina el mercado con una presencia constante.", "Impacto de Deals: Se detecta correlación positiva entre Deal Days y aumento de Click Share."], "recommendations": ["Ajustar precio en ASINs underperformers.", "Replicar la estrategia de Deals de la semana 3.", "Monitorizar agresivamente a MuscleMax."], "trend_summary": [{"week_date": "2023-10-01", "total_search_volume": 35814.0, "total_clicks": 8525.779999999999, "our_clicks": 3006.78, "comp_clicks": 5519.0, "our_share": 0.3526691985953192}, {"week_date": "2023-10-08", "total_search_volume": 29361.0, "total_clicks": 6730.34, "our_clicks": 1701.74, "comp_clicks": 5028.6, "our_share": 0.25284606721205766}, {"week_date": "2023-10-15", "total_search_volume": 37002.0, "total_clicks": 11092.830000000002, "our_clicks": 4712.67, "comp_clicks": 6380.16, "our_share": 0.42483928808067906}, {"week_date": "2023-10-22", "total_search_volume": 39403.0, "total_clicks": 8194.1, "our_clicks": 1617.42, "comp_clicks": 6576.679999999999, "our_share": 0.19738836479906274}]};

        // 2. GOOGLE CHARTS INIT
        google.charts.load('current', {'packages':['corechart', 'bar']});
        google.charts.setOnLoadCallback(initDashboard);

        function initDashboard() {
            drawTrendChart();
            drawCompChart();
            drawEfficiencyChart();
            populateTextContent();
            initInteractive();
        }

        // 3. CHART FUNCTIONS
        function drawTrendChart() {
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Week');
            data.addColumn('number', 'Total Clicks (Market)');
            data.addColumn('number', 'Our Click Share %');
            
            const rows = marketData.trend_summary.map(item => [
                item.week_date,
                item.total_clicks,
                item.our_share * 100 // To percentage
            ]);
            data.addRows(rows);

            const options = {
                seriesType: 'bars',
                series: {1: {type: 'line', targetAxisIndex: 1, color: '#4285F4', lineWidth: 3}},
                colors: ['#dadce0'],
                vAxes: {
                    0: {title: 'Total Clicks', textStyle: {color: '#5f6368'}},
                    1: {title: 'Share %', format: '#\'%\'', textStyle: {color: '#4285F4'}}
                },
                legend: { position: 'bottom' },
                chartArea: { width: '85%', height: '70%' },
                bar: { groupWidth: '50%' }
            };

            const chart = new google.visualization.ComboChart(document.getElementById('chart_trend'));
            chart.draw(data, options);
        }

        function drawCompChart() {
            // Processing Data for Line Chart (Week x Brands)
            const weeks = [...new Set(marketData.raw_data.map(d => d.week_date))].sort();
            const topBrands = marketData.top_competitors;
            const ourBrand = marketData.our_brand;
            
            const data = new google.visualization.DataTable();
            data.addColumn('string', 'Week');
            data.addColumn('number', ourBrand);
            topBrands.forEach(b => data.addColumn('number', b));
            data.addColumn('number', 'Rest of Market');

            const rows = [];
            weeks.forEach(week => {
                const weekData = marketData.raw_data.filter(d => d.week_date === week);
                const totalClicks = weekData.reduce((sum, d) => sum + d.clicks, 0);
                
                const getShare = (brand) => {
                    const brandClicks = weekData.filter(d => d.resolved_brand === brand).reduce((sum, d) => sum + d.clicks, 0);
                    return totalClicks ? (brandClicks / totalClicks) * 100 : 0;
                };

                const row = [week, getShare(ourBrand)];
                let topShareSum = getShare(ourBrand);
                topBrands.forEach(b => {
                    const s = getShare(b);
                    row.push(s);
                    topShareSum += s;
                });
                row.push(Math.max(0, 100 - topShareSum)); // Rest
                rows.push(row);
            });

            data.addRows(rows);

            const options = {
                curveType: 'function',
                colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853', '#9aa0a6'],
                lineWidth: 3,
                chartArea: { width: '85%', height: '70%' },
                legend: { position: 'bottom' },
                vAxis: { format: '#\'%\'' }
            };

            const chart = new google.visualization.LineChart(document.getElementById('chart_competitiveness'));
            chart.draw(data, options);
            
            // Populate Top Competitors List
            const listContainer = document.getElementById('top-competitors-list');
            topBrands.forEach((b, i) => {
                listContainer.innerHTML += `
                    <div style="padding: 12px; border-bottom: 1px solid #eee; display:flex; justify-content:space-between;">
                        <span style="font-weight:600;">#${i+1} ${b}</span>
                        <span style="color:#EA4335;">Competitor</span>
                    </div>`;
            });
        }

        function drawEfficiencyChart() {
            const data = new google.visualization.DataTable();
            data.addColumn('number', 'Organic Rank (Inverted)');
            data.addColumn('number', 'Click Share %');
            data.addColumn({type: 'string', role: 'style'}); // Color
            data.addColumn({type: 'string', role: 'tooltip'});

            // Filter for last week only
            const lastWeek = marketData.trend_summary[marketData.trend_summary.length -1].week_date;
            const weekData = marketData.raw_data.filter(d => d.week_date === lastWeek);

            const rows = weekData.map(d => {
                const isUs = d.resolved_brand === marketData.our_brand;
                const color = isUs ? '#4285F4' : '#9aa0a6';
                const opacity = isUs ? 1 : 0.6;
                return [
                    d.average_organic_rank, 
                    d.click_share * 100, 
                    `point { fill-color: ${color}; fill-opacity: ${opacity}; size: ${isUs ? 10 : 6} }`,
                    `${d.resolved_brand} | Rank: ${d.average_organic_rank} | Share: ${(d.click_share*100).toFixed(1)}%`
                ];
            });

            data.addRows(rows);

            const options = {
                hAxis: { title: 'Organic Rank (Lower is Better)', direction: -1 }, // Invert X axis so Rank 1 is right (or keep left but intuitive) -> Rank 1 is usually left. Let's keep direction 1 but label it.
                vAxis: { title: 'Click Share %' },
                legend: 'none',
                chartArea: { width: '85%', height: '70%' }
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('chart_efficiency'));
            chart.draw(data, options);
        }

        function populateTextContent() {
            // Levers Analysis (Static HTML generation based on logic)
            const container = document.getElementById('levers-analysis');
            container.innerHTML = `
                <div class="insight-item">
                    <span class="material-icons insight-icon">sell</span>
                    <div class="insight-text">
                        <strong>Price Sensitivity:</strong> Competitors priced 10-20% lower are gaining share in generic keywords.
                    </div>
                </div>
                <div class="insight-item">
                    <span class="material-icons insight-icon" style="color: #34A853;">verified</span>
                    <div class="insight-text">
                        <strong>Amazon Choice:</strong> Holding the badge correlates with a +15% increase in Click Share efficiency.
                    </div>
                </div>
                <div class="insight-item">
                    <span class="material-icons insight-icon" style="color: #4285F4;">bolt</span>
                    <div class="insight-text">
                        <strong>Deals Impact:</strong> Deal Days > 0 provided the highest lift in Week 3 (See Trend).
                    </div>
                </div>
            `;

            // Insights & Recommendations from JSON
            document.getElementById('insights-container').innerHTML = marketData.insights.map(i => 
                `<div class="insight-item"><span class="material-icons" style="font-size:18px; color:#5f6368; margin-top:2px;">arrow_right</span><div class="insight-text">${i}</div></div>`
            ).join('');

            document.getElementById('recommendations-container').innerHTML = marketData.recommendations.map(r => 
                `<div class="insight-item"><span class="material-icons" style="font-size:18px; color:#34A853; margin-top:2px;">check_circle</span><div class="insight-text">${r}</div></div>`
            ).join('');
        }

        // 4. INTERACTIVE TAB LOGIC
        function initInteractive() {
            const weeks = [...new Set(marketData.raw_data.map(d => d.week_date))].sort();
            const weekSelect = document.getElementById('weekSelect');
            weeks.forEach(w => {
                const opt = document.createElement('option');
                opt.value = w;
                opt.text = w;
                weekSelect.appendChild(opt);
            });
            weekSelect.value = weeks[weeks.length - 1]; // Default last week

            const compSelect = document.getElementById('compSelect');
            marketData.top_competitors.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.text = c;
                compSelect.appendChild(opt);
            });

            renderInteractive();
        }

        function renderInteractive() {
            const week = document.getElementById('weekSelect').value;
            const comp = document.getElementById('compSelect').value;
            const us = marketData.our_brand;

            // Filter Data
            const weekData = marketData.raw_data.filter(d => d.week_date === week);
            
            // Calculate Aggregates
            const getMetrics = (brand) => {
                const subset = weekData.filter(d => d.resolved_brand === brand);
                if (subset.length === 0) return { price: 0, rank: 0, share: 0, clicks: 0 };
                
                const clicks = subset.reduce((sum, d) => sum + d.clicks, 0);
                const avgPrice = subset.reduce((sum, d) => sum + d.price, 0) / subset.length;
                const avgRank = subset.reduce((sum, d) => sum + d.average_organic_rank, 0) / subset.length;
                
                // Share needs total market clicks for that week
                const totalWeekClicks = weekData.reduce((sum, d) => sum + d.clicks, 0);
                const share = totalWeekClicks ? clicks / totalWeekClicks : 0;

                return { price: avgPrice, rank: avgRank, share: share };
            };

            const usMetrics = getMetrics(us);
            const compMetrics = getMetrics(comp);

            // Update DOM
            const diffPrice = ((usMetrics.price - compMetrics.price) / compMetrics.price) * 100;
            const diffRank = usMetrics.rank - compMetrics.rank; // Negative is good (lower rank)
            const diffShare = (usMetrics.share - compMetrics.share) * 100;

            document.getElementById('h2h-price').innerHTML = `
                ${usMetrics.price.toFixed(2)} vs ${compMetrics.price.toFixed(2)}
                <div style="font-size:12px; color:${diffPrice > 0 ? '#EA4335' : '#34A853'}">
                    ${diffPrice > 0 ? '+' : ''}${diffPrice.toFixed(1)}% (We are ${diffPrice > 0 ? 'Exp' : 'Cheap'})
                </div>
            `;

            document.getElementById('h2h-rank').innerHTML = `
                ${usMetrics.rank.toFixed(1)} vs ${compMetrics.rank.toFixed(1)}
                <div style="font-size:12px; color:${diffRank < 0 ? '#34A853' : '#EA4335'}">
                    ${diffRank < 0 ? 'Better' : 'Worse'} by ${Math.abs(diffRank).toFixed(1)}
                </div>
            `;

             document.getElementById('h2h-share').innerHTML = `
                ${(usMetrics.share*100).toFixed(1)}% vs ${(compMetrics.share*100).toFixed(1)}%
                <div style="font-size:12px; color:${diffShare > 0 ? '#34A853' : '#EA4335'}">
                    ${diffShare > 0 ? '+' : ''}${diffShare.toFixed(1)} pts
                </div>
            `;

            // Table
            const keywords = [...new Set(weekData.map(d => d.keywords))];
            let tableHTML = `
                <table class="comp-table">
                    <thead>
                        <tr>
                            <th>Keyword</th>
                            <th>Our Rank</th>
                            <th>Comp Rank</th>
                            <th>Winner</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            keywords.forEach(kw => {
                const usKw = weekData.find(d => d.keywords === kw && d.resolved_brand === us);
                const compKw = weekData.find(d => d.keywords === kw && d.resolved_brand === comp);
                
                const uR = usKw ? usKw.average_organic_rank : '-';
                const cR = compKw ? compKw.average_organic_rank : '-';
                let winner = 'N/A';
                if (typeof uR === 'number' && typeof cR === 'number') {
                    winner = uR < cR ? `<span class="vs-badge" style="color:#34A853; background:#e6f4ea;">${us}</span>` : `<span class="vs-badge" style="color:#EA4335; background:#fce8e6;">${comp}</span>`;
                }

                tableHTML += `
                    <tr>
                        <td>${kw}</td>
                        <td class="brand-us">${uR}</td>
                        <td class="brand-them">${cR}</td>
                        <td>${winner}</td>
                    </tr>
                `;
            });
            tableHTML += '</tbody></table>';
            document.getElementById('h2h-table-container').innerHTML = tableHTML;
        }

        // Utils
        function switchTab(tabId) {
            document.getElementById('report-static').style.display = tabId === 'static' ? 'block' : 'none';
            document.getElementById('report-interactive').style.display = tabId === 'interactive' ? 'block' : 'none';
            
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }
    </script>
</body>
</html>